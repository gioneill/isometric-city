(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3302:(e,t,r)=>{"use strict";let a;r.r(t),r.d(t,{default:()=>oo});var i=r(5155),n=r(9749),l=r(2115),o=r(6469),s=r(6267),c=r(9279),d=r(1563);function h(...e){return(0,d.QP)((0,c.$)(e))}let u=(0,s.F)("inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-colors duration-150 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-primary/40 bg-transparent hover:bg-primary/10 text-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent/20 text-muted-foreground hover:text-foreground",link:"text-primary underline-offset-4 hover:underline",gold:"bg-primary text-primary-foreground hover:bg-primary/90 font-semibold"},size:{default:"h-10 px-5 py-2",sm:"h-8 px-3 text-xs",lg:"h-12 px-8 text-base",xl:"h-14 px-10 text-lg",icon:"h-10 w-10","icon-sm":"h-8 w-8"}},defaultVariants:{variant:"default",size:"default"}}),f=l.forwardRef(({className:e,variant:t,size:r,asChild:a=!1,...n},l)=>{let s=a?o.DX:"button";return(0,i.jsx)(s,{className:h(u({variant:t,size:r,className:e})),ref:l,...n})});f.displayName="Button";var m=r(4496);let g=null,p=0,x=new Map;function y(){if(g)return!0;try{return(g=new Worker(r.tu(new URL(r.p+r.u(957),r.b)))).onmessage=e=>{let{type:t,id:r,compressed:a,state:i,error:n}=e.data,l=x.get(r);l&&(clearTimeout(l.timeoutId),x.delete(r),n?l.reject(Error(n)):"serialized-compressed"===t||"serialized-compressed-uri"===t||"compressed-transferred"===t||"compressed-transferred-uri"===t?l.resolve(a):"decompressed-parsed"===t&&l.resolve(i))},g.onerror=e=>{console.error("Save worker error:",e),x.forEach(e=>{clearTimeout(e.timeoutId),e.reject(Error("Worker error"))}),x.clear(),g?.terminate(),g=null},!0}catch(e){return console.warn("Failed to create save worker, falling back to main thread:",e),!1}}async function b(e){if(!g&&!y())return(0,m.compressToUTF16)(JSON.stringify(e));let t=++p;return new Promise((r,a)=>{let i=setTimeout(()=>{if(x.get(t)){x.delete(t),console.warn("Save worker timeout, falling back to main thread");try{let t=(0,m.compressToUTF16)(JSON.stringify(e));r(t)}catch(e){a(e)}}},15e3);x.set(t,{resolve:r,reject:a,timeoutId:i});try{let r=JSON.stringify(e),a=new TextEncoder().encode(r).buffer;g.postMessage({type:"compress-transferred",id:t,buffer:a},[a])}catch(n){clearTimeout(i),x.delete(t);try{let t=(0,m.compressToUTF16)(JSON.stringify(e));r(t)}catch(e){a(e)}}})}async function w(e){if(!g&&!y())return(0,m.compressToEncodedURIComponent)(JSON.stringify(e));let t=++p;return new Promise((r,a)=>{let i=setTimeout(()=>{if(x.get(t)){x.delete(t),console.warn("Save worker timeout, falling back to main thread");try{let t=(0,m.compressToEncodedURIComponent)(JSON.stringify(e));r(t)}catch(e){a(e)}}},15e3);x.set(t,{resolve:r,reject:a,timeoutId:i});try{let r=JSON.stringify(e),a=new TextEncoder().encode(r).buffer;g.postMessage({type:"compress-transferred-uri",id:t,buffer:a},[a])}catch(n){clearTimeout(i),x.delete(t);try{let t=(0,m.compressToEncodedURIComponent)(JSON.stringify(e));r(t)}catch(e){a(e)}}})}let v=["house_small","house_medium","mansion","apartment_low","apartment_high"],_=["shop_small","shop_medium","office_low","office_high","mall"],M=["factory_small","factory_medium","warehouse","factory_large","factory_large"],S={empty:{maxPop:0,maxJobs:0,pollution:0,landValue:0},grass:{maxPop:0,maxJobs:0,pollution:0,landValue:0},water:{maxPop:0,maxJobs:0,pollution:0,landValue:5},road:{maxPop:0,maxJobs:0,pollution:2,landValue:0},bridge:{maxPop:0,maxJobs:0,pollution:1,landValue:5},rail:{maxPop:0,maxJobs:0,pollution:1,landValue:-2},tree:{maxPop:0,maxJobs:0,pollution:-5,landValue:2},house_small:{maxPop:6,maxJobs:0,pollution:0,landValue:10},house_medium:{maxPop:14,maxJobs:0,pollution:0,landValue:22},mansion:{maxPop:18,maxJobs:0,pollution:0,landValue:60},apartment_low:{maxPop:120,maxJobs:0,pollution:2,landValue:40},apartment_high:{maxPop:260,maxJobs:0,pollution:3,landValue:55},shop_small:{maxPop:0,maxJobs:10,pollution:1,landValue:16},shop_medium:{maxPop:0,maxJobs:28,pollution:2,landValue:26},office_low:{maxPop:0,maxJobs:90,pollution:2,landValue:40},office_high:{maxPop:0,maxJobs:210,pollution:3,landValue:55},mall:{maxPop:0,maxJobs:260,pollution:6,landValue:70},factory_small:{maxPop:0,maxJobs:40,pollution:15,landValue:-5},factory_medium:{maxPop:0,maxJobs:90,pollution:28,landValue:-10},factory_large:{maxPop:0,maxJobs:180,pollution:55,landValue:-18},warehouse:{maxPop:0,maxJobs:60,pollution:18,landValue:-6},police_station:{maxPop:0,maxJobs:20,pollution:0,landValue:15},fire_station:{maxPop:0,maxJobs:20,pollution:0,landValue:10},hospital:{maxPop:0,maxJobs:80,pollution:0,landValue:25},school:{maxPop:0,maxJobs:25,pollution:0,landValue:15},university:{maxPop:0,maxJobs:100,pollution:0,landValue:35},park:{maxPop:0,maxJobs:2,pollution:-10,landValue:20},park_large:{maxPop:0,maxJobs:6,pollution:-25,landValue:50},tennis:{maxPop:0,maxJobs:1,pollution:-5,landValue:15},power_plant:{maxPop:0,maxJobs:30,pollution:30,landValue:-20},water_tower:{maxPop:0,maxJobs:5,pollution:0,landValue:5},stadium:{maxPop:0,maxJobs:50,pollution:5,landValue:40},museum:{maxPop:0,maxJobs:40,pollution:0,landValue:45},airport:{maxPop:0,maxJobs:200,pollution:20,landValue:50},space_program:{maxPop:0,maxJobs:150,pollution:5,landValue:80},subway_station:{maxPop:0,maxJobs:15,pollution:0,landValue:25},rail_station:{maxPop:0,maxJobs:25,pollution:2,landValue:20},city_hall:{maxPop:0,maxJobs:60,pollution:0,landValue:50},amusement_park:{maxPop:0,maxJobs:100,pollution:8,landValue:60},basketball_courts:{maxPop:0,maxJobs:2,pollution:-3,landValue:12},playground_small:{maxPop:0,maxJobs:1,pollution:-5,landValue:15},playground_large:{maxPop:0,maxJobs:2,pollution:-8,landValue:18},baseball_field_small:{maxPop:0,maxJobs:4,pollution:-10,landValue:25},soccer_field_small:{maxPop:0,maxJobs:2,pollution:-5,landValue:15},football_field:{maxPop:0,maxJobs:8,pollution:-8,landValue:30},baseball_stadium:{maxPop:0,maxJobs:60,pollution:5,landValue:45},community_center:{maxPop:0,maxJobs:10,pollution:0,landValue:20},office_building_small:{maxPop:0,maxJobs:25,pollution:1,landValue:22},swimming_pool:{maxPop:0,maxJobs:5,pollution:-5,landValue:18},skate_park:{maxPop:0,maxJobs:2,pollution:-3,landValue:12},mini_golf_course:{maxPop:0,maxJobs:6,pollution:-8,landValue:22},bleachers_field:{maxPop:0,maxJobs:3,pollution:-5,landValue:15},go_kart_track:{maxPop:0,maxJobs:10,pollution:5,landValue:20},amphitheater:{maxPop:0,maxJobs:15,pollution:-5,landValue:35},greenhouse_garden:{maxPop:0,maxJobs:8,pollution:-15,landValue:28},animal_pens_farm:{maxPop:0,maxJobs:4,pollution:2,landValue:10},cabin_house:{maxPop:4,maxJobs:0,pollution:-3,landValue:15},campground:{maxPop:0,maxJobs:3,pollution:-8,landValue:12},marina_docks_small:{maxPop:0,maxJobs:8,pollution:2,landValue:25},pier_large:{maxPop:0,maxJobs:12,pollution:1,landValue:30},roller_coaster_small:{maxPop:0,maxJobs:20,pollution:3,landValue:40},community_garden:{maxPop:0,maxJobs:2,pollution:-12,landValue:18},pond_park:{maxPop:0,maxJobs:2,pollution:-15,landValue:22},park_gate:{maxPop:0,maxJobs:1,pollution:-2,landValue:8},mountain_lodge:{maxPop:0,maxJobs:15,pollution:-5,landValue:35},mountain_trailhead:{maxPop:0,maxJobs:2,pollution:-10,landValue:15}};var k=r(9729);let j={select:{name:(0,k.msg)("Select"),cost:0,description:(0,k.msg)("Click to view tile info")},bulldoze:{name:(0,k.msg)("Bulldoze"),cost:10,description:(0,k.msg)("Remove buildings and zones")},road:{name:(0,k.msg)("Road"),cost:25,description:(0,k.msg)("Connect your city")},rail:{name:(0,k.msg)("Rail"),cost:40,description:(0,k.msg)("Build railway tracks")},subway:{name:(0,k.msg)("Subway"),cost:50,description:(0,k.msg)("Underground transit")},expand_city:{name:(0,k.msg)("Expand City"),cost:0,description:(0,k.msg)("Add 15 tiles to each edge")},shrink_city:{name:(0,k.msg)("Shrink City"),cost:0,description:(0,k.msg)("Remove 15 tiles from each edge")},tree:{name:(0,k.msg)("Tree"),cost:15,description:(0,k.msg)("Plant trees to improve environment")},zone_residential:{name:(0,k.msg)("Residential"),cost:50,description:(0,k.msg)("Zone for housing")},zone_commercial:{name:(0,k.msg)("Commercial"),cost:50,description:(0,k.msg)("Zone for shops and offices")},zone_industrial:{name:(0,k.msg)("Industrial"),cost:50,description:(0,k.msg)("Zone for factories")},zone_dezone:{name:(0,k.msg)("De-zone"),cost:0,description:(0,k.msg)("Remove zoning")},zone_water:{name:(0,k.msg)("Water Terraform"),cost:5e4,description:(0,k.msg)("Terraform land into water")},zone_land:{name:(0,k.msg)("Land Terraform"),cost:5e4,description:(0,k.msg)("Terraform water into land")},police_station:{name:(0,k.msg)("Police"),cost:500,description:(0,k.msg)("Increase safety"),size:1},fire_station:{name:(0,k.msg)("Fire Station"),cost:500,description:(0,k.msg)("Fight fires"),size:1},hospital:{name:(0,k.msg)("Hospital"),cost:1e3,description:(0,k.msg)("Improve health (2x2)"),size:2},school:{name:(0,k.msg)("School"),cost:400,description:(0,k.msg)("Basic education (2x2)"),size:2},university:{name:(0,k.msg)("University"),cost:2e3,description:(0,k.msg)("Higher education (3x3)"),size:3},park:{name:(0,k.msg)("Small Park"),cost:150,description:(0,k.msg)("Boost happiness and land value (1x1)"),size:1},park_large:{name:(0,k.msg)("Large Park"),cost:600,description:(0,k.msg)("Large park (3x3)"),size:3},tennis:{name:(0,k.msg)("Tennis Court"),cost:200,description:(0,k.msg)("Recreation facility"),size:1},power_plant:{name:(0,k.msg)("Power Plant"),cost:3e3,description:(0,k.msg)("Generate electricity (2x2)"),size:2},water_tower:{name:(0,k.msg)("Water Tower"),cost:1e3,description:(0,k.msg)("Provide water"),size:1},subway_station:{name:(0,k.msg)("Subway Station"),cost:750,description:(0,k.msg)("Access to subway network"),size:1},rail_station:{name:(0,k.msg)("Rail Station"),cost:1e3,description:(0,k.msg)("Passenger and freight station"),size:2},stadium:{name:(0,k.msg)("Stadium"),cost:5e3,description:(0,k.msg)("Boosts commercial demand (3x3)"),size:3},museum:{name:(0,k.msg)("Museum"),cost:4e3,description:(0,k.msg)("Boosts commercial & residential demand (3x3)"),size:3},airport:{name:(0,k.msg)("Airport"),cost:1e4,description:(0,k.msg)("Boosts commercial & industrial demand (4x4)"),size:4},space_program:{name:(0,k.msg)("Space Program"),cost:15e3,description:(0,k.msg)("Boosts industrial & residential demand (3x3)"),size:3},city_hall:{name:(0,k.msg)("City Hall"),cost:6e3,description:(0,k.msg)("Boosts all demand types (2x2)"),size:2},amusement_park:{name:(0,k.msg)("Amusement Park"),cost:12e3,description:(0,k.msg)("Major boost to commercial demand (4x4)"),size:4},basketball_courts:{name:(0,k.msg)("Basketball Courts"),cost:250,description:(0,k.msg)("Outdoor basketball facility"),size:1},playground_small:{name:(0,k.msg)("Small Playground"),cost:200,description:(0,k.msg)("Children's playground"),size:1},playground_large:{name:(0,k.msg)("Large Playground"),cost:350,description:(0,k.msg)("Large playground with more equipment (2x2)"),size:2},baseball_field_small:{name:(0,k.msg)("Baseball Field"),cost:800,description:(0,k.msg)("Local baseball diamond (2x2)"),size:2},soccer_field_small:{name:(0,k.msg)("Soccer Field"),cost:400,description:(0,k.msg)("Soccer/football pitch"),size:1},football_field:{name:(0,k.msg)("Football Field"),cost:1200,description:(0,k.msg)("Football stadium (2x2)"),size:2},baseball_stadium:{name:(0,k.msg)("Baseball Stadium"),cost:6e3,description:(0,k.msg)("Professional baseball venue (3x3)"),size:3},community_center:{name:(0,k.msg)("Community Center"),cost:500,description:(0,k.msg)("Local community hub"),size:1},office_building_small:{name:(0,k.msg)("Small Office"),cost:600,description:(0,k.msg)("Small office building"),size:1},swimming_pool:{name:(0,k.msg)("Swimming Pool"),cost:450,description:(0,k.msg)("Public swimming facility"),size:1},skate_park:{name:(0,k.msg)("Skate Park"),cost:300,description:(0,k.msg)("Skateboarding park"),size:1},mini_golf_course:{name:(0,k.msg)("Mini Golf"),cost:700,description:(0,k.msg)("Miniature golf course (2x2)"),size:2},bleachers_field:{name:(0,k.msg)("Bleachers Field"),cost:350,description:(0,k.msg)("Sports field with seating"),size:1},go_kart_track:{name:(0,k.msg)("Go-Kart Track"),cost:1e3,description:(0,k.msg)("Racing entertainment (2x2)"),size:2},amphitheater:{name:(0,k.msg)("Amphitheater"),cost:1500,description:(0,k.msg)("Outdoor performance venue (2x2)"),size:2},greenhouse_garden:{name:(0,k.msg)("Greenhouse Garden"),cost:800,description:(0,k.msg)("Botanical greenhouse (2x2)"),size:2},animal_pens_farm:{name:(0,k.msg)("Animal Pens"),cost:400,description:(0,k.msg)("Petting zoo / farm animals"),size:1},cabin_house:{name:(0,k.msg)("Cabin House"),cost:300,description:(0,k.msg)("Rustic cabin retreat"),size:1},campground:{name:(0,k.msg)("Campground"),cost:250,description:(0,k.msg)("Outdoor camping area"),size:1},marina_docks_small:{name:(0,k.msg)("Marina"),cost:1200,description:(0,k.msg)("Boat docks (2x2, must be placed next to water)"),size:2},pier_large:{name:(0,k.msg)("Pier"),cost:600,description:(0,k.msg)("Waterfront pier (must be placed next to water)"),size:1},roller_coaster_small:{name:(0,k.msg)("Roller Coaster"),cost:3e3,description:(0,k.msg)("Thrill ride (2x2)"),size:2},community_garden:{name:(0,k.msg)("Community Garden"),cost:200,description:(0,k.msg)("Shared gardening space"),size:1},pond_park:{name:(0,k.msg)("Pond Park"),cost:350,description:(0,k.msg)("Park with scenic pond"),size:1},park_gate:{name:(0,k.msg)("Park Gate"),cost:150,description:(0,k.msg)("Decorative park entrance"),size:1},mountain_lodge:{name:(0,k.msg)("Mountain Lodge"),cost:1500,description:(0,k.msg)("Nature retreat lodge (2x2)"),size:2},mountain_trailhead:{name:(0,k.msg)("Trailhead"),cost:400,description:(0,k.msg)("Hiking trail entrance (3x3)"),size:3}},P=["Spring","Riverside","Harbor","Valley","Hill","Bay","Creek","Park","Lake","Mountain","Beach","Forest","Bridge","Port","View","Heights","Grove","Meadow","Ridge","Point","Falls","Brook","Pine","Oak","Maple","Cedar","Elm","Willow","Ash","Birch","Green","Blue","White","Black","Red","New","Old","East","West","North","South","Grand","Little","Big","Upper","Lower","Central","Fair","Bright","Sunny","Clear","Rock","Stone","Iron","Gold","Silver","Copper","Mill","Town","City","Ville","Burg","Field","Land","Wood"],T=["City","Town","Ville","Burg","Port","Harbor","Bay","Beach","Park","Heights","Hills","Valley","Ridge","Point","Falls","Springs","Grove","Meadow","Field","Woods","Lake","River"],C=["Pine Lake","Crystal Lake","Emerald Lake","Blue Lake","Clear Lake","Silver Lake","Golden Lake","Mountain Lake","Forest Lake","Sunset Lake","Sunrise Lake","Moon Lake","Star Lake","Mirror Lake","Reflection Lake","Tranquil Lake","Serene Lake","Peaceful Lake","Still Lake","Calm Lake","Deep Lake","Shallow Lake","Hidden Lake","Secret Lake","Lost Lake","Wild Lake","Bear Lake","Eagle Lake","Deer Lake","Wolf Lake","Trout Lake","Bass Lake","Salmon Lake","Perch Lake","Pike Lake","Lily Lake","Lotus Lake","Willow Lake","Oak Lake","Maple Lake","Cedar Lake","Birch Lake","Spruce Lake","Fir Lake","Misty Lake","Foggy Lake","Cloudy Lake","Bright Lake","Shimmer Lake","Sparkle Lake","Glitter Lake","Diamond Lake","Pearl Lake","Jade Lake"],N=["Pacific Ocean","Atlantic Ocean","Arctic Ocean","Indian Ocean","Southern Ocean","Mediterranean Sea","Caribbean Sea","North Sea","Baltic Sea","Black Sea","Red Sea","Caspian Sea","Aral Sea","Bering Sea","Sea of Japan","East China Sea","South China Sea","Yellow Sea","Philippine Sea","Coral Sea","Tasman Sea","Arabian Sea","Bay of Bengal","Gulf of Mexico","Persian Gulf","Gulf of Alaska","Hudson Bay","Baffin Bay","Davis Strait","Denmark Strait","Great Bay","Grand Bay","Royal Bay","Majestic Bay","Noble Bay","Ancient Sea","Eternal Sea","Endless Sea","Boundless Sea","Vast Sea","Infinite Sea","Crystal Sea","Emerald Sea","Sapphire Sea","Azure Sea","Turquoise Sea","Northern Sea","Southern Sea","Eastern Sea","Western Sea"];function z(e){let t="lake"===e?C:N;return t[Math.floor(Math.random()*t.length)]}var I=r(7579);let R=I.Fr?50:70;function Y(e,t,r){return"house_small"===r||"shop_small"===r||"factory_small"===r}function X(e,t,r=42){let a=43758.5453123*Math.sin(12.9898*e+78.233*t+r);return a-Math.floor(a)}function A(e,t,r){return(X(e-1,t-1,r)+X(e+1,t-1,r)+X(e-1,t+1,r)+X(e+1,t+1,r))/16+(X(e-1,t,r)+X(e+1,t,r)+X(e,t-1,r)+X(e,t+1,r))/8+X(e,t,r)/4}function O(e,t,r,a=4){let i=0,n=.05,l=1,o=0;for(let s=0;s<a;s++)i+=function(e,t,r){let a=Math.floor(e),i=e-a,n=Math.floor(t),l=t-n;return(A(a,n,r)*(1-i)+A(a+1,n,r)*i)*(1-l)+(A(a,n+1,r)*(1-i)+A(a+1,n+1,r)*i)*l}(e*n,t*n,r+100*s)*l,o+=l,l*=.5,n*=2;return i/o}let E=["marina_docks_small","pier_large"];function $(e){return E.includes(e)}function B(e,t,r,a,i,n){let l=!1,o=!1;for(let o=0;o<a;o++){let a=t+o,s=r+i;if(s<n&&e[s]?.[a]?.building.type==="water"){l=!0;break}}if(!l)for(let o=0;o<i;o++){let i=t+a,s=r+o;if(i<n&&e[s]?.[i]?.building.type==="water"){l=!0;break}}for(let i=0;i<a;i++){let a=t+i,n=r-1;if(n>=0&&e[n]?.[a]?.building.type==="water"){o=!0;break}}if(!o)for(let a=0;a<i;a++){let i=t-1,n=r+a;if(i>=0&&e[n]?.[i]?.building.type==="water"){o=!0;break}}let s=l||o,c=s&&o&&!l;return{hasWater:s,shouldFlip:c}}function L(e,t,r="grass"){return{x:e,y:t,zone:"none",building:W(r),landValue:50,pollution:0,crime:0,traffic:0,hasSubway:!1}}let V=["grass","empty","water","road","bridge","tree"];function W(e){let t=100*!!V.includes(e);return{type:e,level:+("grass"!==e&&"empty"!==e&&"water"!==e),population:0,jobs:0,powered:!1,watered:!1,onFire:!1,fireProgress:0,age:0,constructionProgress:t,abandoned:!1}}let D={small:3,medium:3,large:2,suspension:2};function F(e,t,r,a,i,n,l,o){let s=[],c=r+i,d=a+n;for(;c>=0&&c<t&&d>=0&&d<t;){let t=e[d][c];if("water"===t.building.type){if(s.push({x:c,y:d}),s.length>10)break}else if(t.building.type===o){if(s.length>0){let e=s.length,t=1===e?"small":e<=5?"large":"suspension";return{startX:r,startY:a,endX:c,endY:d,orientation:l,span:e,bridgeType:t,waterTiles:s,trackType:o}}break}else if("bridge"===t.building.type)break;else break;c+=i,d+=n}return null}function J(e){let t=()=>{let t=Array(e);for(let r=0;r<e;r++)t[r]=Array(e).fill(0);return t},r=()=>{let t=Array(e);for(let r=0;r<e;r++)t[r]=Array(e).fill(!1);return t};return{police:t(),fire:t(),health:t(),education:t(),power:r(),water:r()}}function U(){return"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function H(e=R,t="New City"){let{grid:r,waterBodies:a}=function(e){let t=[],r=1e3*Math.random();for(let r=0;r<e;r++){let a=[];for(let t=0;t<e;t++)a.push(L(t,r,"grass"));t.push(a)}let a=[...function(e,t,r){let a=(e,t)=>O(e,t,r+1e3,3),i=[],n=Math.max(8,Math.floor(.15*t)),l=Math.max(.2*t,10),o=.5,s=0;for(;i.length<2&&s<3;){i.length=0;for(let e=n;e<t-n;e++)for(let r=n;r<t-n;r++){let t=a(r,e);if(t<o){let a=!1;for(let t of i)if(Math.sqrt((r-t.x)**2+(e-t.y)**2)<l){a=!0;break}a||i.push({x:r,y:e,noise:t})}}if(i.length>=2)break;o+=.1,s++}if(0===i.length){let e=n+5,r=Math.max(e,Math.floor(t/4)),a=Math.min(t-e,Math.floor(3*t/4));i.push({x:r,y:r,noise:0},{x:a,y:a,noise:0})}else if(1===i.length){let e=i[0],r=n+5,a=Math.max(r,Math.floor(t/4)),l=Math.min(t-r,Math.floor(3*t/4)),o=e.x>t/2?a:l,s=e.y>t/2?a:l;i.push({x:o,y:s,noise:0})}i.sort((e,t)=>e.noise-t.noise);let c=2+Math.floor(2*Math.random()),d=i.slice(0,Math.min(c,i.length)),h=[],u=new Set;for(let r of d){let i=40+Math.floor(41*Math.random()),l=[{x:r.x,y:r.y}],o=[],s=[[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[-1,1],[1,-1],[1,1]];for(let[e,i]of s){let l=r.x+e,s=r.y+i;if(l>=n&&l<t-n&&s>=n&&s<t-n){let t=Math.sqrt(e*e+i*i),r=a(l,s);o.push({x:l,y:s,dist:t,noise:r})}}for(;l.length<i&&o.length>0;){o.sort((e,t)=>.5>Math.abs(e.dist-t.dist)?e.noise-t.noise:e.dist-t.dist);let i=Math.floor(Math.random()*Math.min(5,o.length)),c=o.splice(i,1)[0];if(!l.some(e=>e.x===c.x&&e.y===c.y)&&"water"!==e[c.y][c.x].building.type)for(let[e,i]of(l.push({x:c.x,y:c.y}),s)){let s=c.x+e,d=c.y+i;if(s>=n&&s<t-n&&d>=n&&d<t-n&&!l.some(e=>e.x===s&&e.y===d)&&!o.some(e=>e.x===s&&e.y===d)){let e=Math.sqrt((s-r.x)**2+(d-r.y)**2),t=a(s,d);o.push({x:s,y:d,dist:e,noise:t})}}}for(let t of l)e[t.y][t.x].building=W("water"),e[t.y][t.x].landValue=60;let c=l.reduce((e,t)=>e+t.x,0)/l.length,d=l.reduce((e,t)=>e+t.y,0)/l.length,f=z("lake");for(;u.has(f);)f=z("lake");u.add(f),h.push({id:`lake-${h.length}`,name:f,type:"lake",tiles:l,centerX:Math.round(c),centerY:Math.round(d)})}return h}(t,e,r),...function(e,t,r){let a=[],i=(e,t)=>O(e,t,r+2e3,3),n=[],l=Math.max(4,Math.floor(.12*t)),o=Math.max(4,Math.floor(.08*t)),s=Math.floor(.18*t),c=(r,a,n)=>{let c=[],d=Math.floor(t*(.05+.25*Math.random())),h=Math.floor(t*(.7+.25*Math.random()));for(let u=d;u<h;u++){let f=Math.min((u-d)/5,(h-u)/5,1),m=Math.max(1,Math.min(Math.floor((l+(.6*i(r?.08*u:.08*a,r?.08*a:.08*u)+.4*i(r?.25*u:.25*a+500,r?.25*a+500:.25*u)-.5)*o*2.5)*f),s));for(let a=0;a<m;a++){let i=r?u:1===n?a:t-1-a,l=r?1===n?a:t-1-a:u;i>=0&&i<t&&l>=0&&l<t&&"water"!==e[l][i].building.type&&(e[l][i].building=W("water"),e[l][i].landValue=60,c.push({x:i,y:l}))}}return c};if(.4>Math.random()){let e=c(!0,0,1);e.length>0&&n.push({side:"north",tiles:e})}if(.4>Math.random()){let e=c(!0,t-1,-1);e.length>0&&n.push({side:"south",tiles:e})}if(.4>Math.random()){let e=c(!1,t-1,-1);e.length>0&&n.push({side:"east",tiles:e})}if(.4>Math.random()){let e=c(!1,0,1);e.length>0&&n.push({side:"west",tiles:e})}let d=new Set;for(let e of n)if(e.tiles.length>0){let t=e.tiles.reduce((e,t)=>e+t.x,0)/e.tiles.length,r=e.tiles.reduce((e,t)=>e+t.y,0)/e.tiles.length,i=z("ocean");for(;d.has(i);)i=z("ocean");d.add(i),a.push({id:`ocean-${e.side}-${a.length}`,name:i,type:"ocean",tiles:e.tiles,centerX:Math.round(t),centerY:Math.round(r)})}return a}(t,e,r)];for(let a=0;a<e;a++)for(let i=0;i<e;i++){if("water"===t[a][i].building.type)continue;let n=O(2*i,2*a,r+500,2)>.72&&Math.random()>.65,l=function(e,t,r,a){for(let i=-2;i<=2;i++)for(let n=-2;n<=2;n++){let l=t+n,o=r+i;if(l>=0&&l<a&&o>=0&&o<a&&"water"===e[o][l].building.type)return!0}return!1}(t,i,a,e)&&Math.random()>.7;(n||l)&&(t[a][i].building=W("tree"))}return{grid:t,waterBodies:a}}(e),i=function(){let e=[],t=new Set;for(let r of["north","south","east","west"]){let a;do a=function(){let e=P[Math.floor(Math.random()*P.length)],t=P[Math.floor(Math.random()*P.length)],r=T[Math.floor(Math.random()*T.length)];return Math.random()>.5||e===t?`${e} ${r}`:`${e}${t} ${r}`}();while(t.has(a));t.add(a),e.push({id:`city-${r}`,name:a,direction:r,connected:!1,discovered:!1})}return e}(),n={id:U(),name:t,bounds:{minX:0,minY:0,maxX:e-1,maxY:e-1},economy:{population:0,jobs:0,income:0,expenses:0,happiness:50,lastCalculated:0},color:"#3b82f6"};return{id:U(),grid:r,gridSize:e,cityName:t,year:2024,month:1,day:1,hour:12,tick:0,speed:1,selectedTool:"select",taxRate:9,effectiveTaxRate:9,stats:{population:0,jobs:0,money:1e5,income:0,expenses:0,happiness:50,health:50,education:50,safety:50,environment:75,demand:{residential:50,commercial:30,industrial:40}},budget:{police:{name:"Police",funding:100,cost:0},fire:{name:"Fire",funding:100,cost:0},health:{name:"Health",funding:100,cost:0},education:{name:"Education",funding:100,cost:0},transportation:{name:"Transportation",funding:100,cost:0},parks:{name:"Parks",funding:100,cost:0},power:{name:"Power",funding:100,cost:0},water:{name:"Water",funding:100,cost:0}},services:J(e),notifications:[],advisorMessages:[],history:[],activePanel:"none",disastersEnabled:!0,adjacentCities:i,waterBodies:a,gameVersion:0,cities:[n]}}let G=(e,t)=>({range:e,rangeSquared:e*e,...t}),q={police_station:G(13,{type:"police"}),fire_station:G(18,{type:"fire"}),hospital:G(24,{type:"health"}),school:G(11,{type:"education"}),university:G(19,{type:"education"}),power_plant:G(15,{}),water_tower:G(12,{})},Q=new Set(["police_station","fire_station","hospital","school","university","power_plant","water_tower"]);function Z(e,t){let r=J(t),a=[];for(let r=0;r<t;r++)for(let i=0;i<t;i++){let t=e[r][i],n=t.building.type;Q.has(n)&&(void 0===t.building.constructionProgress||!(t.building.constructionProgress<100))&&(t.building.abandoned||a.push({x:i,y:r,type:n,level:t.building.level}))}for(let e of a){let{x:a,y:i,type:n,level:l}=e,o=q[n];if(!o)continue;let s=Math.floor(o.range*(1+(l-1)*.2)),c=s*s,d=Math.max(0,i-s),h=Math.min(t-1,i+s),u=Math.max(0,a-s),f=Math.min(t-1,a+s);if("power_plant"===n)for(let e=d;e<=h;e++)for(let t=u;t<=f;t++){let n=t-a,l=e-i;n*n+l*l<=c&&(r.power[e][t]=!0)}else if("water_tower"===n)for(let e=d;e<=h;e++)for(let t=u;t<=f;t++){let n=t-a,l=e-i;n*n+l*l<=c&&(r.water[e][t]=!0)}else{let e=r[o.type];for(let t=d;t<=h;t++)for(let r=u;r<=f;r++){let n=r-a,l=t-i,o=n*n+l*l;if(o<=c){let a=Math.max(0,(1-Math.sqrt(o)/s)*100);e[t][r]=Math.min(100,e[t][r]+a)}}}}return r}let K=new Int16Array(768),ee=new Uint8Array(16384);function et(e){let t=0,r=0;for(let a of e)for(let e of a)t+=e,r++;return r>0?t/r:0}let er={power_plant:{width:2,height:2},hospital:{width:2,height:2},school:{width:2,height:2},stadium:{width:3,height:3},museum:{width:3,height:3},university:{width:3,height:3},airport:{width:4,height:4},space_program:{width:3,height:3},park_large:{width:3,height:3},mansion:{width:2,height:2},apartment_low:{width:2,height:2},apartment_high:{width:2,height:2},office_low:{width:2,height:2},office_high:{width:2,height:2},mall:{width:3,height:3},factory_medium:{width:2,height:2},factory_large:{width:3,height:3},warehouse:{width:2,height:2},city_hall:{width:2,height:2},amusement_park:{width:4,height:4},playground_large:{width:2,height:2},baseball_field_small:{width:2,height:2},football_field:{width:2,height:2},baseball_stadium:{width:3,height:3},mini_golf_course:{width:2,height:2},go_kart_track:{width:2,height:2},amphitheater:{width:2,height:2},greenhouse_garden:{width:2,height:2},marina_docks_small:{width:2,height:2},roller_coaster_small:{width:2,height:2},mountain_lodge:{width:2,height:2},mountain_trailhead:{width:3,height:3},rail_station:{width:2,height:2}};function ea(e){return er[e]||{width:1,height:1}}function ei(e){let t=ea(e);return(24+12*Math.random())/Math.sqrt(t.width*t.height)/1.3}let en=new Set(["grass","tree"]),el={residential:new Set(["house_small","house_medium"]),commercial:new Set(["shop_small","shop_medium"]),industrial:new Set(["factory_small"]),none:new Set};function eo(e,t,r,a,i,n,l){let o=ea(a),s=S[a]||{maxPop:0,maxJobs:0,pollution:0,landValue:0};for(let c=0;c<o.height;c++)for(let d=0;d<o.width;d++){let o=e[r+c][t+d];0===d&&0===c?(o.building=W(a),o.building.level=n,o.building.age=0,l&&(o.building.powered=l.power[r+c][t+d],o.building.watered=l.water[r+c][t+d])):(o.building=W("empty"),o.building.level=0),o.zone=i,o.pollution=0===d&&0===c?s.pollution:0}return e[r][t].building}function es(e,t,r,a,i){let n=e.grid[r]?.[t];if(!n||"water"===n.building.type||"road"===a&&!["grass","tree","road","rail"].includes(n.building.type)||"rail"===a&&!["grass","tree","rail","road"].includes(n.building.type)||a&&"road"!==a&&"rail"!==a&&("road"===n.building.type||"bridge"===n.building.type)||a&&"road"!==a&&"rail"!==a&&"rail"===n.building.type)return e;let l=e.grid.map(e=>e.map(e=>({...e,building:{...e.building}})));if(null!==i)if("none"===i){let a=ec(l,t,r,e.gridSize);if(a){let t=ea(a.buildingType);for(let r=0;r<t.height;r++)for(let i=0;i<t.width;i++){let t=a.originX+i,n=a.originY+r;t<e.gridSize&&n<e.gridSize&&(l[n][t].building=W("grass"),l[n][t].zone="none")}}else{if("none"===n.zone)return e;l[r][t].zone="none",l[r][t].building=W("grass")}}else{if(!["grass","tree","road"].includes(n.building.type))return e;l[r][t].zone=i}else if(a){let i=ea(a),o=!1;if($(a)){let a=B(l,t,r,i.width,i.height,e.gridSize);if(!a.hasWater)return e;o=a.shouldFlip}if(i.width>1||i.height>1){if(!function(e,t,r,a,i,n){if(t+a>n||r+i>n)return!1;for(let n=0;n<i;n++)for(let i=0;i<a;i++){let a=e[r+n]?.[t+i];if(!a||"grass"!==a.building.type&&"tree"!==a.building.type)return!1}return!0}(l,t,r,i.width,i.height,e.gridSize))return e;eo(l,t,r,a,"none",1),o&&(l[r][t].building.flipped=!0)}else{if(!["grass","tree","road","rail"].includes(n.building.type))return e;"rail"===a&&"road"===n.building.type?l[r][t].hasRailOverlay=!0:"road"===a&&"rail"===n.building.type?(l[r][t].building=W("road"),l[r][t].hasRailOverlay=!0,l[r][t].zone="none"):"rail"===a&&n.hasRailOverlay||"road"===a&&n.hasRailOverlay||(l[r][t].building=W(a),l[r][t].zone="none","road"!==a&&(l[r][t].hasRailOverlay=!1)),o&&(l[r][t].building.flipped=!0)}}return{...e,grid:l}}function ec(e,t,r,a){let i=e[r]?.[t];if(!i)return null;if("empty"!==i.building.type&&"grass"!==i.building.type&&"water"!==i.building.type&&"road"!==i.building.type&&"bridge"!==i.building.type&&"rail"!==i.building.type&&"tree"!==i.building.type){let e=ea(i.building.type);return e.width>1||e.height>1?{originX:t,originY:r,buildingType:i.building.type}:null}if("empty"===i.building.type)for(let i=0;i<4;i++)for(let n=0;n<4;n++){let l=t-n,o=r-i;if(l>=0&&o>=0&&l<a&&o<a){let a=e[o][l];if("empty"!==a.building.type&&"grass"!==a.building.type&&"water"!==a.building.type&&"road"!==a.building.type&&"bridge"!==a.building.type&&"rail"!==a.building.type&&"tree"!==a.building.type){let e=ea(a.building.type);if(t>=l&&t<l+e.width&&r>=o&&r<o+e.height)return{originX:l,originY:o,buildingType:a.building.type}}}}return null}function ed(e,t,r,a){let i=e[a]?.[r];if(!i||"bridge"!==i.building.type)return[];let n=i.building.bridgeOrientation||"ns",l=[{x:r,y:a}],o=+("ns"===n),s=+("ns"!==n),c=r+o,d=a+s;for(;c>=0&&c<t&&d>=0&&d<t;){let t=e[d][c];if("bridge"===t.building.type&&t.building.bridgeOrientation===n)l.push({x:c,y:d}),c+=o,d+=s;else break}for(c=r-o,d=a-s;c>=0&&c<t&&d>=0&&d<t;){let t=e[d][c];if("bridge"===t.building.type&&t.building.bridgeOrientation===n)l.push({x:c,y:d}),c-=o,d-=s;else break}return l}let eh={id:"sprites4",name:"Default Theme",src:"/assets/sprites_red_water_new.png",constructionSrc:"/assets/sprites_red_water_new_construction.png",abandonedSrc:"/assets/sprites_red_water_new_abandoned.png",denseSrc:"/assets/sprites_red_water_new_dense.png",denseVariants:{apartment_high:[{row:0,col:1},{row:0,col:2},{row:0,col:3}],office_low:[{row:3,col:0},{row:3,col:1},{row:3,col:3}],office_high:[{row:1,col:0},{row:2,col:0},{row:2,col:1},{row:2,col:2}],mall:[{row:1,col:4},{row:2,col:3},{row:2,col:4},{row:3,col:0},{row:3,col:1},{row:3,col:2},{row:3,col:4}],factory_large:[{row:4,col:0},{row:4,col:2},{row:4,col:4}]},cols:5,rows:6,layout:"row",globalScale:.8,spriteOrder:["residential","commercial","industrial","fire_station","hospital","park","park_large","tennis","police_station","school","university","water_tower","power_plant","stadium","space_program","tree","house_medium","mansion","house_small","shop_medium","shop_small","warehouse","factory_small","factory_medium","factory_large","airport","subway_station","city_hall","museum","amusement_park"],verticalOffsets:{residential:-.4,commercial:-.4,industrial:-.5,factory_small:-.25,factory_medium:-.3,factory_large:-1.15,water_tower:-.5,house_medium:-.3,mansion:-.35,house_small:-.3,shop_medium:-.15,shop_small:-.3,warehouse:-.4,airport:-1.5,water:-.2,subway_station:-.4,fire_station:-.3,police_station:-.2,hospital:-.65,school:-.35,power_plant:-.3,park:-.125,park_large:-.77,tennis:-.2,city_hall:-.6,amusement_park:-1.5,space_program:-.95,university:-.55,stadium:-1.2,museum:-1,tree:-.3},horizontalOffsets:{university:0,city_hall:.1},buildingVerticalOffsets:{house_small:-.2,house_medium:-.05,office_low:-.7,office_high:-.7,mall:-1.5,apartment_low:-.9,apartment_high:-.6},constructionVerticalOffsets:{water_tower:-.1,apartment_high:-.4,apartment_low:-.5,mall:-1,office_high:-.5,office_low:-.4,hospital:-.7,tennis:-.2},constructionScales:{mall:.92,office_high:.8,apartment_high:.65,apartment_low:.8},abandonedVerticalOffsets:{apartment_low:-.45,apartment_high:-.35,house_medium:-.05,house_small:-.05,mansion:-.25,office_high:-.2,tree:-.3,factory_small:-.05},abandonedScales:{factory_large:.7},denseVerticalOffsets:{apartment_high:-.8,factory_large:-1.15,mall:-1.5,office_low:-.4,office_high:-.7},denseScales:{apartment_high:.9,office_high:1.3},modernSrc:"/assets/sprites_red_water_new_modern.png",modernVariants:{apartment_high:[{row:0,col:0},{row:0,col:1}],mall:[{row:2,col:0},{row:3,col:0},{row:3,col:3},{row:3,col:4}]},modernVerticalOffsets:{apartment_high:-.8,mall:-1.3},modernScales:{apartment_high:.9},parksSrc:"/assets/sprites_red_water_new_parks.png",parksConstructionSrc:"/assets/sprites_red_water_new_parks_construction.png",parksCols:5,parksRows:6,parksBuildings:{basketball_courts:{row:0,col:1},playground_small:{row:0,col:2},playground_large:{row:0,col:3},baseball_field_small:{row:0,col:4},soccer_field_small:{row:1,col:0},football_field:{row:1,col:1},baseball_stadium:{row:1,col:2},community_center:{row:1,col:3},office_building_small:{row:1,col:4},swimming_pool:{row:2,col:0},skate_park:{row:2,col:1},mini_golf_course:{row:2,col:2},bleachers_field:{row:2,col:3},go_kart_track:{row:2,col:4},amphitheater:{row:3,col:0},greenhouse_garden:{row:3,col:1},animal_pens_farm:{row:3,col:2},cabin_house:{row:3,col:3},campground:{row:3,col:4},marina_docks_small:{row:4,col:0},pier_large:{row:4,col:1},roller_coaster_small:{row:4,col:4},community_garden:{row:5,col:0},pond_park:{row:5,col:1},park_gate:{row:5,col:2},mountain_lodge:{row:5,col:3},mountain_trailhead:{row:5,col:4}},parksVerticalOffsets:{basketball_courts:-.25,playground_small:-.25,playground_large:-.6,baseball_field_small:-.55,soccer_field_small:-.2,football_field:-.55,baseball_stadium:-1.35,community_center:-.2,office_building_small:-.3,swimming_pool:-.2,skate_park:-.25,mini_golf_course:-.6,bleachers_field:-.2,go_kart_track:-.3,amphitheater:-.4,greenhouse_garden:-.75,animal_pens_farm:-.25,cabin_house:-.2,campground:-.15,marina_docks_small:-.45,pier_large:-.1,roller_coaster_small:-.5,community_garden:-.15,pond_park:-.15,park_gate:-.15,mountain_lodge:-.55,mountain_trailhead:-1},parksHorizontalOffsets:{},parksScales:{baseball_stadium:.81,baseball_field_small:.855,basketball_courts:.9,football_field:.855,swimming_pool:.9,soccer_field_small:.95,go_kart_track:.92,mini_golf_course:.95,amphitheater:.9,greenhouse_garden:.9},parksConstructionVerticalOffsets:{baseball_field_small:-.55,mountain_lodge:-.55},farmsSrc:"/assets/sprites_red_water_new_farm.png",farmsCols:5,farmsRows:6,farmsVariants:{factory_small:[{row:0,col:0},{row:0,col:1},{row:0,col:2},{row:0,col:3},{row:0,col:4},{row:1,col:0},{row:1,col:1},{row:1,col:2},{row:1,col:3},{row:1,col:4},{row:5,col:0},{row:5,col:1},{row:5,col:2},{row:5,col:3},{row:5,col:4}]},farmsVerticalOffsets:{factory_small:-.25},farmsHorizontalOffsets:{},farmsScales:{},shopsSrc:"/assets/sprites_red_water_new_shops.png",shopsCols:5,shopsRows:6,shopsVariants:{shop_small:[{row:0,col:0},{row:0,col:1},{row:0,col:2},{row:0,col:3},{row:0,col:4},{row:1,col:1},{row:1,col:2},{row:1,col:3},{row:1,col:4},{row:3,col:0},{row:3,col:1}],shop_medium:[{row:3,col:2},{row:3,col:4},{row:4,col:0},{row:4,col:1},{row:4,col:2},{row:4,col:3},{row:4,col:4},{row:5,col:0},{row:5,col:2}]},shopsVerticalOffsets:{shop_small:-.35,shop_medium:-.35},shopsHorizontalOffsets:{},shopsScales:{shop_small:.9,shop_medium:.9},stationsSrc:"/assets/sprites_red_water_new_stations.png",stationsCols:5,stationsRows:6,stationsVariants:{rail_station:[{row:2,col:0},{row:2,col:1},{row:2,col:2},{row:3,col:2},{row:3,col:3},{row:4,col:1},{row:4,col:2},{row:4,col:3},{row:5,col:0},{row:5,col:1}]},stationsVerticalOffsets:{rail_station:-.6},stationsHorizontalOffsets:{},stationsScales:{rail_station:.85},servicesSrc:"/assets/sprites_red_water_new_services.png",servicesCols:5,servicesRows:6,servicesVariants:{police_station:[{row:0,col:0},{row:0,col:1},{row:0,col:2},{row:0,col:3},{row:0,col:4}],fire_station:[{row:1,col:0},{row:1,col:1},{row:1,col:2},{row:1,col:3},{row:1,col:4}],hospital:[{row:2,col:0},{row:2,col:1},{row:2,col:2},{row:2,col:3},{row:2,col:4}],school:[{row:3,col:0},{row:3,col:1},{row:3,col:2},{row:3,col:3},{row:3,col:4}],university:[{row:4,col:0},{row:4,col:1},{row:4,col:2},{row:4,col:3},{row:4,col:4}],power_plant:[{row:5,col:0},{row:5,col:1},{row:5,col:2},{row:5,col:3},{row:5,col:4}]},servicesVerticalOffsets:{police_station:-.3,fire_station:-.3,hospital:-.5,school:-.3,university:-.85,power_plant:-.3},servicesHorizontalOffsets:{},servicesScales:{},infrastructureSrc:"/assets/sprites_red_water_new_services-2.png",infrastructureCols:5,infrastructureRows:6,infrastructureVariants:{water_tower:[{row:0,col:0},{row:0,col:1},{row:0,col:2},{row:0,col:3},{row:0,col:4}]},infrastructureVerticalOffsets:{water_tower:-.5},infrastructureHorizontalOffsets:{},infrastructureScales:{},mansionsSrc:"/assets/mansion_alternates.png",mansionsCols:5,mansionsRows:7,mansionsVariants:{mansion:[{row:0,col:0},{row:0,col:1},{row:0,col:2},{row:0,col:3},{row:0,col:4}]},mansionsVerticalOffsets:{mansion:-.65},mansionsScales:{mansion:.9},buildingToSprite:{house_small:"house_small",house_medium:"house_medium",mansion:"mansion",apartment_low:"residential",apartment_high:"residential",shop_small:"shop_small",shop_medium:"shop_medium",office_low:"commercial",office_high:"commercial",mall:"commercial",factory_small:"factory_small",factory_medium:"factory_medium",factory_large:"factory_large",warehouse:"warehouse",police_station:"police_station",fire_station:"fire_station",hospital:"hospital",school:"school",university:"university",park:"park",park_large:"park_large",tennis:"tennis",power_plant:"power_plant",water_tower:"water_tower",stadium:"stadium",museum:"museum",airport:"airport",space_program:"space_program",tree:"tree",water:"water",subway_station:"subway_station",city_hall:"city_hall",amusement_park:"amusement_park"}},eu={...eh,id:"sprites4-harry",name:"Harry Potter Theme",src:"/assets/sprites_red_water_new_harry.png",denseSrc:"/assets/sprites_red_water_new_harry_dense.png",modernSrc:"/assets/sprites_red_water_new_harry_dense.png",constructionSrc:"/assets/sprites_red_water_new_harry_construction.png"},ef={...eh,id:"sprites4-china",name:"Chinese Theme",src:"/assets/sprites_red_water_new_china.png"},em=[eh,eu,ef],eg="sprites4";function ep(e){return em.find(t=>t.id===e)||em[0]}let ex=em[0];ex.spriteOrder;let ey=new Proxy({},{get:(e,t)=>ex.verticalOffsets[t]??0,has:(e,t)=>t in ex.verticalOffsets}),eb=new Proxy({},{get:(e,t)=>ex.horizontalOffsets[t]??0,has:(e,t)=>t in ex.horizontalOffsets}),ew=new Proxy({},{get:(e,t)=>ex.buildingToSprite[t],has:(e,t)=>t in ex.buildingToSprite});function ev(e,t,r,a){let i,n,l=a||ex,o=l.buildingToSprite[e];if(!o)return null;let s=l.spriteOrder.indexOf(o);if(-1===s)return null;let c=Math.floor(t/l.cols),d=Math.floor(r/l.rows);"column"===l.layout?(i=Math.floor(s/l.rows),n=s%l.rows):(i=s%l.cols,n=Math.floor(s/l.cols));let h=l.id.startsWith("sprites4"),u=n*d;h&&n>0&&n<=4&&(n<=2?u+=.1*d*n:3===n?u+=.1*d:4===n&&(u+=.05*d));let f=d;return h&&(("residential"===o||"commercial"===o)&&(f=1.1*d),"space_program"===o&&(f=.92*d)),{sx:i*c,sy:u,sw:c,sh:f}}let e_="isocity-game-state",eM="isocity-saved-city",eS="isocity-saved-cities-index",ek="isocity-city-",ej="isocity-sprite-pack",eP="isocity-day-night-mode",eT=(0,l.createContext)(null);function eC(e,t,r){return Math.max(t,Math.min(r,e))}let eN={road:"road",rail:"rail",rail_station:"rail_station",tree:"tree",police_station:"police_station",fire_station:"fire_station",hospital:"hospital",school:"school",university:"university",park:"park",park_large:"park_large",tennis:"tennis",power_plant:"power_plant",water_tower:"water_tower",subway_station:"subway_station",stadium:"stadium",museum:"museum",airport:"airport",space_program:"space_program",city_hall:"city_hall",amusement_park:"amusement_park",basketball_courts:"basketball_courts",playground_small:"playground_small",playground_large:"playground_large",baseball_field_small:"baseball_field_small",soccer_field_small:"soccer_field_small",football_field:"football_field",baseball_stadium:"baseball_stadium",community_center:"community_center",office_building_small:"office_building_small",swimming_pool:"swimming_pool",skate_park:"skate_park",mini_golf_course:"mini_golf_course",bleachers_field:"bleachers_field",go_kart_track:"go_kart_track",amphitheater:"amphitheater",greenhouse_garden:"greenhouse_garden",animal_pens_farm:"animal_pens_farm",cabin_house:"cabin_house",campground:"campground",marina_docks_small:"marina_docks_small",pier_large:"pier_large",roller_coaster_small:"roller_coaster_small",community_garden:"community_garden",pond_park:"pond_park",park_gate:"park_gate",mountain_lodge:"mountain_lodge",mountain_trailhead:"mountain_trailhead"},ez={zone_residential:"residential",zone_commercial:"commercial",zone_industrial:"industrial",zone_dezone:"none"};async function eI(e){if(!e||!e.grid||!e.gridSize||!e.stats)return void console.error("Invalid game state, cannot save",{state:e,hasGrid:!!e?.grid,hasGridSize:!!e?.gridSize,hasStats:!!e?.stats});try{let t,r=((t={...e}).notifications=[],t.advisorMessages=[],t.history&&t.history.length>50&&(t.history=t.history.slice(-50)),t),a=await b(r);if(a.length>5242880)return void console.error("Compressed game state too large to save:",a.length,"chars");try{localStorage.setItem(e_,a)}catch(e){if(e instanceof DOMException&&(22===e.code||1014===e.code)){console.warn("localStorage quota exceeded, trying to free space...");try{localStorage.removeItem(eM),localStorage.removeItem("isocity_sprite_test");let e=[];for(let t=0;t<localStorage.length;t++){let r=localStorage.key(t);r&&r.startsWith("isocity_temp_")&&e.push(r)}e.forEach(e=>localStorage.removeItem(e))}catch(e){console.error("Failed to free localStorage space:",e)}try{localStorage.setItem(e_,a)}catch{console.error("localStorage still full after cleanup")}}}}catch(e){console.error("Failed to save game state:",e)}}function eR(e,t){eI(e).finally(()=>{t?.()})}function eY(){try{localStorage.removeItem(e_)}catch(e){console.error("Failed to clear game state:",e)}}function eX(e){let t=(0,m.decompressFromUTF16)(e);t||(t=e);try{return JSON.parse(t)}catch{return null}}function eA(){try{localStorage.removeItem(eM)}catch(e){console.error("Failed to clear saved city:",e)}}function eO(e){try{localStorage.setItem(eS,JSON.stringify(e))}catch(e){console.error("Failed to save cities index:",e)}}async function eE(e,t){try{let r=await b(t);if(r.length>5242880)return void console.error("Compressed city state too large to save");localStorage.setItem(ek+e,r)}catch(e){e instanceof DOMException&&(22===e.code||1014===e.code)?console.error("localStorage quota exceeded"):console.error("Failed to save city state:",e)}}function e$(e){try{let t=localStorage.getItem(ek+e);if(t){let r=(0,m.decompressFromUTF16)(t);if(!r||!r.startsWith("{"))if(!t.startsWith("{"))return console.error("Corrupted city save data for:",e),null;else r=t;let a=JSON.parse(r);if(a&&a.grid&&a.gridSize&&a.stats)return a}}catch(e){console.error("Failed to load city state:",e)}return null}function eB({children:e,startFresh:t=!1}){let[r,a]=(0,l.useState)(()=>H(R,"IsoCity")),[n,o]=(0,l.useState)(!1),[s,c]=(0,l.useState)(!1),[d,h]=(0,l.useState)(!1);(0,l.useRef)(null);let u=(0,l.useRef)(!1),f=(0,l.useRef)(!1),g=(0,l.useRef)(null),p=(0,l.useRef)(null),[x,y]=(0,l.useState)(()=>ep(eg)),[b,w]=(0,l.useState)("auto"),[k,P]=(0,l.useState)([]);(0,l.useEffect)(()=>{let e=ep(function(){try{let e=localStorage.getItem(ej);if(e&&em.some(t=>t.id===e))return e}catch(e){console.error("Failed to load sprite pack preference:",e)}return eg}());if(y(e),ex=e,w(function(){try{let e=localStorage.getItem(eP);if("auto"===e||"day"===e||"night"===e)return e}catch(e){console.error("Failed to load day/night mode preference:",e)}return"auto"}()),P(function(){try{let e=localStorage.getItem(eS);if(e){let t=JSON.parse(e);if(Array.isArray(t))return t}}catch(e){console.error("Failed to load saved cities index:",e)}return[]}()),t)o(!1);else{let e=function(){try{let e=localStorage.getItem(e_);if(e){let t=(0,m.decompressFromUTF16)(e);if(!t||!t.startsWith("{"))if(!e.startsWith("{"))return console.error("Corrupted save data detected, clearing..."),localStorage.removeItem(e_),null;else t=e;let r=JSON.parse(t);if(r&&r.grid&&Array.isArray(r.grid)&&r.gridSize&&"number"==typeof r.gridSize&&r.stats&&void 0!==r.stats.money&&void 0!==r.stats.population){if(r.grid)for(let e=0;e<r.grid.length;e++)for(let t=0;t<r.grid[e].length;t++)r.grid[e][t]?.building?.type==="park_medium"&&(r.grid[e][t].building.type="park_large");for(let e of("park_medium"===r.selectedTool&&(r.selectedTool="park_large"),r.adjacentCities||(r.adjacentCities=[]),r.adjacentCities))void 0===e.discovered&&(e.discovered=!0);if(r.waterBodies||(r.waterBodies=[]),r.cities||(r.cities=[{id:r.id||"default-city",name:r.cityName||"City",bounds:{minX:0,minY:0,maxX:(r.gridSize||50)-1,maxY:(r.gridSize||50)-1},economy:{population:r.stats?.population||0,jobs:r.stats?.jobs||0,income:r.stats?.income||0,expenses:r.stats?.expenses||0,happiness:r.stats?.happiness||50,lastCalculated:0},color:"#3b82f6"}]),void 0===r.hour&&(r.hour=12),void 0===r.effectiveTaxRate&&(r.effectiveTaxRate=r.taxRate??9),r.grid)for(let e=0;e<r.grid.length;e++)for(let t=0;t<r.grid[e].length;t++)r.grid[e][t]?.building&&void 0===r.grid[e][t].building.constructionProgress&&(r.grid[e][t].building.constructionProgress=100),r.grid[e][t]?.building&&void 0===r.grid[e][t].building.abandoned&&(r.grid[e][t].building.abandoned=!1);return void 0===r.gameVersion&&(r.gameVersion=0),r.id||(r.id="undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),r}localStorage.removeItem(e_)}}catch(e){console.error("Failed to load game state:",e);try{localStorage.removeItem(e_)}catch(e){console.error("Failed to clear corrupted game state:",e)}}return null}();e?(u.current=!0,a(e),o(!0)):o(!1)}f.current=!0,c(!0)},[t]);let T=(0,l.useRef)(0),C=(0,l.useRef)(null),N=(0,l.useRef)(!1),z=(0,l.useRef)(r);z.current=r,(0,l.useEffect)(()=>{if(f.current){if(u.current){u.current=!1,T.current=Date.now();return}N.current=!0}},[r]);let I=(0,l.useRef)(!1);(0,l.useEffect)(()=>{let e=setTimeout(()=>{f.current&&(C.current&&clearInterval(C.current),C.current=setInterval(()=>{if(u.current){u.current=!1;return}I.current||N.current&&(I.current=!0,N.current=!1,h(!0),eR(z.current,()=>{T.current=Date.now(),o(!0),h(!1),I.current=!1}))},5e3))},200);return()=>{clearTimeout(e),C.current&&clearInterval(C.current)}},[]);let X=(0,l.useRef)(0),A=(0,l.useRef)(0);(0,l.useEffect)(()=>{let e=null;return r.speed>0&&(e=setInterval(()=>{X.current++;let e=performance.now(),t=function(e){let t=e.gridSize,r=Z(e.grid,t),a=new Set,i=Array(t);for(let r=0;r<t;r++)i[r]=e.grid[r];let n=(t,r)=>(a.has(r)||(i[r]=e.grid[r].map(e=>({...e,building:{...e.building}})),a.add(r)),i[r][t]);for(let l=0;l<t;l++)for(let o=0;o<t;o++){let s=e.grid[l][o],c=s.building;if("water"===c.type)continue;let d=r.power[l][o],h=r.water[l][o],u=c.powered!==d||c.watered!==h;if(("road"===c.type||"bridge"===c.type)&&!u||"none"===s.zone&&("grass"===c.type||"tree"===c.type)&&!u&&s.pollution<.01&&0===(S[c.type]?.pollution||0)||"none"===s.zone&&100===c.constructionProgress&&!c.onFire&&"grass"!==c.type&&"tree"!==c.type&&"empty"!==c.type&&!u&&s.pollution<.01)continue;let f=n(o,l);if(f.building.powered=d,f.building.watered=h,"none"===f.zone&&void 0!==f.building.constructionProgress&&f.building.constructionProgress<100&&!V.includes(f.building.type)&&("power_plant"===f.building.type||"water_tower"===f.building.type||f.building.powered&&f.building.watered)){let e=ei(f.building.type);f.building.constructionProgress=Math.min(100,f.building.constructionProgress+e)}if("empty"===f.building.type&&(ec(i,o,l,t)||(f.building=W("grass"),f.building.powered=d,f.building.watered=h)),"none"!==f.zone&&"grass"===f.building.type){let n=function(e,t,r,a,i=8){let n=e[r][t].zone;if("none"===n)return!1;let l=Math.max(0,t-i),o=Math.min(a-1,t+i),s=Math.max(0,r-i),c=Math.min(a-1,r+i);for(let e=s;e<=c;e++)for(let t=l;t<=o;t++)ee[e*a+t]=0;let d=0,h=3;for(K[0]=t,K[1]=r,K[2]=0,ee[r*a+t]=1;d<h;){let t=K[d],r=K[d+1],l=K[d+2];if(d+=3,!(l>=i))for(let[i,o]of[[t-1,r],[t+1,r],[t,r-1],[t,r+1]]){if(i<0||i>=a||o<0||o>=a)continue;let t=o*a+i;if(ee[t])continue;ee[t]=1;let r=e[o][i];if("road"===r.building.type||"bridge"===r.building.type)return!0;r.zone===n&&"water"!==r.building.type&&h<K.length-3&&(K[h]=i,K[h+1]=o,K[h+2]=l+1,h+=3)}}return!1}(i,o,l,t),s=.05*Math.max(0,Math.min(1,((e.stats.demand?"residential"===f.zone?e.stats.demand.residential:"commercial"===f.zone?e.stats.demand.commercial:"industrial"===f.zone?e.stats.demand.industrial:0:0)+30)/80)),c=("residential"===f.zone?v:"commercial"===f.zone?_:M)[0],u=Y(o,l,c),m=d&&h;if(n&&(m||u)&&Math.random()<s){let n=ea(c);if(function(e,t,r,a,i,n,l){if(t+a>l||r+i>l)return!1;for(let l=0;l<i;l++)for(let i=0;i<a;i++){let a=e[r+l]?.[t+i];if(!a||a.zone!==n||"grass"!==a.building.type&&"tree"!==a.building.type)return!1}return!0}(i,o,l,n.width,n.height,f.zone,t)){for(let r=0;r<n.height&&l+r<t;r++)a.has(l+r)||(i[l+r]=e.grid[l+r].map(e=>({...e,building:{...e.building}})),a.add(l+r));eo(i,o,l,c,f.zone,1,r)}}}else"none"!==f.zone&&"grass"!==f.building.type&&(i[l][o].building=function(e,t,r,a,i){let n=e[r][t],l=n.building,o=n.zone;if("none"===o||"grass"===l.type||"water"===l.type||"road"===l.type||"bridge"===l.type)return l;if("empty"===l.type)return l.powered=a.power[r][t],l.watered=a.water[r][t],l.population=0,l.jobs=0,l;l.powered=a.power[r][t],l.watered=a.water[r][t];let s=l.powered,c=l.watered,d=n.landValue,h=Y(t,r,l.type);if(!h&&(!s||!c))return l;if(void 0!==l.constructionProgress&&l.constructionProgress<100){let e=ei(l.type);return l.constructionProgress=Math.min(100,l.constructionProgress+e),l.population=0,l.jobs=0,l}let u=i?"residential"===o?i.residential:"commercial"===o?i.commercial:"industrial"===o?i.industrial:0:0;if(l.abandoned){if(u>10&&Math.random()<Math.min(.12,(u-10)/600)){let i=ea(l.type);if(i.width>1||i.height>1)for(let n=0;n<i.height;n++)for(let l=0;l<i.width;l++){let i=e[r+n]?.[t+l];if(i){let e=W("grass");e.powered=a.power[r+n]?.[t+l]??!1,e.watered=a.water[r+n]?.[t+l]??!1,i.building=e}}let n=W("grass");return n.powered=l.powered,n.watered=l.watered,n}return l.population=0,l.jobs=0,l.age=(l.age||0)+.1,l}if(u<-20&&l.age>30&&Math.random()<Math.min(.02,Math.abs(u+20)/4e3)+(h?0:.005*!s+.005*!c)+.003*(l.level<=2))return l.abandoned=!0,l.population=0,l.jobs=0,l;l.age=(l.age||0)+1;let f="residential"===o?v:"commercial"===o?_:"industrial"===o?M:[],m=(a.police[r][t]+a.fire[r][t]+a.health[r][t]+a.education[r][t])/4,g=.7*Math.max(0,((i?"residential"===o?i.residential:"commercial"===o?i.commercial:"industrial"===o?i.industrial:0:0)-30)/70),p=Math.min(5,Math.max(1,Math.floor(d/24+m/28+l.age/60+g))),x=Math.min(f.length-1,p-1),y=f[x],b=t,w=r,k=.08,j=!1,P="residential"===o&&("house_small"===l.type||"house_medium"===l.type),T="commercial"===o&&("shop_small"===l.type||"shop_medium"===l.type),C="industrial"===o&&"factory_small"===l.type,N=i?"residential"===o?i.residential:"commercial"===o?i.commercial:"industrial"===o?i.industrial:0:0;if(N>30&&(P||T||C)&&(k+=Math.min(.25,(N-30)/300),N>70&&(k+=.05,j=!0)),s&&c&&l.age>12&&(p>l.level||y!==l.type)&&Math.random()<k){let i=ea(y),n=function(e,t,r,a,i,n,l,o){let s=[],c={x:t,y:r};for(let d=r-(i-1);d<=r;d++)for(let h=t-(a-1);h<=t;h++){if(!function(e,t,r,a,i,n,l,o,s){if(t<0||r<0||t+a>l||r+i>l)return!1;for(let l=0;l<i;l++)for(let i=0;i<a;i++){var c;if(c=e[r+l][t+i],o&&c.x===o.x&&c.y===o.y?c.zone!==n||!!c.building.onFire||"water"===c.building.type||"road"===c.building.type:c.zone!==n||!!c.building.onFire||"water"===c.building.type||"road"===c.building.type||"bridge"===c.building.type||!(en.has(c.building.type)||s&&el[n]?.has(c.building.type)))return!1}return!0}(e,h,d,a,i,n,l,c,o)||t<h||t>=h+a||r<d||r>=d+i)continue;let u=function(e,t,r,a,i,n){let l=0,o=[[-1,0],[1,0],[0,-1],[0,1]];for(let s=0;s<i;s++)for(let i=0;i<a;i++){let a=t+i,c=r+s;for(let[t,r]of o){let i=a+t,o=c+r;if(i>=0&&o>=0&&i<n&&o<n){let t=e[o][i].building.type;("road"===t||"bridge"===t)&&l++}}}return l-a*i*.25}(e,h,d,a,i,l);s.push({originX:h,originY:d,score:u})}return 0===s.length?null:(s.sort((e,t)=>t.score-e.score),{originX:s[0].originX,originY:s[0].originY})}(e,t,r,i.width,i.height,o,e.length,j);n?(eo(e,n.originX,n.originY,y,o,p,a).level=p,b=n.originX,w=n.originY):p>l.level&&(l.level=Math.min(p,l.level+1))}let z=e[w][b].building;z.powered=a.power[w][b],z.watered=a.water[w][b],z.level=Math.max(z.level,Math.min(p,z.level+1));let I=S[z.type],R=.5*!!z.powered+.5*!!z.watered;return z.population=I?.maxPop>0?Math.floor(I.maxPop*Math.max(1,z.level)*R*.8):0,z.jobs=I?.maxJobs>0?Math.floor(I.maxJobs*Math.max(1,z.level)*R*.8):0,e[r][t].building}(i,o,l,r,e.stats.demand));let m=S[f.building.type];if(f.pollution=Math.max(0,.95*f.pollution+(m?.pollution||0)),e.disastersEnabled&&f.building.onFire&&(Math.random()<r.fire[l][o]/300?(f.building.onFire=!1,f.building.fireProgress=0):(f.building.fireProgress+=2/3,f.building.fireProgress>=100&&(f.building=W("grass"),f.zone="none"))),e.disastersEnabled&&!f.building.onFire&&"grass"!==f.building.type&&"water"!==f.building.type&&"road"!==f.building.type&&"tree"!==f.building.type&&"empty"!==f.building.type&&"bridge"!==f.building.type&&"rail"!==f.building.type){let e=0;for(let[r,a]of[[-1,0],[1,0],[0,-1],[0,1]]){let n=o+r,s=l+a;n>=0&&n<t&&s>=0&&s<t&&i[s][n].building.onFire&&e++}e>0&&Math.random()<.005*e*(1-.95*(r.fire[l][o]/100))&&(f.building.onFire=!0,f.building.fireProgress=0)}e.disastersEnabled&&!f.building.onFire&&"grass"!==f.building.type&&"water"!==f.building.type&&"road"!==f.building.type&&"tree"!==f.building.type&&"empty"!==f.building.type&&3e-5>Math.random()&&(f.building.onFire=!0,f.building.fireProgress=0)}let l=function(e,t){let r={...t},a=0,i=0,n=0,l=0,o=0,s=0,c=0,d=0,h=0,u=0,f=0;for(let t of e)for(let e of t)switch(e.hasSubway&&u++,e.building.type){case"police_station":a++;break;case"fire_station":i++;break;case"hospital":n++;break;case"school":l++;break;case"university":o++;break;case"park":case"park_large":case"tennis":s++;break;case"power_plant":c++;break;case"water_tower":d++;break;case"road":h++;break;case"subway_station":f++}return r.police.cost=50*a,r.fire.cost=50*i,r.health.cost=100*n,r.education.cost=30*l+100*o,r.transportation.cost=2*h+3*u+25*f,r.parks.cost=10*s,r.power.cost=150*c,r.water.cost=75*d,r}(i,e.budget),o=e.taxRate-e.effectiveTaxRate,s=e.effectiveTaxRate+.03*o,c=function(e,t,r,a,i,n){let l,o=0,s=0,c=0,d=0,h=0,u=0,f=0,m=0,g=0,p=0,x=!1,y=!1,b=!1,w=0,v=0,_=!1;for(let r=0;r<t;r++)for(let a=0;a<t;a++){let t=e[r][a],i=t.building,n=i.jobs;t.hasSubway&&"commercial"===t.zone&&(n=Math.floor(1.15*n)),o+=i.population,s+=n,c+=t.pollution,t.landValue,"residential"===t.zone||"commercial"===t.zone?"grass"!==i.type&&i.type:"industrial"===t.zone&&"grass"!==i.type&&i.type,"tree"===i.type&&d++,"water"===i.type&&h++,("park"===i.type||"park_large"===i.type)&&u++,"tennis"===i.type&&u++,t.hasSubway&&f++,"subway_station"===i.type&&m++,("rail"===i.type||t.hasRailOverlay)&&g++,"rail_station"===i.type&&p++,(void 0===i.constructionProgress||i.constructionProgress>=100)&&("airport"===i.type&&(x=!0),"city_hall"===i.type&&(y=!0),"space_program"===i.type&&(b=!0),"stadium"===i.type&&w++,"museum"===i.type&&v++,"amusement_park"===i.type&&(_=!0))}let M=Math.max(0,1-(i-9)/91),S=(9-i)*2,k=Math.min(15,8*v),j=Math.min(100,Math.max(-100,((s-.7*o)/18+8*!!y+10*!!b+Math.min(10,5*v))*M+S)),P=Math.min(100,Math.max(-100,((.3*o-.3*s)/4+Math.min(20,.5*f+3*m)+15*!!x+10*!!y+Math.min(20,12*w)+k+18*!!_+Math.min(12,.15*g+4*p))*M+.8*S)),T=Math.min(100,Math.max(-100,((.35*o-.3*s)/2+10*!!x+5*!!y+20*!!b+Math.min(18,.25*g+6*p))*M+.5*S)),C=Math.floor(o*a*.1+s*a*.05);l=0+Math.floor(r.police.cost*r.police.funding/100)+Math.floor(r.fire.cost*r.fire.funding/100)+Math.floor(r.health.cost*r.health.funding/100)+Math.floor(r.education.cost*r.education.funding/100)+Math.floor(r.transportation.cost*r.transportation.funding/100)+Math.floor(r.parks.cost*r.parks.funding/100)+Math.floor(r.power.cost*r.power.funding/100)+Math.floor(r.water.cost*r.water.funding/100);let N=et(n.police),z=et(n.fire),I=et(n.health),R=et(n.education),Y=Math.min(100,.7*N+.3*z),X=Math.min(100,.8*I+(100-c/(t*t))*.2),A=Math.min(100,R),O=Math.min(100,Math.max(0,(d+h+u)/(t*t)*200-c/(t*t*100)*100+50)),E=Math.min(100,.15*Y+.2*X+.15*A+.15*O+.2*(s>=o?100:s/(o||1)*100)+(100-3*a)*.15);return{population:o,jobs:s,money:0,income:C,expenses:l,happiness:E,health:X,education:A,safety:Y,environment:O,demand:{residential:j,commercial:P,industrial:T}}}(i,t,l,e.taxRate,s,r);c.money=e.stats.money;let d=e.stats.demand;d&&(c.demand.residential=d.residential+(c.demand.residential-d.residential)*.12,c.demand.commercial=d.commercial+(c.demand.commercial-d.commercial)*.12,c.demand.industrial=d.industrial+(c.demand.industrial-d.industrial)*.12);let h=e.year,u=e.month,f=e.day,m=e.tick+1,g=Math.floor(((e.year-2024)*10800+(e.month-1)*900+(e.day-1)*30+m)%450/450*24);m>=30&&(m=0,++f%7==0&&(c.money+=Math.floor((c.income-c.expenses)/4))),f>30&&(f=1,u++),u>12&&(u=1,h++);let p=function(e,t,r){let a=[],i=0,n=0,l=0,o=0,s=0,c=0;for(let e of r)for(let t of e)"none"!==t.zone&&"grass"!==t.building.type&&(!t.building.powered&&i++,!t.building.watered&&n++),t.building.abandoned&&(l++,"residential"===t.zone?o++:"commercial"===t.zone?s++:"industrial"===t.zone&&c++);i>0&&a.push({name:"Power Advisor",icon:"power",messages:[`${i} buildings lack power. Build more power plants!`],priority:i>10?"high":"medium"}),n>0&&a.push({name:"Water Advisor",icon:"water",messages:[`${n} buildings lack water. Build water towers!`],priority:n>10?"high":"medium"});let d=e.income-e.expenses;d<0&&a.push({name:"Finance Advisor",icon:"cash",messages:[`City is running a deficit of $${Math.abs(d)}/month. Consider raising taxes or cutting services.`],priority:d<-500?"critical":"high"}),e.safety<40&&a.push({name:"Safety Advisor",icon:"shield",messages:["Crime is on the rise. Build more police stations to protect citizens."],priority:e.safety<20?"critical":"high"}),e.health<50&&a.push({name:"Health Advisor",icon:"hospital",messages:["Health services are lacking. Build hospitals to improve citizen health."],priority:e.health<30?"high":"medium"}),e.education<50&&a.push({name:"Education Advisor",icon:"education",messages:["Education levels are low. Build schools and universities."],priority:e.education<30?"high":"medium"}),e.environment<40&&a.push({name:"Environment Advisor",icon:"environment",messages:["Pollution is high. Plant trees and build parks to improve air quality."],priority:e.environment<20?"high":"medium"});let h=e.jobs/(e.population||1);if(e.population>100&&h<.8&&a.push({name:"Employment Advisor",icon:"jobs",messages:["Unemployment is high. Zone more commercial and industrial areas."],priority:h<.5?"high":"medium"}),l>0){let e=[];o>0&&e.push(`${o} residential`),s>0&&e.push(`${s} commercial`),c>0&&e.push(`${c} industrial`),a.push({name:"Urban Planning Advisor",icon:"planning",messages:[`${l} abandoned building${l>1?"s":""} in your city (${e.join(", ")}).`,"Oversupply has caused buildings to become vacant.","Increase demand by growing your city or wait for natural redevelopment."],priority:l>10?"high":l>5?"medium":"low"})}return a}(c,0,i),x=[...e.notifications];for(;x.length>10;)x.pop();let y=[...e.history];if(u%3==0&&1===f&&0===m)for(y.push({year:h,month:u,population:c.population,money:c.money,happiness:c.happiness});y.length>100;)y.shift();return{...e,grid:i,year:h,month:u,day:f,hour:g,tick:m,effectiveTaxRate:s,stats:c,budget:l,services:r,advisorMessages:p,notifications:x,history:y}}(z.current);z.current=t,N.current=!0,e-A.current>=500&&(A.current=e,a(t))},window.innerWidth<768||/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?1===r.speed?750:2===r.speed?450:300:1===r.speed?500:2===r.speed?300:200)),()=>{e&&clearInterval(e)}},[r.speed]);let E=(0,l.useCallback)(e=>{a(t=>({...t,selectedTool:e,activePanel:"none"}))},[]),$=(0,l.useCallback)(e=>{a(t=>({...t,speed:e}))},[]),B=(0,l.useCallback)(e=>{a(t=>({...t,taxRate:eC(e,0,100)}))},[]),J=(0,l.useCallback)(e=>{a(t=>({...t,activePanel:e}))},[]),U=(0,l.useCallback)((e,t)=>{let r=eC(t,0,100);a(t=>({...t,budget:{...t.budget,[e]:{...t.budget[e],funding:r}}}))},[]),G=(0,l.useCallback)((e,t,r=!1)=>{let i=z.current.selectedTool;a(r=>{let a,i=r.selectedTool;if("select"===i)return r;let n=j[i],l=n?.cost??0,o=r.grid[t]?.[e];if(!o||l>0&&r.stats.money<l||"bulldoze"===i&&"grass"===o.building.type&&"none"===o.zone)return r;let s=eN[i],c=ez[i];if(c&&o.zone===c||s&&o.building.type===s)return r;if("subway"===i){if("water"===o.building.type||o.hasSubway)return r;let a=function(e,t,r){let a=e.grid[r]?.[t];if(!a||"water"===a.building.type||a.hasSubway)return e;let i=e.grid.map(e=>e.map(e=>({...e,building:{...e.building}})));return i[r][t].hasSubway=!0,{...e,grid:i}}(r,e,t);return a===r?r:{...a,stats:{...a.stats,money:a.stats.money-l}}}if("zone_water"===i){if("water"===o.building.type||"bridge"===o.building.type)return r;let a=function(e,t,r){let a=e.grid[r]?.[t];if(!a||"water"===a.building.type||"bridge"===a.building.type)return e;let i=e.grid.map(e=>e.map(e=>({...e,building:{...e.building}}))),n=ec(i,t,r,e.gridSize);if(n){let t=ea(n.buildingType);for(let r=0;r<t.height;r++)for(let a=0;a<t.width;a++){let t=n.originX+a,l=n.originY+r;t<e.gridSize&&l<e.gridSize&&(i[l][t].building=W("grass"),i[l][t].zone="none")}}return i[r][t].building=W("water"),i[r][t].zone="none",i[r][t].hasSubway=!1,{...e,grid:i}}(r,e,t);return a===r?r:{...a,stats:{...a.stats,money:a.stats.money-l}}}if("zone_land"===i){if("water"!==o.building.type)return r;let a=function(e,t,r){let a=e.grid[r]?.[t];if(!a||"water"!==a.building.type)return e;let i=e.grid.map(e=>e.map(e=>({...e,building:{...e.building}})));return i[r][t].building=W("grass"),i[r][t].zone="none",{...e,grid:i}}(r,e,t);return a===r?r:{...a,stats:{...a.stats,money:a.stats.money-l}}}if("bulldoze"===i)a=function(e,t,r){let a=e.grid[r]?.[t];if(!a||"water"===a.building.type)return e;let i=e.grid.map(e=>e.map(e=>({...e,building:{...e.building}})));if("bridge"===a.building.type){for(let a of ed(i,e.gridSize,t,r))i[a.y][a.x].building=W("water"),i[a.y][a.x].zone="none",i[a.y][a.x].hasRailOverlay=!1;return{...e,grid:i}}if("road"===a.building.type){let a=function(e,t,r,a){for(let{dx:i,dy:n}of[{dx:-1,dy:0},{dx:1,dy:0},{dx:0,dy:-1},{dx:0,dy:1}]){let l=r+i,o=a+n;if(l>=0&&l<t&&o>=0&&o<t){let r=e[o][l];if("bridge"===r.building.type){let a=r.building.bridgePosition;if("start"===a||"end"===a)return ed(e,t,l,o)}}}return[]}(i,e.gridSize,t,r);if(a.length>0){for(let e of(i[r][t].building=W("grass"),i[r][t].zone="none",i[r][t].hasRailOverlay=!1,a))i[e.y][e.x].building=W("water"),i[e.y][e.x].zone="none",i[e.y][e.x].hasRailOverlay=!1;return{...e,grid:i}}}let n=ec(i,t,r,e.gridSize);if(n){let t=ea(n.buildingType);for(let r=0;r<t.height;r++)for(let a=0;a<t.width;a++){let t=n.originX+a,l=n.originY+r;t<e.gridSize&&l<e.gridSize&&(i[l][t].building=W("grass"),i[l][t].zone="none",i[l][t].hasRailOverlay=!1)}}else i[r][t].building=W("grass"),i[r][t].zone="none",i[r][t].hasRailOverlay=!1;return{...e,grid:i}}(r,e,t);else if(c)a=es(r,e,t,null,c);else{if(!s)return r;a=es(r,e,t,s,null)}return a===r?r:(l>0&&(a={...a,stats:{...a.stats,money:a.stats.money-l}}),a)}),!r&&"select"!==i&&g.current&&g.current({x:e,y:t,tool:i})},[]),q=(0,l.useCallback)((e,t)=>{let r=!1;return a(a=>{let i=function(e,t,r){let a=e.grid[r]?.[t];if(!a)return null;let i=a.building,n=i.type;if(!Q.has(n)||i.level>=5||void 0!==i.constructionProgress&&i.constructionProgress<100||i.abandoned)return null;let l=j[n]?.cost;if(!l)return null;let o=l*Math.pow(2,i.level);if(e.stats.money<o)return null;let s=e.grid.map(e=>e.map(e=>({...e,building:{...e.building}})));s[r][t].building.level=i.level+1;let c={...e.stats,money:e.stats.money-o},d=Z(s,e.gridSize);return{...e,grid:s,stats:c,services:d}}(a,e,t);return i?(r=!0,i):a}),r},[]),er=(0,l.useCallback)((e,t,r=!1)=>{a(r=>(function(e,t,r="road"){if(0===t.length||!t.some(t=>{let r=e.grid[t.y]?.[t.x];return r&&"water"===r.building.type}))return e;let a=e.grid.map(e=>e.map(e=>({...e,building:{...e.building}})));for(let i of t)a[i.y]?.[i.x]?.building.type===r&&function(e,t,r,a,i){let n,l,o,s=function(e,t,r,a,i){let n=e[a]?.[r];if(!n||n.building.type!==i)return null;let l=F(e,t,r,a,-1,0,"ns",i);if(l)return l;let o=F(e,t,r,a,1,0,"ns",i);if(o)return o;let s=F(e,t,r,a,0,-1,"ew",i);if(s)return s;let c=F(e,t,r,a,0,1,"ew",i);return c||null}(e,t,r,a,i);s&&(n=(31*s.waterTiles[0].x+17*s.waterTiles[0].y)%100%D[s.bridgeType],o=(l=[...s.waterTiles].sort((e,t)=>"ns"===s.orientation?e.x!==t.x?e.x-t.x:e.y-t.y:e.y!==t.y?e.y-t.y:e.x-t.x)).length,l.forEach((t,r)=>{let a;a=0===r?"start":r===l.length-1?"end":"middle",e[t.y][t.x].building=function(e,t,r,a,i,n,l="road"){return{type:"bridge",level:0,population:0,jobs:0,powered:!0,watered:!0,onFire:!1,fireProgress:0,age:0,constructionProgress:100,abandoned:!1,bridgeType:e,bridgeOrientation:t,bridgeVariant:r,bridgePosition:a,bridgeIndex:i,bridgeSpan:n,bridgeTrackType:l}}(s.bridgeType,s.orientation,n,a,r,o,s.trackType),e[t.y][t.x].zone="none"}))}(a,e.gridSize,i.x,i.y,r);return{...e,grid:a}})(r,e,t)),!r&&p.current&&p.current({pathTiles:e,trackType:t})},[]),eh=(0,l.useCallback)(e=>{a(t=>{let r=t.adjacentCities.find(t=>t.id===e);if(!r||r.connected)return t;let a=t.adjacentCities.map(t=>t.id===e?{...t,connected:!0,discovered:!0}:t);return{...t,adjacentCities:a,stats:{...t.stats,money:t.stats.money+5e3,income:t.stats.income+200},notifications:[{id:`city-connect-${Date.now()}`,title:"City Connected!",description:`Trade route established with ${r.name}. +$5000 bonus and +$200/month income.`,icon:"road",timestamp:Date.now()},...t.notifications.slice(0,9)]}})},[]),eu=(0,l.useCallback)(e=>{a(t=>{let r=t.adjacentCities.find(t=>t.id===e);if(!r||r.discovered)return t;let a=t.adjacentCities.map(t=>t.id===e?{...t,discovered:!0}:t);return{...t,adjacentCities:a,notifications:[{id:`city-discover-${Date.now()}`,title:"City Discovered!",description:`Your road has reached the ${r.direction} border! You can now connect to ${r.name}.`,icon:"road",timestamp:Date.now()},...t.notifications.slice(0,9)]}})},[]),ef=(0,l.useCallback)(e=>{a(t=>{let r=function(e,t,r){let a=[];for(let i of r)!i.connected&&function(e,t,r){switch(r){case"north":for(let r=0;r<t;r++){let t=e[0][r].building.type;if("road"===t||"bridge"===t)return!0}return!1;case"south":for(let r=0;r<t;r++){let a=e[t-1][r].building.type;if("road"===a||"bridge"===a)return!0}return!1;case"east":for(let r=0;r<t;r++){let a=e[r][t-1].building.type;if("road"===a||"bridge"===a)return!0}return!1;case"west":for(let r=0;r<t;r++){let t=e[r][0].building.type;if("road"===t||"bridge"===t)return!0}return!1}}(e,t,i.direction)&&!i.discovered&&a.push(i);return a}(t.grid,t.gridSize,t.adjacentCities);if(0===r.length)return t;let a=r[0],i=t.adjacentCities.map(e=>e.id===a.id?{...e,discovered:!0}:e);return e&&setTimeout(()=>{e({id:a.id,direction:a.direction,name:a.name})},0),{...t,adjacentCities:i}})},[]),ey=(0,l.useCallback)(e=>{a(t=>({...t,disastersEnabled:e}))},[]),eb=(0,l.useCallback)(e=>{g.current=e},[]),ew=(0,l.useCallback)(e=>{p.current=e},[]),ev=(0,l.useCallback)(e=>{let t=ep(e);y(t),ex=t;try{localStorage.setItem(ej,e)}catch(e){console.error("Failed to save sprite pack preference:",e)}},[]),eI=(0,l.useCallback)(e=>{w(e);try{localStorage.setItem(eP,e)}catch(e){console.error("Failed to save day/night mode preference:",e)}},[]),eB="auto"===b?r.hour:"day"===b?12:22,eL=(0,l.useCallback)((e,t)=>{eY();let r=H(t??R,e||"IsoCity");a(e=>({...r,gameVersion:(e.gameVersion??0)+1}))},[]),eV=(0,l.useCallback)(e=>{try{let t=JSON.parse(e);if(t&&t.grid&&Array.isArray(t.grid)&&t.gridSize&&"number"==typeof t.gridSize&&t.stats&&void 0!==t.stats.money&&void 0!==t.stats.population){for(let e of(t.adjacentCities||(t.adjacentCities=[]),t.adjacentCities))void 0===e.discovered&&(e.discovered=!0);if(t.waterBodies||(t.waterBodies=[]),t.cities||(t.cities=[{id:t.id||"default-city",name:t.cityName||"City",bounds:{minX:0,minY:0,maxX:(t.gridSize||50)-1,maxY:(t.gridSize||50)-1},economy:{population:t.stats?.population||0,jobs:t.stats?.jobs||0,income:t.stats?.income||0,expenses:t.stats?.expenses||0,happiness:t.stats?.happiness||50,lastCalculated:0},color:"#3b82f6"}]),void 0===t.effectiveTaxRate&&(t.effectiveTaxRate=t.taxRate??9),t.grid)for(let e=0;e<t.grid.length;e++)for(let r=0;r<t.grid[e].length;r++)t.grid[e][r]?.building&&void 0===t.grid[e][r].building.constructionProgress&&(t.grid[e][r].building.constructionProgress=100),t.grid[e][r]?.building&&void 0===t.grid[e][r].building.abandoned&&(t.grid[e][r].building.abandoned=!1);return a(e=>({...t,gameVersion:(e.gameVersion??0)+1})),!0}return!1}catch{return!1}},[]),eW=(0,l.useCallback)(()=>JSON.stringify(r),[r]),eD=(0,l.useCallback)(()=>{eY();let e=function(e=R,t="Metropolis"){let r=H(e,t),a=r.grid,i=(e,t)=>{let r=a[t]?.[e];r&&"water"!==r.building.type&&(r.building=n("road"),r.zone="none")};function n(e){return{type:e,level:"grass"===e||"empty"===e||"water"===e||"road"===e||"bridge"===e?0:Math.floor(3*Math.random())+3,population:0,jobs:0,powered:!0,watered:!0,onFire:!1,fireProgress:0,age:Math.floor(100*Math.random())+50,constructionProgress:100,abandoned:!1}}let l=(e,t,r,i)=>{let l=a[t]?.[e];if(l&&"water"!==l.building.type&&"road"!==l.building.type){l.zone=r,l.building=n(i),l.building.level=Math.floor(3*Math.random())+3;let e=S[i];e&&(l.building.population=Math.floor(e.maxPop*l.building.level*.7),l.building.jobs=Math.floor(e.maxJobs*l.building.level*.7))}},o=(t,r,i,l="none")=>{let o=ea(i);if(!((e,t,r,i)=>{for(let n=0;n<i;n++)for(let i=0;i<r;i++){let r=a[t+n]?.[e+i];if(!r||"water"===r.building.type)return!1}return!0})(t,r,o.width,o.height)||t+o.width>e||r+o.height>e)return!1;for(let e=0;e<o.height;e++)for(let i=0;i<o.width;i++){let n=a[r+e][t+i].building.type;if("road"===n||"bridge"===n)return!1}for(let e=0;e<o.height;e++)for(let s=0;s<o.width;s++){let o=a[r+e][t+s];if(o.zone=l,0===s&&0===e){o.building=n(i);let e=S[i];e&&(o.building.population=Math.floor(e.maxPop*o.building.level*.8),o.building.jobs=Math.floor(e.maxJobs*o.building.level*.8))}else o.building=n("empty"),o.building.level=0}return!0},s=Math.floor(e/2),c=Math.floor(e/2),d=Math.floor(.35*e),h=6+Math.floor(3*Math.random());for(let t=c-d;t<=c+d;t+=h)if(!(t<2)&&!(t>=e-2))for(let r=Math.max(2,s-d);r<=Math.min(e-3,s+d);r++)i(r,t);for(let t=s-d;t<=s+d;t+=h)if(!(t<2)&&!(t>=e-2))for(let r=Math.max(2,c-d);r<=Math.min(e-3,c+d);r++)i(t,r);let u=d-5;for(let t=0;t<2*Math.PI;t+=.08){let r=Math.round(s+Math.cos(t)*u),a=Math.round(c+Math.sin(t)*u);r>=2&&r<e-2&&a>=2&&a<e-2&&i(r,a)}for(let e of[{type:"power_plant",count:4+Math.floor(3*Math.random())},{type:"water_tower",count:8+Math.floor(4*Math.random())},{type:"police_station",count:6+Math.floor(4*Math.random())},{type:"fire_station",count:6+Math.floor(4*Math.random())},{type:"hospital",count:3+Math.floor(2*Math.random())},{type:"school",count:5+Math.floor(3*Math.random())},{type:"university",count:2+Math.floor(2*Math.random())}]){let t=0,r=0;for(;t<e.count&&r<500;)o(s-d+Math.floor(Math.random()*d*2),c-d+Math.floor(Math.random()*d*2),e.type)&&t++,r++}for(let e of["city_hall","stadium","museum","airport","space_program","amusement_park","baseball_stadium","amphitheater","community_center"]){let t=0;for(;t<200&&!o(s-d+Math.floor(Math.random()*d*2),c-d+Math.floor(Math.random()*d*2),e);)t++}let f=["park","park_large","tennis","basketball_courts","playground_small","playground_large","swimming_pool","skate_park","community_garden","pond_park"];for(let e=0;e<25+Math.floor(15*Math.random());e++){let e=f[Math.floor(Math.random()*f.length)],t=0;for(;t<100&&!o(s-d+Math.floor(Math.random()*d*2),c-d+Math.floor(Math.random()*d*2),e);)t++}for(let t=0;t<e;t++)for(let r=0;r<e;r++){let e,i,n=a[t][r];if("grass"!==n.building.type&&"tree"!==n.building.type)continue;let h=Math.sqrt((r-s)**2+(t-c)**2);if(h>d)continue;let u=!1;for(let e=-2;e<=2&&!u;e++)for(let i=-2;i<=2&&!u;i++){let n=a[t+e]?.[r+i],l=n?.building.type;("road"===l||"bridge"===l)&&(u=!0)}if(!u)continue;let f=h/d,m=Math.random();if(f<.3)if(m<.6){e="commercial";let t=["shop_small","shop_medium","office_low","office_high","mall"];i=t[Math.floor(Math.random()*t.length)]}else{e="residential";let t=["apartment_low","apartment_high"];i=t[Math.floor(Math.random()*t.length)]}else if(f<.6)if(m<.5){e="residential";let t=["house_medium","mansion","apartment_low"];i=t[Math.floor(Math.random()*t.length)]}else if(m<.8){e="commercial";let t=["shop_small","shop_medium","office_low"];i=t[Math.floor(Math.random()*t.length)]}else e="industrial",i="factory_small";else if(m<.5){e="residential";let t=["house_small","house_medium"];i=t[Math.floor(Math.random()*t.length)]}else if(m<.7){e="industrial";let t=["factory_small","factory_medium","warehouse"];i=t[Math.floor(Math.random()*t.length)]}else e="commercial",i="shop_small";let g=ea(i);g.width>1||g.height>1?o(r,t,i,e):l(r,t,e,i)}for(let t=0;t<e;t++)for(let r=0;r<e;r++){let e=a[t][r];"grass"===e.building.type&&.15>Math.random()&&(e.building=n("tree"))}for(let e=c-Math.floor(.6*d);e<=c+Math.floor(.6*d);e++)for(let t=s-Math.floor(.6*d);t<=s+Math.floor(.6*d);t++){let r=a[e]?.[t];r&&"water"!==r.building.type&&(t%h==s%h||e%h==c%h)&&.7>Math.random()&&(r.hasSubway=!0)}let m=2*h;for(let e=c-d;e<=c+d;e+=m)for(let t=s-d;t<=s+d;t+=m){let r=a[e]?.[t];r&&"grass"===r.building.type&&"none"===r.zone&&(r.building=n("subway_station"),r.hasSubway=!0)}let g=Z(a,e);for(let t=0;t<e;t++)for(let r=0;r<e;r++)a[t][r].building.powered=g.power[t][r],a[t][r].building.watered=g.water[t][r];let p=0,x=0;for(let t=0;t<e;t++)for(let r=0;r<e;r++){let e=a[t][r].building;p+=e.population,x+=e.jobs}return{...r,grid:a,cityName:t,year:2024+Math.floor(50*Math.random()),month:Math.floor(12*Math.random())+1,day:Math.floor(28*Math.random())+1,hour:12,tick:0,speed:1,selectedTool:"select",taxRate:7+Math.floor(4*Math.random()),effectiveTaxRate:8,stats:{population:p,jobs:x,money:5e5+Math.floor(1e6*Math.random()),income:Math.floor(.8*p+.4*x),expenses:Math.floor((p+x)*.3),happiness:65+Math.floor(20*Math.random()),health:60+Math.floor(25*Math.random()),education:55+Math.floor(30*Math.random()),safety:60+Math.floor(25*Math.random()),environment:50+Math.floor(30*Math.random()),demand:{residential:20+Math.floor(40*Math.random()),commercial:15+Math.floor(35*Math.random()),industrial:10+Math.floor(30*Math.random())}},services:g,notifications:[],advisorMessages:[],history:[],activePanel:"none",disastersEnabled:!0}}(R);a(t=>({...e,gameVersion:(t.gameVersion??0)+1}))},[]),eF=(0,l.useCallback)(()=>{a(e=>{let{grid:t,newSize:r}=function(e,t,r=15){let a=t+2*r,i=[],n=(r,a)=>!(r<0)&&!(a<0)&&!(r>=t)&&!(a>=t)&&"water"===e[a][r].building.type,l=(e,a)=>{let i=e-r,n=a-r,l=0;return i<0&&(l=Math.max(l,-i)),n<0&&(l=Math.max(l,-n)),i>=t&&(l=Math.max(l,i-t+1)),n>=t&&(l=Math.max(l,n-t+1)),l},o=(e,a,i=10)=>{let l=e-r,o=a-r,s=0,c=0,d=0,h=0;if(l<0){d=0;for(let e=-i;e<=i;e++)n(0,Math.max(0,Math.min(t-1,o+e)))?(s++,h=Math.max(h,++d)):d=0,c++}if(l>=t){d=0;for(let e=-i;e<=i;e++){let r=Math.max(0,Math.min(t-1,o+e));n(t-1,r)?(s++,h=Math.max(h,++d)):d=0,c++}}if(o<0){d=0;for(let e=-i;e<=i;e++)n(Math.max(0,Math.min(t-1,l+e)),0)?(s++,h=Math.max(h,++d)):d=0,c++}if(o>=t){d=0;for(let e=-i;e<=i;e++)n(Math.max(0,Math.min(t-1,l+e)),t-1)?(s++,h=Math.max(h,++d)):d=0,c++}let u=c>0?s/c:0,f=u>.7&&h>=i;return{density:u,isSea:f}},s=Date.now()%1e5;for(let n=0;n<a;n++){let c=[];for(let i=0;i<a;i++){let d=i-r,h=n-r;if(d>=0&&h>=0&&d<t&&h<t){let t=e[h][d];c.push({...t,x:i,y:n,building:{...t.building}})}else{let e=l(i,n),{density:t,isSea:d}=o(i,n),h=O(.12*i,.12*n,s,3),u=!1;d?u=!(2>=Math.min(i,n,a-1-i,a-1-n))||h>.2:t>.3&&(u=Math.max(0,1-Math.pow(e/(r*(.5+.3*h+.4*t)),1.3))*t>.12+.18*h),u?c.push(L(i,n,"water")):.12>O(.3*i,.3*n,s+500,2)?c.push(L(i,n,"tree")):c.push(L(i,n,"grass"))}}i.push(c)}let c=(e,t,r=1)=>{let n=0;for(let l=-r;l<=r;l++)for(let o=-r;o<=r;o++){if(0===o&&0===l)continue;let r=e+o,s=t+l;r>=0&&s>=0&&r<a&&s<a&&"water"===i[s][r].building.type&&n++}return n},d=(e,a)=>{let i=e-r,n=a-r;return i<0||n<0||i>=t||n>=t};for(let e=0;e<4;e++){let e=[];for(let t=0;t<a;t++)for(let r=0;r<a;r++){if(!d(r,t))continue;let a="water"===i[t][r].building.type,n=c(r,t,1),l=c(r,t,2);a?n<=1&&e.push({x:r,y:t,toWater:!1}):n>=5?e.push({x:r,y:t,toWater:!0}):n>=4&&l>=16&&e.push({x:r,y:t,toWater:!0})}for(let t of e)if(t.toWater)i[t.y][t.x].building=W("water");else{let e=O(.3*t.x,.3*t.y,s+1e3,2);i[t.y][t.x].building=W(e<.15?"tree":"grass")}}for(let e=0;e<a;e++)for(let t=0;t<a;t++){if(!d(t,e))continue;let r="water"===i[e][t].building.type,a=c(t,e,1);if(r&&a<=1){let r=O(.3*t,.3*e,s+2e3,2);i[e][t].building=W(r<.15?"tree":"grass")}else!r&&a>=6&&(i[e][t].building=W("water"))}let h=(e,t)=>O(e,t,s+3e3,3),u=Math.max(.25*r,4),f=Math.max(.15*r,3),m=[];for(let e=2;e<a-2;e++)for(let t=2;t<a-2;t++){if(!d(t,e)||"water"===i[e][t].building.type)continue;let r=h(t,e);if(r<.35){let a=!1;for(let r of m)if(Math.sqrt((t-r.x)**2+(e-r.y)**2)<u){a=!0;break}a||m.push({x:t,y:e,noise:r})}}m.sort((e,t)=>e.noise-t.noise);let g=Math.min(m.length,4+Math.floor(5*Math.random())),p=m.slice(0,g),x=[],y=(e,t)=>O(e,t,s+4e3,2);for(let e=2;e<a-2;e++)for(let t=2;t<a-2;t++){if(!d(t,e)||"water"===i[e][t].building.type)continue;let r=y(t,e);if(r<.45){let a=!1;for(let r of p)if(Math.sqrt((t-r.x)**2+(e-r.y)**2)<u){a=!0;break}if(a)continue;let i=!1;for(let r of x)if(Math.sqrt((t-r.x)**2+(e-r.y)**2)<f){i=!0;break}i||x.push({x:t,y:e,noise:r})}}x.sort((e,t)=>e.noise-t.noise);let b=Math.min(x.length,10+Math.floor(11*Math.random())),w=x.slice(0,b),v=[...p.map(e=>({...e,isBig:!0})),...w.map(e=>({...e,isBig:!1}))],_=[[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[-1,1],[1,-1],[1,1]];for(let e of v){let t=e.isBig?25+Math.floor(46*Math.random()):4+Math.floor(12*Math.random()),r=[{x:e.x,y:e.y}],n=[];for(let[t,r]of _){let l=e.x+t,o=e.y+r;if(l>=1&&l<a-1&&o>=1&&o<a-1&&"water"!==i[o][l].building.type){let e=Math.sqrt(t*t+r*r),a=h(l,o);n.push({x:l,y:o,dist:e,noise:a})}}for(;r.length<t&&n.length>0;){n.sort((e,t)=>.5>Math.abs(e.dist-t.dist)?e.noise-t.noise:e.dist-t.dist);let t=Math.floor(Math.random()*Math.min(5,n.length)),l=n.splice(t,1)[0];if(!r.some(e=>e.x===l.x&&e.y===l.y)&&"water"!==i[l.y][l.x].building.type)for(let[t,o]of(r.push({x:l.x,y:l.y}),_)){let s=l.x+t,c=l.y+o;if(s>=1&&s<a-1&&c>=1&&c<a-1&&"water"!==i[c][s].building.type&&!r.some(e=>e.x===s&&e.y===c)&&!n.some(e=>e.x===s&&e.y===c)){let t=Math.sqrt((s-e.x)**2+(c-e.y)**2),r=h(s,c);n.push({x:s,y:c,dist:t,noise:r})}}}for(let e of r)i[e.y][e.x].building=W("water"),i[e.y][e.x].landValue=60}if(.4>Math.random()){let e=1+Math.floor(3*Math.random());for(let t=0;t<e;t++){let e=0,r=0,n=0,l=0,o=!1;for(let t=0;t<50&&!o;t++){let t=2+Math.floor(Math.random()*(a-4)),n=2+Math.floor(Math.random()*(a-4));if(d(t,n)&&"water"===i[n][t].building.type){let l=!1;for(let[o,s]of[[-1,0],[1,0],[0,-1],[0,1]]){let c=t+o,d=n+s;if(c>=0&&d>=0&&c<a&&d<a&&"water"!==i[d][c].building.type){l=!0,e=c,r=d;break}}l&&(o=!0)}}if(!o){switch(Math.floor(4*Math.random())){case 0:e=2+Math.floor(Math.random()*(a-4)),r=2;break;case 1:e=2+Math.floor(Math.random()*(a-4)),r=a-2-1;break;case 2:e=2,r=2+Math.floor(Math.random()*(a-4));break;case 3:e=a-2-1,r=2+Math.floor(Math.random()*(a-4))}if(!d(e,r))continue;o=!0}if(!o)continue;n=a/2+(Math.random()-.5)*a*.6,l=a/2+(Math.random()-.5)*a*.6;let c=e,h=r,u=15+Math.floor(25*Math.random()),f=1+Math.floor(2*Math.random());for(let e=0;e<u;e++){for(let e=0;e<f;e++){let t=c+e%2,r=h+Math.floor(e/2);t>=0&&r>=0&&t<a&&r<a&&d(t,r)&&(i[r][t].building=W("water"))}let r=O(.2*c,.2*h,s+5e3+100*t,2),o=Math.atan2(l-h,n-c)+(r-.5)*Math.PI*.8,u=Math.round(c+Math.cos(o)),m=Math.round(h+Math.sin(o));if(u<1||m<1||u>=a-1||m>=a-1||!d(u,m)||"water"===i[m][u].building.type&&e>5)break;c=u,h=m}}}return{grid:i,newSize:a}}(e.grid,e.gridSize,15),a=t=>{let a=(()=>{let e=[];for(let t=0;t<r;t++)e.push(Array(r).fill(0));return e})();if(t&&Array.isArray(t))for(let r=0;r<e.gridSize;r++){let i=t[r];if(i&&Array.isArray(i))for(let t=0;t<e.gridSize;t++){let e=i[t];"number"==typeof e&&(a[r+15][t+15]=e)}}return a},i=t=>{let a=(()=>{let e=[];for(let t=0;t<r;t++)e.push(Array(r).fill(!1));return e})();if(t&&Array.isArray(t))for(let r=0;r<e.gridSize;r++){let i=t[r];if(i&&Array.isArray(i))for(let t=0;t<e.gridSize;t++){let e=i[t];"boolean"==typeof e&&(a[r+15][t+15]=e)}}return a};return{...e,grid:t,gridSize:r,services:{power:i(e.services.power),water:i(e.services.water),fire:a(e.services.fire),police:a(e.services.police),health:a(e.services.health),education:a(e.services.education)},bounds:{minX:0,minY:0,maxX:r-1,maxY:r-1},gameVersion:(e.gameVersion??0)+1}})},[]),eJ=(0,l.useCallback)(()=>{let e=!1;return a(t=>{let r=function(e,t,r=15){let a=t-2*r;if(a<20)return null;let i=[];for(let t=0;t<a;t++){let n=[];for(let i=0;i<a;i++){let a=i+r,l=e[t+r][a];n.push({...l,x:i,y:t,building:{...l.building}})}i.push(n)}return{grid:i,newSize:a}}(t.grid,t.gridSize,15);if(!r)return t;e=!0;let{grid:a,newSize:i}=r,n=e=>{let t=(()=>{let e=[];for(let t=0;t<i;t++)e.push(Array(i).fill(0));return e})();if(e&&Array.isArray(e))for(let r=0;r<i;r++){let a=e[r+15];if(a&&Array.isArray(a))for(let e=0;e<i;e++){let i=a[e+15];"number"==typeof i&&(t[r][e]=i)}}return t},l=e=>{let t=(()=>{let e=[];for(let t=0;t<i;t++)e.push(Array(i).fill(!1));return e})();if(e&&Array.isArray(e))for(let r=0;r<i;r++){let a=e[r+15];if(a&&Array.isArray(a))for(let e=0;e<i;e++){let i=a[e+15];"boolean"==typeof i&&(t[r][e]=i)}}return t};return{...t,grid:a,gridSize:i,services:{power:l(t.services.power),water:l(t.services.water),fire:n(t.services.fire),police:n(t.services.police),health:n(t.services.health),education:n(t.services.education)},bounds:{minX:0,minY:0,maxX:i-1,maxY:i-1},gameVersion:(t.gameVersion??0)+1}}),e},[]),eU=(0,l.useCallback)(e=>{a(t=>({...t,stats:{...t.stats,money:t.stats.money+e}}))},[]),eH=(0,l.useCallback)((e,t,r)=>{a(a=>{let i=[{id:`cheat-${Date.now()}-${Math.random()}`,title:e,description:t,icon:r,timestamp:Date.now()},...a.notifications];for(;i.length>10;)i.pop();return{...a,notifications:i}})},[]),eG=(0,l.useCallback)(()=>{try{let e={state:r,info:{cityName:r.cityName,population:r.stats.population,money:r.stats.money,savedAt:Date.now()}},t=(0,m.compressToUTF16)(JSON.stringify(e));localStorage.setItem(eM,t)}catch(e){console.error("Failed to save city for restore:",e)}},[r]),eq=(0,l.useCallback)(()=>{let e=function(){try{let e=localStorage.getItem(eM);if(e){let t=eX(e);if(t?.state&&t.state.grid&&t.state.gridSize&&t.state.stats)return t.state}}catch(e){console.error("Failed to load saved city state:",e)}return null}();return!!e&&(u.current=!0,a(e),eA(),!0)},[]),eQ=(0,l.useCallback)(()=>(function(){try{let e=localStorage.getItem(eM);if(e){let t=eX(e);if(t?.info)return t.info}}catch(e){console.error("Failed to load saved city info:",e)}return null})(),[]),eZ=(0,l.useCallback)(()=>{eA()},[]),eK=(0,l.useCallback)(()=>{let e={id:r.id,cityName:r.cityName,population:r.stats.population,money:r.stats.money,year:r.year,month:r.month,gridSize:r.gridSize,savedAt:Date.now()};eE(r.id,r),P(t=>{let a,i=t.findIndex(e=>e.id===r.id);return i>=0?(a=[...t])[i]=e:a=[...t,e],a.sort((e,t)=>t.savedAt-e.savedAt),eO(a),a})},[r]),e0=(0,l.useCallback)(e=>{let t=e$(e);if(!t)return!1;for(let r of(t.id||(t.id=e),t.adjacentCities||(t.adjacentCities=[]),t.adjacentCities))void 0===r.discovered&&(r.discovered=!0);if(t.waterBodies||(t.waterBodies=[]),t.cities||(t.cities=[{id:t.id||"default-city",name:t.cityName||"City",bounds:{minX:0,minY:0,maxX:(t.gridSize||50)-1,maxY:(t.gridSize||50)-1},economy:{population:t.stats?.population||0,jobs:t.stats?.jobs||0,income:t.stats?.income||0,expenses:t.stats?.expenses||0,happiness:t.stats?.happiness||50,lastCalculated:0},color:"#3b82f6"}]),void 0===t.effectiveTaxRate&&(t.effectiveTaxRate=t.taxRate??9),t.grid)for(let e=0;e<t.grid.length;e++)for(let r=0;r<t.grid[e].length;r++)t.grid[e][r]?.building&&void 0===t.grid[e][r].building.constructionProgress&&(t.grid[e][r].building.constructionProgress=100),t.grid[e][r]?.building&&void 0===t.grid[e][r].building.abandoned&&(t.grid[e][r].building.abandoned=!1);return u.current=!0,a(e=>({...t,gameVersion:(e.gameVersion??0)+1})),eR(t),!0},[]),e1=(0,l.useCallback)(e=>{try{localStorage.removeItem(ek+e)}catch(e){console.error("Failed to delete city state:",e)}P(t=>{let r=t.filter(t=>t.id!==e);return eO(r),r})},[]),e2=(0,l.useCallback)((e,t)=>{let i=e$(e);i&&(i.cityName=t,eE(e,i)),P(r=>{let a=r.map(r=>r.id===e?{...r,cityName:t}:r);return eO(a),a}),r.id===e&&a(e=>({...e,cityName:t}))},[r.id]);return(0,i.jsx)(eT.Provider,{value:{state:r,latestStateRef:z,setTool:E,setSpeed:$,setTaxRate:B,setActivePanel:J,setBudgetFunding:U,placeAtTile:G,upgradeServiceBuilding:q,setPlaceCallback:eb,finishTrackDrag:er,setBridgeCallback:ew,connectToCity:eh,discoverCity:eu,checkAndDiscoverCities:ef,setDisastersEnabled:ey,newGame:eL,loadState:eV,exportState:eW,generateRandomCity:eD,expandCity:eF,shrinkCity:eJ,hasExistingGame:n,isStateReady:s,isSaving:d,addMoney:eU,addNotification:eH,currentSpritePack:x,availableSpritePacks:em,setSpritePack:ev,dayNightMode:b,setDayNightMode:eI,visualHour:eB,saveCurrentCityForRestore:eG,restoreSavedCity:eq,getSavedCityInfo:eQ,clearSavedCity:eZ,savedCities:k,saveCity:eK,loadSavedCity:e0,deleteSavedCity:e1,renameSavedCity:e2},children:e})}function eL(){let e=(0,l.useContext)(eT);if(!e)throw Error("useGame must be used within a GameProvider");return e}var eV=r(6230);let eW=["Red","Blue","Green","Golden","Silver","Purple","Orange","Pink","Swift","Brave","Clever","Happy","Lucky","Cosmic","Mighty","Gentle","Wild","Calm","Bold","Bright","Fluffy","Speedy","Tiny","Giant"],eD=["Panda","Fox","Wolf","Bear","Eagle","Owl","Tiger","Lion","Falcon","Dolphin","Otter","Koala","Penguin","Rabbit","Deer","Hawk","Lynx","Raven","Cobra","Crane","Shark","Whale","Badger","Moose"];var eF=r(2402);let eJ=eF.env.NEXT_PUBLIC_SUPABASE_URL,eU=eF.env.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY,eH=eJ&&eU?(0,eV.UU)(eJ,eU):null;class eG extends Error{constructor(e,t=0x1400000){super(`City size (${(e/1048576).toFixed(2)}MB) exceeds maximum allowed size (${(t/1048576).toFixed(0)}MB)`),this.name="CitySizeLimitError",this.sizeBytes=e,this.limitBytes=t}}function eq(e){let t=e.length;if(t>0x1400000)throw new eG(t)}async function eQ(e,t,r){if(!eH)return!1;try{let a=await w(r);eq(a);let{error:i}=await eH.from("game_rooms").insert({room_code:e.toUpperCase(),city_name:t,game_state:a,player_count:1});if(i)return console.error("[Database] Failed to create room:",i),!1;return!0}catch(e){if(e instanceof eG)throw e;return console.error("[Database] Error creating room:",e),!1}}async function eZ(e){if(!eH)return null;try{let{data:t,error:r}=await eH.from("game_rooms").select("game_state, city_name").eq("room_code",e.toUpperCase()).single();if(r||!t)return console.error("[Database] Failed to load room:",r),null;let a=(0,m.decompressFromEncodedURIComponent)(t.game_state);if(!a)return console.error("[Database] Failed to decompress state"),null;return{gameState:JSON.parse(a),cityName:t.city_name}}catch(e){return console.error("[Database] Error loading room:",e),null}}async function eK(e,t){if(!eH)return!1;try{let r=await w(t);eq(r);let{error:a}=await eH.from("game_rooms").update({game_state:r}).eq("room_code",e.toUpperCase());if(a)return console.error("[Database] Failed to update room:",a),!1;return!0}catch(e){if(e instanceof eG)throw e;return console.error("[Database] Error updating room:",e),!1}}async function e0(e,t){if(eH)try{await eH.from("game_rooms").update({player_count:t}).eq("room_code",e.toUpperCase())}catch(e){console.error("[Database] Error updating player count:",e)}}var e1=r(2402);let e2=e1.env.NEXT_PUBLIC_SUPABASE_URL,e5=e1.env.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY,e3=e2&&e5?(0,eV.UU)(e2,e5):null;class e4{constructor(e){if(this.players=new Map,this.gameState=null,this.destroyed=!1,this.hasReceivedInitialState=!1,this.lastStateSave=0,this.pendingStateSave=null,this.saveTimeout=null,!e3)throw Error("Multiplayer requires Supabase configuration");this.options=e,this.roomCode=e.roomCode,this.peerId=`player-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,this.gameState=e.initialGameState||null,this.isCreator=!!e.initialGameState,this.player={id:this.peerId,name:e.playerName||function(){let e=eW[Math.floor(Math.random()*eW.length)],t=eD[Math.floor(Math.random()*eD.length)];return`${e}${t}`}(),color:function(){let e=["#ef4444","#f97316","#eab308","#22c55e","#14b8a6","#3b82f6","#8b5cf6","#ec4899"];return e[Math.floor(Math.random()*e.length)]}(),joinedAt:Date.now(),isHost:!1},this.players.set(this.peerId,this.player),this.channel=e3.channel(`room-${e.roomCode}`,{config:{presence:{key:this.peerId},broadcast:{self:!1}}})}async connect(){if(!this.destroyed){if(this.isCreator&&this.gameState){this.hasReceivedInitialState=!0;try{if(!await eQ(this.roomCode,this.options.cityName,this.gameState))throw this.options.onError?.((0,k.msg)("Failed to create room in database")),Error((0,k.msg)("Failed to create room in database"))}catch(e){throw e instanceof eG&&this.options.onError?.(e.message),e}}else{let e=await eZ(this.roomCode);if(!e)throw this.options.onError?.((0,k.msg)("Room not found")),Error((0,k.msg)("Room not found"));this.gameState=e.gameState,this.options.onStateReceived?.(e.gameState)}this.channel.on("presence",{event:"sync"},()=>{let e=this.channel.presenceState();this.players.clear(),this.players.set(this.peerId,this.player),Object.entries(e).forEach(([e,t])=>{if(e!==this.peerId&&t.length>0){let r=t[0];r.player&&this.players.set(e,r.player)}}),this.notifyPlayersChange(),this.updateConnectionStatus(),e0(this.roomCode,this.players.size)}).on("presence",{event:"join"},({key:e,newPresences:t})=>{if(e!==this.peerId&&t.length>0){let r=t[0];r.player&&(this.players.set(e,r.player),this.notifyPlayersChange(),this.updateConnectionStatus(),this.gameState&&setTimeout(()=>{!this.destroyed&&this.gameState&&this.channel.send({type:"broadcast",event:"state-sync",payload:{state:this.gameState,to:e,from:this.peerId}})},200*Math.random()))}}).on("presence",{event:"leave"},({key:e})=>{this.players.delete(e),this.notifyPlayersChange(),this.updateConnectionStatus(),e0(this.roomCode,this.players.size)}).on("broadcast",{event:"action"},({payload:e})=>{e&&e.type&&e.playerId?e.playerId!==this.peerId&&this.options.onAction&&this.options.onAction(e):console.warn("[Multiplayer] Received invalid action payload:",e)}).on("broadcast",{event:"state-sync"},({payload:e})=>{let{state:t,to:r,from:a}=e;r===this.peerId&&!this.isCreator&&!this.hasReceivedInitialState&&a!==this.peerId&&t&&this.options.onStateReceived&&(this.hasReceivedInitialState=!0,this.gameState=t,this.options.onStateReceived(t))}),await this.channel.subscribe(async e=>{"SUBSCRIBED"===e&&(await this.channel.track({player:this.player}),this.options.onConnectionChange&&this.options.onConnectionChange(!0,this.players.size),this.notifyPlayersChange())})}}dispatchAction(e){if(this.destroyed)return;let t={...e,timestamp:Date.now(),playerId:this.peerId};this.channel.send({type:"broadcast",event:"action",payload:t})}updateGameState(e){this.gameState=e;let t=Date.now()-this.lastStateSave;t>=3e3?this.saveStateToDatabase(e):(this.pendingStateSave=e,this.saveTimeout||(this.saveTimeout=setTimeout(()=>{this.saveTimeout=null,this.pendingStateSave&&!this.destroyed&&(this.saveStateToDatabase(this.pendingStateSave),this.pendingStateSave=null)},3e3-t)))}saveStateToDatabase(e){this.lastStateSave=Date.now(),eK(this.roomCode,e).catch(e=>{e instanceof eG?(console.warn("[Multiplayer] City too large to save:",e.message),this.options.onError?.(e.message)):console.error("[Multiplayer] Failed to save state to database:",e)})}updateConnectionStatus(){this.options.onConnectionChange&&this.options.onConnectionChange(!0,this.players.size)}notifyPlayersChange(){this.options.onPlayersChange&&this.options.onPlayersChange(Array.from(this.players.values()))}destroy(){this.destroyed||(this.destroyed=!0,this.pendingStateSave&&(this.saveStateToDatabase(this.pendingStateSave),this.pendingStateSave=null),this.saveTimeout&&(clearTimeout(this.saveTimeout),this.saveTimeout=null),this.channel.unsubscribe(),e3?.removeChannel(this.channel))}}async function e9(e){let t=new e4(e);return await t.connect(),t}let e6=(0,l.createContext)(null);function e8(e){let t,r,a,o,s,c,d,h,u,f,m,g=(0,n.c)(24),{children:p}=e,x=(0,k.useGT)(),[y,b]=(0,l.useState)("disconnected"),[w,v]=(0,l.useState)(null);g[0]===Symbol.for("react.memo_cache_sentinel")?(t=[],g[0]=t):t=g[0];let[_,M]=(0,l.useState)(t),[S,j]=(0,l.useState)(null),[P,T]=(0,l.useState)(null),[C,N]=(0,l.useState)(null),[z,I]=(0,l.useState)(null),R=(0,l.useRef)(null),Y=(0,l.useRef)(null);g[1]===Symbol.for("react.memo_cache_sentinel")?(r=e=>{Y.current=e,I(e)},g[1]=r):r=g[1];let X=r;g[2]!==x?(a=async(e,t)=>{b("connecting"),j(null);try{let r=function(){let e="ABCDEFGHJKLMNPQRSTUVWXYZ23456789",t="";for(let r=0;r<5;r++)t+=e[Math.floor(Math.random()*e.length)];return t}(),a=await e9({roomCode:r,cityName:e,initialGameState:t,onConnectionChange:e=>{b(e?"connected":"disconnected")},onPlayersChange:e=>{M(e)},onAction:e=>{Y.current&&Y.current(e)},onError:e=>{j(e),b("error")}});return R.current=a,N(a),v(r),b("connected"),r}catch(e){throw b("error"),j(e instanceof Error?e.message:x("Failed to create room")),e}},g[2]=x,g[3]=a):a=g[3];let A=a;g[4]!==x?(o=async e=>{b("connecting"),j(null);try{let t=e.toUpperCase(),r=await e9({roomCode:t,cityName:x("Co-op City"),onConnectionChange:e=>{b(e?"connected":"disconnected")},onPlayersChange:e=>{M(e)},onAction:e=>{Y.current&&Y.current(e)},onStateReceived:e=>{T(e)},onError:e=>{j(e),b("error")}});return R.current=r,N(r),v(t),b("connected"),{code:t,hostId:"",cityName:x("Co-op City"),createdAt:Date.now(),playerCount:1}}catch(e){throw b("error"),j(e instanceof Error?e.message:x("Failed to join room")),e}},g[4]=x,g[5]=o):o=g[5];let O=o;g[6]===Symbol.for("react.memo_cache_sentinel")?(s=()=>{R.current&&(R.current.destroy(),R.current=null),N(null),b("disconnected"),v(null),M([]),j(null),T(null)},g[6]=s):s=g[6];let E=s;g[7]===Symbol.for("react.memo_cache_sentinel")?(c=e=>{R.current&&R.current.dispatchAction(e)},g[7]=c):c=g[7];let $=c;g[8]===Symbol.for("react.memo_cache_sentinel")?(d=e=>{R.current&&R.current.updateGameState(e)},g[8]=d):d=g[8];let B=d;g[9]===Symbol.for("react.memo_cache_sentinel")?(h=()=>()=>{R.current&&R.current.destroy()},u=[],g[9]=h,g[10]=u):(h=g[9],u=g[10]),(0,l.useEffect)(h,u),g[11]!==y||g[12]!==A||g[13]!==S||g[14]!==P||g[15]!==O||g[16]!==z||g[17]!==_||g[18]!==C||g[19]!==w?(f={connectionState:y,roomCode:w,players:_,error:S,createRoom:A,joinRoom:O,leaveRoom:E,dispatchAction:$,initialState:P,onRemoteAction:z,setOnRemoteAction:X,updateGameState:B,provider:C,isHost:!1},g[11]=y,g[12]=A,g[13]=S,g[14]=P,g[15]=O,g[16]=z,g[17]=_,g[18]=C,g[19]=w,g[20]=f):f=g[20];let L=f;return g[21]!==p||g[22]!==L?(m=(0,i.jsx)(e6.Provider,{value:L,children:p}),g[21]=p,g[22]=L,g[23]=m):m=g[23],m}function e7(){let e=(0,l.useContext)(e6);if(!e)throw Error("useMultiplayer must be used within a MultiplayerContextProvider");return e}function te(){return(0,l.useContext)(e6)}function tt(){let e,t,r,a=(0,n.c)(9),[i,o]=(0,l.useState)(0),[s,c]=(0,l.useState)(0),[d,h]=(0,l.useState)(!1),[u,f]=(0,l.useState)(!1),[m,g]=(0,l.useState)("portrait");a[0]===Symbol.for("react.memo_cache_sentinel")?(e=()=>{let e=()=>{let e=window.innerWidth,t=window.innerHeight;o(e),c(t),h(e<768),g(e>t?"landscape":"portrait")};return e(),f("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0),window.addEventListener("resize",e),window.addEventListener("orientationchange",e),()=>{window.removeEventListener("resize",e),window.removeEventListener("orientationchange",e)}},t=[],a[0]=e,a[1]=t):(e=a[0],t=a[1]),(0,l.useEffect)(e,t);let p=I.Fr||d;return a[2]!==d||a[3]!==u||a[4]!==m||a[5]!==s||a[6]!==i||a[7]!==p?(r={isMobileDevice:p,isTabletDevice:I.v1,isMobileOnly:I.XF,isSmallScreen:d,isTouchDevice:u,screenWidth:i,screenHeight:s,orientation:m},a[2]=d,a[3]=u,a[4]=m,a[5]=s,a[6]=i,a[7]=p,a[8]=r):r=a[8],r}let tr=l.forwardRef(({className:e,...t},r)=>(0,i.jsx)("div",{ref:r,className:h("rounded-sm bg-card text-card-foreground border border-sidebar-border shadow-md",e),...t}));tr.displayName="Card";let ta=l.forwardRef(({className:e,...t},r)=>(0,i.jsx)("div",{ref:r,className:h("flex flex-col space-y-1.5 p-5 pb-3",e),...t}));ta.displayName="CardHeader";let ti=l.forwardRef(({className:e,...t},r)=>(0,i.jsx)("h3",{ref:r,className:h("font-display text-xl font-semibold leading-none tracking-wide text-gold",e),...t}));ti.displayName="CardTitle",l.forwardRef(({className:e,...t},r)=>(0,i.jsx)("p",{ref:r,className:h("text-sm text-muted-foreground leading-relaxed",e),...t})).displayName="CardDescription";let tn=l.forwardRef(({className:e,...t},r)=>(0,i.jsx)("div",{ref:r,className:h("p-5 pt-0",e),...t}));tn.displayName="CardContent",l.forwardRef(({className:e,...t},r)=>(0,i.jsx)("div",{ref:r,className:h("flex items-center p-5 pt-0",e),...t})).displayName="CardFooter";let tl={fill:"none",stroke:"currentColor",strokeWidth:1.8,strokeLinecap:"round",strokeLinejoin:"round"};function to(e){let t,r,a=(0,n.c)(4),{size:l,className:o}=e,s=void 0===l?18:l;return a[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,i.jsx)("path",{...tl,d:"M8 5v14l10-7z"}),a[0]=t):t=a[0],a[1]!==o||a[2]!==s?(r=(0,i.jsx)("svg",{width:s,height:s,viewBox:"0 0 24 24",className:o,children:t}),a[1]=o,a[2]=s,a[3]=r):r=a[3],r}function ts(e){let t,r,a=(0,n.c)(4),{size:l,className:o}=e,s=void 0===l?18:l;return a[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,i.jsx)("path",{...tl,d:"M8 5v14M16 5v14"}),a[0]=t):t=a[0],a[1]!==o||a[2]!==s?(r=(0,i.jsx)("svg",{width:s,height:s,viewBox:"0 0 24 24",className:o,children:t}),a[1]=o,a[2]=s,a[3]=r):r=a[3],r}function tc(e){let t,r,a=(0,n.c)(4),{size:l,className:o}=e,s=void 0===l?18:l;return a[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,i.jsx)("path",{...tl,d:"M6 6l12 12M18 6l-12 12"}),a[0]=t):t=a[0],a[1]!==o||a[2]!==s?(r=(0,i.jsx)("svg",{width:s,height:s,viewBox:"0 0 24 24",className:o,children:t}),a[1]=o,a[2]=s,a[3]=r):r=a[3],r}function td(e){let t,r,a,l,o=(0,n.c)(6),{size:s,className:c}=e,d=void 0===s?18:s;return o[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,i.jsx)("path",{...tl,d:"M12 3c3 2 4 4.5 4 6.5A4 4 0 0 1 12 14a4 4 0 0 1-4-4.5C8 7.5 9 5 12 3z"}),r=(0,i.jsx)("path",{...tl,d:"M12 14v5"}),a=(0,i.jsx)("path",{...tl,d:"M9 20h6"}),o[0]=t,o[1]=r,o[2]=a):(t=o[0],r=o[1],a=o[2]),o[3]!==c||o[4]!==d?(l=(0,i.jsxs)("svg",{width:d,height:d,viewBox:"0 0 24 24",className:c,children:[t,r,a]}),o[3]=c,o[4]=d,o[5]=l):l=o[5],l}function th(e){let t,r,a,l=(0,n.c)(5),{size:o,className:s}=e,c=void 0===o?18:o;return l[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,i.jsx)("path",{...tl,d:"M12 3s2 3 2 5-2 4-2 4-2-2-2-4 2-5 2-5z"}),r=(0,i.jsx)("path",{...tl,d:"M12 12c-2 1-3 3-3 4.5a3 3 0 0 0 6 0C15 15 14 13 12 12z"}),l[0]=t,l[1]=r):(t=l[0],r=l[1]),l[2]!==s||l[3]!==c?(a=(0,i.jsxs)("svg",{width:c,height:c,viewBox:"0 0 24 24",className:s,children:[t,r]}),l[2]=s,l[3]=c,l[4]=a):a=l[4],a}function tu(e){let t,r,a=(0,n.c)(4),{size:l,className:o}=e,s=void 0===l?18:l;return a[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,i.jsx)("path",{...tl,d:"M13 2l-4 10h4l-2 10 8-12h-5l3-8z"}),a[0]=t):t=a[0],a[1]!==o||a[2]!==s?(r=(0,i.jsx)("svg",{width:s,height:s,viewBox:"0 0 24 24",className:o,children:t}),a[1]=o,a[2]=s,a[3]=r):r=a[3],r}function tf(e){let t,r,a,l=(0,n.c)(5),{size:o,className:s}=e,c=void 0===o?18:o;return l[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,i.jsx)("path",{...tl,d:"M12 3s6 7 6 11a6 6 0 0 1-12 0c0-4 6-11 6-11z"}),r=(0,i.jsx)("path",{...tl,d:"M9 15c.5.8 1.5 1.2 3 1.2 1.5 0 2.5-.4 3-1.2"}),l[0]=t,l[1]=r):(t=l[0],r=l[1]),l[2]!==s||l[3]!==c?(a=(0,i.jsxs)("svg",{width:c,height:c,viewBox:"0 0 24 24",className:s,children:[t,r]}),l[2]=s,l[3]=c,l[4]=a):a=l[4],a}function tm(e){let t,r,a,l,o,s=(0,n.c)(7),{size:c,className:d}=e,h=void 0===c?18:c;return s[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,i.jsx)("circle",{...tl,cx:"9",cy:"8",r:"3"}),r=(0,i.jsx)("path",{...tl,d:"M4 19c0-3 2.5-5 5-5s5 2 5 5"}),a=(0,i.jsx)("circle",{...tl,cx:"17",cy:"10",r:"2"}),l=(0,i.jsx)("path",{...tl,d:"M15 19c0-2 1.2-3.3 2.5-3.8"}),s[0]=t,s[1]=r,s[2]=a,s[3]=l):(t=s[0],r=s[1],a=s[2],l=s[3]),s[4]!==d||s[5]!==h?(o=(0,i.jsxs)("svg",{width:h,height:h,viewBox:"0 0 24 24",className:d,children:[t,r,a,l]}),s[4]=d,s[5]=h,s[6]=o):o=s[6],o}function tg(e){let t,r,a,l=(0,n.c)(5),{size:o,className:s}=e,c=void 0===o?18:o;return l[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,i.jsx)("rect",{...tl,x:"4",y:"6",width:"16",height:"12",rx:"2"}),r=(0,i.jsx)("path",{...tl,d:"M12 9v6M9 12h6"}),l[0]=t,l[1]=r):(t=l[0],r=l[1]),l[2]!==s||l[3]!==c?(a=(0,i.jsxs)("svg",{width:c,height:c,viewBox:"0 0 24 24",className:s,children:[t,r]}),l[2]=s,l[3]=c,l[4]=a):a=l[4],a}function tp(e){let t,r,a,l=(0,n.c)(5),{size:o,className:s}=e,c=void 0===o?18:o;return l[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,i.jsx)("circle",{...tl,cx:"12",cy:"12",r:"9"}),r=(0,i.jsx)("path",{...tl,d:"M9 10h.01M15 10h.01M8 14c1 1 2.5 1.5 4 1.5s3-.5 4-1.5"}),l[0]=t,l[1]=r):(t=l[0],r=l[1]),l[2]!==s||l[3]!==c?(a=(0,i.jsxs)("svg",{width:c,height:c,viewBox:"0 0 24 24",className:s,children:[t,r]}),l[2]=s,l[3]=c,l[4]=a):a=l[4],a}function tx(e){let t,r,a,l=(0,n.c)(5),{size:o,className:s}=e,c=void 0===o?18:o;return l[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,i.jsx)("circle",{...tl,cx:"12",cy:"12",r:"8.5"}),r=(0,i.jsx)("path",{...tl,d:"M12 9v6M9 12h6"}),l[0]=t,l[1]=r):(t=l[0],r=l[1]),l[2]!==s||l[3]!==c?(a=(0,i.jsxs)("svg",{width:c,height:c,viewBox:"0 0 24 24",className:s,children:[t,r]}),l[2]=s,l[3]=c,l[4]=a):a=l[4],a}function ty(e){let t,r,a,l,o=(0,n.c)(6),{size:s,className:c}=e,d=void 0===s?18:s;return o[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,i.jsx)("path",{...tl,d:"M3 9l9-5 9 5-9 5-9-5z"}),r=(0,i.jsx)("path",{...tl,d:"M12 14v7"}),a=(0,i.jsx)("path",{...tl,d:"M7 12v4c0 1 2 2 5 2s5-1 5-2v-4"}),o[0]=t,o[1]=r,o[2]=a):(t=o[0],r=o[1],a=o[2]),o[3]!==c||o[4]!==d?(l=(0,i.jsxs)("svg",{width:d,height:d,viewBox:"0 0 24 24",className:c,children:[t,r,a]}),o[3]=c,o[4]=d,o[5]=l):l=o[5],l}function tb(e){let t,r,a,l=(0,n.c)(5),{size:o,className:s}=e,c=void 0===o?18:o;return l[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,i.jsx)("path",{...tl,d:"M12 3l8 4v5c0 4.5-3.5 7.8-8 9-4.5-1.2-8-4.5-8-9V7z"}),r=(0,i.jsx)("path",{...tl,d:"M9 12l2 2 4-4"}),l[0]=t,l[1]=r):(t=l[0],r=l[1]),l[2]!==s||l[3]!==c?(a=(0,i.jsxs)("svg",{width:c,height:c,viewBox:"0 0 24 24",className:s,children:[t,r]}),l[2]=s,l[3]=c,l[4]=a):a=l[4],a}function tw(e){let t,r,a,l=(0,n.c)(5),{size:o,className:s}=e,c=void 0===o?18:o;return l[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,i.jsx)("path",{...tl,d:"M12 3c3 3 6 6 6 10a6 6 0 0 1-12 0c0-4 3-7 6-10z"}),r=(0,i.jsx)("path",{...tl,d:"M12 10v6M9 14h6"}),l[0]=t,l[1]=r):(t=l[0],r=l[1]),l[2]!==s||l[3]!==c?(a=(0,i.jsxs)("svg",{width:c,height:c,viewBox:"0 0 24 24",className:s,children:[t,r]}),l[2]=s,l[3]=c,l[4]=a):a=l[4],a}function tv(e){let t,r,a,l,o=(0,n.c)(6),{size:s,className:c}=e,d=void 0===s?18:s;return o[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,i.jsx)("path",{...tl,d:"M4 7h16v10H4z"}),r=(0,i.jsx)("path",{...tl,d:"M8 11h4M8 15h8"}),a=(0,i.jsx)("circle",{...tl,cx:"16",cy:"9",r:"1.2"}),o[0]=t,o[1]=r,o[2]=a):(t=o[0],r=o[1],a=o[2]),o[3]!==c||o[4]!==d?(l=(0,i.jsxs)("svg",{width:d,height:d,viewBox:"0 0 24 24",className:c,children:[t,r,a]}),o[3]=c,o[4]=d,o[5]=l):l=o[5],l}function t_(e){let t,r,a,l,o=(0,n.c)(6),{size:s,className:c}=e,d=void 0===s?18:s;return o[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,i.jsx)("path",{...tl,d:"M4 19h16"}),r=(0,i.jsx)("path",{...tl,d:"M7 15l3-4 4 3 3-5"}),a=(0,i.jsx)("path",{...tl,d:"M7 10h.01M10 11h.01M14 14h.01M17 9h.01"}),o[0]=t,o[1]=r,o[2]=a):(t=o[0],r=o[1],a=o[2]),o[3]!==c||o[4]!==d?(l=(0,i.jsxs)("svg",{width:d,height:d,viewBox:"0 0 24 24",className:c,children:[t,r,a]}),o[3]=c,o[4]=d,o[5]=l):l=o[5],l}function tM(e){let t,r,a,l=(0,n.c)(5),{size:o,className:s}=e,c=void 0===o?18:o;return l[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,i.jsx)("path",{...tl,d:"M12 3l7 4-7 4-7-4z"}),r=(0,i.jsx)("path",{...tl,d:"M5 11v5l7 4 7-4v-5"}),l[0]=t,l[1]=r):(t=l[0],r=l[1]),l[2]!==s||l[3]!==c?(a=(0,i.jsxs)("svg",{width:c,height:c,viewBox:"0 0 24 24",className:s,children:[t,r]}),l[2]=s,l[3]=c,l[4]=a):a=l[4],a}function tS(e){let t,r,a,l=(0,n.c)(5),{size:o,className:s}=e,c=void 0===o?18:o;return l[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,i.jsx)("circle",{...tl,cx:"12",cy:"12",r:"3"}),r=(0,i.jsx)("path",{...tl,d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"}),l[0]=t,l[1]=r):(t=l[0],r=l[1]),l[2]!==s||l[3]!==c?(a=(0,i.jsxs)("svg",{width:c,height:c,viewBox:"0 0 24 24",className:s,children:[t,r]}),l[2]=s,l[3]=c,l[4]=a):a=l[4],a}function tk(e){let t,r,a,l=(0,n.c)(5),{size:o,className:s}=e,c=void 0===o?18:o;return l[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,i.jsx)("circle",{...tl,cx:"12",cy:"12",r:"9"}),r=(0,i.jsx)("path",{...tl,d:"M12 10v6M12 7h.01"}),l[0]=t,l[1]=r):(t=l[0],r=l[1]),l[2]!==s||l[3]!==c?(a=(0,i.jsxs)("svg",{width:c,height:c,viewBox:"0 0 24 24",className:s,children:[t,r]}),l[2]=s,l[3]=c,l[4]=a):a=l[4],a}function tj(e){let t,r,a,l,o,s,c,d=(0,n.c)(9),{size:h,className:u}=e,f=void 0===h?18:h;return d[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,i.jsx)("rect",{...tl,x:"4",y:"8",width:"16",height:"10",rx:"3"}),r=(0,i.jsx)("rect",{...tl,x:"6",y:"10",width:"4",height:"4",rx:"1"}),a=(0,i.jsx)("rect",{...tl,x:"14",y:"10",width:"4",height:"4",rx:"1"}),l=(0,i.jsx)("circle",{...tl,cx:"8",cy:"19",r:"1.5"}),o=(0,i.jsx)("circle",{...tl,cx:"16",cy:"19",r:"1.5"}),s=(0,i.jsx)("path",{...tl,d:"M10 8V5M14 8V5M10 5h4"}),d[0]=t,d[1]=r,d[2]=a,d[3]=l,d[4]=o,d[5]=s):(t=d[0],r=d[1],a=d[2],l=d[3],o=d[4],s=d[5]),d[6]!==u||d[7]!==f?(c=(0,i.jsxs)("svg",{width:f,height:f,viewBox:"0 0 24 24",className:u,children:[t,r,a,l,o,s]}),d[6]=u,d[7]=f,d[8]=c):c=d[8],c}let tP={TOOLS:(0,i.jsx)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,i.jsx)("path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"})}),ZONES:(0,i.jsxs)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,i.jsx)("rect",{x:"3",y:"3",width:"7",height:"7"}),(0,i.jsx)("rect",{x:"14",y:"3",width:"7",height:"7"}),(0,i.jsx)("rect",{x:"14",y:"14",width:"7",height:"7"}),(0,i.jsx)("rect",{x:"3",y:"14",width:"7",height:"7"})]}),ZONING:(0,i.jsxs)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,i.jsx)("path",{d:"M4 4l16 16M20 4L4 20"}),(0,i.jsx)("circle",{cx:"12",cy:"12",r:"8"})]}),SERVICES:(0,i.jsxs)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,i.jsx)("path",{d:"M3 21h18"}),(0,i.jsx)("path",{d:"M5 21V7l8-4v18"}),(0,i.jsx)("path",{d:"M19 21V11l-6-4"}),(0,i.jsx)("path",{d:"M9 9v.01"}),(0,i.jsx)("path",{d:"M9 12v.01"}),(0,i.jsx)("path",{d:"M9 15v.01"}),(0,i.jsx)("path",{d:"M9 18v.01"})]}),PARKS:(0,i.jsx)(td,{size:20}),SPORTS:(0,i.jsxs)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,i.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,i.jsx)("path",{d:"M12 6v12M6 12h12"})]}),WATERFRONT:(0,i.jsx)(tf,{size:20}),COMMUNITY:(0,i.jsxs)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,i.jsx)("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),(0,i.jsx)("circle",{cx:"9",cy:"7",r:"4"}),(0,i.jsx)("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),(0,i.jsx)("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),UTILITIES:(0,i.jsx)(tu,{size:20}),SPECIAL:(0,i.jsx)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,i.jsx)("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})})},tT={select:(0,i.jsx)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"currentColor",children:(0,i.jsx)("path",{d:"M4 4l16 8-8 3-3 8z"})}),bulldoze:(0,i.jsx)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,i.jsx)("path",{d:"M3 6h18M6 6v14a2 2 0 002 2h8a2 2 0 002-2V6M9 6V4a2 2 0 012-2h2a2 2 0 012 2v2"})}),road:(0,i.jsx)(function(e){let t,r,a,l,o=(0,n.c)(6),{size:s,className:c}=e,d=void 0===s?18:s;return o[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,i.jsx)("rect",{...tl,x:"6",y:"4",width:"12",height:"16",rx:"1"}),r=(0,i.jsx)("path",{...tl,d:"M12 6v12",strokeDasharray:"2 2"}),a=(0,i.jsx)("path",{...tl,d:"M6 8h12M6 16h12"}),o[0]=t,o[1]=r,o[2]=a):(t=o[0],r=o[1],a=o[2]),o[3]!==c||o[4]!==d?(l=(0,i.jsxs)("svg",{width:d,height:d,viewBox:"0 0 24 24",className:c,children:[t,r,a]}),o[3]=c,o[4]=d,o[5]=l):l=o[5],l},{size:20}),rail:(0,i.jsx)(function(e){let t,r,a,l,o,s,c,d=(0,n.c)(9),{size:h,className:u}=e,f=void 0===h?18:h;return d[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,i.jsx)("path",{...tl,d:"M6 4v16"}),r=(0,i.jsx)("path",{...tl,d:"M18 4v16"}),a=(0,i.jsx)("path",{...tl,d:"M4 6h16"}),l=(0,i.jsx)("path",{...tl,d:"M4 10h16"}),o=(0,i.jsx)("path",{...tl,d:"M4 14h16"}),s=(0,i.jsx)("path",{...tl,d:"M4 18h16"}),d[0]=t,d[1]=r,d[2]=a,d[3]=l,d[4]=o,d[5]=s):(t=d[0],r=d[1],a=d[2],l=d[3],o=d[4],s=d[5]),d[6]!==u||d[7]!==f?(c=(0,i.jsxs)("svg",{width:f,height:f,viewBox:"0 0 24 24",className:u,children:[t,r,a,l,o,s]}),d[6]=u,d[7]=f,d[8]=c):c=d[8],c},{size:20}),subway:(0,i.jsx)(tj,{size:20}),tree:(0,i.jsx)(td,{size:20}),zone_residential:(0,i.jsx)("div",{className:"w-5 h-5 rounded-sm bg-green-500 flex items-center justify-center text-[10px] font-bold text-white",children:"R"}),zone_commercial:(0,i.jsx)("div",{className:"w-5 h-5 rounded-sm bg-blue-500 flex items-center justify-center text-[10px] font-bold text-white",children:"C"}),zone_industrial:(0,i.jsx)("div",{className:"w-5 h-5 rounded-sm bg-amber-500 flex items-center justify-center text-[10px] font-bold text-white",children:"I"}),zone_dezone:(0,i.jsx)("div",{className:"w-5 h-5 rounded-sm bg-gray-500 flex items-center justify-center text-[10px] font-bold text-white",children:"X"}),zone_water:(0,i.jsx)("div",{className:"w-5 h-5 rounded-sm bg-cyan-500 flex items-center justify-center text-[10px] font-bold text-white",children:"~"}),zone_land:(0,i.jsx)("div",{className:"w-5 h-5 rounded-sm bg-emerald-600 flex items-center justify-center text-[10px] font-bold text-white",children:""}),police_station:(0,i.jsx)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"currentColor",children:(0,i.jsx)("path",{d:"M12 1l9 4v6c0 5.5-3.8 10.7-9 12-5.2-1.3-9-6.5-9-12V5l9-4z"})}),fire_station:(0,i.jsx)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"currentColor",children:(0,i.jsx)("path",{d:"M12 2c-1.5 4-1.5 6 0 8 1.5-2 1.5-4 0-8zM8 10c-2 4-2 6 0 10 2-4 2-6 0-10zM16 10c-2 4-2 6 0 10 2-4 2-6 0-10z"})}),hospital:(0,i.jsxs)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,i.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),(0,i.jsx)("path",{d:"M12 8v8M8 12h8"})]}),school:(0,i.jsxs)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,i.jsx)("path",{d:"M22 10v6M2 10l10-5 10 5-10 5z"}),(0,i.jsx)("path",{d:"M6 12v5c3 3 9 3 12 0v-5"})]}),university:(0,i.jsxs)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,i.jsx)("path",{d:"M2 20h20"}),(0,i.jsx)("path",{d:"M5 20V8l7-4 7 4v12"}),(0,i.jsx)("path",{d:"M9 20v-4h6v4"})]}),park:(0,i.jsx)(td,{size:20}),park_large:(0,i.jsx)(td,{size:20}),tennis:(0,i.jsxs)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,i.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,i.jsx)("path",{d:"M4.5 4.5c5 5 10 5 15 0"}),(0,i.jsx)("path",{d:"M4.5 19.5c5-5 10-5 15 0"})]}),power_plant:(0,i.jsx)(tu,{size:20}),water_tower:(0,i.jsx)(tf,{size:20}),subway_station:(0,i.jsx)(tj,{size:20}),stadium:(0,i.jsx)(function(e){let t,r,a,l,o,s=(0,n.c)(7),{size:c,className:d}=e,h=void 0===c?18:c;return s[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,i.jsx)("path",{...tl,d:"M8 4h8v4a4 4 0 0 1-8 0z"}),r=(0,i.jsx)("path",{...tl,d:"M10 14h4M9 19h6"}),a=(0,i.jsx)("path",{...tl,d:"M6 6h-2v2a3 3 0 0 0 3 3"}),l=(0,i.jsx)("path",{...tl,d:"M18 6h2v2a3 3 0 0 1-3 3"}),s[0]=t,s[1]=r,s[2]=a,s[3]=l):(t=s[0],r=s[1],a=s[2],l=s[3]),s[4]!==d||s[5]!==h?(o=(0,i.jsxs)("svg",{width:h,height:h,viewBox:"0 0 24 24",className:d,children:[t,r,a,l]}),s[4]=d,s[5]=h,s[6]=o):o=s[6],o},{size:20}),museum:(0,i.jsxs)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,i.jsx)("path",{d:"M2 20h20"}),(0,i.jsx)("path",{d:"M4 20v-6h4v6"}),(0,i.jsx)("path",{d:"M10 20v-6h4v6"}),(0,i.jsx)("path",{d:"M16 20v-6h4v6"}),(0,i.jsx)("path",{d:"M2 14h20"}),(0,i.jsx)("path",{d:"M12 3l10 7H2l10-7z"})]}),airport:(0,i.jsx)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"currentColor",children:(0,i.jsx)("path",{d:"M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z"})}),space_program:(0,i.jsx)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"currentColor",children:(0,i.jsx)("path",{d:"M12 2L4 5v6.5c0 6 5.5 10.5 8 11.5 2.5-1 8-5.5 8-11.5V5l-8-3z"})}),city_hall:(0,i.jsxs)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,i.jsx)("path",{d:"M2 20h20"}),(0,i.jsx)("path",{d:"M4 20v-8l8-8 8 8v8"}),(0,i.jsx)("rect",{x:"9",y:"14",width:"6",height:"6"})]}),amusement_park:(0,i.jsxs)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,i.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,i.jsx)("path",{d:"M12 2v20"}),(0,i.jsx)("path",{d:"M2 12h20"}),(0,i.jsx)("circle",{cx:"12",cy:"12",r:"3"})]})},tC={TOOLS:(0,k.msg)("Tools"),ZONES:(0,k.msg)("Zones"),EXPAND_CITY:(0,k.msg)("Expand City"),ZONING:(0,k.msg)("Zoning"),UTILITIES:(0,k.msg)("Utilities"),SERVICES:(0,k.msg)("Services"),PARKS:(0,k.msg)("Parks"),SPORTS:(0,k.msg)("Sports"),WATERFRONT:(0,k.msg)("Waterfront"),COMMUNITY:(0,k.msg)("Community"),SPECIAL:(0,k.msg)("Special")},tN={viewOverlays:(0,k.msg)("View Overlays"),none:(0,k.msg)("None"),power:(0,k.msg)("Power"),water:(0,k.msg)("Water"),fire:(0,k.msg)("Fire"),police:(0,k.msg)("Police"),health:(0,k.msg)("Health"),education:(0,k.msg)("Education"),subway:(0,k.msg)("Subway"),budget:(0,k.msg)("Budget"),statistics:(0,k.msg)("Statistics"),advisors:(0,k.msg)("Advisors"),settings:(0,k.msg)("Settings")},tz={TOOLS:["select","bulldoze","road","rail","subway"],ZONES:["zone_residential","zone_commercial","zone_industrial"],ZONING:["zone_dezone","zone_water","zone_land"],UTILITIES:["power_plant","water_tower","subway_station","rail_station"],SERVICES:["police_station","fire_station","hospital","school","university"],PARKS:["park","park_large","tennis","playground_small","playground_large","community_garden","pond_park","park_gate","greenhouse_garden","mini_golf_course","go_kart_track","amphitheater","roller_coaster_small","campground","cabin_house","mountain_lodge","mountain_trailhead"],SPORTS:["tennis","basketball_courts","soccer_field_small","baseball_field_small","football_field","baseball_stadium","swimming_pool","skate_park","bleachers_field"],WATERFRONT:["marina_docks_small","pier_large"],COMMUNITY:["community_center","animal_pens_farm","office_building_small"],SPECIAL:["stadium","museum","airport","space_program","city_hall","amusement_park"]};function tI(e){let t,r,a,o,s,c,d,h,u,m,g,p,x=(0,n.c)(45),{onOpenPanel:y,overlayMode:b,setOverlayMode:w,toolLayout:v}=e,_=void 0===b?"none":b,M=void 0===v?"category":v,{state:S,setTool:P,expandCity:T,shrinkCity:C}=eL(),{selectedTool:N,stats:z}=S,[I,R]=(0,l.useState)(null),[Y,X]=(0,l.useState)(!1),[A,O]=(0,l.useState)(!1),E=(0,k.useMessages)();x[0]!==I?(t=e=>{I===e?R(null):R(e)},x[0]=I,x[1]=t):t=x[1];let $=t;x[2]!==N||x[3]!==P?(r=(e,t)=>{N===e&&"select"!==e?P("select"):P(e),R(null),void 0!==t&&t&&X(!1)},x[2]=N,x[3]=P,x[4]=r):r=x[4];let B=r;x[5]===Symbol.for("react.memo_cache_sentinel")?(a=e=>{R(e),X(!0)},x[5]=a):a=x[5];let L=a;x[6]!==E||x[7]!==N||x[8]!==z?(o=N&&j[N]&&(0,i.jsxs)("div",{className:"flex items-center justify-between px-4 py-1.5 border-b border-sidebar-border/50 bg-secondary/30 text-xs",children:[(0,i.jsx)("span",{className:"text-foreground font-medium",children:E(j[N].name)}),j[N].cost>0&&(0,i.jsxs)("span",{className:`font-mono ${z.money>=j[N].cost?"text-green-400":"text-red-400"}`,children:["$",j[N].cost]})]}),x[6]=E,x[7]=N,x[8]=z,x[9]=o):o=x[9],x[10]!==B||x[11]!==E||x[12]!==N||x[13]!==M?(s="quick"===M?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(f,{variant:"select"===N?"default":"ghost",size:"icon",className:"h-11 w-11",onClick:()=>B("select"),children:tT.select}),(0,i.jsx)(f,{variant:"bulldoze"===N?"default":"ghost",size:"icon",className:"h-11 w-11 text-red-400",onClick:()=>B("bulldoze"),children:tT.bulldoze}),(0,i.jsx)(f,{variant:"road"===N?"default":"ghost",size:"icon",className:"h-11 w-11",onClick:()=>B("road"),children:tT.road}),(0,i.jsx)(f,{variant:"rail"===N?"default":"ghost",size:"icon",className:"h-11 w-11",onClick:()=>B("rail"),children:tT.rail}),(0,i.jsx)(f,{variant:"zone_residential"===N?"default":"ghost",size:"icon",className:"h-11 w-11",onClick:()=>B("zone_residential"),children:tT.zone_residential}),(0,i.jsx)(f,{variant:"zone_commercial"===N?"default":"ghost",size:"icon",className:"h-11 w-11",onClick:()=>B("zone_commercial"),children:tT.zone_commercial}),(0,i.jsx)(f,{variant:"zone_industrial"===N?"default":"ghost",size:"icon",className:"h-11 w-11",onClick:()=>B("zone_industrial"),children:tT.zone_industrial})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(f,{variant:"select"===N?"default":"ghost",size:"icon",className:"h-11 w-11",onClick:()=>B("select"),children:tT.select}),(0,i.jsx)(f,{variant:"bulldoze"===N?"default":"ghost",size:"icon",className:"h-11 w-11 text-red-400",onClick:()=>B("bulldoze"),children:tT.bulldoze}),(0,i.jsx)(f,{variant:"ghost",size:"icon",className:"h-11 w-11",onClick:()=>L("TOOLS"),title:String(E(tC.TOOLS)),children:tP.TOOLS}),(0,i.jsx)(f,{variant:"ghost",size:"icon",className:"h-11 w-11",onClick:()=>L("ZONES"),title:String(E(tC.ZONES)),children:tP.ZONES}),(0,i.jsx)(f,{variant:"ghost",size:"icon",className:"h-11 w-11",onClick:()=>L("SERVICES"),title:String(E(tC.SERVICES)),children:tP.SERVICES}),(0,i.jsx)(f,{variant:"ghost",size:"icon",className:"h-11 w-11",onClick:()=>L("SPECIAL"),title:String(E(tC.SPECIAL)),children:tP.SPECIAL})]}),x[10]=B,x[11]=E,x[12]=N,x[13]=M,x[14]=s):s=x[14];let V=Y?"default":"secondary";return x[15]!==Y?(d=()=>X(!Y),c=Y?(0,i.jsx)(tc,{size:20}):(0,i.jsxs)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,i.jsx)("circle",{cx:"12",cy:"12",r:"1"}),(0,i.jsx)("circle",{cx:"19",cy:"12",r:"1"}),(0,i.jsx)("circle",{cx:"5",cy:"12",r:"1"})]}),x[15]=Y,x[16]=c,x[17]=d):(c=x[16],d=x[17]),x[18]!==c||x[19]!==V||x[20]!==d?(h=(0,i.jsx)(f,{variant:V,size:"icon",className:"h-11 w-11",onClick:d,children:c}),x[18]=c,x[19]=V,x[20]=d,x[21]=h):h=x[21],x[22]!==h||x[23]!==s?(u=(0,i.jsxs)("div",{className:"flex items-center justify-around px-2 py-2 gap-1",children:[s,h]}),x[22]=h,x[23]=s,x[24]=u):u=x[24],x[25]!==u||x[26]!==o?(m=(0,i.jsx)("div",{className:"fixed bottom-0 left-0 right-0 z-50 safe-area-bottom",children:(0,i.jsxs)(tr,{className:"rounded-none border-x-0 border-b-0 bg-card/95 backdrop-blur-sm",children:[o,u]})}),x[25]=u,x[26]=o,x[27]=m):m=x[27],x[28]!==T||x[29]!==A||x[30]!==I||x[31]!==$||x[32]!==B||x[33]!==E||x[34]!==y||x[35]!==_||x[36]!==N||x[37]!==w||x[38]!==Y||x[39]!==C||x[40]!==z?(g=Y&&(0,i.jsx)("div",{className:"fixed inset-0 z-40 bg-black/50 backdrop-blur-sm",onClick:()=>X(!1),children:(0,i.jsxs)(tr,{className:"absolute bottom-20 left-2 right-2 max-h-[70vh] overflow-hidden rounded-xl flex flex-col",onClick:tR,children:[(0,i.jsxs)("div",{className:"p-3 border-b border-border flex-shrink-0",children:[(0,i.jsx)("div",{className:"text-xs text-muted-foreground uppercase tracking-wider mb-2",children:E((0,k.msg)("City Management"))}),(0,i.jsxs)("div",{className:"grid grid-cols-4 gap-2",children:[(0,i.jsx)(f,{variant:"ghost",size:"sm",className:"h-10 w-full text-xs",onClick:()=>{y("budget"),X(!1)},children:E(tN.budget)}),(0,i.jsx)(f,{variant:"ghost",size:"sm",className:"h-10 w-full text-xs",onClick:()=>{y("statistics"),X(!1)},children:E(tN.statistics)}),(0,i.jsx)(f,{variant:"ghost",size:"sm",className:"h-10 w-full text-xs",onClick:()=>{y("advisors"),X(!1)},children:E(tN.advisors)}),(0,i.jsx)(f,{variant:"ghost",size:"sm",className:"h-10 w-full text-xs",onClick:()=>{y("settings"),X(!1)},children:E(tN.settings)})]})]}),w&&(0,i.jsxs)("div",{className:"p-3 border-b border-border flex-shrink-0",children:[(0,i.jsx)("div",{className:"text-xs text-muted-foreground uppercase tracking-wider mb-2",children:E(tN.viewOverlays)}),(0,i.jsxs)("div",{className:"grid grid-cols-4 gap-2",children:[(0,i.jsx)(f,{variant:"none"===_?"default":"ghost",size:"sm",className:"h-10 w-full text-xs",onClick:()=>w("none"),children:E(tN.none)}),(0,i.jsx)(f,{variant:"power"===_?"default":"ghost",size:"sm",className:`h-10 w-full text-xs ${"power"===_?"bg-amber-500 hover:bg-amber-600":""}`,onClick:()=>w("power"),children:E(tN.power)}),(0,i.jsx)(f,{variant:"water"===_?"default":"ghost",size:"sm",className:`h-10 w-full text-xs ${"water"===_?"bg-blue-500 hover:bg-blue-600":""}`,onClick:()=>w("water"),children:E(tN.water)}),(0,i.jsx)(f,{variant:"fire"===_?"default":"ghost",size:"sm",className:`h-10 w-full text-xs ${"fire"===_?"bg-red-500 hover:bg-red-600":""}`,onClick:()=>w("fire"),children:E(tN.fire)}),(0,i.jsx)(f,{variant:"police"===_?"default":"ghost",size:"sm",className:`h-10 w-full text-xs ${"police"===_?"bg-blue-600 hover:bg-blue-700":""}`,onClick:()=>w("police"),children:E(tN.police)}),(0,i.jsx)(f,{variant:"health"===_?"default":"ghost",size:"sm",className:`h-10 w-full text-xs ${"health"===_?"bg-green-500 hover:bg-green-600":""}`,onClick:()=>w("health"),children:E(tN.health)}),(0,i.jsx)(f,{variant:"education"===_?"default":"ghost",size:"sm",className:`h-10 w-full text-xs ${"education"===_?"bg-purple-500 hover:bg-purple-600":""}`,onClick:()=>w("education"),children:E(tN.education)}),(0,i.jsx)(f,{variant:"subway"===_?"default":"ghost",size:"sm",className:`h-10 w-full text-xs ${"subway"===_?"bg-yellow-500 hover:bg-yellow-600":""}`,onClick:()=>w("subway"),children:E(tN.subway)})]})]}),(0,i.jsx)("div",{className:"flex-1 min-h-0 overflow-y-auto overscroll-contain",style:{WebkitOverflowScrolling:"touch"},children:(0,i.jsx)("div",{className:"p-2 space-y-1 pb-4",children:Object.entries(tz).map(e=>{let[t,r]=e;return(0,i.jsxs)("div",{children:["ZONING"===t&&(0,i.jsxs)("div",{className:"mb-1",children:[(0,i.jsxs)(f,{variant:A?"secondary":"ghost",className:"w-full justify-start gap-3 h-12",onClick:()=>O(!A),children:[(0,i.jsx)("span",{className:"flex-1 text-left font-medium",children:E(tC.EXPAND_CITY)}),(0,i.jsx)("svg",{className:`w-4 h-4 transition-transform ${A?"rotate-180":""}`,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,i.jsx)("path",{d:"M6 9l6 6 6-6"})})]}),A&&(0,i.jsxs)("div",{className:"pl-4 py-1 space-y-0.5",children:[(0,i.jsx)(f,{variant:"ghost",className:"w-full justify-start gap-3 h-11",onClick:()=>{T(),X(!1)},children:(0,i.jsx)("span",{className:"flex-1 text-left",children:E(j.expand_city.name)})}),(0,i.jsx)(f,{variant:"ghost",className:"w-full justify-start gap-3 h-11",onClick:()=>{C(),X(!1)},children:(0,i.jsx)("span",{className:"flex-1 text-left",children:E(j.shrink_city.name)})})]})]}),(0,i.jsxs)(f,{variant:I===t?"secondary":"ghost",className:"w-full justify-start gap-3 h-12",onClick:()=>$(t),children:[(0,i.jsx)("span",{className:"flex-1 text-left font-medium",children:E(tC[t]||t)}),(0,i.jsx)("svg",{className:`w-4 h-4 transition-transform ${I===t?"rotate-180":""}`,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,i.jsx)("path",{d:"M6 9l6 6 6-6"})})]}),I===t&&(0,i.jsx)("div",{className:"pl-4 py-1 space-y-0.5",children:r.map(e=>{let t=j[e];if(!t)return null;let r=z.money>=t.cost;return(0,i.jsxs)(f,{variant:N===e?"default":"ghost",className:"w-full justify-start gap-3 h-11",disabled:!r&&t.cost>0,onClick:()=>B(e,!0),children:[(0,i.jsx)("span",{className:"flex-1 text-left",children:E(t.name)}),t.cost>0&&(0,i.jsxs)("span",{className:`text-xs font-mono ${r?"text-green-400":"text-red-400"}`,children:["$",t.cost]})]},e)})})]},t)})})})]})}),x[28]=T,x[29]=A,x[30]=I,x[31]=$,x[32]=B,x[33]=E,x[34]=y,x[35]=_,x[36]=N,x[37]=w,x[38]=Y,x[39]=C,x[40]=z,x[41]=g):g=x[41],x[42]!==m||x[43]!==g?(p=(0,i.jsxs)(i.Fragment,{children:[m,g]}),x[42]=m,x[43]=g,x[44]=p):p=x[44],p}function tR(e){return e.stopPropagation()}var tY=r(6724);let tX=l.forwardRef(({className:e,...t},r)=>(0,i.jsxs)(tY.bL,{ref:r,className:h("relative flex w-full touch-none select-none items-center",e),...t,children:[(0,i.jsx)(tY.CC,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:(0,i.jsx)(tY.Q6,{className:"absolute h-full bg-primary"})}),(0,i.jsx)(tY.zi,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));tX.displayName=tY.bL.displayName;var tA=r(4271);let tO=l.forwardRef(({className:e,orientation:t="horizontal",decorative:r=!0,...a},n)=>(0,i.jsx)(tA.b,{ref:n,decorative:r,orientation:t,className:h("shrink-0 bg-border","horizontal"===t?"h-[1px] w-full":"h-full w-[1px]",e),...a}));tO.displayName=tA.b.displayName;var tE=r(487),t$=r(4393);let tB=t$.bL;t$.l9;let tL=t$.ZL;t$.bm;let tV=l.forwardRef((e,t)=>{let r,a,l,o,s=(0,n.c)(9);return s[0]!==e?({className:r,...a}=e,s[0]=e,s[1]=r,s[2]=a):(r=s[1],a=s[2]),s[3]!==r?(l=h("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),s[3]=r,s[4]=l):l=s[4],s[5]!==a||s[6]!==t||s[7]!==l?(o=(0,i.jsx)(t$.hJ,{ref:t,className:l,...a}),s[5]=a,s[6]=t,s[7]=l,s[8]=o):o=s[8],o});tV.displayName=t$.hJ.displayName;let tW=l.forwardRef((e,t)=>{let r,a,l,o,s,c,d=(0,n.c)(12);return d[0]!==e?({className:a,children:r,...l}=e,d[0]=e,d[1]=r,d[2]=a,d[3]=l):(r=d[1],a=d[2],l=d[3]),d[4]===Symbol.for("react.memo_cache_sentinel")?(o=(0,i.jsx)(tV,{}),d[4]=o):o=d[4],d[5]!==a?(s=h("fixed left-4 right-4 top-[50%] z-50 grid max-w-lg mx-auto translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-top-[48%] rounded-lg",a),d[5]=a,d[6]=s):s=d[6],d[7]!==r||d[8]!==l||d[9]!==t||d[10]!==s?(c=(0,i.jsxs)(tL,{children:[o,(0,i.jsx)(t$.UC,{ref:t,className:s,...l,children:r})]}),d[7]=r,d[8]=l,d[9]=t,d[10]=s,d[11]=c):c=d[11],c});tW.displayName=t$.UC.displayName;let tD=e=>{let t,r,a,l,o=(0,n.c)(8);return o[0]!==e?({className:t,...r}=e,o[0]=e,o[1]=t,o[2]=r):(t=o[1],r=o[2]),o[3]!==t?(a=h("flex flex-col space-y-1.5 text-center sm:text-left",t),o[3]=t,o[4]=a):a=o[4],o[5]!==r||o[6]!==a?(l=(0,i.jsx)("div",{className:a,...r}),o[5]=r,o[6]=a,o[7]=l):l=o[7],l};tD.displayName="DialogHeader";let tF=e=>{let t,r,a,l,o=(0,n.c)(8);return o[0]!==e?({className:t,...r}=e,o[0]=e,o[1]=t,o[2]=r):(t=o[1],r=o[2]),o[3]!==t?(a=h("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),o[3]=t,o[4]=a):a=o[4],o[5]!==r||o[6]!==a?(l=(0,i.jsx)("div",{className:a,...r}),o[5]=r,o[6]=a,o[7]=l):l=o[7],l};tF.displayName="DialogFooter";let tJ=l.forwardRef((e,t)=>{let r,a,l,o,s=(0,n.c)(9);return s[0]!==e?({className:r,...a}=e,s[0]=e,s[1]=r,s[2]=a):(r=s[1],a=s[2]),s[3]!==r?(l=h("text-lg font-semibold leading-none tracking-tight",r),s[3]=r,s[4]=l):l=s[4],s[5]!==a||s[6]!==t||s[7]!==l?(o=(0,i.jsx)(t$.hE,{ref:t,className:l,...a}),s[5]=a,s[6]=t,s[7]=l,s[8]=o):o=s[8],o});tJ.displayName=t$.hE.displayName;let tU=l.forwardRef((e,t)=>{let r,a,l,o,s=(0,n.c)(9);return s[0]!==e?({className:r,...a}=e,s[0]=e,s[1]=r,s[2]=a):(r=s[1],a=s[2]),s[3]!==r?(l=h("text-sm text-muted-foreground",r),s[3]=r,s[4]=l):l=s[4],s[5]!==a||s[6]!==t||s[7]!==l?(o=(0,i.jsx)(t$.VY,{ref:t,className:l,...a}),s[5]=a,s[6]=t,s[7]=l,s[8]=o):o=s[8],o});tU.displayName=t$.VY.displayName;var tH=r(7650),tG=r(1800),tq=r(1662);let tQ=tq.bL,tZ=tq.l9;tq.YJ,tq.ZL;let tK=l.forwardRef(({className:e,sideOffset:t=4,...r},a)=>(0,i.jsx)(tq.ZL,{children:(0,i.jsx)(tq.UC,{ref:a,sideOffset:t,className:h("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r})}));tK.displayName=tq.UC.displayName;let t0=l.forwardRef(({className:e,inset:t,...r},a)=>(0,i.jsx)(tq.q7,{ref:a,className:h("relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",e),...r}));t0.displayName=tq.q7.displayName,l.forwardRef(({className:e,inset:t,...r},a)=>(0,i.jsx)(tq.JU,{ref:a,className:h("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...r})).displayName=tq.JU.displayName,l.forwardRef(({className:e,...t},r)=>(0,i.jsx)(tq.wv,{ref:r,className:h("-mx-1 my-1 h-px bg-muted",e),...t})).displayName=tq.wv.displayName;let t1=[{code:"en",name:"English"},{code:"es",name:"Espa\xf1ol"},{code:"zh",name:""},{code:"ja",name:""},{code:"fr",name:"Fran\xe7ais"},{code:"de",name:"Deutsch"},{code:"pt-BR",name:"Portugu\xeas"},{code:"it",name:"Italiano"},{code:"tr",name:"T\xfcrk\xe7e"}];function t2(e){let t,r,a,l,o=(0,n.c)(5),{size:s}=e,c=void 0===s?16:s;return o[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,i.jsx)("circle",{cx:"12",cy:"12",r:"10"}),r=(0,i.jsx)("path",{d:"M2 12h20"}),a=(0,i.jsx)("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"}),o[0]=t,o[1]=r,o[2]=a):(t=o[0],r=o[1],a=o[2]),o[3]!==c?(l=(0,i.jsxs)("svg",{width:c,height:c,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t,r,a]}),o[3]=c,o[4]=l):l=o[4],l}function t5(e){let t,r,a=(0,n.c)(3),{size:l}=e,o=void 0===l?16:l;return a[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,i.jsx)("polyline",{points:"20,6 9,17 4,12"}),a[0]=t):t=a[0],a[1]!==o?(r=(0,i.jsx)("svg",{width:o,height:o,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:t}),a[1]=o,a[2]=r):r=a[2],r}function t3(e){let t,r,a,o,s,c,d=(0,n.c)(31),{iconOnly:h,className:u,variant:m,iconSize:g,useDrawer:p}=e,x=void 0!==h&&h,y=void 0===u?"":u,b=void 0===m?"ghost":m,w=void 0===g?16:g,v=(0,tG.Ym)(),_=(0,tG.qB)(),[M,S]=(0,l.useState)(!1);d[0]!==v?(t=t1.find(e=>e.code===v)||t1[0],d[0]=v,d[1]=t):t=d[1];let j=t;d[2]!==_?(r=e=>{_(e),S(!1)},d[2]=_,d[3]=r):r=d[3];let P=r;if(void 0!==p&&p){let e,t,r,a,n;d[4]===Symbol.for("react.memo_cache_sentinel")?(e=()=>S(!0),d[4]=e):e=d[4];let l=`h-6 w-4 p-0 m-0 flex items-center justify-center text-muted-foreground hover:text-foreground transition-colors ${y}`;return d[5]!==w?(t=(0,i.jsx)(t2,{size:w}),d[5]=w,d[6]=t):t=d[6],d[7]!==t||d[8]!==l?(r=(0,i.jsx)("button",{onClick:e,className:l,title:"Change Language",children:t}),d[7]=t,d[8]=l,d[9]=r):r=d[9],d[10]!==P||d[11]!==M||d[12]!==v?(a=M&&"undefined"!=typeof document&&(0,tH.createPortal)((0,i.jsxs)("div",{className:"fixed inset-0 z-[60]",onClick:()=>S(!1),children:[(0,i.jsx)("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm"}),(0,i.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 bg-card border-t border-border rounded-t-xl animate-in slide-in-from-bottom duration-200 pb-24",onClick:t4,children:[(0,i.jsx)("div",{className:"flex justify-center pt-3 pb-1",children:(0,i.jsx)("div",{className:"w-10 h-1 bg-muted-foreground/30 rounded-full"})}),(0,i.jsxs)("div",{className:"p-4 pt-2",children:[(0,i.jsx)("div",{className:"text-sm font-medium text-foreground mb-3",children:(0,i.jsx)(k.T,{children:"Select Language"})}),(0,i.jsx)("div",{className:"grid grid-cols-3 gap-2",children:t1.map(e=>(0,i.jsx)(f,{variant:v===e.code?"default":"ghost",size:"sm",className:"h-11 w-full text-xs justify-center",onClick:()=>P(e.code),children:e.name},e.code))})]})]})]}),document.body),d[10]=P,d[11]=M,d[12]=v,d[13]=a):a=d[13],d[14]!==r||d[15]!==a?(n=(0,i.jsxs)(i.Fragment,{children:[r,a]}),d[14]=r,d[15]=a,d[16]=n):n=d[16],n}return d[17]!==y||d[18]!==j||d[19]!==x||d[20]!==w||d[21]!==b?(a=(0,i.jsx)(tZ,{asChild:!0,children:x?(0,i.jsx)("button",{className:`h-6 w-6 p-0 m-0 flex items-center justify-center text-muted-foreground hover:text-foreground transition-colors ${y}`,title:"Change Language",children:(0,i.jsx)(t2,{size:w})}):(0,i.jsxs)(f,{variant:b,size:"sm",className:`gap-2 ${y}`,children:[(0,i.jsx)(t2,{size:w}),(0,i.jsx)("span",{className:"text-xs hidden xl:inline",children:j.name})]})}),d[17]=y,d[18]=j,d[19]=x,d[20]=w,d[21]=b,d[22]=a):a=d[22],d[23]!==v||d[24]!==_?(o=t1.map(e=>(0,i.jsxs)(t0,{onClick:()=>_(e.code),className:"flex items-center justify-between gap-2 cursor-pointer",children:[(0,i.jsx)("span",{children:e.name}),v===e.code&&(0,i.jsx)(t5,{size:14})]},e.code)),d[23]=v,d[24]=_,d[25]=o):o=d[25],d[26]!==o?(s=(0,i.jsx)(tK,{align:"end",className:"min-w-[140px]",children:o}),d[26]=o,d[27]=s):s=d[27],d[28]!==s||d[29]!==a?(c=(0,i.jsxs)(tQ,{children:[a,s]}),d[28]=s,d[29]=a,d[30]=c):c=d[30],c}function t4(e){return e.stopPropagation()}let t9={pop:(0,k.msg)("Pop"),funds:(0,k.msg)("Funds"),tax:(0,k.msg)("Tax"),taxRate:(0,k.msg)("Tax Rate"),emptyLot:(0,k.msg)("Empty Lot"),jobsLower:(0,k.msg)("jobs"),jobs:(0,k.msg)("Jobs"),hasPower:(0,k.msg)("Has power"),noPower:(0,k.msg)("No power"),hasWater:(0,k.msg)("Has water"),noWater:(0,k.msg)("No water"),happiness:(0,k.msg)("Happiness"),health:(0,k.msg)("Health"),education:(0,k.msg)("Education"),safety:(0,k.msg)("Safety"),environment:(0,k.msg)("Environ"),population:(0,k.msg)("Population"),monthlyIncome:(0,k.msg)("Monthly Income"),monthlyExpenses:(0,k.msg)("Monthly Expenses"),weeklyNet:(0,k.msg)("Weekly Net"),exitToMainMenu:(0,k.msg)("Exit to Main Menu"),exitDialogTitle:(0,k.msg)("Exit to Main Menu"),exitDialogDescription:(0,k.msg)("Would you like to save your city before exiting?"),exitWithoutSaving:(0,k.msg)("Exit Without Saving"),saveAndExit:(0,k.msg)("Save & Exit"),zone:(0,k.msg)("Zone")};function t6(e){let t,r,a,l,o,s,c=(0,n.c)(16),{label:d,demand:h,color:u}=e;c[0]!==h?(t=Math.abs(h),c[0]=h,c[1]=t):t=c[1];let f=Math.min(100,t),m=h>=0,g=`text-[9px] font-bold ${u} w-2`;c[2]!==d||c[3]!==g?(r=(0,i.jsx)("span",{className:g,children:d}),c[2]=d,c[3]=g,c[4]=r):r=c[4],c[5]!==u||c[6]!==m?(a=m?u.replace("text-","bg-"):"bg-red-500",c[5]=u,c[6]=m,c[7]=a):a=c[7];let p=`h-full rounded-full ${a}`,x=`${f}%`;return c[8]!==x?(l={width:x},c[8]=x,c[9]=l):l=c[9],c[10]!==p||c[11]!==l?(o=(0,i.jsx)("div",{className:"w-8 h-1.5 bg-secondary rounded-full overflow-hidden",children:(0,i.jsx)("div",{className:p,style:l})}),c[10]=p,c[11]=l,c[12]=o):o=c[12],c[13]!==r||c[14]!==o?(s=(0,i.jsxs)("div",{className:"flex items-center gap-1",children:[r,o]}),c[13]=r,c[14]=o,c[15]=s):s=c[15],s}function t8(e){let t,r,a,o,s,c,d,h,u,m,g,p,x,y,b,w,v,_,M,S,j,P,T,C,N,z,I,R,Y,X,A,O,E,$,B,L,V,W,D,F,J,U,H,G,q,Q,Z,K,ee,et,er,ea,ei,en,el,eo=(0,n.c)(164),{selectedTile:es,onCloseTile:ec,onShare:ed,onExit:eh,hudDensity:eu}=e,ef=void 0===eu?"compact":eu,{state:em,setSpeed:eg,setTaxRate:ep,saveCity:ex}=eL(),{stats:ey,year:eb,month:ew,speed:ev,taxRate:e_,cityName:eM}=em,[eS,ek]=(0,l.useState)(!1),[ej,eP]=(0,l.useState)(!1),[eT,eC]=(0,l.useState)(!1),eN=(0,k.useMessages)();eo[0]!==eh||eo[1]!==ex?(t=()=>{ex(),eP(!1),eh?.()},eo[0]=eh,eo[1]=ex,eo[2]=t):t=eo[2];let ez=t;eo[3]!==eh?(r=()=>{eP(!1),eh?.()},eo[3]=eh,eo[4]=r):r=eo[4];let eI=r;eo[5]===Symbol.for("react.memo_cache_sentinel")?(a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],eo[5]=a):a=eo[5];let eR=a;eo[6]!==eS?(o=()=>ek(!eS),eo[6]=eS,eo[7]=o):o=eo[7],eo[8]!==eM?(s=(0,i.jsx)("div",{className:"flex items-center gap-1",children:(0,i.jsx)("span",{className:"text-foreground font-semibold text-xs truncate max-w-[80px]",children:eM})}),eo[8]=eM,eo[9]=s):s=eo[9];let eY=eR[ew-1];eo[10]!==eY||eo[11]!==eb?(c=(0,i.jsxs)("span",{className:"text-muted-foreground text-[10px] font-mono",children:[eY," ",eb]}),eo[10]=eY,eo[11]=eb,eo[12]=c):c=eo[12],eo[13]!==s||eo[14]!==c?(d=(0,i.jsxs)("div",{className:"flex flex-col items-start",children:[s,c]}),eo[13]=s,eo[14]=c,eo[15]=d):d=eo[15],eo[16]!==ey.population?(h=ey.population>=1e3?`${(ey.population/1e3).toFixed(1)}k`:ey.population,eo[16]=ey.population,eo[17]=h):h=eo[17],eo[18]!==h?(u=(0,i.jsx)("span",{className:"text-xs font-mono font-semibold text-foreground",children:h}),eo[18]=h,eo[19]=u):u=eo[19],eo[20]!==eN?(m=eN(t9.pop),eo[20]=eN,eo[21]=m):m=eo[21],eo[22]!==m?(g=(0,i.jsx)("span",{className:"text-[9px] text-muted-foreground",children:m}),eo[22]=m,eo[23]=g):g=eo[23],eo[24]!==u||eo[25]!==g?(p=(0,i.jsxs)("div",{className:"flex flex-col items-start",children:[u,g]}),eo[24]=u,eo[25]=g,eo[26]=p):p=eo[26];let eX=`text-xs font-mono font-semibold ${ey.money<0?"text-red-500":ey.money<1e3?"text-amber-500":"text-green-500"}`;eo[27]!==ey.money?(x=ey.money>=1e6?`${(ey.money/1e6).toFixed(1)}M`:ey.money>=1e3?`${(ey.money/1e3).toFixed(0)}k`:ey.money,eo[27]=ey.money,eo[28]=x):x=eo[28],eo[29]!==eX||eo[30]!==x?(y=(0,i.jsxs)("span",{className:eX,children:["$",x]}),eo[29]=eX,eo[30]=x,eo[31]=y):y=eo[31],eo[32]!==eN?(b=eN(t9.funds),eo[32]=eN,eo[33]=b):b=eo[33],eo[34]!==b?(w=(0,i.jsx)("span",{className:"text-[9px] text-muted-foreground",children:b}),eo[34]=b,eo[35]=w):w=eo[35],eo[36]!==y||eo[37]!==w?(v=(0,i.jsxs)("div",{className:"flex flex-col items-start",children:[y,w]}),eo[36]=y,eo[37]=w,eo[38]=v):v=eo[38],eo[39]!==p||eo[40]!==v||eo[41]!==o||eo[42]!==d?(_=(0,i.jsxs)("button",{className:"flex items-center gap-3 min-w-0 active:opacity-70 p-0 m-0 mr-auto",onClick:o,children:[d,p,v]}),eo[39]=p,eo[40]=v,eo[41]=o,eo[42]=d,eo[43]=_):_=eo[43],eo[44]!==eg?(M=()=>eg(0),eo[44]=eg,eo[45]=M):M=eo[45];let eA=`h-6 w-6 min-w-6 p-0 m-0 flex items-center justify-center rounded-none ${0===ev?"bg-primary text-primary-foreground":"text-muted-foreground hover:bg-accent/20"}`;eo[46]===Symbol.for("react.memo_cache_sentinel")?(S=(0,i.jsx)(ts,{size:12}),eo[46]=S):S=eo[46],eo[47]!==M||eo[48]!==eA?(j=(0,i.jsx)("button",{onClick:M,className:eA,title:"Pause",children:S}),eo[47]=M,eo[48]=eA,eo[49]=j):j=eo[49],eo[50]!==eg?(P=()=>eg(1),eo[50]=eg,eo[51]=P):P=eo[51];let eO=`h-6 w-6 min-w-6 p-0 m-0 flex items-center justify-center rounded-none ${1===ev?"bg-primary text-primary-foreground":"text-muted-foreground hover:bg-accent/20"}`;eo[52]===Symbol.for("react.memo_cache_sentinel")?(T=(0,i.jsx)(to,{size:12}),eo[52]=T):T=eo[52],eo[53]!==P||eo[54]!==eO?(C=(0,i.jsx)("button",{onClick:P,className:eO,title:"Normal speed",children:T}),eo[53]=P,eo[54]=eO,eo[55]=C):C=eo[55],eo[56]!==eg?(N=()=>eg(2),eo[56]=eg,eo[57]=N):N=eo[57];let eE=`h-6 w-6 min-w-6 p-0 m-0 flex items-center justify-center rounded-none ${2===ev?"bg-primary text-primary-foreground":"text-muted-foreground hover:bg-accent/20"}`;eo[58]===Symbol.for("react.memo_cache_sentinel")?(z=(0,i.jsxs)("div",{className:"flex items-center -space-x-[5px]",children:[(0,i.jsx)(to,{size:12}),(0,i.jsx)(to,{size:12})]}),eo[58]=z):z=eo[58],eo[59]!==N||eo[60]!==eE?(I=(0,i.jsx)("button",{onClick:N,className:eE,title:"2x speed",children:z}),eo[59]=N,eo[60]=eE,eo[61]=I):I=eo[61],eo[62]!==eg?(R=()=>eg(3),eo[62]=eg,eo[63]=R):R=eo[63];let e$=`h-6 w-6 min-w-6 p-0 m-0 flex items-center justify-center rounded-none ${3===ev?"bg-primary text-primary-foreground":"text-muted-foreground hover:bg-accent/20"}`;return eo[64]===Symbol.for("react.memo_cache_sentinel")?(Y=(0,i.jsxs)("div",{className:"flex items-center -space-x-[7px]",children:[(0,i.jsx)(to,{size:12}),(0,i.jsx)(to,{size:12}),(0,i.jsx)(to,{size:12})]}),eo[64]=Y):Y=eo[64],eo[65]!==R||eo[66]!==e$?(X=(0,i.jsx)("button",{onClick:R,className:e$,title:"3x speed",children:Y}),eo[65]=R,eo[66]=e$,eo[67]=X):X=eo[67],eo[68]!==j||eo[69]!==C||eo[70]!==I||eo[71]!==X?(A=(0,i.jsxs)("div",{className:"flex items-center gap-0 bg-secondary rounded-sm h-6 overflow-hidden p-0 m-0",children:[j,C,I,X]}),eo[68]=j,eo[69]=C,eo[70]=I,eo[71]=X,eo[72]=A):A=eo[72],eo[73]===Symbol.for("react.memo_cache_sentinel")?(O=(0,i.jsx)(t3,{useDrawer:!0,iconSize:12}),eo[73]=O):O=eo[73],eo[74]!==ed?(E=ed&&(0,i.jsx)("button",{onClick:ed,className:"h-6 w-4 p-0 m-0 flex items-center justify-center text-muted-foreground hover:text-foreground",title:"Invite Players",children:(0,i.jsx)(tE.A,{className:"w-3 h-3"})}),eo[74]=ed,eo[75]=E):E=eo[75],eo[76]!==eh?($=eh&&(0,i.jsx)("button",{onClick:()=>eP(!0),className:"h-6 w-4 p-0 m-0 flex items-center justify-center text-muted-foreground hover:text-foreground",title:"Exit to Main Menu",children:(0,i.jsx)("svg",{className:"w-3 h-3 -scale-x-100",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})}),eo[76]=eh,eo[77]=$):$=eo[77],eo[78]!==E||eo[79]!==$?(B=(0,i.jsxs)("div",{className:"flex items-center -space-x-0.5",children:[O,E,$]}),eo[78]=E,eo[79]=$,eo[80]=B):B=eo[80],eo[81]!==A||eo[82]!==B?(L=(0,i.jsxs)("div",{className:"flex items-center gap-1",children:[A,B]}),eo[81]=A,eo[82]=B,eo[83]=L):L=eo[83],eo[84]!==_||eo[85]!==L?(V=(0,i.jsxs)("div",{className:"flex items-center justify-between px-3 py-1.5",children:[_,L]}),eo[84]=_,eo[85]=L,eo[86]=V):V=eo[86],eo[87]!==ef||eo[88]!==eN||eo[89]!==ec||eo[90]!==es||eo[91]!==ep||eo[92]!==eT||eo[93]!==ey.demand||eo[94]!==ey.expenses||eo[95]!==ey.income||eo[96]!==e_?(W="minimal"!==ef&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"flex items-center justify-between px-3 py-1 border-t border-sidebar-border/50 bg-secondary/30",children:[(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)(t6,{label:"R",demand:ey.demand.residential,color:"text-green-500"}),(0,i.jsx)(t6,{label:"C",demand:ey.demand.commercial,color:"text-blue-500"}),(0,i.jsx)(t6,{label:"I",demand:ey.demand.industrial,color:"text-amber-500"})]}),(0,i.jsxs)("button",{className:"flex items-center gap-1 active:opacity-70",onClick:()=>{let e=!eT;eC(e),e&&es&&ec()},children:[(0,i.jsx)("span",{className:"text-[9px] text-muted-foreground",children:eN(t9.tax)}),(0,i.jsxs)("span",{className:"text-[10px] font-mono text-foreground",children:[e_,"%"]})]}),(0,i.jsx)("div",{className:"flex items-center gap-1",children:(0,i.jsxs)("span",{className:`text-[10px] font-mono ${ey.income-ey.expenses>=0?"text-green-400":"text-red-400"}`,children:[ey.income-ey.expenses>=0?"+":"","$",(ey.income-ey.expenses).toLocaleString(),"/mo"]})})]}),eT&&!es&&(0,i.jsxs)("div",{className:"border-t border-sidebar-border/50 bg-secondary/30 px-3 py-0.5 flex items-center gap-2 text-[10px]",children:[(0,i.jsx)("span",{className:"text-muted-foreground whitespace-nowrap",children:eN(t9.taxRate)}),(0,i.jsx)(tX,{value:[e_],onValueChange:e=>ep(e[0]),min:0,max:100,step:1,className:"flex-1"}),(0,i.jsxs)("span",{className:"font-mono text-foreground w-8 text-right shrink-0",children:[e_,"%"]}),(0,i.jsx)("button",{onClick:()=>eC(!1),className:"text-muted-foreground hover:text-foreground transition-colors shrink-0",children:(0,i.jsx)(tc,{size:12})})]})]}),eo[87]=ef,eo[88]=eN,eo[89]=ec,eo[90]=es,eo[91]=ep,eo[92]=eT,eo[93]=ey.demand,eo[94]=ey.expenses,eo[95]=ey.income,eo[96]=e_,eo[97]=W):W=eo[97],eo[98]!==ef||eo[99]!==ey.education||eo[100]!==ey.environment||eo[101]!==ey.expenses||eo[102]!==ey.happiness||eo[103]!==ey.health||eo[104]!==ey.income||eo[105]!==ey.safety?(D="full"===ef&&(0,i.jsx)("div",{className:"border-t border-sidebar-border/50 bg-secondary/20 px-3 py-1.5",children:(0,i.jsxs)("div",{className:"grid grid-cols-3 gap-2 text-[10px]",children:[(0,i.jsxs)("div",{className:"text-muted-foreground",children:["HAP ",(0,i.jsxs)("span",{className:"text-foreground font-mono",children:[Math.round(ey.happiness),"%"]})]}),(0,i.jsxs)("div",{className:"text-muted-foreground",children:["HLT ",(0,i.jsxs)("span",{className:"text-foreground font-mono",children:[Math.round(ey.health),"%"]})]}),(0,i.jsxs)("div",{className:"text-muted-foreground",children:["EDU ",(0,i.jsxs)("span",{className:"text-foreground font-mono",children:[Math.round(ey.education),"%"]})]}),(0,i.jsxs)("div",{className:"text-muted-foreground",children:["SFT ",(0,i.jsxs)("span",{className:"text-foreground font-mono",children:[Math.round(ey.safety),"%"]})]}),(0,i.jsxs)("div",{className:"text-muted-foreground",children:["ENV ",(0,i.jsxs)("span",{className:"text-foreground font-mono",children:[Math.round(ey.environment),"%"]})]}),(0,i.jsxs)("div",{className:`font-mono ${ey.income-ey.expenses>=0?"text-green-400":"text-red-400"}`,children:[ey.income-ey.expenses>=0?"+":"","$",(ey.income-ey.expenses).toLocaleString()]})]})}),eo[98]=ef,eo[99]=ey.education,eo[100]=ey.environment,eo[101]=ey.expenses,eo[102]=ey.happiness,eo[103]=ey.health,eo[104]=ey.income,eo[105]=ey.safety,eo[106]=D):D=eo[106],eo[107]!==eN||eo[108]!==ec||eo[109]!==es?(F=es&&(0,i.jsxs)("div",{className:"border-t border-sidebar-border/50 bg-gradient-to-b from-secondary/60 to-secondary/20 px-3 py-0.5 flex items-center gap-2 text-[10px]",children:[(0,i.jsxs)("div",{className:"flex items-center gap-1.5 shrink-0",children:[(0,i.jsx)("div",{className:`w-2 h-2 rounded-full ${"residential"===es.zone?"bg-green-500":"commercial"===es.zone?"bg-blue-500":"industrial"===es.zone?"bg-amber-500":"bg-muted-foreground/40"}`}),(0,i.jsx)("span",{className:"text-xs font-medium text-foreground capitalize",children:"empty"===es.building.type?"none"===es.zone?eN(t9.emptyLot):`${es.zone} ${eN(t9.zone)}`:es.building.type.replace(/_/g," ")})]}),es.building.population>0&&(0,i.jsxs)("div",{className:"flex items-center gap-1 shrink-0",children:[(0,i.jsx)(tm,{size:10,className:"text-muted-foreground"}),(0,i.jsx)("span",{className:"text-foreground font-mono",children:es.building.population})]}),es.building.jobs>0&&(0,i.jsxs)("span",{className:"text-foreground font-mono shrink-0",children:[es.building.jobs," ",eN(t9.jobsLower)]}),(0,i.jsx)("span",{className:`shrink-0 ${es.building.powered?"text-yellow-400":"text-muted-foreground/60"}`,children:eN(es.building.powered?t9.hasPower:t9.noPower)}),(0,i.jsx)("span",{className:`shrink-0 ${es.building.watered?"text-cyan-400":"text-muted-foreground/60"}`,children:eN(es.building.watered?t9.hasWater:t9.noWater)}),(0,i.jsxs)("div",{className:"flex items-center gap-1 text-muted-foreground shrink-0",children:[(0,i.jsx)(tg,{size:10}),(0,i.jsx)("span",{className:"font-mono text-foreground",children:es.landValue})]}),es.pollution>0&&(0,i.jsxs)("div",{className:"flex items-center gap-1 shrink-0",children:[(0,i.jsx)("div",{className:`w-1.5 h-1.5 rounded-full ${es.pollution>50?"bg-red-500":es.pollution>25?"bg-amber-500":"bg-green-500"}`}),(0,i.jsxs)("span",{className:`font-mono ${es.pollution>50?"text-red-400":es.pollution>25?"text-amber-400":"text-green-400"}`,children:[Math.round(es.pollution),"%"]})]}),(0,i.jsx)("div",{className:"flex-1"}),(0,i.jsx)("button",{onClick:ec,className:"text-muted-foreground hover:text-foreground transition-colors shrink-0",children:(0,i.jsx)(tc,{size:12})})]}),eo[107]=eN,eo[108]=ec,eo[109]=es,eo[110]=F):F=eo[110],eo[111]!==V||eo[112]!==W||eo[113]!==D||eo[114]!==F?(J=(0,i.jsxs)(tr,{className:"fixed top-0 left-0 right-0 z-40 rounded-none border-x-0 border-t-0 bg-card/95 backdrop-blur-sm safe-area-top",children:[V,W,D,F]}),eo[111]=V,eo[112]=W,eo[113]=D,eo[114]=F,eo[115]=J):J=eo[115],eo[116]!==eN||eo[117]!==ep||eo[118]!==eS||eo[119]!==ey.education||eo[120]!==ey.environment||eo[121]!==ey.expenses||eo[122]!==ey.happiness||eo[123]!==ey.health||eo[124]!==ey.income||eo[125]!==ey.jobs||eo[126]!==ey.population||eo[127]!==ey.safety||eo[128]!==e_?(U=eS&&(0,i.jsx)("div",{className:"fixed inset-0 z-30 bg-black/50 backdrop-blur-sm pt-[72px]",onClick:()=>ek(!1),children:(0,i.jsxs)(tr,{className:"mx-2 mt-2 rounded-xl overflow-hidden",onClick:t7,children:[(0,i.jsxs)("div",{className:"p-4 grid grid-cols-5 gap-3",children:[(0,i.jsx)(re,{icon:(0,i.jsx)(tp,{size:16}),label:String(eN(t9.happiness)),value:ey.happiness,color:ey.happiness>=70?"text-green-500":ey.happiness>=40?"text-amber-500":"text-red-500"}),(0,i.jsx)(re,{icon:(0,i.jsx)(tx,{size:16}),label:String(eN(t9.health)),value:ey.health,color:ey.health>=70?"text-green-500":ey.health>=40?"text-amber-500":"text-red-500"}),(0,i.jsx)(re,{icon:(0,i.jsx)(ty,{size:16}),label:String(eN(t9.education)),value:ey.education,color:ey.education>=70?"text-green-500":ey.education>=40?"text-amber-500":"text-red-500"}),(0,i.jsx)(re,{icon:(0,i.jsx)(tb,{size:16}),label:String(eN(t9.safety)),value:ey.safety,color:ey.safety>=70?"text-green-500":ey.safety>=40?"text-amber-500":"text-red-500"}),(0,i.jsx)(re,{icon:(0,i.jsx)(tw,{size:16}),label:String(eN(t9.environment)),value:ey.environment,color:ey.environment>=70?"text-green-500":ey.environment>=40?"text-amber-500":"text-red-500"})]}),(0,i.jsx)(tO,{}),(0,i.jsxs)("div",{className:"p-4 space-y-3",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)("span",{className:"text-sm text-muted-foreground",children:eN(t9.population)}),(0,i.jsx)("span",{className:"text-sm font-mono text-foreground",children:ey.population.toLocaleString()})]}),(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)("span",{className:"text-sm text-muted-foreground",children:eN(t9.jobs)}),(0,i.jsx)("span",{className:"text-sm font-mono text-foreground",children:ey.jobs.toLocaleString()})]}),(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)("span",{className:"text-sm text-muted-foreground",children:eN(t9.monthlyIncome)}),(0,i.jsxs)("span",{className:"text-sm font-mono text-green-400",children:["$",ey.income.toLocaleString()]})]}),(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)("span",{className:"text-sm text-muted-foreground",children:eN(t9.monthlyExpenses)}),(0,i.jsxs)("span",{className:"text-sm font-mono text-red-400",children:["$",ey.expenses.toLocaleString()]})]}),(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)("span",{className:"text-sm text-muted-foreground",children:eN(t9.weeklyNet)}),(0,i.jsxs)("span",{className:`text-sm font-mono ${ey.income-ey.expenses>=0?"text-green-400":"text-red-400"}`,children:["$",Math.floor((ey.income-ey.expenses)/4).toLocaleString()]})]})]}),(0,i.jsx)(tO,{}),(0,i.jsxs)("div",{className:"p-4",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,i.jsx)("span",{className:"text-sm text-muted-foreground",children:eN(t9.taxRate)}),(0,i.jsxs)("span",{className:"text-sm font-mono text-foreground",children:[e_,"%"]})]}),(0,i.jsx)(tX,{value:[e_],onValueChange:e=>ep(e[0]),min:0,max:100,step:1,className:"w-full"}),(0,i.jsxs)("div",{className:"flex justify-between mt-1 text-[10px] text-muted-foreground",children:[(0,i.jsx)("span",{children:"0%"}),(0,i.jsx)("span",{children:"100%"})]})]})]})}),eo[116]=eN,eo[117]=ep,eo[118]=eS,eo[119]=ey.education,eo[120]=ey.environment,eo[121]=ey.expenses,eo[122]=ey.happiness,eo[123]=ey.health,eo[124]=ey.income,eo[125]=ey.jobs,eo[126]=ey.population,eo[127]=ey.safety,eo[128]=e_,eo[129]=U):U=eo[129],eo[130]!==eN?(H=eN(t9.exitDialogTitle),eo[130]=eN,eo[131]=H):H=eo[131],eo[132]!==H?(G=(0,i.jsx)(tJ,{children:H}),eo[132]=H,eo[133]=G):G=eo[133],eo[134]!==eN?(q=eN(t9.exitDialogDescription),eo[134]=eN,eo[135]=q):q=eo[135],eo[136]!==q?(Q=(0,i.jsx)(tU,{children:q}),eo[136]=q,eo[137]=Q):Q=eo[137],eo[138]!==G||eo[139]!==Q?(Z=(0,i.jsxs)(tD,{children:[G,Q]}),eo[138]=G,eo[139]=Q,eo[140]=Z):Z=eo[140],eo[141]!==eN?(K=eN(t9.exitWithoutSaving),eo[141]=eN,eo[142]=K):K=eo[142],eo[143]!==eI||eo[144]!==K?(ee=(0,i.jsx)(f,{variant:"outline",onClick:eI,className:"w-full sm:w-auto",children:K}),eo[143]=eI,eo[144]=K,eo[145]=ee):ee=eo[145],eo[146]!==eN?(et=eN(t9.saveAndExit),eo[146]=eN,eo[147]=et):et=eo[147],eo[148]!==ez||eo[149]!==et?(er=(0,i.jsx)(f,{onClick:ez,className:"w-full sm:w-auto",children:et}),eo[148]=ez,eo[149]=et,eo[150]=er):er=eo[150],eo[151]!==ee||eo[152]!==er?(ea=(0,i.jsxs)(tF,{className:"flex-col sm:flex-row gap-2",children:[ee,er]}),eo[151]=ee,eo[152]=er,eo[153]=ea):ea=eo[153],eo[154]!==Z||eo[155]!==ea?(ei=(0,i.jsxs)(tW,{className:"sm:max-w-md",children:[Z,ea]}),eo[154]=Z,eo[155]=ea,eo[156]=ei):ei=eo[156],eo[157]!==ej||eo[158]!==ei?(en=(0,i.jsx)(tB,{open:ej,onOpenChange:eP,children:ei}),eo[157]=ej,eo[158]=ei,eo[159]=en):en=eo[159],eo[160]!==J||eo[161]!==U||eo[162]!==en?(el=(0,i.jsxs)(i.Fragment,{children:[J,U,en]}),eo[160]=J,eo[161]=U,eo[162]=en,eo[163]=el):el=eo[163],el}function t7(e){return e.stopPropagation()}function re(e){let t,r,a,l,o,s=(0,n.c)(13),{icon:c,label:d,value:h,color:u}=e;s[0]!==c?(t=(0,i.jsx)("span",{className:"text-muted-foreground",children:c}),s[0]=c,s[1]=t):t=s[1];let f=`text-sm font-mono font-semibold ${u}`;return s[2]!==h?(r=Math.round(h),s[2]=h,s[3]=r):r=s[3],s[4]!==f||s[5]!==r?(a=(0,i.jsxs)("span",{className:f,children:[r,"%"]}),s[4]=f,s[5]=r,s[6]=a):a=s[6],s[7]!==d?(l=(0,i.jsx)("span",{className:"text-[9px] text-muted-foreground",children:d}),s[7]=d,s[8]=l):l=s[8],s[9]!==t||s[10]!==a||s[11]!==l?(o=(0,i.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[t,a,l]}),s[9]=t,s[10]=a,s[11]=l,s[12]=o):o=s[12],o}var rt=r(292);let rr=rt.Kq,ra=rt.bL,ri=rt.l9,rn=l.forwardRef(({className:e,sideOffset:t=4,...r},a)=>(0,i.jsx)(rt.UC,{ref:a,sideOffset:t,className:h("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r}));rn.displayName=rt.UC.displayName;let rl=["ArrowUp","ArrowUp","ArrowDown","ArrowDown","ArrowLeft","ArrowRight","ArrowLeft","ArrowRight","b","a"];function ro(e,t){return e===rl[t].toLowerCase()}function rs(e){return!!e?.closest('input, textarea, select, [contenteditable="true"]')}function rc(e){let t,r,a,l,o,s,c,d,h,u=(0,n.c)(22),{open:m,onOpenChange:g}=e,{addMoney:p,addNotification:x}=eL();u[0]!==p||u[1]!==x||u[2]!==g?(t=()=>{p(5e5),x("Questionable Finances","You received $500,000 from Cousin Vinnie. Your accountants are... concerned.","disaster"),g(!1)},u[0]=p,u[1]=x,u[2]=g,u[3]=t):t=u[3];let y=t;u[4]!==p||u[5]!==x||u[6]!==g?(r=()=>{p(1e4),x("Integrity Bonus","You declined Vinnie's offer. A mysterious benefactor rewards your honesty with $10,000.","trophy"),g(!1)},u[4]=p,u[5]=x,u[6]=g,u[7]=r):r=u[7];let b=r;return u[8]===Symbol.for("react.memo_cache_sentinel")?(a=(0,i.jsx)(tJ,{className:"text-sky-400",children:"A Shady Offer"}),u[8]=a):a=u[8],u[9]===Symbol.for("react.memo_cache_sentinel")?(l=(0,i.jsx)("p",{className:"mb-2",children:"Hey there, Mayor... My associate Vinnie heard you could use some help with the city budget."}),u[9]=l):l=u[9],u[10]===Symbol.for("react.memo_cache_sentinel")?(o=(0,i.jsxs)(tD,{children:[a,(0,i.jsx)(tU,{asChild:!0,children:(0,i.jsxs)("div",{className:"text-slate-300 pt-2",children:[l,(0,i.jsxs)("p",{className:"mb-2",children:["He's offering ",(0,i.jsx)("span",{className:"text-green-400 font-semibold",children:"$500,000"}),"... no strings attached."]}),(0,i.jsx)("p",{className:"text-slate-400 italic",children:"Well, maybe a few strings."})]})})]}),u[10]=o):o=u[10],u[11]!==b?(s=(0,i.jsx)(f,{variant:"outline",onClick:b,className:"border-slate-600 text-slate-200 hover:bg-slate-800",children:"Decline"}),u[11]=b,u[12]=s):s=u[12],u[13]!==y?(c=(0,i.jsx)(f,{onClick:y,className:"bg-blue-600 hover:bg-blue-700 text-white",children:"Accept Offer"}),u[13]=y,u[14]=c):c=u[14],u[15]!==s||u[16]!==c?(d=(0,i.jsxs)(tW,{className:"bg-slate-900 border-slate-700 text-slate-100",children:[o,(0,i.jsxs)(tF,{className:"gap-2",children:[s,c]})]}),u[15]=s,u[16]=c,u[17]=d):d=u[17],u[18]!==g||u[19]!==m||u[20]!==d?(h=(0,i.jsx)(tB,{open:m,onOpenChange:g,children:d}),u[18]=g,u[19]=m,u[20]=d,u[21]=h):h=u[21],h}let rd=l.forwardRef(({className:e,type:t,...r},a)=>(0,i.jsx)("input",{type:t,className:h("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:a,...r}));rd.displayName="Input";var rh=r(5156);let ru=l.forwardRef(({className:e,children:t,...r},a)=>(0,i.jsxs)(rh.bL,{ref:a,className:h("relative overflow-hidden",e),...r,children:[(0,i.jsx)(rh.LM,{className:"h-full w-full rounded-[inherit] [&>div]:!block [&>div]:h-full",style:{WebkitOverflowScrolling:"touch"},children:t}),(0,i.jsx)(rf,{}),(0,i.jsx)(rh.OK,{})]}));ru.displayName=rh.bL.displayName;let rf=l.forwardRef(({className:e,orientation:t="vertical",...r},a)=>(0,i.jsx)(rh.VM,{ref:a,orientation:t,className:h("flex touch-none select-none transition-colors","vertical"===t&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===t&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...r,children:(0,i.jsx)(rh.lr,{className:"relative flex-1 rounded-full bg-border"})}));rf.displayName=rh.VM.displayName;var rm=r(5295);let rg=null;function rp(){rg?.()}let rx=[{key:"tools",label:(0,k.msg)("Tools")},{key:"zones",label:(0,k.msg)("Zones")},{key:"zoning",label:(0,k.msg)("Zoning")},{key:"services",label:(0,k.msg)("Services")},{key:"parks",label:(0,k.msg)("Parks")},{key:"sports",label:(0,k.msg)("Sports")},{key:"waterfront",label:(0,k.msg)("Waterfront")},{key:"community",label:(0,k.msg)("Community")},{key:"utilities",label:(0,k.msg)("Utilities")},{key:"special",label:(0,k.msg)("Special")},{key:"panels",label:(0,k.msg)("Panels")}],ry=(a=[],["select","bulldoze","road","rail","subway"].forEach(e=>{let t=j[e];a.push({id:e,type:"tool",tool:e,name:t.name,description:t.description,cost:t.cost,category:"tools",keywords:[t.name.toLowerCase(),e,"tool","infrastructure"]})}),["zone_residential","zone_commercial","zone_industrial"].forEach(e=>{let t=j[e];a.push({id:e,type:"tool",tool:e,name:t.name,description:t.description,cost:t.cost,category:"zones",keywords:[t.name.toLowerCase(),e,"zone"]})}),["zone_dezone","zone_water","zone_land"].forEach(e=>{let t=j[e],r=[t.name.toLowerCase(),e,"zoning"];"zone_water"===e?r.push("water","terraform","lake","ocean"):"zone_land"===e?r.push("land","terraform","grass","fill"):r.push("remove","clear"),a.push({id:e,type:"tool",tool:e,name:t.name,description:t.description,cost:t.cost,category:"zoning",keywords:r})}),["police_station","fire_station","hospital","school","university"].forEach(e=>{let t=j[e];a.push({id:e,type:"tool",tool:e,name:t.name,description:t.description,cost:t.cost,category:"services",keywords:[t.name.toLowerCase(),e,"service","building"]})}),["tree","park","park_large","tennis","playground_small","playground_large","community_garden","pond_park","park_gate","greenhouse_garden","mini_golf_course","go_kart_track","amphitheater","roller_coaster_small","campground","cabin_house","mountain_lodge","mountain_trailhead"].forEach(e=>{let t=j[e];a.push({id:e,type:"tool",tool:e,name:t.name,description:t.description,cost:t.cost,category:"parks",keywords:[t.name.toLowerCase(),e,"park","green","nature","recreation","entertainment"]})}),["basketball_courts","soccer_field_small","baseball_field_small","football_field","baseball_stadium","swimming_pool","skate_park","bleachers_field"].forEach(e=>{let t=j[e];a.push({id:e,type:"tool",tool:e,name:t.name,description:t.description,cost:t.cost,category:"sports",keywords:[t.name.toLowerCase(),e,"sports","recreation","field"]})}),["marina_docks_small","pier_large"].forEach(e=>{let t=j[e];a.push({id:e,type:"tool",tool:e,name:t.name,description:t.description,cost:t.cost,category:"waterfront",keywords:[t.name.toLowerCase(),e,"water","waterfront","dock","pier","marina"]})}),["community_center","animal_pens_farm","office_building_small"].forEach(e=>{let t=j[e];a.push({id:e,type:"tool",tool:e,name:t.name,description:t.description,cost:t.cost,category:"community",keywords:[t.name.toLowerCase(),e,"community","building"]})}),["power_plant","water_tower","subway_station","rail_station"].forEach(e=>{let t=j[e];a.push({id:e,type:"tool",tool:e,name:t.name,description:t.description,cost:t.cost,category:"utilities",keywords:[t.name.toLowerCase(),e,"utility","power","water","infrastructure","transit","station","train"]})}),["stadium","museum","airport","space_program","city_hall","amusement_park"].forEach(e=>{let t=j[e];a.push({id:e,type:"tool",tool:e,name:t.name,description:t.description,cost:t.cost,category:"special",keywords:[t.name.toLowerCase(),e,"special","landmark","attraction"]})}),[{panel:"budget",name:"Budget",description:"Manage city finances and funding",keywords:["budget","money","finance","tax","funding"]},{panel:"statistics",name:"Statistics",description:"View city statistics and charts",keywords:["statistics","stats","charts","data","info"]},{panel:"advisors",name:"Advisors",description:"Get advice from city advisors",keywords:["advisors","advice","help","tips"]},{panel:"settings",name:"Settings",description:"Game settings and preferences",keywords:["settings","options","preferences","config"]}].forEach(({panel:e,name:t,description:r,keywords:i})=>{a.push({id:`panel-${e}`,type:"panel",panel:e,name:t,description:r,category:"panels",keywords:i})}),a);function rb(){let e,t,r,a,o,s,c,d,u,f,m,g,p,x,y,b,w,v,_,M,S,j,P,T,C,N,z=(0,n.c)(53),{isMobileDevice:I}=tt(),{state:R,setTool:Y,setActivePanel:X}=eL(),{stats:A}=R,O=(0,k.useMessages)(),[E,$]=(0,l.useState)(!1),[B,L]=(0,l.useState)(""),[V,W]=(0,l.useState)(0),D=(0,l.useRef)(null),F=(0,l.useRef)(null);z[0]===Symbol.for("react.memo_cache_sentinel")?(e=e=>{L(e),W(0)},z[0]=e):e=z[0];let J=e;z[1]===Symbol.for("react.memo_cache_sentinel")?(t=e=>{$(e),e&&(L(""),W(0),setTimeout(()=>D.current?.focus(),50))},z[1]=t):t=z[1];let U=t;z[2]===Symbol.for("react.memo_cache_sentinel")?(r=()=>(rg=()=>U(!0),rv),a=[U],z[2]=r,z[3]=a):(r=z[2],a=z[3]),(0,l.useEffect)(r,a);e:{let e;if(!B.trim()){o=ry;break e}if(z[4]!==O||z[5]!==B){let t=B.toLowerCase().trim();e=ry.filter(e=>!!(String(O(e.name)).toLowerCase().includes(t)||String(O(e.description)).toLowerCase().includes(t)||e.keywords.some(e=>e.includes(t))||e.category.includes(t))),z[4]=O,z[5]=B,z[6]=e}else e=z[6];o=e}let H=o;z[7]!==H?(s={},H.forEach(e=>{s[e.category]||(s[e.category]=[]),s[e.category].push(e)}),z[7]=H,z[8]=s):s=z[8];let G=s;z[9]!==G?(c=[],rx.forEach(e=>{G[e.key]&&c.push(...G[e.key])}),z[9]=G,z[10]=c):c=z[10];let q=c;z[11]!==I?(d=()=>{if(I)return;let e=e=>{(e.metaKey||e.ctrlKey)&&"k"===e.key&&(e.preventDefault(),$(rw))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},u=[I],z[11]=I,z[12]=d,z[13]=u):(d=z[12],u=z[13]),(0,l.useEffect)(d,u),z[14]!==X||z[15]!==Y||z[16]!==R.activePanel?(f=e=>{"tool"===e.type&&e.tool?Y(e.tool):"panel"===e.type&&e.panel&&X(R.activePanel===e.panel?"none":e.panel),$(!1)},z[14]=X,z[15]=Y,z[16]=R.activePanel,z[17]=f):f=z[17];let Q=f;z[18]!==q.length||z[19]!==V?(m=()=>{if(!F.current||0===q.length)return;let e=F.current.querySelector(`[data-index="${V}"]`);e&&e.scrollIntoView({block:"nearest"})},g=[V,q.length],z[18]=q.length,z[19]=V,z[20]=m,z[21]=g):(m=z[20],g=z[21]),(0,l.useEffect)(m,g),z[22]!==q||z[23]!==Q||z[24]!==V?(p=e=>{switch(e.key){case"ArrowDown":e.preventDefault(),W(e=>(e+1)%q.length);break;case"ArrowUp":e.preventDefault(),W(e=>(e-1+q.length)%q.length);break;case"Enter":e.preventDefault(),q[V]&&Q(q[V]);break;case"Escape":e.preventDefault(),$(!1)}},z[22]=q,z[23]=Q,z[24]=V,z[25]=p):p=z[25];let Z=p;return I?null:(z[26]===Symbol.for("react.memo_cache_sentinel")?(x=(0,i.jsx)(rm.bL,{children:(0,i.jsx)(tJ,{children:"Command Menu"})}),z[26]=x):x=z[26],z[27]===Symbol.for("react.memo_cache_sentinel")?(y=(0,i.jsx)("svg",{className:"w-4 h-4 text-muted-foreground shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),z[27]=y):y=z[27],z[28]===Symbol.for("react.memo_cache_sentinel")?(b=e=>J(e.target.value),z[28]=b):b=z[28],z[29]!==B?(w=(0,i.jsx)(rd,{ref:D,value:B,onChange:b,placeholder:"Search tools, buildings, panels...",className:"border-0 focus-visible:ring-0 focus-visible:ring-offset-0 bg-transparent h-12 text-sm"}),z[29]=B,z[30]=w):w=z[30],z[31]===Symbol.for("react.memo_cache_sentinel")?(v=(0,i.jsx)("kbd",{className:"hidden sm:inline-flex h-5 select-none items-center gap-1 rounded border border-sidebar-border bg-muted px-1.5 font-mono text-[10px] font-medium text-muted-foreground",children:"ESC"}),z[31]=v):v=z[31],z[32]!==w?(_=(0,i.jsxs)("div",{className:"flex items-center border-b border-sidebar-border px-3",children:[y,w,v]}),z[32]=w,z[33]=_):_=z[33],z[34]!==q||z[35]!==G||z[36]!==Q||z[37]!==O||z[38]!==V||z[39]!==A?(M=0===q.length?(0,i.jsx)("div",{className:"py-6 text-center text-sm text-muted-foreground",children:"No results found."}):rx.map(e=>{let t=G[e.key];return t&&0!==t.length?(0,i.jsxs)("div",{className:"mb-2",children:[(0,i.jsx)("div",{className:"px-2 py-1.5 text-[10px] font-bold tracking-widest text-muted-foreground uppercase",children:O(e.label)}),(0,i.jsx)("div",{className:"flex flex-col gap-0.5",children:t.map(e=>{let t=q.indexOf(e),r=t===V,a=void 0===e.cost||0===e.cost||A.money>=e.cost;return(0,i.jsxs)("button",{"data-index":t,onClick:()=>Q(e),disabled:!a,className:h("flex items-center justify-between gap-2 px-3 py-2 rounded-sm text-sm transition-colors text-left w-full",r?"bg-primary text-primary-foreground":"hover:bg-muted/60",!a&&"opacity-50 cursor-not-allowed"),children:[(0,i.jsxs)("div",{className:"flex flex-col gap-0.5 min-w-0",children:[(0,i.jsx)("span",{className:"font-medium truncate",children:O(e.name)}),(0,i.jsx)("span",{className:h("text-xs truncate",r?"text-primary-foreground/70":"text-muted-foreground"),children:O(e.description)})]}),void 0!==e.cost&&e.cost>0&&(0,i.jsxs)("span",{className:h("text-xs shrink-0",r?"text-primary-foreground/70":"text-muted-foreground"),children:["$",e.cost.toLocaleString()]})]},e.id)})})]},e.key):null}),z[34]=q,z[35]=G,z[36]=Q,z[37]=O,z[38]=V,z[39]=A,z[40]=M):M=z[40],z[41]!==M?(S=(0,i.jsx)(ru,{className:"max-h-[360px]",children:(0,i.jsx)("div",{ref:F,className:"p-2",children:M})}),z[41]=M,z[42]=S):S=z[42],z[43]===Symbol.for("react.memo_cache_sentinel")?(j=(0,i.jsxs)("span",{className:"flex items-center gap-1",children:[(0,i.jsx)("kbd",{className:"inline-flex h-4 items-center rounded border border-sidebar-border bg-muted px-1 font-mono text-[10px]",children:""}),(0,i.jsx)("kbd",{className:"inline-flex h-4 items-center rounded border border-sidebar-border bg-muted px-1 font-mono text-[10px]",children:""}),(0,i.jsx)("span",{children:"navigate"})]}),z[43]=j):j=z[43],z[44]===Symbol.for("react.memo_cache_sentinel")?(P=(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[j,(0,i.jsxs)("span",{className:"flex items-center gap-1",children:[(0,i.jsx)("kbd",{className:"inline-flex h-4 items-center rounded border border-sidebar-border bg-muted px-1 font-mono text-[10px]",children:""}),(0,i.jsx)("span",{children:"select"})]})]}),z[44]=P):P=z[44],z[45]===Symbol.for("react.memo_cache_sentinel")?(T=(0,i.jsxs)("div",{className:"flex items-center justify-between border-t border-sidebar-border px-3 py-2 text-xs text-muted-foreground",children:[P,(0,i.jsxs)("span",{className:"flex items-center gap-1",children:[(0,i.jsx)("kbd",{className:"inline-flex h-4 items-center rounded border border-sidebar-border bg-muted px-1 font-mono text-[10px]",children:""}),(0,i.jsx)("kbd",{className:"inline-flex h-4 items-center rounded border border-sidebar-border bg-muted px-1 font-mono text-[10px]",children:"K"}),(0,i.jsx)("span",{children:"to toggle"})]})]}),z[45]=T):T=z[45],z[46]!==Z||z[47]!==_||z[48]!==S?(C=(0,i.jsxs)(tW,{className:"p-0 gap-0 max-w-lg overflow-hidden bg-sidebar border-sidebar-border shadow-2xl",onKeyDown:Z,children:[x,_,S,T]}),z[46]=Z,z[47]=_,z[48]=S,z[49]=C):C=z[49],z[50]!==E||z[51]!==C?(N=(0,i.jsx)(tB,{open:E,onOpenChange:U,children:C}),z[50]=E,z[51]=C,z[52]=N):N=z[52],N)}function rw(e){return!e}function rv(){rg=null}var r_=r(9272),rM=r(8079),rS=r(3574),rk=r(7325);function rj(e){let t,r,a,o,s,c,d,u,m,g,p,x,y,b,w,v,_,M,S,j,P,T=(0,n.c)(39),{message:C,isVisible:N,onContinue:z,onSkipAll:I}=e,R=(0,k.useGT)(),Y=(0,k.useMessages)(),[X,A]=(0,l.useState)(!1),[O,E]=(0,l.useState)(!1);return(T[0]!==N?(t=()=>{if(N){E(!0);let e=requestAnimationFrame(()=>{requestAnimationFrame(()=>{A(!0)})});return()=>cancelAnimationFrame(e)}{A(!1);let e=setTimeout(()=>{E(!1)},300);return()=>clearTimeout(e)}},r=[N],T[0]=N,T[1]=t,T[2]=r):(t=T[1],r=T[2]),(0,l.useEffect)(t,r),O)?(T[3]!==X?(a=h("fixed z-[9999] pointer-events-auto","transition-all duration-300 ease-out","top-20 left-3 right-3","md:top-auto md:bottom-6 md:left-1/2 md:right-auto md:-translate-x-1/2",X?"opacity-100 translate-y-0":h("opacity-0","max-md:-translate-y-4","md:translate-y-4")),T[3]=X,T[4]=a):a=T[4],T[5]===Symbol.for("react.memo_cache_sentinel")?(o={position:"fixed"},T[5]=o):o=T[5],T[6]===Symbol.for("react.memo_cache_sentinel")?(s=(0,i.jsx)("div",{className:"absolute top-0 left-0 right-0 h-0.5 bg-gradient-to-r from-transparent via-primary to-transparent"}),T[6]=s):s=T[6],T[7]===Symbol.for("react.memo_cache_sentinel")?(c=(0,i.jsx)("div",{className:"flex-shrink-0 w-10 h-10 rounded-sm bg-primary/10 border border-primary/20 flex items-center justify-center",children:(0,i.jsx)(r_.A,{className:"w-5 h-5 text-primary"})}),T[7]=c):c=T[7],T[8]!==Y||T[9]!==C?(d=Y(C),T[8]=Y,T[9]=C,T[10]=d):d=T[10],T[11]!==d?(u=(0,i.jsx)("div",{className:"flex-1 min-w-0",children:(0,i.jsx)("p",{className:"text-sm font-medium text-foreground leading-relaxed",children:d})}),T[11]=d,T[12]=u):u=T[12],T[13]!==R?(m=R("Dismiss tip"),T[13]=R,T[14]=m):m=T[14],T[15]===Symbol.for("react.memo_cache_sentinel")?(g=(0,i.jsx)(rM.A,{className:"w-4 h-4"}),T[15]=g):g=T[15],T[16]!==z||T[17]!==m?(p=(0,i.jsx)("button",{onClick:z,className:"flex-shrink-0 p-1 text-muted-foreground hover:text-foreground transition-colors","aria-label":m,children:g}),T[16]=z,T[17]=m,T[18]=p):p=T[18],T[19]!==p||T[20]!==u?(x=(0,i.jsxs)("div",{className:"p-4 flex items-start gap-3",children:[c,u,p]}),T[19]=p,T[20]=u,T[21]=x):x=T[21],T[22]===Symbol.for("react.memo_cache_sentinel")?(y=(0,i.jsxs)(k.T,{children:[(0,i.jsx)(rS.A,{className:"w-3.5 h-3.5"}),"Skip All Tips"]}),T[22]=y):y=T[22],T[23]!==I?(b=(0,i.jsx)(f,{variant:"ghost",size:"sm",onClick:I,className:"text-xs text-muted-foreground hover:text-foreground gap-1",children:y}),T[23]=I,T[24]=b):b=T[24],T[25]===Symbol.for("react.memo_cache_sentinel")?(w=(0,i.jsxs)(k.T,{children:["Continue",(0,i.jsx)(rk.A,{className:"w-3.5 h-3.5"})]}),T[25]=w):w=T[25],T[26]!==z?(v=(0,i.jsx)(f,{variant:"default",size:"sm",onClick:z,className:"text-xs gap-1",children:w}),T[26]=z,T[27]=v):v=T[27],T[28]!==b||T[29]!==v?(_=(0,i.jsxs)("div",{className:"px-4 pb-4 flex items-center gap-2 justify-end",children:[b,v]}),T[28]=b,T[29]=v,T[30]=_):_=T[30],T[31]===Symbol.for("react.memo_cache_sentinel")?(M=(0,i.jsx)("div",{className:"absolute bottom-0 left-0 w-3 h-3 border-l border-b border-primary/30"}),S=(0,i.jsx)("div",{className:"absolute bottom-0 right-0 w-3 h-3 border-r border-b border-primary/30"}),T[31]=M,T[32]=S):(M=T[31],S=T[32]),T[33]!==x||T[34]!==_?(j=(0,i.jsxs)("div",{className:"relative bg-card border border-sidebar-border rounded-sm shadow-lg overflow-hidden w-full md:w-auto md:max-w-md",children:[s,x,_,M,S]}),T[33]=x,T[34]=_,T[35]=j):j=T[35],T[36]!==j||T[37]!==a?(P=(0,i.jsx)("div",{className:a,style:o,children:j}),T[36]=j,T[37]=a,T[38]=P):P=T[38],P):null}function rP(e){let t,r,a,o=(0,n.c)(4),[s,c]=(0,l.useState)(!1);return(o[0]===Symbol.for("react.memo_cache_sentinel")?(t=()=>{c(!0)},r=[],o[0]=t,o[1]=r):(t=o[0],r=o[1]),(0,l.useEffect)(t,r),s&&"undefined"!=typeof document)?(o[2]!==e?(a=(0,tH.createPortal)((0,i.jsx)(rj,{...e}),document.body),o[2]=e,o[3]=a):a=o[3],a):null}let rT=[{id:"get_started",message:(0,k.msg)("Welcome! Start by zoning areas for residential, commercial, and industrial buildings. Then add roads, power, and water to build your city."),priority:0,check:e=>{let t=!1,r=!1;for(let a=0;a<e.gridSize;a++)for(let i=0;i<e.gridSize;i++){let n=e.grid[a][i];"none"!==n.zone&&(t=!0);let l=n.building.type;"grass"!==l&&"water"!==l&&"tree"!==l&&(r=!0)}return!t&&!r}},{id:"needs_utilities",message:(0,k.msg)("Buildings need power, water, and roads for construction to begin."),priority:1,check:e=>{let t=!1,r=!1,a=!1,i=!1;for(let n=0;n<e.gridSize;n++)for(let l=0;l<e.gridSize;l++){let o=e.grid[n][l];"none"!==o.zone&&(t=!0);let s=o.building.type;"power_plant"===s&&(r=!0),"water_tower"===s&&(a=!0),("road"===s||"bridge"===s)&&(i=!0)}return t&&(!r||!a||!i)}},{id:"negative_demand",message:(0,k.msg)("Keep an eye on zone demand. Negative demand can cause buildings to become abandoned."),priority:2,check:e=>{let{residential:t,commercial:r,industrial:a}=e.stats.demand;return t<-20||r<-20||a<-20}},{id:"needs_safety_services",message:(0,k.msg)("Add fire and police stations to keep your city safe from crime and fires."),priority:3,check:e=>{let t=!1,r=!1,a=!1;for(let i=0;i<e.gridSize;i++)for(let n=0;n<e.gridSize;n++){let l=e.grid[i][n].building.type;"fire_station"===l&&(r=!0),"police_station"===l&&(a=!0),"none"!==e.grid[i][n].zone&&"grass"!==l&&(t=!0)}return t&&e.stats.population>=50&&(!r||!a)}},{id:"needs_parks",message:(0,k.msg)("Add parks and trees to improve your city's environment and make residents happier."),priority:4,check:e=>e.stats.environment<40&&e.stats.population>=100},{id:"needs_health_education",message:(0,k.msg)("Build hospitals and schools to improve health and education for your citizens."),priority:5,check:e=>{let t=!1,r=!1;for(let a=0;a<e.gridSize;a++)for(let i=0;i<e.gridSize;i++){let n=e.grid[a][i].building.type;"hospital"===n&&(t=!0),("school"===n||"university"===n)&&(r=!0)}return e.stats.population>=100&&(!t||!r)}}],rC="isocity-tips-disabled",rN="isocity-tips-shown",rz="isocity-saved-cities-index";function rI(){}var rR=r(2601),rY=r(4547),rX=r(8976);function rA(e){let t,r,a,o,s,c,d,h,u=(0,n.c)(25),{open:m,onOpenChange:g}=e,[p,x]=(0,l.useState)(!1),[y,b]=(0,l.useState)(!1),{roomCode:w,createRoom:v}=e7(),{state:_,isStateReady:M}=eL();u[0]!==v||u[1]!==y||u[2]!==M||u[3]!==m||u[4]!==w||u[5]!==_?(t=()=>{m&&!w&&!y&&M&&(b(!0),v(_.cityName,_).then(rE).catch(rO).finally(()=>{b(!1)}))},r=[m,w,y,M,v,_],u[0]=v,u[1]=y,u[2]=M,u[3]=m,u[4]=w,u[5]=_,u[6]=t,u[7]=r):(t=u[6],r=u[7]),(0,l.useEffect)(t,r),u[8]!==m?(a=()=>{m||x(!1)},o=[m],u[8]=m,u[9]=a,u[10]=o):(a=u[9],o=u[10]),(0,l.useEffect)(a,o),u[11]!==w?(s=()=>{if(!w)return;let e=`${window.location.origin}/coop/${w}`;navigator.clipboard.writeText(e),x(!0),setTimeout(()=>x(!1),2e3)},u[11]=w,u[12]=s):s=u[12];let S=s,k=w?`${window.location.origin}/coop/${w}`:"";return u[13]===Symbol.for("react.memo_cache_sentinel")?(c=(0,i.jsxs)(tD,{children:[(0,i.jsx)(tJ,{className:"text-white",children:"Invite Players"}),(0,i.jsx)(tU,{className:"text-slate-400",children:"Share this link with friends to play together"})]}),u[13]=c):c=u[13],u[14]!==p||u[15]!==S||u[16]!==k||u[17]!==y||u[18]!==g||u[19]!==w?(d=(0,i.jsxs)(tW,{className:"sm:max-w-md bg-slate-900 border-slate-700 text-white overflow-hidden",children:[c,(0,i.jsx)("div",{className:"space-y-6 py-4 overflow-hidden",children:y||!w?(0,i.jsxs)("div",{className:"flex items-center justify-center gap-2 py-8",children:[(0,i.jsx)(rR.A,{className:"w-6 h-6 animate-spin text-slate-400"}),(0,i.jsx)("span",{className:"text-slate-400",children:"Creating co-op session..."})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("div",{className:"text-4xl font-mono font-bold tracking-widest text-white mb-2",children:w}),(0,i.jsx)("div",{className:"text-sm text-slate-400",children:"Invite Code"})]}),(0,i.jsxs)("div",{className:"space-y-2 overflow-hidden",children:[(0,i.jsx)("div",{className:"w-full bg-slate-800 rounded-lg px-4 py-3 text-sm text-slate-300 truncate",children:k}),(0,i.jsx)(f,{onClick:S,variant:"outline",className:"w-full border-slate-600 hover:bg-slate-700",children:p?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(rY.A,{className:"w-4 h-4 mr-2 text-green-400"}),"Copied!"]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(rX.A,{className:"w-4 h-4 mr-2"}),"Copy Invite Link"]})})]}),(0,i.jsx)(f,{onClick:()=>g(!1),className:"w-full bg-slate-700 hover:bg-slate-600 text-white border border-slate-600",children:"Close"})]})})]}),u[14]=p,u[15]=S,u[16]=k,u[17]=y,u[18]=g,u[19]=w,u[20]=d):d=u[20],u[21]!==g||u[22]!==m||u[23]!==d?(h=(0,i.jsx)(tB,{open:m,onOpenChange:g,children:d}),u[21]=g,u[22]=m,u[23]=d,u[24]=h):h=u[24],h}function rO(e){console.error("[ShareModal] Failed to create room:",e)}function rE(e){window.history.replaceState({},"",`/coop/${e}`)}let r$={none:{label:"None",title:"No Overlay",activeColor:"",hoverColor:""},power:{label:"Power",title:"Power Grid",activeColor:"bg-amber-500",hoverColor:"hover:bg-amber-600"},water:{label:"Water",title:"Water System",activeColor:"bg-blue-500",hoverColor:"hover:bg-blue-600"},fire:{label:"Fire",title:"Fire Coverage",activeColor:"bg-red-500",hoverColor:"hover:bg-red-600"},police:{label:"Police",title:"Police Coverage",activeColor:"bg-blue-600",hoverColor:"hover:bg-blue-700"},health:{label:"Health",title:"Health Coverage",activeColor:"bg-green-500",hoverColor:"hover:bg-green-600"},education:{label:"Education",title:"Education Coverage",activeColor:"bg-purple-500",hoverColor:"hover:bg-purple-600"},subway:{label:"Subway",title:"Subway Coverage",activeColor:"bg-yellow-500",hoverColor:"hover:bg-yellow-600"}},rB={power_plant:"power",water_tower:"water",fire_station:"fire",police_station:"police",hospital:"health",school:"education",university:"education",subway_station:"subway",subway:"subway"},rL=new Set(["empty","grass","water","road","rail","tree"]),rV="rgba(239, 68, 68, 0.45)",rW="rgba(0, 0, 0, 0)",rD={none:[],power:["power_plant"],water:["water_tower"],fire:["fire_station"],police:["police_station"],health:["hospital"],education:["school","university"],subway:["subway_station"]},rF={none:"transparent",power:"rgba(251, 191, 36, 0.8)",water:"rgba(96, 165, 250, 0.8)",fire:"rgba(248, 113, 113, 0.8)",police:"rgba(147, 197, 253, 0.8)",health:"rgba(134, 239, 172, 0.8)",education:"rgba(196, 181, 253, 0.8)",subway:"rgba(253, 224, 71, 0.8)"},rJ={none:"transparent",power:"rgba(251, 191, 36, 1)",water:"rgba(96, 165, 250, 1)",fire:"rgba(239, 68, 68, 1)",police:"rgba(59, 130, 246, 1)",health:"rgba(34, 197, 94, 1)",education:"rgba(168, 85, 247, 1)",subway:"rgba(234, 179, 8, 1)"},rU={none:"transparent",power:"rgba(251, 191, 36, 0.12)",water:"rgba(96, 165, 250, 0.12)",fire:"rgba(248, 113, 113, 0.12)",police:"rgba(147, 197, 253, 0.12)",health:"rgba(134, 239, 172, 0.12)",education:"rgba(196, 181, 253, 0.12)",subway:"rgba(253, 224, 71, 0.12)"},rH={none:(0,i.jsx)(tc,{size:14}),power:(0,i.jsx)(tu,{size:14}),water:(0,i.jsx)(tf,{size:14}),fire:(0,i.jsx)(th,{size:14}),police:(0,i.jsx)(tb,{size:14}),health:(0,i.jsx)(tx,{size:14}),education:(0,i.jsx)(ty,{size:14}),subway:(0,i.jsx)(tj,{size:14})},rG=(0,k.msg)("View Overlay"),rq=l.memo(function(e){let t,r,a,l,o=(0,n.c)(10),{overlayMode:s,setOverlayMode:c}=e,d=(0,k.useMessages)();return o[0]!==d?(t=d(rG),o[0]=d,o[1]=t):t=o[1],o[2]!==t?(r=(0,i.jsx)("div",{className:"text-[10px] uppercase tracking-[0.12em] text-muted-foreground font-semibold mb-2",children:t}),o[2]=t,o[3]=r):r=o[3],o[4]!==s||o[5]!==c?(a=(0,i.jsx)("div",{className:"flex gap-1",children:Object.keys(r$).map(e=>{let t=r$[e],r=s===e;return(0,i.jsx)(f,{variant:r?"default":"ghost",size:"sm",onClick:()=>c(e),className:`h-8 px-3 ${function(e,t){if(!t||"none"===e)return"";let r=r$[e];return`${r.activeColor} ${r.hoverColor}`}(e,r)}`,title:t.title,children:rH[e]},e)})}),o[4]=s,o[5]=c,o[6]=a):a=o[6],o[7]!==r||o[8]!==a?(l=(0,i.jsxs)(tr,{className:"fixed bottom-4 left-[240px] p-2 shadow-lg bg-card/90 border-border/70 z-50",children:[r,a]}),o[7]=r,o[8]=a,o[9]=l):l=o[9],l}),rQ={TOOLS:(0,k.msg)("Tools"),ZONES:(0,k.msg)("Zones"),tools:(0,k.msg)("Tools"),zones:(0,k.msg)("Zones"),zoning:(0,k.msg)("Zoning"),expandCity:(0,k.msg)("Expand City"),services:(0,k.msg)("Services"),parks:(0,k.msg)("Parks"),sports:(0,k.msg)("Sports"),waterfront:(0,k.msg)("Waterfront"),community:(0,k.msg)("Community"),utilities:(0,k.msg)("Utilities"),special:(0,k.msg)("Special")},rZ={budget:(0,k.msg)("Budget"),statistics:(0,k.msg)("Statistics"),advisors:(0,k.msg)("Advisors"),settings:(0,k.msg)("Settings")},rK=l.memo(function(e){let t,r,a,o,s,c,d,h,u,m,g,p,x,y,b,w,v,_,M=(0,n.c)(41),{label:S,tools:P,selectedTool:T,money:C,onSelectTool:N,forceOpenUpward:z}=e,I=void 0!==z&&z,[R,Y]=(0,l.useState)(!1);M[0]===Symbol.for("react.memo_cache_sentinel")?(t={top:0,left:0,buttonHeight:0,openUpward:!1},M[0]=t):t=M[0];let[X,A]=(0,l.useState)(t),O=(0,l.useRef)(null),E=(0,l.useRef)(null),$=(0,l.useRef)(null),B=(0,l.useRef)(null),L=(0,k.useMessages)(),V=P.includes(T);M[1]===Symbol.for("react.memo_cache_sentinel")?(r=()=>{$.current&&(clearTimeout($.current),$.current=null)},M[1]=r):r=M[1];let W=r;M[2]!==I?(a=()=>{if(W(),O.current){let e=O.current.getBoundingClientRect(),t=window.innerHeight-e.top,r=I||t<220&&e.top>220;A({top:r?e.bottom:e.top,left:e.right+12,buttonHeight:e.height,openUpward:r})}Y(!0)},M[2]=I,M[3]=a):a=M[3];let D=a;M[4]===Symbol.for("react.memo_cache_sentinel")?(o=e=>{if(!B.current||!E.current)return!1;let t=E.current.getBoundingClientRect(),r=e.clientX,a=e.clientY,i=B.current.x,n=a>=t.top-50&&a<=t.bottom+50;return r>i&&n},M[4]=o):o=M[4];let F=o;M[5]===Symbol.for("react.memo_cache_sentinel")?(s=e=>{B.current={x:e.clientX,y:e.clientY}},M[5]=s):s=M[5];let J=s;M[6]===Symbol.for("react.memo_cache_sentinel")?(c=e=>{let t=F(e)?300:100;W(),$.current=setTimeout(()=>{Y(!1)},t)},M[6]=c):c=M[6];let U=c;M[7]===Symbol.for("react.memo_cache_sentinel")?(d=()=>{W()},M[7]=d):d=M[7];let H=d;M[8]===Symbol.for("react.memo_cache_sentinel")?(h=()=>{W(),$.current=setTimeout(()=>{Y(!1)},100)},M[8]=h):h=M[8];let G=h;M[9]===Symbol.for("react.memo_cache_sentinel")?(u=()=>()=>{$.current&&clearTimeout($.current)},m=[],M[9]=u,M[10]=m):(u=M[9],m=M[10]),(0,l.useEffect)(u,m);let q=V?"default":"ghost",Q=`w-full justify-between gap-2 px-3 py-2.5 h-auto text-sm group transition-all duration-200 ${V?"bg-primary text-primary-foreground":""} ${R?"bg-muted/80":""}`;M[11]!==L||M[12]!==S?(g=L(S),M[11]=L,M[12]=S,M[13]=g):g=M[13],M[14]!==g?(p=(0,i.jsx)("span",{className:"font-medium",children:g}),M[14]=g,M[15]=p):p=M[15];let Z=`w-4 h-4 transition-transform duration-200 ${R?"rotate-90":""}`;return M[16]===Symbol.for("react.memo_cache_sentinel")?(x=(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"}),M[16]=x):x=M[16],M[17]!==Z?(y=(0,i.jsx)("svg",{className:Z,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:x}),M[17]=Z,M[18]=y):y=M[18],M[19]!==q||M[20]!==Q||M[21]!==p||M[22]!==y?(b=(0,i.jsxs)(f,{ref:O,variant:q,className:Q,children:[p,y]}),M[19]=q,M[20]=Q,M[21]=p,M[22]=y,M[23]=b):b=M[23],M[24]!==R||M[25]!==X?(w=R&&(0,i.jsx)("div",{className:"fixed",style:{top:`${X.top}px`,left:`${X.left-12}px`,width:"20px",height:`${Math.max(X.buttonHeight,200)}px`,zIndex:9998},onMouseEnter:H,onMouseLeave:G}),M[24]=R,M[25]=X,M[26]=w):w=M[26],M[27]!==R||M[28]!==S||M[29]!==L||M[30]!==X||M[31]!==C||M[32]!==N||M[33]!==T||M[34]!==P?(v=R&&(0,i.jsxs)("div",{ref:E,className:"fixed w-52 bg-sidebar backdrop-blur-sm border border-sidebar-border rounded-md shadow-xl overflow-hidden animate-submenu-in",style:{boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(96, 165, 250, 0.1)",zIndex:9999,...X.openUpward?{bottom:`${window.innerHeight-X.top}px`}:{top:`${X.top}px`},left:`${X.left}px`},onMouseEnter:H,onMouseLeave:G,children:[(0,i.jsx)("div",{className:"px-3 py-2 border-b border-sidebar-border/50 bg-muted/30",children:(0,i.jsx)("span",{className:"text-[10px] font-bold tracking-widest text-muted-foreground uppercase",children:L(S)})}),(0,i.jsx)("div",{className:"p-1.5 flex flex-col gap-0.5 max-h-48 overflow-y-auto",children:P.map(e=>{let t=j[e];if(!t)return null;let r=T===e,a=C>=t.cost;return(0,i.jsxs)(f,{onClick:()=>N(e),disabled:!a&&t.cost>0,variant:r?"default":"ghost",className:`w-full justify-start gap-2 px-3 py-2 h-auto text-sm transition-all duration-150 ${r?"bg-primary text-primary-foreground shadow-sm":"hover:bg-muted/60"}`,title:`${L(t.description)} - Cost: $${t.cost.toLocaleString()}`,children:[(0,i.jsx)("span",{className:"flex-1 text-left truncate",children:L(t.name)}),(0,i.jsxs)("span",{className:`text-xs ${r?"opacity-80":"opacity-50"}`,children:["$",t.cost.toLocaleString()]})]},e)})})]}),M[27]=R,M[28]=S,M[29]=L,M[30]=X,M[31]=C,M[32]=N,M[33]=T,M[34]=P,M[35]=v):v=M[35],M[36]!==D||M[37]!==b||M[38]!==w||M[39]!==v?(_=(0,i.jsxs)("div",{className:"relative",onMouseEnter:D,onMouseMove:J,onMouseLeave:U,children:[b,w,v]}),M[36]=D,M[37]=b,M[38]=w,M[39]=v,M[40]=_):_=M[40],_}),r0=l.memo(function(e){let t,r,a,o,s,c,d,h,u,m,g,p,x,y,b,w,v,_,M=(0,n.c)(35),{label:S,actions:j}=e,[P,T]=(0,l.useState)(!1);M[0]===Symbol.for("react.memo_cache_sentinel")?(t={top:0,left:0,buttonHeight:0,openUpward:!1},M[0]=t):t=M[0];let[C,N]=(0,l.useState)(t),z=(0,l.useRef)(null),I=(0,l.useRef)(null),R=(0,l.useRef)(null),Y=(0,l.useRef)(null),X=(0,k.useMessages)();M[1]===Symbol.for("react.memo_cache_sentinel")?(r=()=>{R.current&&(clearTimeout(R.current),R.current=null)},M[1]=r):r=M[1];let A=r;M[2]===Symbol.for("react.memo_cache_sentinel")?(a=()=>{if(A(),z.current){let e=z.current.getBoundingClientRect(),t=window.innerHeight-e.top<220&&e.top>220;N({top:t?e.bottom:e.top,left:e.right+12,buttonHeight:e.height,openUpward:t})}T(!0)},M[2]=a):a=M[2];let O=a;M[3]===Symbol.for("react.memo_cache_sentinel")?(o=e=>{if(!Y.current||!I.current)return!1;let t=I.current.getBoundingClientRect(),r=e.clientX,a=e.clientY,i=Y.current.x,n=a>=t.top-50&&a<=t.bottom+50;return r>i&&n},M[3]=o):o=M[3];let E=o;M[4]===Symbol.for("react.memo_cache_sentinel")?(s=e=>{Y.current={x:e.clientX,y:e.clientY}},M[4]=s):s=M[4];let $=s;M[5]===Symbol.for("react.memo_cache_sentinel")?(c=e=>{let t=E(e)?300:100;A(),R.current=setTimeout(()=>{T(!1)},t)},M[5]=c):c=M[5];let B=c;M[6]===Symbol.for("react.memo_cache_sentinel")?(d=()=>{A()},M[6]=d):d=M[6];let L=d;M[7]===Symbol.for("react.memo_cache_sentinel")?(h=()=>{A(),R.current=setTimeout(()=>{T(!1)},100)},M[7]=h):h=M[7];let V=h;M[8]===Symbol.for("react.memo_cache_sentinel")?(m=()=>()=>{R.current&&clearTimeout(R.current)},u=[],M[8]=u,M[9]=m):(u=M[8],m=M[9]),(0,l.useEffect)(m,u);let W=`w-full justify-between gap-2 px-3 py-2.5 h-auto text-sm group transition-all duration-200 ${P?"bg-muted/80":""}`;M[10]!==X||M[11]!==S?(g=X(S),M[10]=X,M[11]=S,M[12]=g):g=M[12],M[13]!==g?(p=(0,i.jsx)("span",{className:"font-medium",children:g}),M[13]=g,M[14]=p):p=M[14];let D=`w-4 h-4 transition-transform duration-200 ${P?"rotate-90":""}`;return M[15]===Symbol.for("react.memo_cache_sentinel")?(x=(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"}),M[15]=x):x=M[15],M[16]!==D?(y=(0,i.jsx)("svg",{className:D,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:x}),M[16]=D,M[17]=y):y=M[17],M[18]!==W||M[19]!==p||M[20]!==y?(b=(0,i.jsxs)(f,{ref:z,variant:"ghost",className:W,children:[p,y]}),M[18]=W,M[19]=p,M[20]=y,M[21]=b):b=M[21],M[22]!==P||M[23]!==C?(w=P&&(0,i.jsx)("div",{className:"fixed",style:{top:`${C.top}px`,left:`${C.left-12}px`,width:"20px",height:`${Math.max(C.buttonHeight,200)}px`,zIndex:9998},onMouseEnter:L,onMouseLeave:V}),M[22]=P,M[23]=C,M[24]=w):w=M[24],M[25]!==j||M[26]!==P||M[27]!==S||M[28]!==X||M[29]!==C?(v=P&&(0,i.jsxs)("div",{ref:I,className:"fixed w-52 bg-sidebar backdrop-blur-sm border border-sidebar-border rounded-md shadow-xl overflow-hidden animate-submenu-in",style:{boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(96, 165, 250, 0.1)",zIndex:9999,...C.openUpward?{bottom:`${window.innerHeight-C.top}px`}:{top:`${C.top}px`},left:`${C.left}px`},onMouseEnter:L,onMouseLeave:V,children:[(0,i.jsx)("div",{className:"px-3 py-2 border-b border-sidebar-border/50 bg-muted/30",children:(0,i.jsx)("span",{className:"text-[10px] font-bold tracking-widest text-muted-foreground uppercase",children:X(S)})}),(0,i.jsx)("div",{className:"p-1.5 flex flex-col gap-0.5 max-h-48 overflow-y-auto",children:j.map(e=>(0,i.jsx)(f,{onClick:e.onClick,variant:"ghost",className:"w-full justify-start gap-2 px-3 py-2 h-auto text-sm transition-all duration-150 hover:bg-muted/60",title:e.description,children:(0,i.jsx)("span",{className:"flex-1 text-left truncate",children:X(e.name)})},e.key))})]}),M[25]=j,M[26]=P,M[27]=S,M[28]=X,M[29]=C,M[30]=v):v=M[30],M[31]!==b||M[32]!==w||M[33]!==v?(_=(0,i.jsxs)("div",{className:"relative",onMouseEnter:O,onMouseMove:$,onMouseLeave:B,children:[b,w,v]}),M[31]=b,M[32]=w,M[33]=v,M[34]=_):_=M[34],_});function r1(e){let t,r,a,l,o,s=(0,n.c)(12),{open:c,onOpenChange:d,onSaveAndExit:h,onExitWithoutSaving:u}=e;return s[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,i.jsxs)(tD,{children:[(0,i.jsx)(tJ,{children:"Exit to Main Menu"}),(0,i.jsx)(tU,{children:"Would you like to save your city before exiting?"})]}),s[0]=t):t=s[0],s[1]!==u?(r=(0,i.jsx)(f,{variant:"outline",onClick:u,className:"w-full sm:w-auto",children:"Exit Without Saving"}),s[1]=u,s[2]=r):r=s[2],s[3]!==h?(a=(0,i.jsx)(f,{onClick:h,className:"w-full sm:w-auto",children:"Save & Exit"}),s[3]=h,s[4]=a):a=s[4],s[5]!==r||s[6]!==a?(l=(0,i.jsxs)(tW,{className:"sm:max-w-md",children:[t,(0,i.jsxs)(tF,{className:"flex-col sm:flex-row gap-2",children:[r,a]})]}),s[5]=r,s[6]=a,s[7]=l):l=s[7],s[8]!==d||s[9]!==c||s[10]!==l?(o=(0,i.jsx)(tB,{open:c,onOpenChange:d,children:l}),s[8]=d,s[9]=c,s[10]=l,s[11]=o):o=s[11],o}let r2=l.memo(function(e){let t,r,a,o,s,c,d,h,u,m,g,p,x,y,b,w,v,_,M,S,P,T,C,N,z,I,R,Y,X,A,O,E,$,B,L,V,W,D,F,J,U,H,G,q,Q,Z,K,ee,et=(0,n.c)(88),{onExit:er}=e,{state:ea,setTool:ei,setActivePanel:en,saveCity:el,expandCity:eo,shrinkCity:es}=eL(),{selectedTool:ec,stats:ed,activePanel:eh}=ea,[eu,ef]=(0,l.useState)(!1),[em,eg]=(0,l.useState)(!1),ep=te(),ex=(0,l.useRef)(!1);et[0]!==ep?.connectionState||et[1]!==ep?.initialState||et[2]!==ep?.roomCode?(t=()=>{ep?.connectionState==="connected"&&ep?.roomCode&&!ep?.initialState&&!ex.current&&(ex.current=!0,eg(!0))},et[0]=ep?.connectionState,et[1]=ep?.initialState,et[2]=ep?.roomCode,et[3]=t):t=et[3];let ey=ep?.connectionState,eb=ep?.roomCode,ew=ep?.initialState;et[4]!==ey||et[5]!==eb||et[6]!==ew?(r=[ey,eb,ew],et[4]=ey,et[5]=eb,et[6]=ew,et[7]=r):r=et[7],(0,l.useEffect)(t,r);let ev=(0,k.useMessages)();et[8]!==er||et[9]!==el?(a=()=>{el(),ef(!1),er?.()},et[8]=er,et[9]=el,et[10]=a):a=et[10];let e_=a;et[11]!==er?(o=()=>{ef(!1),er?.()},et[11]=er,et[12]=o):o=et[12];let eM=o;et[13]===Symbol.for("react.memo_cache_sentinel")?(s=["select","bulldoze","road","rail","subway"],et[13]=s):s=et[13],et[14]===Symbol.for("react.memo_cache_sentinel")?(c=["zone_residential","zone_commercial","zone_industrial"],et[14]=c):c=et[14],et[15]===Symbol.for("react.memo_cache_sentinel")?(d={TOOLS:s,ZONES:c},et[15]=d):d=et[15];let eS=d;et[16]===Symbol.for("react.memo_cache_sentinel")?(h=["zone_dezone","zone_water","zone_land"],et[16]=h):h=et[16],et[17]===Symbol.for("react.memo_cache_sentinel")?(u={key:"zoning",label:rQ.zoning,tools:h},et[17]=u):u=et[17];let ek=u;et[18]!==eo?(m={key:"expand_city",name:j.expand_city.name,description:"Add 15 tiles to each edge of the city",onClick:eo},et[18]=eo,et[19]=m):m=et[19],et[20]!==es?(g={key:"shrink_city",name:j.shrink_city.name,description:"Remove 15 tiles from each edge of the city",onClick:es},et[20]=es,et[21]=g):g=et[21],et[22]!==m||et[23]!==g?(p=[m,g],et[22]=m,et[23]=g,et[24]=p):p=et[24];let ej=p;et[25]===Symbol.for("react.memo_cache_sentinel")?(x=["police_station","fire_station","hospital","school","university"],et[25]=x):x=et[25],et[26]===Symbol.for("react.memo_cache_sentinel")?(y={key:"services",label:rQ.services,tools:x},et[26]=y):y=et[26],et[27]===Symbol.for("react.memo_cache_sentinel")?(b=["tree","park","park_large","tennis","playground_small","playground_large","community_garden","pond_park","park_gate","greenhouse_garden","mini_golf_course","go_kart_track","amphitheater","roller_coaster_small","campground","cabin_house","mountain_lodge","mountain_trailhead"],et[27]=b):b=et[27],et[28]===Symbol.for("react.memo_cache_sentinel")?(w={key:"parks",label:rQ.parks,tools:b},et[28]=w):w=et[28],et[29]===Symbol.for("react.memo_cache_sentinel")?(v=["basketball_courts","soccer_field_small","baseball_field_small","football_field","baseball_stadium","swimming_pool","skate_park","bleachers_field"],et[29]=v):v=et[29],et[30]===Symbol.for("react.memo_cache_sentinel")?(_={key:"sports",label:rQ.sports,tools:v},et[30]=_):_=et[30],et[31]===Symbol.for("react.memo_cache_sentinel")?(M=["marina_docks_small","pier_large"],et[31]=M):M=et[31],et[32]===Symbol.for("react.memo_cache_sentinel")?(S={key:"waterfront",label:rQ.waterfront,tools:M},et[32]=S):S=et[32],et[33]===Symbol.for("react.memo_cache_sentinel")?(P=["community_center","animal_pens_farm","office_building_small"],et[33]=P):P=et[33],et[34]===Symbol.for("react.memo_cache_sentinel")?(T={key:"community",label:rQ.community,tools:P},et[34]=T):T=et[34],et[35]===Symbol.for("react.memo_cache_sentinel")?(C=["power_plant","water_tower","subway_station","rail_station"],et[35]=C):C=et[35],et[36]===Symbol.for("react.memo_cache_sentinel")?(N={key:"utilities",label:rQ.utilities,tools:C,forceOpenUpward:!0},et[36]=N):N=et[36],et[37]===Symbol.for("react.memo_cache_sentinel")?(z=["stadium","museum","airport","space_program","city_hall","amusement_park"],et[37]=z):z=et[37],et[38]===Symbol.for("react.memo_cache_sentinel")?(I=[y,w,_,S,T,N,{key:"special",label:rQ.special,tools:z,forceOpenUpward:!0}],et[38]=I):I=et[38];let eP=I;return et[39]===Symbol.for("react.memo_cache_sentinel")?(R=(0,i.jsx)("span",{className:"text-sidebar-foreground font-bold tracking-tight",children:"ISOCITY"}),et[39]=R):R=et[39],et[40]===Symbol.for("react.memo_cache_sentinel")?(Y=(0,i.jsx)(f,{variant:"ghost",size:"icon-sm",onClick:rp,title:"Search (K)",className:"h-7 w-7 text-muted-foreground hover:text-sidebar-foreground",children:(0,i.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),et[40]=Y):Y=et[40],et[41]!==ep?(X=ep&&(0,i.jsx)(f,{variant:"ghost",size:"icon-sm",onClick:()=>eg(!0),title:"Invite Players",className:"h-7 w-7 text-muted-foreground hover:text-sidebar-foreground",children:(0,i.jsx)(tE.A,{className:"w-4 h-4"})}),et[41]=ep,et[42]=X):X=et[42],et[43]!==er?(A=er&&(0,i.jsx)(f,{variant:"ghost",size:"icon-sm",onClick:()=>ef(!0),title:"Exit to Main Menu",className:"h-7 w-7 text-muted-foreground hover:text-sidebar-foreground",children:(0,i.jsx)("svg",{className:"w-4 h-4 -scale-x-100",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})}),et[43]=er,et[44]=A):A=et[44],et[45]!==X||et[46]!==A?(O=(0,i.jsx)("div",{className:"px-4 py-4 border-b border-sidebar-border",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[R,(0,i.jsxs)("div",{className:"flex items-center gap-1",children:[Y,X,A]})]})}),et[45]=X,et[46]=A,et[47]=O):O=et[47],et[48]!==ej||et[49]!==ev||et[50]!==ec||et[51]!==ei||et[52]!==ed?(E=Object.entries(eS).map(e=>{let[t,r]=e;return(0,i.jsxs)("div",{className:"mb-1",children:["ZONES"===t&&(0,i.jsx)("div",{className:"mx-4 my-2 h-px bg-sidebar-border/50"}),(0,i.jsx)("div",{className:"px-4 py-2 text-[10px] font-bold tracking-widest text-muted-foreground",children:ev(rQ[t]||t)}),(0,i.jsxs)("div",{className:"px-2 flex flex-col gap-0.5",children:[r.map(e=>{let t=j[e];if(!t)return null;let r=ec===e,a=ed.money>=t.cost;return(0,i.jsxs)(f,{onClick:()=>ei(e),disabled:!a&&t.cost>0,variant:r?"default":"ghost",className:`w-full justify-start gap-3 px-3 py-2 h-auto text-sm ${r?"bg-primary text-primary-foreground":""}`,title:`${ev(t.description)}${t.cost>0?` - Cost: $${t.cost}`:""}`,children:[(0,i.jsx)("span",{className:"flex-1 text-left truncate",children:ev(t.name)}),t.cost>0&&(0,i.jsxs)("span",{className:"text-xs opacity-60",children:["$",t.cost]})]},e)}),"TOOLS"===t&&(0,i.jsx)(r0,{label:rQ.expandCity,actions:ej},"expandCity"),"ZONES"===t&&(0,i.jsx)(rK,{label:ek.label,tools:ek.tools,selectedTool:ec,money:ed.money,onSelectTool:ei},ek.key)]})]},t)}),et[48]=ej,et[49]=ev,et[50]=ec,et[51]=ei,et[52]=ed,et[53]=E):E=et[53],et[54]===Symbol.for("react.memo_cache_sentinel")?($=(0,i.jsx)("div",{className:"mx-4 my-2 h-px bg-sidebar-border/50"}),B=(0,i.jsx)("div",{className:"px-4 py-2 text-[10px] font-bold tracking-widest text-muted-foreground",children:"BUILDINGS"}),et[54]=$,et[55]=B):($=et[54],B=et[55]),et[56]!==ec||et[57]!==ei||et[58]!==ed?(L=(0,i.jsx)("div",{className:"px-2 flex flex-col gap-0.5",children:eP.map(e=>{let{key:t,label:r,tools:a,forceOpenUpward:n}=e;return(0,i.jsx)(rK,{label:r,tools:a,selectedTool:ec,money:ed.money,onSelectTool:ei,forceOpenUpward:n},t)})}),et[56]=ec,et[57]=ei,et[58]=ed,et[59]=L):L=et[59],et[60]!==E||et[61]!==L?(V=(0,i.jsxs)(ru,{className:"flex-1 py-2",children:[E,$,B,L]}),et[60]=E,et[61]=L,et[62]=V):V=et[62],et[63]===Symbol.for("react.memo_cache_sentinel")?(W=(0,i.jsx)(tv,{size:16}),et[63]=W):W=et[63],et[64]===Symbol.for("react.memo_cache_sentinel")?(D={panel:"budget",icon:W,labelKey:"budget"},et[64]=D):D=et[64],et[65]===Symbol.for("react.memo_cache_sentinel")?(F=(0,i.jsx)(t_,{size:16}),et[65]=F):F=et[65],et[66]===Symbol.for("react.memo_cache_sentinel")?(J={panel:"statistics",icon:F,labelKey:"statistics"},et[66]=J):J=et[66],et[67]===Symbol.for("react.memo_cache_sentinel")?(U=(0,i.jsx)(tM,{size:16}),et[67]=U):U=et[67],et[68]===Symbol.for("react.memo_cache_sentinel")?(H={panel:"advisors",icon:U,labelKey:"advisors"},et[68]=H):H=et[68],et[69]===Symbol.for("react.memo_cache_sentinel")?(G=(0,i.jsx)(tS,{size:16}),et[69]=G):G=et[69],et[70]===Symbol.for("react.memo_cache_sentinel")?(q=[D,J,H,{panel:"settings",icon:G,labelKey:"settings"}],et[70]=q):q=et[70],et[71]!==eh||et[72]!==ev||et[73]!==en?(Q=(0,i.jsx)("div",{className:"border-t border-sidebar-border p-2",children:(0,i.jsx)("div",{className:"grid grid-cols-4 gap-1",children:q.map(e=>{let{panel:t,icon:r,labelKey:a}=e;return(0,i.jsx)(f,{onClick:()=>en(eh===t?"none":t),variant:eh===t?"default":"ghost",size:"icon-sm",className:"w-full",title:String(ev(rZ[a])),children:r},t)})})}),et[71]=eh,et[72]=ev,et[73]=en,et[74]=Q):Q=et[74],et[75]!==eM||et[76]!==e_||et[77]!==eu?(Z=(0,i.jsx)(r1,{open:eu,onOpenChange:ef,onSaveAndExit:e_,onExitWithoutSaving:eM}),et[75]=eM,et[76]=e_,et[77]=eu,et[78]=Z):Z=et[78],et[79]!==ep||et[80]!==em?(K=ep&&(0,i.jsx)(rA,{open:em,onOpenChange:eg}),et[79]=ep,et[80]=em,et[81]=K):K=et[81],et[82]!==O||et[83]!==V||et[84]!==Q||et[85]!==Z||et[86]!==K?(ee=(0,i.jsxs)("div",{className:"w-56 bg-sidebar border-r border-sidebar-border flex flex-col h-screen fixed left-0 top-0 z-40",children:[O,V,Q,Z,K]}),et[82]=O,et[83]=V,et[84]=Q,et[85]=Z,et[86]=K,et[87]=ee):ee=et[87],ee});var r5=r(6228);let r3=(0,s.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),r4=l.forwardRef(({className:e,...t},r)=>(0,i.jsx)(r5.b,{ref:r,className:h(r3(),e),...t}));r4.displayName=r5.b.displayName;let r9={budget:(0,k.msg)("Budget"),income:(0,k.msg)("Income"),expenses:(0,k.msg)("Expenses"),net:(0,k.msg)("Net")};function r6(){let e,t,r,a,l,o,s,c,d,h,u,f,m,g,p,x,y,b,w,v,_,M,S,j,P,T,C,N,z,I,R,Y,X=(0,n.c)(81),{state:A,setActivePanel:O,setBudgetFunding:E}=eL(),{budget:$,stats:B}=A,L=(0,k.useMessages)();X[0]!==$.police?(e={key:"police",...$.police},X[0]=$.police,X[1]=e):e=X[1],X[2]!==$.fire?(t={key:"fire",...$.fire},X[2]=$.fire,X[3]=t):t=X[3],X[4]!==$.health?(r={key:"health",...$.health},X[4]=$.health,X[5]=r):r=X[5],X[6]!==$.education?(a={key:"education",...$.education},X[6]=$.education,X[7]=a):a=X[7],X[8]!==$.transportation?(l={key:"transportation",...$.transportation},X[8]=$.transportation,X[9]=l):l=X[9],X[10]!==$.parks?(o={key:"parks",...$.parks},X[10]=$.parks,X[11]=o):o=X[11],X[12]!==$.power?(s={key:"power",...$.power},X[12]=$.power,X[13]=s):s=X[13],X[14]!==$.water?(c={key:"water",...$.water},X[14]=$.water,X[15]=c):c=X[15],X[16]!==e||X[17]!==t||X[18]!==r||X[19]!==a||X[20]!==l||X[21]!==o||X[22]!==s||X[23]!==c?(d=[e,t,r,a,l,o,s,c],X[16]=e,X[17]=t,X[18]=r,X[19]=a,X[20]=l,X[21]=o,X[22]=s,X[23]=c,X[24]=d):d=X[24];let V=d;X[25]!==O?(h=()=>O("none"),X[25]=O,X[26]=h):h=X[26],X[27]!==L?(u=L(r9.budget),X[27]=L,X[28]=u):u=X[28],X[29]!==u?(f=(0,i.jsx)(tD,{children:(0,i.jsx)(tJ,{children:u})}),X[29]=u,X[30]=f):f=X[30],X[31]!==L?(m=L(r9.income),X[31]=L,X[32]=m):m=X[32],X[33]!==m?(g=(0,i.jsx)("div",{className:"text-muted-foreground text-xs mb-1",children:m}),X[33]=m,X[34]=g):g=X[34],X[35]!==B.income?(p=B.income.toLocaleString(),X[35]=B.income,X[36]=p):p=X[36],X[37]!==p?(x=(0,i.jsxs)("div",{className:"text-green-400 font-mono",children:["$",p,"/mo"]}),X[37]=p,X[38]=x):x=X[38],X[39]!==g||X[40]!==x?(y=(0,i.jsxs)("div",{children:[g,x]}),X[39]=g,X[40]=x,X[41]=y):y=X[41],X[42]!==L?(b=L(r9.expenses),X[42]=L,X[43]=b):b=X[43],X[44]!==b?(w=(0,i.jsx)("div",{className:"text-muted-foreground text-xs mb-1",children:b}),X[44]=b,X[45]=w):w=X[45],X[46]!==B.expenses?(v=B.expenses.toLocaleString(),X[46]=B.expenses,X[47]=v):v=X[47],X[48]!==v?(_=(0,i.jsxs)("div",{className:"text-red-400 font-mono",children:["$",v,"/mo"]}),X[48]=v,X[49]=_):_=X[49],X[50]!==w||X[51]!==_?(M=(0,i.jsxs)("div",{children:[w,_]}),X[50]=w,X[51]=_,X[52]=M):M=X[52],X[53]!==L?(S=L(r9.net),X[53]=L,X[54]=S):S=X[54],X[55]!==S?(j=(0,i.jsx)("div",{className:"text-muted-foreground text-xs mb-1",children:S}),X[55]=S,X[56]=j):j=X[56];let W=`font-mono ${B.income-B.expenses>=0?"text-green-400":"text-red-400"}`,D=B.income-B.expenses;return X[57]!==D?(P=D.toLocaleString(),X[57]=D,X[58]=P):P=X[58],X[59]!==W||X[60]!==P?(T=(0,i.jsxs)("div",{className:W,children:["$",P,"/mo"]}),X[59]=W,X[60]=P,X[61]=T):T=X[61],X[62]!==j||X[63]!==T?(C=(0,i.jsxs)("div",{children:[j,T]}),X[62]=j,X[63]=T,X[64]=C):C=X[64],X[65]!==y||X[66]!==M||X[67]!==C?(N=(0,i.jsxs)("div",{className:"grid grid-cols-3 gap-4 pb-4 border-b border-border",children:[y,M,C]}),X[65]=y,X[66]=M,X[67]=C,X[68]=N):N=X[68],X[69]!==V||X[70]!==E?(z=(0,i.jsx)("div",{className:"space-y-4",children:V.map(e=>(0,i.jsxs)("div",{className:"flex items-center gap-4",children:[(0,i.jsx)(r4,{className:"w-28 text-sm",children:e.name}),(0,i.jsx)(tX,{value:[e.funding],onValueChange:t=>E(e.key,t[0]),min:0,max:100,step:5,className:"flex-1"}),(0,i.jsxs)("span",{className:"w-12 text-right font-mono text-sm",children:[e.funding,"%"]})]},e.key))}),X[69]=V,X[70]=E,X[71]=z):z=X[71],X[72]!==N||X[73]!==z?(I=(0,i.jsxs)("div",{className:"space-y-6",children:[N,z]}),X[72]=N,X[73]=z,X[74]=I):I=X[74],X[75]!==f||X[76]!==I?(R=(0,i.jsxs)(tW,{className:"max-w-[500px]",children:[f,I]}),X[75]=f,X[76]=I,X[77]=R):R=X[77],X[78]!==R||X[79]!==h?(Y=(0,i.jsx)(tB,{open:!0,onOpenChange:h,children:R}),X[78]=R,X[79]=h,X[80]=Y):Y=X[80],Y}var r8=r(5213);let r7=r8.bL,ae=l.forwardRef(({className:e,...t},r)=>(0,i.jsx)(r8.B8,{ref:r,className:h("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));ae.displayName=r8.B8.displayName;let at=l.forwardRef(({className:e,...t},r)=>(0,i.jsx)(r8.l9,{ref:r,className:h("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...t}));at.displayName=r8.l9.displayName,l.forwardRef(({className:e,...t},r)=>(0,i.jsx)(r8.UC,{ref:r,className:h("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t})).displayName=r8.UC.displayName;let ar={cityStatistics:(0,k.msg)("City Statistics"),population:(0,k.msg)("Population"),jobs:(0,k.msg)("Jobs"),treasury:(0,k.msg)("Treasury"),weekly:(0,k.msg)("Weekly"),money:(0,k.msg)("Money"),happiness:(0,k.msg)("Happiness"),notEnoughData:(0,k.msg)("Not enough data yet. Keep playing to see historical trends.")};function aa(){let e,t,r,a,o,s,c,d,h,u,f,m,g,p,x,y,b,w,v,_,M,S,j,P,T,C,N,z,I,R,Y,X,A,O,E,$,B,L,V,W=(0,n.c)(93),{state:D,setActivePanel:F}=eL(),{history:J,stats:U}=D,[H,G]=(0,l.useState)("population"),q=(0,k.useMessages)(),Q=(0,l.useRef)(null);W[0]!==H||W[1]!==J?(e=()=>{let e=Q.current;if(!e||J.length<2)return;let t=e.getContext("2d");if(!t)return;let r=e.width,a=e.height;t.fillStyle="#1a1f2e",t.fillRect(0,0,r,a);let i=[],n="#10b981";switch(H){case"population":i=J.map(al),n="#10b981";break;case"money":i=J.map(an),n="#f59e0b";break;case"happiness":i=J.map(ai),n="#ec4899"}if(i.length<2)return;let l=Math.min(...i),o=Math.max(...i)-l||1;t.strokeStyle="#2d3748",t.lineWidth=.5;for(let e=0;e<=4;e++){let i=40+e/4*(a-80);t.beginPath(),t.moveTo(40,i),t.lineTo(r-40,i),t.stroke()}t.strokeStyle=n,t.lineWidth=2,t.beginPath();let s=(r-80)/(i.length-1);i.forEach((e,r)=>{let i=40+r*s,n=40+(a-80)*(1-(e-l)/o);0===r?t.moveTo(i,n):t.lineTo(i,n)}),t.stroke()},t=[J,H],W[0]=H,W[1]=J,W[2]=e,W[3]=t):(e=W[2],t=W[3]),(0,l.useEffect)(e,t),W[4]!==F?(r=()=>F("none"),W[4]=F,W[5]=r):r=W[5],W[6]!==q?(a=q(ar.cityStatistics),W[6]=q,W[7]=a):a=W[7],W[8]!==a?(o=(0,i.jsx)(tD,{children:(0,i.jsx)(tJ,{children:a})}),W[8]=a,W[9]=o):o=W[9],W[10]!==q?(s=q(ar.population),W[10]=q,W[11]=s):s=W[11],W[12]!==s?(c=(0,i.jsx)("div",{className:"text-muted-foreground text-[10px] sm:text-xs mb-1",children:s}),W[12]=s,W[13]=c):c=W[13],W[14]!==U.population?(d=U.population.toLocaleString(),W[14]=U.population,W[15]=d):d=W[15],W[16]!==d?(h=(0,i.jsx)("div",{className:"font-mono tabular-nums font-semibold text-green-400 text-sm sm:text-base truncate",children:d}),W[16]=d,W[17]=h):h=W[17],W[18]!==c||W[19]!==h?(u=(0,i.jsxs)(tr,{className:"p-2 sm:p-3",children:[c,h]}),W[18]=c,W[19]=h,W[20]=u):u=W[20],W[21]!==q?(f=q(ar.jobs),W[21]=q,W[22]=f):f=W[22],W[23]!==f?(m=(0,i.jsx)("div",{className:"text-muted-foreground text-[10px] sm:text-xs mb-1",children:f}),W[23]=f,W[24]=m):m=W[24],W[25]!==U.jobs?(g=U.jobs.toLocaleString(),W[25]=U.jobs,W[26]=g):g=W[26],W[27]!==g?(p=(0,i.jsx)("div",{className:"font-mono tabular-nums font-semibold text-blue-400 text-sm sm:text-base truncate",children:g}),W[27]=g,W[28]=p):p=W[28],W[29]!==m||W[30]!==p?(x=(0,i.jsxs)(tr,{className:"p-2 sm:p-3",children:[m,p]}),W[29]=m,W[30]=p,W[31]=x):x=W[31],W[32]!==q?(y=q(ar.treasury),W[32]=q,W[33]=y):y=W[33],W[34]!==y?(b=(0,i.jsx)("div",{className:"text-muted-foreground text-[10px] sm:text-xs mb-1",children:y}),W[34]=y,W[35]=b):b=W[35],W[36]!==U.money?(w=U.money.toLocaleString(),W[36]=U.money,W[37]=w):w=W[37],W[38]!==w?(v=(0,i.jsxs)("div",{className:"font-mono tabular-nums font-semibold text-amber-400 text-sm sm:text-base truncate",children:["$",w]}),W[38]=w,W[39]=v):v=W[39],W[40]!==b||W[41]!==v?(_=(0,i.jsxs)(tr,{className:"p-2 sm:p-3",children:[b,v]}),W[40]=b,W[41]=v,W[42]=_):_=W[42],W[43]!==q?(M=q(ar.weekly),W[43]=q,W[44]=M):M=W[44],W[45]!==M?(S=(0,i.jsx)("div",{className:"text-muted-foreground text-[10px] sm:text-xs mb-1",children:M}),W[45]=M,W[46]=S):S=W[46];let Z=`font-mono tabular-nums font-semibold text-sm sm:text-base truncate ${U.income-U.expenses>=0?"text-green-400":"text-red-400"}`,K=Math.floor((U.income-U.expenses)/4);return W[47]!==K?(j=K.toLocaleString(),W[47]=K,W[48]=j):j=W[48],W[49]!==Z||W[50]!==j?(P=(0,i.jsxs)("div",{className:Z,children:["$",j]}),W[49]=Z,W[50]=j,W[51]=P):P=W[51],W[52]!==S||W[53]!==P?(T=(0,i.jsxs)(tr,{className:"p-2 sm:p-3",children:[S,P]}),W[52]=S,W[53]=P,W[54]=T):T=W[54],W[55]!==x||W[56]!==_||W[57]!==T||W[58]!==u?(C=(0,i.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 sm:gap-3",children:[u,x,_,T]}),W[55]=x,W[56]=_,W[57]=T,W[58]=u,W[59]=C):C=W[59],W[60]===Symbol.for("react.memo_cache_sentinel")?(N=e=>G(e),W[60]=N):N=W[60],W[61]!==q?(z=q(ar.population),W[61]=q,W[62]=z):z=W[62],W[63]!==z?(I=(0,i.jsx)(at,{value:"population",className:"text-xs sm:text-sm py-2 px-2 sm:px-3",children:z}),W[63]=z,W[64]=I):I=W[64],W[65]!==q?(R=q(ar.money),W[65]=q,W[66]=R):R=W[66],W[67]!==R?(Y=(0,i.jsx)(at,{value:"money",className:"text-xs sm:text-sm py-2 px-2 sm:px-3",children:R}),W[67]=R,W[68]=Y):Y=W[68],W[69]!==q?(X=q(ar.happiness),W[69]=q,W[70]=X):X=W[70],W[71]!==X?(A=(0,i.jsx)(at,{value:"happiness",className:"text-xs sm:text-sm py-2 px-2 sm:px-3",children:X}),W[71]=X,W[72]=A):A=W[72],W[73]!==I||W[74]!==Y||W[75]!==A?(O=(0,i.jsxs)(ae,{className:"grid w-full grid-cols-3 h-auto",children:[I,Y,A]}),W[73]=I,W[74]=Y,W[75]=A,W[76]=O):O=W[76],W[77]!==H||W[78]!==O?(E=(0,i.jsx)(r7,{value:H,onValueChange:N,children:O}),W[77]=H,W[78]=O,W[79]=E):E=W[79],W[80]!==J.length||W[81]!==q?($=(0,i.jsx)(tr,{className:"p-4",children:J.length<2?(0,i.jsx)("div",{className:"h-[200px] flex items-center justify-center text-muted-foreground text-sm",children:q(ar.notEnoughData)}):(0,i.jsx)("canvas",{ref:Q,width:536,height:200,className:"w-full rounded-md"})}),W[80]=J.length,W[81]=q,W[82]=$):$=W[82],W[83]!==C||W[84]!==E||W[85]!==$?(B=(0,i.jsxs)("div",{className:"space-y-4",children:[C,E,$]}),W[83]=C,W[84]=E,W[85]=$,W[86]=B):B=W[86],W[87]!==B||W[88]!==o?(L=(0,i.jsxs)(tW,{className:"max-w-[600px]",children:[o,B]}),W[87]=B,W[88]=o,W[89]=L):L=W[89],W[90]!==r||W[91]!==L?(V=(0,i.jsx)(tB,{open:!0,onOpenChange:r,children:L}),W[90]=r,W[91]=L,W[92]=V):V=W[92],V}function ai(e){return e.happiness}function an(e){return e.money}function al(e){return e.population}var ao=r(3981),as=r(2222),ac=r(6181);let ad=l.forwardRef(({className:e,...t},r)=>(0,i.jsx)(ac.bL,{className:h("peer inline-flex shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),style:{width:"44px",minWidth:"44px",height:"24px"},...t,ref:r,children:(0,i.jsx)(ac.zi,{className:h("pointer-events-none block rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0"),style:{width:"20px",height:"20px"}})}));function ah(e){let t,r,a,o,s,c,d,h,u,f,m,g,p,x,y,b,w,v,_,M,S,k,j,P,T,C,N=(0,n.c)(68),{onClose:z}=e,{currentSpritePack:I}=eL(),[R,Y]=(0,l.useState)("main"),X=(0,l.useRef)(null);N[0]===Symbol.for("react.memo_cache_sentinel")?(t={main:null,construction:null,abandoned:null,dense:null,modern:null,parks:null,parksConstruction:null,services:null,infrastructure:null},N[0]=t):t=N[0];let[A,O]=(0,l.useState)(t);N[1]!==I.abandonedSrc||N[2]!==I.constructionSrc||N[3]!==I.denseSrc||N[4]!==I.infrastructureSrc||N[5]!==I.modernSrc||N[6]!==I.parksConstructionSrc||N[7]!==I.parksSrc||N[8]!==I.servicesSrc||N[9]!==I.src?(r=()=>{let e=(e,t)=>e?new Promise(r=>{let a=new Image;a.onload=()=>{O(e=>({...e,[t]:a})),r()},a.onerror=()=>{O(e=>({...e,[t]:null})),r()},a.src=e}):(O(e=>({...e,[t]:null})),Promise.resolve());Promise.all([e(I.src,"main"),e(I.constructionSrc,"construction"),e(I.abandonedSrc,"abandoned"),e(I.denseSrc,"dense"),e(I.modernSrc,"modern"),e(I.parksSrc,"parks"),e(I.parksConstructionSrc,"parksConstruction"),e(I.servicesSrc,"services"),e(I.infrastructureSrc,"infrastructure")])},N[1]=I.abandonedSrc,N[2]=I.constructionSrc,N[3]=I.denseSrc,N[4]=I.infrastructureSrc,N[5]=I.modernSrc,N[6]=I.parksConstructionSrc,N[7]=I.parksSrc,N[8]=I.servicesSrc,N[9]=I.src,N[10]=r):r=N[10],N[11]!==I?(a=[I],N[11]=I,N[12]=a):a=N[12],(0,l.useEffect)(r,a);let E=!!A.main;N[13]!==E?(o={id:"main",label:"Main",available:E},N[13]=E,N[14]=o):o=N[14];let $=!!A.construction;N[15]!==$?(s={id:"construction",label:"Construction",available:$},N[15]=$,N[16]=s):s=N[16];let B=!!A.abandoned;N[17]!==B?(c={id:"abandoned",label:"Abandoned",available:B},N[17]=B,N[18]=c):c=N[18];let L=!!A.dense;N[19]!==L?(d={id:"dense",label:"High Density",available:L},N[19]=L,N[20]=d):d=N[20];let V=!!A.modern;N[21]!==V?(h={id:"modern",label:"Modern",available:V},N[21]=V,N[22]=h):h=N[22];let W=!!A.parks;N[23]!==W?(u={id:"parks",label:"Parks",available:W},N[23]=W,N[24]=u):u=N[24];let D=!!A.parksConstruction;N[25]!==D?(f={id:"parksConstruction",label:"Parks Construction",available:D},N[25]=D,N[26]=f):f=N[26];let F=!!A.services;N[27]!==F?(m={id:"services",label:"Services",available:F},N[27]=F,N[28]=m):m=N[28];let J=!!A.infrastructure;N[29]!==J?(g={id:"infrastructure",label:"Infrastructure",available:J},N[29]=J,N[30]=g):g=N[30],N[31]!==d||N[32]!==h||N[33]!==u||N[34]!==f||N[35]!==m||N[36]!==g||N[37]!==o||N[38]!==s||N[39]!==c?(p=[o,s,c,d,h,u,f,m,g].filter(af),N[31]=d,N[32]=h,N[33]=u,N[34]=f,N[35]=m,N[36]=g,N[37]=o,N[38]=s,N[39]=c,N[40]=p):p=N[40];let U=p;e:{if(U.length>0&&!U.find(e=>e.id===R)){x=U[0].id;break e}x=R}let H=x;N[41]!==H||N[42]!==I||N[43]!==A?(y=()=>{let e,t,r=X.current,a=A[H];if(!r||!a)return;let i=r.getContext("2d",{willReadFrequently:!1,alpha:!0});if(!i)return;let n=window.devicePixelRatio||1;i.imageSmoothingEnabled=!1,i.imageSmoothingQuality="high";let l=[],o=a.naturalWidth||a.width,s=a.naturalHeight||a.height;if("main"===H)I.spriteOrder.forEach((e,t)=>{let r=ev(Object.entries(I.buildingToSprite).find(t=>{let[,r]=t;return r===e})?.[0]||e,o,s,I);r&&l.push({label:e,coords:r,index:t})});else if("construction"===H&&I.constructionSrc)I.spriteOrder.forEach((e,t)=>{let r=ev(Object.entries(I.buildingToSprite).find(t=>{let[,r]=t;return r===e})?.[0]||e,o,s,I);r&&l.push({label:`${e} (construction)`,coords:r,index:t})});else if("abandoned"===H&&I.abandonedSrc)I.spriteOrder.forEach((e,t)=>{let r=ev(Object.entries(I.buildingToSprite).find(t=>{let[,r]=t;return r===e})?.[0]||e,o,s,I);r&&l.push({label:`${e} (abandoned)`,coords:r,index:t})});else if("dense"===H&&I.denseSrc&&I.denseVariants){e=I.cols,t=I.rows;let r=Math.floor(o/e),a=Math.floor(s/t);Object.entries(I.denseVariants).forEach(e=>{let[t,i]=e;i.forEach((e,i)=>{let n=e.col*r,o=e.row*a;l.push({label:`${t} (dense ${i+1})`,coords:{sx:n,sy:o,sw:r,sh:a}})})})}else if("modern"===H&&I.modernSrc&&I.modernVariants){e=I.cols,t=I.rows;let r=Math.floor(o/e),a=Math.floor(s/t);Object.entries(I.modernVariants).forEach(e=>{let[t,i]=e;i.forEach((e,i)=>{let n=e.col*r,o=e.row*a;l.push({label:`${t} (modern ${i+1})`,coords:{sx:n,sy:o,sw:r,sh:a}})})})}else if("parks"===H&&I.parksSrc&&I.parksBuildings){e=I.parksCols||I.cols,t=I.parksRows||I.rows;let r=Math.floor(o/e),a=Math.floor(s/t);Object.entries(I.parksBuildings).forEach(e=>{let[t,i]=e,n=i.col*r,o=i.row*a;l.push({label:t,coords:{sx:n,sy:o,sw:r,sh:a}})})}else if("parksConstruction"===H&&I.parksConstructionSrc&&I.parksBuildings){e=I.parksCols||I.cols,t=I.parksRows||I.rows;let r=Math.floor(o/e),a=Math.floor(s/t);Object.entries(I.parksBuildings).forEach(e=>{let[t,i]=e,n=i.col*r,o=i.row*a;l.push({label:`${t} (construction)`,coords:{sx:n,sy:o,sw:r,sh:a}})})}else if("services"===H&&I.servicesSrc&&I.servicesVariants){e=I.servicesCols||I.cols,t=I.servicesRows||I.rows;let r=Math.floor(o/e),a=Math.floor(s/t);Object.entries(I.servicesVariants).forEach(e=>{let[t,i]=e;i.forEach((e,i)=>{let n=e.col*r,o=e.row*a;l.push({label:`${t} (level ${i+1})`,coords:{sx:n,sy:o,sw:r,sh:a}})})})}else if("infrastructure"===H&&I.infrastructureSrc&&I.infrastructureVariants){e=I.infrastructureCols||5,t=I.infrastructureRows||6;let r=Math.floor(o/e),a=Math.floor(s/t);Object.entries(I.infrastructureVariants).forEach(e=>{let[t,i]=e;i.forEach((e,i)=>{let n=e.col*r,o=e.row*a;l.push({label:`${t} (level ${i+1})`,coords:{sx:n,sy:o,sw:r,sh:a}})})})}let c=135.2*Math.ceil(l.length/5)+60;r.width=700*n,r.height=c*n,r.style.width="700px",r.style.height=`${c}px`,i.scale(n,n),i.fillStyle="#1a1a2e",i.fillRect(0,0,700,c),l.forEach((e,t)=>{let r=Math.floor(t/5),n=94+t%5*96,l=68.4+135.2*r;i.strokeStyle="#3d3d5c",i.lineWidth=1,i.beginPath(),i.moveTo(n,l-19.2),i.lineTo(n+32,l),i.lineTo(n,l+19.2),i.lineTo(n-32,l),i.closePath(),i.stroke(),i.fillStyle="#2a2a4a",i.fill();let o=76.8*(e.coords.sh/e.coords.sw),s=n-38.4,c=l+19.2-o+.15*o;i.drawImage(a,e.coords.sx,e.coords.sy,e.coords.sw,e.coords.sh,Math.round(s),Math.round(c),Math.round(76.8),Math.round(o)),i.fillStyle="#888",i.font="10px monospace",i.textAlign="center";let d=e.label.split(" ");d.forEach((e,t)=>{i.fillText(e,n,l+38.4+16+10*t)}),void 0!==e.index&&(i.fillStyle="#666",i.font="8px monospace",i.fillText(`[${e.index}]`,n,l+38.4+26+10*d.length))})},b=[A,H,I],N[41]=H,N[42]=I,N[43]=A,N[44]=y,N[45]=b):(y=N[44],b=N[45]),(0,l.useEffect)(y,b);let G="main"===H?I.src:"construction"===H?I.constructionSrc:"abandoned"===H?I.abandonedSrc:"dense"===H?I.denseSrc:"modern"===H?I.modernSrc:"parksConstruction"===H?I.parksConstructionSrc:"services"===H?I.servicesSrc:"infrastructure"===H?I.infrastructureSrc:I.parksSrc,q=("parks"===H||"parksConstruction"===H)&&I.parksCols&&I.parksRows?`${I.parksCols}x${I.parksRows}`:"services"===H&&I.servicesCols&&I.servicesRows?`${I.servicesCols}x${I.servicesRows}`:"infrastructure"===H&&I.infrastructureCols&&I.infrastructureRows?`${I.infrastructureCols}x${I.infrastructureRows}`:`${I.cols}x${I.rows}`;return N[46]===Symbol.for("react.memo_cache_sentinel")?(w=(0,i.jsx)(tJ,{children:"Sprite Test View"}),N[46]=w):w=N[46],N[47]!==I.name?(v=(0,i.jsxs)(tD,{children:[w,(0,i.jsxs)(tU,{children:['View all sprite variants from "',I.name,'"']})]}),N[47]=I.name,N[48]=v):v=N[48],N[49]!==U?(_=(0,i.jsx)(ae,{className:"flex flex-wrap gap-1 w-full",children:U.map(au)}),N[49]=U,N[50]=_):_=N[50],N[51]!==H||N[52]!==_?(M=(0,i.jsx)(r7,{value:H,onValueChange:Y,className:"w-full",children:_}),N[51]=H,N[52]=_,N[53]=M):M=N[53],N[54]===Symbol.for("react.memo_cache_sentinel")?(S=(0,i.jsx)("div",{className:"overflow-auto max-h-[70vh] bg-[#1a1a2e] rounded-lg",children:(0,i.jsx)("canvas",{ref:X,className:"mx-auto",style:{imageRendering:"pixelated"}})}),N[54]=S):S=N[54],N[55]!==G||N[56]!==q?(k=(0,i.jsxs)("p",{children:["Sprite sheet: ",G," (",q," grid)"]}),N[55]=G,N[56]=q,N[57]=k):k=N[57],N[58]===Symbol.for("react.memo_cache_sentinel")?(j=(0,i.jsxs)("p",{children:["Edit offsets in ",(0,i.jsx)("code",{className:"px-1 rounded bg-muted",children:"src/lib/renderConfig.ts"}),"  each sprite pack's verticalOffsets"]}),N[58]=j):j=N[58],N[59]!==k?(P=(0,i.jsxs)("div",{className:"space-y-1 text-xs text-muted-foreground",children:[k,j]}),N[59]=k,N[60]=P):P=N[60],N[61]!==v||N[62]!==M||N[63]!==P?(T=(0,i.jsxs)(tW,{className:"max-w-[900px] max-h-[90vh]",children:[v,M,S,P]}),N[61]=v,N[62]=M,N[63]=P,N[64]=T):T=N[64],N[65]!==z||N[66]!==T?(C=(0,i.jsx)(tB,{open:!0,onOpenChange:z,children:T}),N[65]=z,N[66]=T,N[67]=C):C=N[67],C}function au(e){return(0,i.jsx)(at,{value:e.id,className:"flex-shrink-0 text-xs",children:e.label},e.id)}function af(e){return e.available}ad.displayName=ac.bL.displayName;let am="isocity-mobile-ui-settings",ag="isocity-mobile-ui-settings-updated",ap={hudDensity:"compact",toolLayout:"category",showMinimap:!1};function ax(e){return e&&"object"==typeof e?{hudDensity:"minimal"===e.hudDensity||"compact"===e.hudDensity||"full"===e.hudDensity?e.hudDensity:ap.hudDensity,toolLayout:"category"===e.toolLayout||"quick"===e.toolLayout?e.toolLayout:ap.toolLayout,showMinimap:!!e.showMinimap}:ap}function ay(){try{let e=window.localStorage.getItem(am);if(!e)return ap;return ax(JSON.parse(e))}catch{return ap}}function ab(){let e,t,r,a,i=(0,n.c)(5),[o,s]=(0,l.useState)(aw);i[0]===Symbol.for("react.memo_cache_sentinel")?(e=()=>{let e,t;return e=e=>{s(ax(e.detail))},t=e=>{e.key===am&&s(ay())},window.addEventListener(ag,e),window.addEventListener("storage",t),()=>{window.removeEventListener(ag,e),window.removeEventListener("storage",t)}},t=[],i[0]=e,i[1]=t):(e=i[0],t=i[1]),(0,l.useEffect)(e,t),i[2]===Symbol.for("react.memo_cache_sentinel")?(r=e=>{let t;s((t=ax({...ay(),...e}),window.localStorage.setItem(am,JSON.stringify(t)),window.dispatchEvent(new CustomEvent(ag,{detail:t})),t))},i[2]=r):r=i[2];let c=r;return i[3]!==o?(a={settings:o,updateSettings:c},i[3]=o,i[4]=a):a=i[4],a}function aw(){return ay()}let av={settings:(0,k.msg)("Settings"),gameSettings:(0,k.msg)("Game Settings"),disasters:(0,k.msg)("Disasters"),disastersDesc:(0,k.msg)("Enable random fires and disasters"),spritePack:(0,k.msg)("Sprite Pack"),spritePackDesc:(0,k.msg)("Choose building artwork style"),language:(0,k.msg)("Language"),languageDesc:(0,k.msg)("Choose your preferred language"),cityInformation:(0,k.msg)("City Information"),cityName:(0,k.msg)("City Name"),gridSize:(0,k.msg)("Grid Size"),autoSave:(0,k.msg)("Auto-Save"),enabled:(0,k.msg)("Enabled"),expandCity:(0,k.msg)("Expand City (+30x30)"),expandCityDesc:(0,k.msg)("Add 15 tiles on each side. Land edges extend as land, water edges extend as water."),shrinkCity:(0,k.msg)("Shrink City (-30x30)"),shrinkCityDesc:(0,k.msg)("Remove 15 tiles from each edge. Buildings on edges will be deleted."),savedCities:(0,k.msg)("Saved Cities"),savedCitiesDesc:(0,k.msg)("Save multiple cities and switch between them"),citySaved:(0,k.msg)("City Saved!"),save:(0,k.msg)("Save"),newCityName:(0,k.msg)("New city name..."),cancel:(0,k.msg)("Cancel"),deleteThisCity:(0,k.msg)("Delete this city?"),delete:(0,k.msg)("Delete"),current:(0,k.msg)("(current)"),pop:(0,k.msg)("Pop"),saved:(0,k.msg)("Saved"),load:(0,k.msg)("Load"),rename:(0,k.msg)("Rename"),noSavedCities:(0,k.msg)("No saved cities yet."),restore:(0,k.msg)("Restore"),citySavedBeforeViewing:(0,k.msg)("Your city was saved before viewing a shared city"),startNewGame:(0,k.msg)("Start New Game"),confirmReset:(0,k.msg)("Are you sure? This will reset all progress."),reset:(0,k.msg)("Reset"),exportGame:(0,k.msg)("Export Game"),exportGameDesc:(0,k.msg)("Copy your game state to share or backup"),copied:(0,k.msg)("Copied!"),copyGameState:(0,k.msg)("Copy Game State"),importGame:(0,k.msg)("Import Game"),importGameDesc:(0,k.msg)("Paste a game state to load it"),pasteGameState:(0,k.msg)("Paste game state here..."),invalidGameState:(0,k.msg)("Invalid game state. Please check and try again."),gameLoadedSuccess:(0,k.msg)("Game loaded successfully!"),loadGameState:(0,k.msg)("Load Game State"),developerTools:(0,k.msg)("Developer Tools"),openSpriteTestView:(0,k.msg)("Open Sprite Test View"),loadExampleState:(0,k.msg)("Load Example State"),dayNightMode:(0,k.msg)("Day/Night Mode"),dayNightModeDesc:(0,k.msg)("Override the time-of-day appearance without affecting time progression"),auto:(0,k.msg)("Auto"),day:(0,k.msg)("Day"),night:(0,k.msg)("Night"),cannotShrink:(0,k.msg)("Cannot shrink city further - minimum size reached."),mobileUi:(0,k.msg)("Mobile UI"),mobileUiDesc:(0,k.msg)("Customize compact layouts for phones and tablets"),mobileToolLayout:(0,k.msg)("Toolbar Layout"),toolbarLayoutCategory:(0,k.msg)("Category First"),toolbarLayoutQuick:(0,k.msg)("Quick Tools"),mobileHudDensity:(0,k.msg)("HUD Density"),hudMinimal:(0,k.msg)("Minimal"),hudCompact:(0,k.msg)("Compact"),hudFull:(0,k.msg)("Full"),mobileMinimap:(0,k.msg)("Show Minimap on Mobile"),mobileMinimapDesc:(0,k.msg)("Default is off. Turn on to access a compact minimap overlay.")};async function a_(e,t,r){try{let a=await fetch(`/example-states/${e}`);if(!a.ok){console.error(`Failed to fetch ${e}:`,a.status),alert(`Failed to load example state: ${a.status}`);return}let i=await a.json();t(JSON.stringify(i))?r("none"):(console.error("loadState returned false - invalid state format for",e),alert("Failed to load example state: invalid format"))}catch(e){console.error("Error loading example state:",e),alert(`Error loading example state: ${e}`)}}function aM(){let e,t,r,a,o,s,c,d,h,u,m,g,p,x,y,b,w,v,_,M,S,j,P,T,C,N,z,I,R,Y,X,A,O,E,$,B,L,V,W,D,F,J,U,H,G,q,Q,Z,K,ee,et,er,ea,ei,en,el,eo,es,ec,ed,eh,eu,ef,em,eg,ep,ex,ey,eb,ew,ev,e_,eM,eS,ek,ej,eP,eT,eC,eN,ez,eI,eR,eY,eX,eA,eO,eE,e$,eB,eV,eW,eD,eF,eJ,eU,eH,eG,eq,eQ,eZ,eK,e0,e1,e2,e5,e3,e4,e9,e6,e8,e7,te,tt,tr,ta,ti,tn,tl,to,ts,tc,td,th,tu,tf,tm,tg,tp,tx,ty,tb,tw,tv,t_,tM,tS,tk,tj,tP,tT,tC,tN,tz,tI,tR,tY,tX,tA,tE,t$,tL,tV,tF,tU,tH,tG,tq,tQ,tZ,tK,t0,t1,t2,t5=(0,n.c)(448),{state:t3,setActivePanel:t4,setDisastersEnabled:t9,newGame:t6,loadState:t8,exportState:t7,expandCity:re,shrinkCity:rt,currentSpritePack:rr,availableSpritePacks:ra,setSpritePack:ri,dayNightMode:rn,setDayNightMode:rl,getSavedCityInfo:ro,restoreSavedCity:rs,savedCities:rc,saveCity:rh,loadSavedCity:ru,deleteSavedCity:rf,renameSavedCity:rm}=eL(),{disastersEnabled:rg,cityName:rp,gridSize:rx,id:ry}=t3,rb=(0,k.useMessages)(),rw=(0,as.useSearchParams)(),rv=(0,as.useRouter)(),[r_,rM]=(0,l.useState)(rp),[rS,rk]=(0,l.useState)(!1),[rj,rP]=(0,l.useState)(!1),[rT,rC]=(0,l.useState)(null),[rN,rz]=(0,l.useState)(null),[rI,rR]=(0,l.useState)(""),[rY,rX]=(0,l.useState)(""),[rA,rO]=(0,l.useState)(!1),[rE,r$]=(0,l.useState)(!1),[rB,rL]=(0,l.useState)(!1);t5[0]!==ro?(e=ro(),t5[0]=ro,t5[1]=e):e=t5[1];let[rV,rW]=(0,l.useState)(e),{settings:rD,updateSettings:rF}=ab();t5[2]!==ro?(t=()=>{rW(ro())},r=[ro],t5[2]=ro,t5[3]=t,t5[4]=r):(t=t5[3],r=t5[4]),l.useEffect(t,r),t5[5]!==rw?(a=rw?.get("spriteTest"),t5[5]=rw,t5[6]=a):a=t5[6];let rJ="true"===a,[rU,rH]=(0,l.useState)(rJ),rG=(0,l.useRef)(rJ),rq=(0,l.useRef)(!1);t5[7]!==rw?(o=()=>{let e=rw?.get("spriteTest")==="true";e===rG.current||rq.current||(rG.current=e,setTimeout(()=>rH(e),0))},s=[rw],t5[7]=rw,t5[8]=o,t5[9]=s):(o=t5[8],s=t5[9]),(0,l.useEffect)(o,s),t5[10]!==rv||t5[11]!==rw||t5[12]!==rU?(c=()=>{if(rw?.get("spriteTest")==="true"===rU)return;rq.current=!0,rG.current=rU;let e=new URLSearchParams(rw?.toString()||"");rU?e.set("spriteTest","true"):e.delete("spriteTest");let t=e.toString()?`?${e.toString()}`:window.location.pathname;rv.replace(t,{scroll:!1}),setTimeout(()=>{rq.current=!1},0)},d=[rU,rw,rv],t5[10]=rv,t5[11]=rw,t5[12]=rU,t5[13]=c,t5[14]=d):(c=t5[13],d=t5[14]),(0,l.useEffect)(c,d),t5[15]!==t7?(h=async()=>{let e=t7();await navigator.clipboard.writeText(e),rO(!0),setTimeout(()=>rO(!1),2e3)},t5[15]=t7,t5[16]=h):h=t5[16];let rQ=h;t5[17]!==rY||t5[18]!==t8?(u=()=>{r$(!1),rL(!1),rY.trim()&&(t8(rY.trim())?(rL(!0),rX(""),setTimeout(()=>rL(!1),2e3)):r$(!0))},t5[17]=rY,t5[18]=t8,t5[19]=u):u=t5[19];let rZ=u;if(t5[20]!==t4?(m=()=>t4("none"),t5[20]=t4,t5[21]=m):m=t5[21],t5[22]!==rb?(g=rb(av.settings),t5[22]=rb,t5[23]=g):g=t5[23],t5[24]!==g?(p=(0,i.jsx)(tD,{children:(0,i.jsx)(tJ,{children:g})}),t5[24]=g,t5[25]=p):p=t5[25],t5[26]!==rb?(x=rb(av.gameSettings),t5[26]=rb,t5[27]=x):x=t5[27],t5[28]!==x?(y=(0,i.jsx)("div",{className:"text-[10px] text-muted-foreground uppercase tracking-wider mb-3",children:x}),t5[28]=x,t5[29]=y):y=t5[29],t5[30]!==rb?(b=rb(av.disasters),t5[30]=rb,t5[31]=b):b=t5[31],t5[32]!==b?(w=(0,i.jsx)(r4,{children:b}),t5[32]=b,t5[33]=w):w=t5[33],t5[34]!==rb?(v=rb(av.disastersDesc),t5[34]=rb,t5[35]=v):v=t5[35],t5[36]!==v?(_=(0,i.jsx)("p",{className:"text-muted-foreground text-xs",children:v}),t5[36]=v,t5[37]=_):_=t5[37],t5[38]!==w||t5[39]!==_?(M=(0,i.jsxs)("div",{className:"flex-1 min-w-0",children:[w,_]}),t5[38]=w,t5[39]=_,t5[40]=M):M=t5[40],t5[41]!==rg||t5[42]!==t9?(S=(0,i.jsx)(ad,{checked:rg,onCheckedChange:t9}),t5[41]=rg,t5[42]=t9,t5[43]=S):S=t5[43],t5[44]!==M||t5[45]!==S?(j=(0,i.jsxs)("div",{className:"flex items-center justify-between py-2 gap-4",children:[M,S]}),t5[44]=M,t5[45]=S,t5[46]=j):j=t5[46],t5[47]!==rb?(P=rb(av.spritePack),t5[47]=rb,t5[48]=P):P=t5[48],t5[49]!==P?(T=(0,i.jsx)(r4,{children:P}),t5[49]=P,t5[50]=T):T=t5[50],t5[51]!==rb?(C=rb(av.spritePackDesc),t5[51]=rb,t5[52]=C):C=t5[52],t5[53]!==C?(N=(0,i.jsx)("p",{className:"text-muted-foreground text-xs mb-2",children:C}),t5[53]=C,t5[54]=N):N=t5[54],t5[55]!==ra||t5[56]!==rr||t5[57]!==ri){let e;t5[59]!==rr||t5[60]!==ri?(e=e=>(0,i.jsxs)("button",{onClick:()=>ri(e.id),className:`flex items-center gap-3 p-2 rounded-md border transition-colors text-left ${rr.id===e.id?"border-primary bg-primary/10 text-foreground":"border-border hover:border-muted-foreground/50 text-muted-foreground hover:text-foreground"}`,children:[(0,i.jsx)("div",{className:"w-10 h-10 rounded overflow-hidden bg-muted flex-shrink-0 relative",children:(0,i.jsx)(ao.default,{src:e.src,alt:e.name,fill:!0,className:"object-cover object-top",style:{imageRendering:"pixelated"},unoptimized:!0})}),(0,i.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,i.jsx)("div",{className:"font-medium text-sm truncate",children:e.name}),(0,i.jsx)("div",{className:"text-xs text-muted-foreground truncate",children:e.src})]}),rr.id===e.id&&(0,i.jsx)("div",{className:"w-2 h-2 rounded-full bg-primary flex-shrink-0"})]},e.id),t5[59]=rr,t5[60]=ri,t5[61]=e):e=t5[61],z=ra.map(e),t5[55]=ra,t5[56]=rr,t5[57]=ri,t5[58]=z}else z=t5[58];t5[62]!==z?(I=(0,i.jsx)("div",{className:"grid grid-cols-1 gap-2",children:z}),t5[62]=z,t5[63]=I):I=t5[63],t5[64]!==T||t5[65]!==N||t5[66]!==I?(R=(0,i.jsxs)("div",{className:"py-2",children:[T,N,I]}),t5[64]=T,t5[65]=N,t5[66]=I,t5[67]=R):R=t5[67],t5[68]!==rb?(Y=rb(av.language),t5[68]=rb,t5[69]=Y):Y=t5[69],t5[70]!==Y?(X=(0,i.jsx)(r4,{children:Y}),t5[70]=Y,t5[71]=X):X=t5[71],t5[72]!==rb?(A=rb(av.languageDesc),t5[72]=rb,t5[73]=A):A=t5[73],t5[74]!==A?(O=(0,i.jsx)("p",{className:"text-muted-foreground text-xs mb-2",children:A}),t5[74]=A,t5[75]=O):O=t5[75],t5[76]===Symbol.for("react.memo_cache_sentinel")?(E=(0,i.jsx)(k.LocaleSelector,{}),t5[76]=E):E=t5[76],t5[77]!==X||t5[78]!==O?($=(0,i.jsxs)("div",{className:"py-2",children:[X,O,E]}),t5[77]=X,t5[78]=O,t5[79]=$):$=t5[79],t5[80]!==rb?(B=rb(av.mobileUi),t5[80]=rb,t5[81]=B):B=t5[81],t5[82]!==B?(L=(0,i.jsx)(r4,{children:B}),t5[82]=B,t5[83]=L):L=t5[83],t5[84]!==rb?(V=rb(av.mobileUiDesc),t5[84]=rb,t5[85]=V):V=t5[85],t5[86]!==V?(W=(0,i.jsx)("p",{className:"text-muted-foreground text-xs",children:V}),t5[86]=V,t5[87]=W):W=t5[87],t5[88]!==L||t5[89]!==W?(D=(0,i.jsxs)("div",{children:[L,W]}),t5[88]=L,t5[89]=W,t5[90]=D):D=t5[90],t5[91]!==rb?(F=rb(av.mobileToolLayout),t5[91]=rb,t5[92]=F):F=t5[92],t5[93]!==F?(J=(0,i.jsx)("div",{className:"text-xs font-medium mb-1",children:F}),t5[93]=F,t5[94]=J):J=t5[94];let rK="category"===rD.toolLayout?"default":"outline";t5[95]!==rF?(U=()=>rF({toolLayout:"category"}),t5[95]=rF,t5[96]=U):U=t5[96],t5[97]!==rb?(H=rb(av.toolbarLayoutCategory),t5[97]=rb,t5[98]=H):H=t5[98],t5[99]!==rK||t5[100]!==U||t5[101]!==H?(G=(0,i.jsx)(f,{variant:rK,size:"sm",onClick:U,children:H}),t5[99]=rK,t5[100]=U,t5[101]=H,t5[102]=G):G=t5[102];let r0="quick"===rD.toolLayout?"default":"outline";t5[103]!==rF?(q=()=>rF({toolLayout:"quick"}),t5[103]=rF,t5[104]=q):q=t5[104],t5[105]!==rb?(Q=rb(av.toolbarLayoutQuick),t5[105]=rb,t5[106]=Q):Q=t5[106],t5[107]!==r0||t5[108]!==q||t5[109]!==Q?(Z=(0,i.jsx)(f,{variant:r0,size:"sm",onClick:q,children:Q}),t5[107]=r0,t5[108]=q,t5[109]=Q,t5[110]=Z):Z=t5[110],t5[111]!==G||t5[112]!==Z?(K=(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[G,Z]}),t5[111]=G,t5[112]=Z,t5[113]=K):K=t5[113],t5[114]!==J||t5[115]!==K?(ee=(0,i.jsxs)("div",{children:[J,K]}),t5[114]=J,t5[115]=K,t5[116]=ee):ee=t5[116],t5[117]!==rb?(et=rb(av.mobileHudDensity),t5[117]=rb,t5[118]=et):et=t5[118],t5[119]!==et?(er=(0,i.jsx)("div",{className:"text-xs font-medium mb-1",children:et}),t5[119]=et,t5[120]=er):er=t5[120];let r1="minimal"===rD.hudDensity?"default":"outline";t5[121]!==rF?(ea=()=>rF({hudDensity:"minimal"}),t5[121]=rF,t5[122]=ea):ea=t5[122],t5[123]!==rb?(ei=rb(av.hudMinimal),t5[123]=rb,t5[124]=ei):ei=t5[124],t5[125]!==r1||t5[126]!==ea||t5[127]!==ei?(en=(0,i.jsx)(f,{variant:r1,size:"sm",onClick:ea,children:ei}),t5[125]=r1,t5[126]=ea,t5[127]=ei,t5[128]=en):en=t5[128];let r2="compact"===rD.hudDensity?"default":"outline";t5[129]!==rF?(el=()=>rF({hudDensity:"compact"}),t5[129]=rF,t5[130]=el):el=t5[130],t5[131]!==rb?(eo=rb(av.hudCompact),t5[131]=rb,t5[132]=eo):eo=t5[132],t5[133]!==r2||t5[134]!==el||t5[135]!==eo?(es=(0,i.jsx)(f,{variant:r2,size:"sm",onClick:el,children:eo}),t5[133]=r2,t5[134]=el,t5[135]=eo,t5[136]=es):es=t5[136];let r5="full"===rD.hudDensity?"default":"outline";t5[137]!==rF?(ec=()=>rF({hudDensity:"full"}),t5[137]=rF,t5[138]=ec):ec=t5[138],t5[139]!==rb?(ed=rb(av.hudFull),t5[139]=rb,t5[140]=ed):ed=t5[140],t5[141]!==r5||t5[142]!==ec||t5[143]!==ed?(eh=(0,i.jsx)(f,{variant:r5,size:"sm",onClick:ec,children:ed}),t5[141]=r5,t5[142]=ec,t5[143]=ed,t5[144]=eh):eh=t5[144],t5[145]!==en||t5[146]!==es||t5[147]!==eh?(eu=(0,i.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[en,es,eh]}),t5[145]=en,t5[146]=es,t5[147]=eh,t5[148]=eu):eu=t5[148],t5[149]!==er||t5[150]!==eu?(ef=(0,i.jsxs)("div",{children:[er,eu]}),t5[149]=er,t5[150]=eu,t5[151]=ef):ef=t5[151],t5[152]!==rb?(em=rb(av.mobileMinimap),t5[152]=rb,t5[153]=em):em=t5[153],t5[154]!==em?(eg=(0,i.jsx)(r4,{children:em}),t5[154]=em,t5[155]=eg):eg=t5[155],t5[156]!==rb?(ep=rb(av.mobileMinimapDesc),t5[156]=rb,t5[157]=ep):ep=t5[157],t5[158]!==ep?(ex=(0,i.jsx)("p",{className:"text-muted-foreground text-xs",children:ep}),t5[158]=ep,t5[159]=ex):ex=t5[159],t5[160]!==eg||t5[161]!==ex?(ey=(0,i.jsxs)("div",{className:"flex-1 min-w-0",children:[eg,ex]}),t5[160]=eg,t5[161]=ex,t5[162]=ey):ey=t5[162],t5[163]!==rF?(eb=e=>rF({showMinimap:e}),t5[163]=rF,t5[164]=eb):eb=t5[164],t5[165]!==rD.showMinimap||t5[166]!==eb?(ew=(0,i.jsx)(ad,{checked:rD.showMinimap,onCheckedChange:eb}),t5[165]=rD.showMinimap,t5[166]=eb,t5[167]=ew):ew=t5[167],t5[168]!==ey||t5[169]!==ew?(ev=(0,i.jsxs)("div",{className:"flex items-center justify-between py-2 gap-4",children:[ey,ew]}),t5[168]=ey,t5[169]=ew,t5[170]=ev):ev=t5[170],t5[171]!==D||t5[172]!==ee||t5[173]!==ef||t5[174]!==ev?(e_=(0,i.jsxs)("div",{className:"py-2 space-y-3",children:[D,ee,ef,ev]}),t5[171]=D,t5[172]=ee,t5[173]=ef,t5[174]=ev,t5[175]=e_):e_=t5[175],t5[176]!==y||t5[177]!==j||t5[178]!==R||t5[179]!==$||t5[180]!==e_?(eM=(0,i.jsxs)("div",{children:[y,j,R,$,e_]}),t5[176]=y,t5[177]=j,t5[178]=R,t5[179]=$,t5[180]=e_,t5[181]=eM):eM=t5[181],t5[182]!==rb?(eS=rb(av.cityInformation),t5[182]=rb,t5[183]=eS):eS=t5[183],t5[184]!==eS?(ek=(0,i.jsx)("div",{className:"text-[10px] text-muted-foreground uppercase tracking-wider mb-3",children:eS}),t5[184]=eS,t5[185]=ek):ek=t5[185],t5[186]!==rb?(ej=rb(av.cityName),t5[186]=rb,t5[187]=ej):ej=t5[187],t5[188]!==ej?(eP=(0,i.jsx)("span",{children:ej}),t5[188]=ej,t5[189]=eP):eP=t5[189],t5[190]!==rp?(eT=(0,i.jsx)("span",{className:"text-foreground",children:rp}),t5[190]=rp,t5[191]=eT):eT=t5[191],t5[192]!==eP||t5[193]!==eT?(eC=(0,i.jsxs)("div",{className:"flex justify-between text-muted-foreground",children:[eP,eT]}),t5[192]=eP,t5[193]=eT,t5[194]=eC):eC=t5[194],t5[195]!==rb?(eN=rb(av.gridSize),t5[195]=rb,t5[196]=eN):eN=t5[196],t5[197]!==eN?(ez=(0,i.jsx)("span",{children:eN}),t5[197]=eN,t5[198]=ez):ez=t5[198],t5[199]!==rx?(eI=(0,i.jsxs)("span",{className:"text-foreground",children:[rx," x ",rx]}),t5[199]=rx,t5[200]=eI):eI=t5[200],t5[201]!==ez||t5[202]!==eI?(eR=(0,i.jsxs)("div",{className:"flex justify-between text-muted-foreground",children:[ez,eI]}),t5[201]=ez,t5[202]=eI,t5[203]=eR):eR=t5[203],t5[204]!==rb?(eY=rb(av.autoSave),t5[204]=rb,t5[205]=eY):eY=t5[205],t5[206]!==eY?(eX=(0,i.jsx)("span",{children:eY}),t5[206]=eY,t5[207]=eX):eX=t5[207],t5[208]!==rb?(eA=rb(av.enabled),t5[208]=rb,t5[209]=eA):eA=t5[209],t5[210]!==eA?(eO=(0,i.jsx)("span",{className:"text-green-400",children:eA}),t5[210]=eA,t5[211]=eO):eO=t5[211],t5[212]!==eX||t5[213]!==eO?(eE=(0,i.jsxs)("div",{className:"flex justify-between text-muted-foreground",children:[eX,eO]}),t5[212]=eX,t5[213]=eO,t5[214]=eE):eE=t5[214],t5[215]!==eC||t5[216]!==eR||t5[217]!==eE?(e$=(0,i.jsxs)("div",{className:"space-y-2 text-sm",children:[eC,eR,eE]}),t5[215]=eC,t5[216]=eR,t5[217]=eE,t5[218]=e$):e$=t5[218],t5[219]!==re?(eB=()=>{re()},t5[219]=re,t5[220]=eB):eB=t5[220],t5[221]!==rb?(eV=rb(av.expandCity),t5[221]=rb,t5[222]=eV):eV=t5[222],t5[223]!==eB||t5[224]!==eV?(eW=(0,i.jsx)(f,{variant:"outline",className:"w-full",onClick:eB,children:eV}),t5[223]=eB,t5[224]=eV,t5[225]=eW):eW=t5[225],t5[226]!==rb?(eD=rb(av.expandCityDesc),t5[226]=rb,t5[227]=eD):eD=t5[227],t5[228]!==eD?(eF=(0,i.jsx)("p",{className:"text-muted-foreground text-xs mt-1 text-center",children:eD}),t5[228]=eD,t5[229]=eF):eF=t5[229],t5[230]!==eW||t5[231]!==eF?(eJ=(0,i.jsxs)("div",{children:[eW,eF]}),t5[230]=eW,t5[231]=eF,t5[232]=eJ):eJ=t5[232],t5[233]!==rb||t5[234]!==rt?(eU=()=>{rt()||alert(String(rb(av.cannotShrink)))},t5[233]=rb,t5[234]=rt,t5[235]=eU):eU=t5[235];let r3=rx<=50;t5[236]!==rb?(eH=rb(av.shrinkCity),t5[236]=rb,t5[237]=eH):eH=t5[237],t5[238]!==eU||t5[239]!==r3||t5[240]!==eH?(eG=(0,i.jsx)(f,{variant:"outline",className:"w-full",onClick:eU,disabled:r3,children:eH}),t5[238]=eU,t5[239]=r3,t5[240]=eH,t5[241]=eG):eG=t5[241],t5[242]!==rb?(eq=rb(av.shrinkCityDesc),t5[242]=rb,t5[243]=eq):eq=t5[243],t5[244]!==eq?(eQ=(0,i.jsx)("p",{className:"text-muted-foreground text-xs mt-1 text-center",children:eq}),t5[244]=eq,t5[245]=eQ):eQ=t5[245],t5[246]!==eG||t5[247]!==eQ?(eZ=(0,i.jsxs)("div",{children:[eG,eQ]}),t5[246]=eG,t5[247]=eQ,t5[248]=eZ):eZ=t5[248],t5[249]!==eZ||t5[250]!==eJ?(eK=(0,i.jsxs)("div",{className:"mt-4 space-y-3",children:[eJ,eZ]}),t5[249]=eZ,t5[250]=eJ,t5[251]=eK):eK=t5[251],t5[252]!==eK||t5[253]!==ek||t5[254]!==e$?(e0=(0,i.jsxs)("div",{children:[ek,e$,eK]}),t5[252]=eK,t5[253]=ek,t5[254]=e$,t5[255]=e0):e0=t5[255],t5[256]===Symbol.for("react.memo_cache_sentinel")?(e1=(0,i.jsx)(tO,{}),t5[256]=e1):e1=t5[256],t5[257]!==rb?(e2=rb(av.savedCities),t5[257]=rb,t5[258]=e2):e2=t5[258],t5[259]!==e2?(e5=(0,i.jsx)("div",{className:"text-[10px] text-muted-foreground uppercase tracking-wider mb-3",children:e2}),t5[259]=e2,t5[260]=e5):e5=t5[260],t5[261]!==rb?(e3=rb(av.savedCitiesDesc),t5[261]=rb,t5[262]=e3):e3=t5[262],t5[263]!==e3?(e4=(0,i.jsx)("p",{className:"text-muted-foreground text-xs mb-3",children:e3}),t5[263]=e3,t5[264]=e4):e4=t5[264],t5[265]!==rh?(e9=()=>{rh(),rP(!0),setTimeout(()=>rP(!1),2e3)},t5[265]=rh,t5[266]=e9):e9=t5[266],t5[267]!==rp||t5[268]!==rb||t5[269]!==rj?(e6=rj?` ${rb(av.citySaved)}`:`${rb(av.save)} "${rp}"`,t5[267]=rp,t5[268]=rb,t5[269]=rj,t5[270]=e6):e6=t5[270],t5[271]!==e9||t5[272]!==e6?(e8=(0,i.jsx)(f,{variant:"default",className:"w-full mb-3",onClick:e9,children:e6}),t5[271]=e9,t5[272]=e6,t5[273]=e8):e8=t5[273],t5[274]!==rT?.id||t5[275]!==rN?.id||t5[276]!==ry||t5[277]!==rf||t5[278]!==ru||t5[279]!==rb||t5[280]!==rm||t5[281]!==rI||t5[282]!==rc||t5[283]!==t4?(e7=rc.length>0?(0,i.jsx)("div",{className:"space-y-2 max-h-[200px] overflow-y-auto overscroll-y-contain",style:{WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:rc.map(e=>{var t,r;return(0,i.jsx)("div",{className:`p-3 rounded-md border transition-colors ${e.id===ry?"border-primary bg-primary/10":"border-border hover:border-muted-foreground/50"}`,children:rN?.id===e.id?(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(rd,{value:rI,onChange:e=>rR(e.target.value),placeholder:String(rb(av.newCityName)),className:"h-8 text-sm",autoFocus:!0}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)(f,{variant:"outline",size:"sm",className:"flex-1 h-7 text-xs",onClick:()=>{rz(null),rR("")},children:rb(av.cancel)}),(0,i.jsx)(f,{variant:"default",size:"sm",className:"flex-1 h-7 text-xs",onClick:()=>{rI.trim()&&rm(e.id,rI.trim()),rz(null),rR("")},children:rb(av.save)})]})]}):rT?.id===e.id?(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("p",{className:"text-xs text-muted-foreground text-center",children:rb(av.deleteThisCity)}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)(f,{variant:"outline",size:"sm",className:"flex-1 h-7 text-xs",onClick:()=>rC(null),children:rb(av.cancel)}),(0,i.jsx)(f,{variant:"destructive",size:"sm",className:"flex-1 h-7 text-xs",onClick:()=>{rf(e.id),rC(null)},children:rb(av.delete)})]})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"flex items-start justify-between mb-1",children:(0,i.jsxs)("div",{className:"font-medium text-sm truncate flex-1",children:[e.cityName,e.id===ry&&(0,i.jsx)("span",{className:"ml-2 text-[10px] text-primary",children:rb(av.current)})]})}),(0,i.jsxs)("div",{className:"flex items-center gap-3 text-xs text-muted-foreground mb-2",children:[(0,i.jsxs)("span",{children:[rb(av.pop),": ",(t=e.population)>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(1)}K`:t.toString()]}),(0,i.jsx)("span",{children:(r=e.money)>=1e6?`$${(r/1e6).toFixed(1)}M`:r>=1e3?`$${(r/1e3).toFixed(1)}K`:`$${r}`}),(0,i.jsxs)("span",{children:[e.gridSize,"\xd7",e.gridSize]})]}),(0,i.jsxs)("div",{className:"text-[10px] text-muted-foreground mb-2",children:[rb(av.saved)," ",new Date(e.savedAt).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[e.id!==ry&&(0,i.jsx)(f,{variant:"default",size:"sm",className:"flex-1 h-7 text-xs",onClick:()=>{ru(e.id),t4("none")},children:rb(av.load)}),(0,i.jsx)(f,{variant:"outline",size:"sm",className:"flex-1 h-7 text-xs",onClick:()=>{rz(e),rR(e.cityName)},children:rb(av.rename)}),(0,i.jsx)(f,{variant:"outline",size:"sm",className:"flex-1 h-7 text-xs hover:bg-destructive hover:text-destructive-foreground",onClick:()=>rC(e),children:rb(av.delete)})]})]})},e.id)})}):(0,i.jsx)("p",{className:"text-muted-foreground text-xs text-center py-3 border border-dashed rounded-md",children:rb(av.noSavedCities)}),t5[274]=rT?.id,t5[275]=rN?.id,t5[276]=ry,t5[277]=rf,t5[278]=ru,t5[279]=rb,t5[280]=rm,t5[281]=rI,t5[282]=rc,t5[283]=t4,t5[284]=e7):e7=t5[284],t5[285]!==e5||t5[286]!==e4||t5[287]!==e8||t5[288]!==e7?(te=(0,i.jsxs)("div",{children:[e5,e4,e8,e7]}),t5[285]=e5,t5[286]=e4,t5[287]=e8,t5[288]=e7,t5[289]=te):te=t5[289],t5[290]!==rb||t5[291]!==rs||t5[292]!==rV||t5[293]!==t4?(tt=rV&&(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)(f,{variant:"default",className:"w-full",onClick:()=>{rs(),rW(null),t4("none")},children:[rb(av.restore)," ",rV.cityName]}),(0,i.jsx)("p",{className:"text-muted-foreground text-xs text-center",children:rb(av.citySavedBeforeViewing)}),(0,i.jsx)(tO,{})]}),t5[290]=rb,t5[291]=rs,t5[292]=rV,t5[293]=t4,t5[294]=tt):tt=t5[294],t5[295]!==rx||t5[296]!==rb||t5[297]!==r_||t5[298]!==t6||t5[299]!==t4||t5[300]!==rS?(tr=rS?(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsx)("p",{className:"text-muted-foreground text-sm text-center",children:rb(av.confirmReset)}),(0,i.jsx)(rd,{value:r_,onChange:e=>rM(e.target.value),placeholder:String(rb(av.newCityName))}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)(f,{variant:"outline",className:"flex-1",onClick:()=>rk(!1),children:rb(av.cancel)}),(0,i.jsx)(f,{variant:"destructive",className:"flex-1",onClick:()=>{t6(r_||"New City",rx),t4("none")},children:rb(av.reset)})]})]}):(0,i.jsx)(f,{variant:"destructive",className:"w-full",onClick:()=>rk(!0),children:rb(av.startNewGame)}),t5[295]=rx,t5[296]=rb,t5[297]=r_,t5[298]=t6,t5[299]=t4,t5[300]=rS,t5[301]=tr):tr=t5[301],t5[302]===Symbol.for("react.memo_cache_sentinel")?(ta=(0,i.jsx)(tO,{}),t5[302]=ta):ta=t5[302],t5[303]!==rb?(ti=rb(av.exportGame),t5[303]=rb,t5[304]=ti):ti=t5[304],t5[305]!==ti?(tn=(0,i.jsx)("div",{className:"text-[10px] text-muted-foreground uppercase tracking-wider mb-3",children:ti}),t5[305]=ti,t5[306]=tn):tn=t5[306],t5[307]!==rb?(tl=rb(av.exportGameDesc),t5[307]=rb,t5[308]=tl):tl=t5[308],t5[309]!==tl?(to=(0,i.jsx)("p",{className:"text-muted-foreground text-xs mb-2",children:tl}),t5[309]=tl,t5[310]=to):to=t5[310],t5[311]!==rA||t5[312]!==rb?(ts=rA?` ${rb(av.copied)}`:rb(av.copyGameState),t5[311]=rA,t5[312]=rb,t5[313]=ts):ts=t5[313],t5[314]!==rQ||t5[315]!==ts?(tc=(0,i.jsx)(f,{variant:"outline",className:"w-full",onClick:rQ,children:ts}),t5[314]=rQ,t5[315]=ts,t5[316]=tc):tc=t5[316],t5[317]!==tn||t5[318]!==to||t5[319]!==tc?(td=(0,i.jsxs)("div",{children:[tn,to,tc]}),t5[317]=tn,t5[318]=to,t5[319]=tc,t5[320]=td):td=t5[320],t5[321]!==rb?(th=rb(av.importGame),t5[321]=rb,t5[322]=th):th=t5[322],t5[323]!==th?(tu=(0,i.jsx)("div",{className:"text-[10px] text-muted-foreground uppercase tracking-wider mb-3",children:th}),t5[323]=th,t5[324]=tu):tu=t5[324],t5[325]!==rb?(tf=rb(av.importGameDesc),t5[325]=rb,t5[326]=tf):tf=t5[326],t5[327]!==tf?(tm=(0,i.jsx)("p",{className:"text-muted-foreground text-xs mb-2",children:tf}),t5[327]=tf,t5[328]=tm):tm=t5[328],t5[329]!==rb?(tg=rb(av.pasteGameState),t5[329]=rb,t5[330]=tg):tg=t5[330];let r9=String(tg);t5[331]===Symbol.for("react.memo_cache_sentinel")?(tp=e=>{rX(e.target.value),r$(!1),rL(!1)},t5[331]=tp):tp=t5[331],t5[332]!==rY||t5[333]!==r9?(tx=(0,i.jsx)("textarea",{className:"w-full h-20 bg-background border border-border rounded-md p-2 text-xs font-mono resize-none focus:outline-none focus:ring-1 focus:ring-ring",placeholder:r9,value:rY,onChange:tp}),t5[332]=rY,t5[333]=r9,t5[334]=tx):tx=t5[334],t5[335]!==rE||t5[336]!==rb?(ty=rE&&(0,i.jsx)("p",{className:"text-red-400 text-xs mt-1",children:rb(av.invalidGameState)}),t5[335]=rE,t5[336]=rb,t5[337]=ty):ty=t5[337],t5[338]!==rB||t5[339]!==rb?(tb=rB&&(0,i.jsx)("p",{className:"text-green-400 text-xs mt-1",children:rb(av.gameLoadedSuccess)}),t5[338]=rB,t5[339]=rb,t5[340]=tb):tb=t5[340],t5[341]!==rY?(tw=rY.trim(),t5[341]=rY,t5[342]=tw):tw=t5[342];let r6=!tw;return t5[343]!==rb?(tv=rb(av.loadGameState),t5[343]=rb,t5[344]=tv):tv=t5[344],t5[345]!==rZ||t5[346]!==r6||t5[347]!==tv?(t_=(0,i.jsx)(f,{variant:"outline",className:"w-full mt-2",onClick:rZ,disabled:r6,children:tv}),t5[345]=rZ,t5[346]=r6,t5[347]=tv,t5[348]=t_):t_=t5[348],t5[349]!==tu||t5[350]!==tm||t5[351]!==tx||t5[352]!==ty||t5[353]!==tb||t5[354]!==t_?(tM=(0,i.jsxs)("div",{children:[tu,tm,tx,ty,tb,t_]}),t5[349]=tu,t5[350]=tm,t5[351]=tx,t5[352]=ty,t5[353]=tb,t5[354]=t_,t5[355]=tM):tM=t5[355],t5[356]!==rb?(tS=rb(av.developerTools),t5[356]=rb,t5[357]=tS):tS=t5[357],t5[358]!==tS?(tk=(0,i.jsx)("div",{className:"text-[10px] text-muted-foreground uppercase tracking-wider mb-3",children:tS}),t5[358]=tS,t5[359]=tk):tk=t5[359],t5[360]===Symbol.for("react.memo_cache_sentinel")?(tj=()=>rH(!0),t5[360]=tj):tj=t5[360],t5[361]!==rb?(tP=rb(av.openSpriteTestView),t5[361]=rb,t5[362]=tP):tP=t5[362],t5[363]!==tP?(tT=(0,i.jsx)(f,{variant:"outline",className:"w-full",onClick:tj,children:tP}),t5[363]=tP,t5[364]=tT):tT=t5[364],t5[365]!==t8||t5[366]!==t4?(tC=(0,i.jsx)(f,{variant:"outline",className:"w-full mt-2",onClick:()=>a_("example_state.json",t8,t4),children:"Load Example State"}),t5[365]=t8,t5[366]=t4,t5[367]=tC):tC=t5[367],t5[368]!==t8||t5[369]!==t4?(tN=(0,i.jsx)(f,{variant:"outline",className:"w-full mt-2",onClick:()=>a_("example_state_2.json",t8,t4),children:"Load Example State 2"}),t5[368]=t8,t5[369]=t4,t5[370]=tN):tN=t5[370],t5[371]!==t8||t5[372]!==t4?(tz=(0,i.jsx)(f,{variant:"outline",className:"w-full mt-2",onClick:()=>a_("example_state_3.json",t8,t4),children:"Load Example State 3"}),t5[371]=t8,t5[372]=t4,t5[373]=tz):tz=t5[373],t5[374]!==t8||t5[375]!==t4?(tI=(0,i.jsx)(f,{variant:"outline",className:"w-full mt-2",onClick:()=>a_("example_state_4.json",t8,t4),children:"Load Example State 4"}),t5[374]=t8,t5[375]=t4,t5[376]=tI):tI=t5[376],t5[377]!==t8||t5[378]!==t4?(tR=(0,i.jsx)(f,{variant:"outline",className:"w-full mt-2",onClick:()=>a_("example_state_5.json",t8,t4),children:"Load Example State 5"}),t5[377]=t8,t5[378]=t4,t5[379]=tR):tR=t5[379],t5[380]!==t8||t5[381]!==t4?(tY=(0,i.jsx)(f,{variant:"outline",className:"w-full mt-2",onClick:()=>a_("example_state_6.json",t8,t4),children:"Load Example State 6"}),t5[380]=t8,t5[381]=t4,t5[382]=tY):tY=t5[382],t5[383]!==t8||t5[384]!==t4?(tX=(0,i.jsx)(f,{variant:"outline",className:"w-full mt-2",onClick:()=>a_("example_state_7.json",t8,t4),children:"Load Example State 7"}),t5[383]=t8,t5[384]=t4,t5[385]=tX):tX=t5[385],t5[386]!==t8||t5[387]!==t4?(tA=(0,i.jsx)(f,{variant:"outline",className:"w-full mt-2",onClick:()=>a_("example_state_8.json",t8,t4),children:"Load Example State 8"}),t5[386]=t8,t5[387]=t4,t5[388]=tA):tA=t5[388],t5[389]!==t8||t5[390]!==t4?(tE=(0,i.jsx)(f,{variant:"outline",className:"w-full mt-2",onClick:()=>a_("example_state_9.json",t8,t4),children:"Load Example State 9"}),t5[389]=t8,t5[390]=t4,t5[391]=tE):tE=t5[391],t5[392]!==t8||t5[393]!==t4?(t$=(0,i.jsx)(f,{variant:"outline",className:"w-full mt-2",onClick:()=>a_("example_state_10.json",t8,t4),children:"Load Example State 10"}),t5[392]=t8,t5[393]=t4,t5[394]=t$):t$=t5[394],t5[395]!==t8||t5[396]!==t4?(tL=(0,i.jsx)(f,{variant:"outline",className:"w-full mt-2",onClick:()=>a_("example_state_11.json",t8,t4),children:"Load Example State 11"}),t5[395]=t8,t5[396]=t4,t5[397]=tL):tL=t5[397],t5[398]!==rb?(tV=rb(av.dayNightMode),t5[398]=rb,t5[399]=tV):tV=t5[399],t5[400]!==tV?(tF=(0,i.jsx)(r4,{children:tV}),t5[400]=tV,t5[401]=tF):tF=t5[401],t5[402]!==rb?(tU=rb(av.dayNightModeDesc),t5[402]=rb,t5[403]=tU):tU=t5[403],t5[404]!==tU?(tH=(0,i.jsx)("p",{className:"text-muted-foreground text-xs mb-2",children:tU}),t5[404]=tU,t5[405]=tH):tH=t5[405],t5[406]===Symbol.for("react.memo_cache_sentinel")?(tG=["auto","day","night"],t5[406]=tG):tG=t5[406],t5[407]!==rn||t5[408]!==rb||t5[409]!==rl?(tq=(0,i.jsx)("div",{className:"flex rounded-md border border-border overflow-hidden",children:tG.map(e=>(0,i.jsxs)("button",{onClick:()=>rl(e),className:`flex-1 px-3 py-2 text-sm font-medium transition-colors ${rn===e?"bg-primary text-primary-foreground":"bg-background hover:bg-muted text-muted-foreground hover:text-foreground"}`,children:["auto"===e&&rb(av.auto),"day"===e&&rb(av.day),"night"===e&&rb(av.night)]},e))}),t5[407]=rn,t5[408]=rb,t5[409]=rl,t5[410]=tq):tq=t5[410],t5[411]!==tF||t5[412]!==tH||t5[413]!==tq?(tQ=(0,i.jsxs)("div",{className:"mt-4 pt-4 border-t border-border",children:[tF,tH,tq]}),t5[411]=tF,t5[412]=tH,t5[413]=tq,t5[414]=tQ):tQ=t5[414],t5[415]!==tk||t5[416]!==tT||t5[417]!==tC||t5[418]!==tN||t5[419]!==tz||t5[420]!==tI||t5[421]!==tR||t5[422]!==tY||t5[423]!==tX||t5[424]!==tA||t5[425]!==tE||t5[426]!==t$||t5[427]!==tL||t5[428]!==tQ?(tZ=(0,i.jsxs)("div",{children:[tk,tT,tC,tN,tz,tI,tR,tY,tX,tA,tE,t$,tL,tQ]}),t5[415]=tk,t5[416]=tT,t5[417]=tC,t5[418]=tN,t5[419]=tz,t5[420]=tI,t5[421]=tR,t5[422]=tY,t5[423]=tX,t5[424]=tA,t5[425]=tE,t5[426]=t$,t5[427]=tL,t5[428]=tQ,t5[429]=tZ):tZ=t5[429],t5[430]!==e0||t5[431]!==te||t5[432]!==tt||t5[433]!==tr||t5[434]!==td||t5[435]!==tM||t5[436]!==tZ||t5[437]!==eM?(tK=(0,i.jsxs)("div",{className:"space-y-6",children:[eM,e0,e1,te,tt,tr,ta,td,tM,tZ]}),t5[430]=e0,t5[431]=te,t5[432]=tt,t5[433]=tr,t5[434]=td,t5[435]=tM,t5[436]=tZ,t5[437]=eM,t5[438]=tK):tK=t5[438],t5[439]!==p||t5[440]!==tK?(t0=(0,i.jsxs)(tW,{className:"max-w-[400px] max-h-[85vh] overflow-y-auto",children:[p,tK]}),t5[439]=p,t5[440]=tK,t5[441]=t0):t0=t5[441],t5[442]!==rU?(t1=rU&&(0,i.jsx)(ah,{onClose:()=>{rH(!1)}}),t5[442]=rU,t5[443]=t1):t1=t5[443],t5[444]!==m||t5[445]!==t0||t5[446]!==t1?(t2=(0,i.jsxs)(tB,{open:!0,onOpenChange:m,children:[t0,t1]}),t5[444]=m,t5[445]=t0,t5[446]=t1,t5[447]=t2):t2=t5[447],t2}let aS=(0,s.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function ak(e){let t,r,a,l,o,s=(0,n.c)(10);return s[0]!==e?({className:t,variant:a,...r}=e,s[0]=e,s[1]=t,s[2]=r,s[3]=a):(t=s[1],r=s[2],a=s[3]),s[4]!==t||s[5]!==a?(l=h(aS({variant:a}),t),s[4]=t,s[5]=a,s[6]=l):l=s[6],s[7]!==r||s[8]!==l?(o=(0,i.jsx)("div",{className:l,...r}),s[7]=r,s[8]=l,s[9]=o):o=s[9],o}let aj={cityAdvisors:(0,k.msg)("City Advisors"),overallCityRating:(0,k.msg)("Overall City Rating"),ratingDescription:(0,k.msg)("Based on happiness, health, education, safety & environment"),noUrgentIssues:(0,k.msg)("No urgent issues to report!"),cityRunningSmoothly:(0,k.msg)("Your city is running smoothly.")},aP={power:(0,i.jsx)(tu,{size:18}),water:(0,i.jsx)(tf,{size:18}),cash:(0,i.jsx)(tg,{size:18}),shield:(0,i.jsx)(tb,{size:18}),hospital:(0,i.jsx)(tx,{size:18}),education:(0,i.jsx)(ty,{size:18}),environment:(0,i.jsx)(tw,{size:18}),planning:(0,i.jsx)(tM,{size:18}),jobs:(0,i.jsx)(function(e){let t,r,a,l,o=(0,n.c)(6),{size:s,className:c}=e,d=void 0===s?18:s;return o[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,i.jsx)("path",{...tl,d:"M7 7V5a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2"}),r=(0,i.jsx)("path",{...tl,d:"M4 10h16v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2z"}),a=(0,i.jsx)("path",{...tl,d:"M10 14h4"}),o[0]=t,o[1]=r,o[2]=a):(t=o[0],r=o[1],a=o[2]),o[3]!==c||o[4]!==d?(l=(0,i.jsxs)("svg",{width:d,height:d,viewBox:"0 0 24 24",className:c,children:[t,r,a]}),o[3]=c,o[4]=d,o[5]=l):l=o[5],l},{size:18})};function aT(){let e,t,r,a,l,o,s,c,d,h,u,f,m,g,p,x=(0,n.c)(37),{state:y,setActivePanel:b}=eL(),{advisorMessages:w,stats:v}=y,_=(0,k.useMessages)(),M=(v.happiness+v.health+v.education+v.safety+v.environment)/5,S=M>=90?"A+":M>=80?"A":M>=70?"B":M>=60?"C":M>=50?"D":"F";x[0]!==b?(e=()=>b("none"),x[0]=b,x[1]=e):e=x[1],x[2]!==_?(t=_(aj.cityAdvisors),x[2]=_,x[3]=t):t=x[3],x[4]!==t?(r=(0,i.jsx)(tD,{children:(0,i.jsx)(tJ,{children:t})}),x[4]=t,x[5]=r):r=x[5];let j=`w-16 h-16 flex items-center justify-center text-3xl font-black rounded-md ${M>=70?"text-green-400":M>=50?"text-amber-400":"text-red-400"} bg-primary/20`;return x[6]!==S||x[7]!==j?(a=(0,i.jsx)("div",{className:j,children:S}),x[6]=S,x[7]=j,x[8]=a):a=x[8],x[9]!==_?(l=_(aj.overallCityRating),x[9]=_,x[10]=l):l=x[10],x[11]!==l?(o=(0,i.jsx)("div",{className:"text-foreground font-semibold",children:l}),x[11]=l,x[12]=o):o=x[12],x[13]!==_?(s=_(aj.ratingDescription),x[13]=_,x[14]=s):s=x[14],x[15]!==s?(c=(0,i.jsx)("div",{className:"text-muted-foreground text-sm",children:s}),x[15]=s,x[16]=c):c=x[16],x[17]!==o||x[18]!==c?(d=(0,i.jsxs)("div",{children:[o,c]}),x[17]=o,x[18]=c,x[19]=d):d=x[19],x[20]!==a||x[21]!==d?(h=(0,i.jsxs)(tr,{className:"flex items-center gap-4 p-4 bg-primary/10 border-primary/30",children:[a,d]}),x[20]=a,x[21]=d,x[22]=h):h=x[22],x[23]!==w||x[24]!==_?(u=0===w.length?(0,i.jsxs)(tr,{className:"text-center py-8 text-muted-foreground bg-primary/10 border-primary/30",children:[(0,i.jsx)(tM,{size:32,className:"mx-auto mb-3 opacity-50"}),(0,i.jsx)("div",{className:"text-sm",children:_(aj.noUrgentIssues)}),(0,i.jsx)("div",{className:"text-xs mt-1",children:_(aj.cityRunningSmoothly)})]}):w.map(aC),x[23]=w,x[24]=_,x[25]=u):u=x[25],x[26]!==u?(f=(0,i.jsx)(ru,{className:"max-h-[350px]",children:(0,i.jsx)("div",{className:"space-y-3",children:u})}),x[26]=u,x[27]=f):f=x[27],x[28]!==h||x[29]!==f?(m=(0,i.jsxs)("div",{className:"space-y-4",children:[h,f]}),x[28]=h,x[29]=f,x[30]=m):m=x[30],x[31]!==m||x[32]!==r?(g=(0,i.jsxs)(tW,{className:"max-w-[500px] max-h-[600px]",children:[r,m]}),x[31]=m,x[32]=r,x[33]=g):g=x[33],x[34]!==e||x[35]!==g?(p=(0,i.jsx)(tB,{open:!0,onOpenChange:e,children:g}),x[34]=e,x[35]=g,x[36]=p):p=x[36],p}function aC(e,t){return(0,i.jsxs)(tr,{className:`p-3 bg-primary/10 border-primary/30 ${"critical"===e.priority?"border-l-2 border-l-red-500":"high"===e.priority?"border-l-2 border-l-amber-500":"medium"===e.priority?"border-l-2 border-l-yellow-500":""}`,children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,i.jsx)("span",{className:"text-lg text-muted-foreground",children:aP[e.icon]||(0,i.jsx)(tk,{size:18})}),(0,i.jsx)("span",{className:"text-foreground font-medium text-sm",children:e.name}),(0,i.jsx)(ak,{variant:"critical"===e.priority||"high"===e.priority?"destructive":"secondary",className:"ml-auto text-[10px]",children:e.priority})]}),e.messages.map(aN)]},t)}function aN(e,t){return(0,i.jsx)("div",{className:"text-muted-foreground text-sm leading-relaxed",children:e},t)}function az(e){let t,r,a,l,o,s,c,d,h,u,m,g,p,x,y,b,w,v,_,M,S,k,P,T,C,N,z,I,R,Y,X,A,O,E,$,B,L,V,W,D,F,J,U,H,G,Z,K,ee=(0,n.c)(123),{tile:et,services:er,onClose:ea,isMobile:ei}=e,en=void 0!==ei&&ei,{x:el,y:eo}=et,{state:es,upgradeServiceBuilding:ec}=eL(),ed=Q.has(et.building.type);e:{let e;if(!ed){t=null;break e}let r=et.building.type,a=j[r]?.cost??0,i=et.building.level;if(i>=5){t=null;break e}let n=a*Math.pow(2,i),l=es.stats.money>=n,o=void 0!==et.building.constructionProgress&&et.building.constructionProgress<100,s=et.building.abandoned,c=q[r],d=c?.range??0,h=Math.floor(d*(1+(i-1)*.2)),u=Math.floor(d*(1+.2*i));ee[0]!==d||ee[1]!==l||ee[2]!==h||ee[3]!==i||ee[4]!==s||ee[5]!==o||ee[6]!==u||ee[7]!==n?(e={cost:n,canAfford:l,isUnderConstruction:o,isAbandoned:s,currentLevel:i,maxLevel:5,baseRange:d,currentEffectiveRange:h,nextEffectiveRange:u},ee[0]=d,ee[1]=l,ee[2]=h,ee[3]=i,ee[4]=s,ee[5]=o,ee[6]=u,ee[7]=n,ee[8]=e):e=ee[8],t=e}let eh=t;ee[9]!==eh||ee[10]!==ec||ee[11]!==el||ee[12]!==eo?(r=e=>{e.stopPropagation(),e.preventDefault(),eh&&eh.canAfford&&ec(el,eo)},ee[9]=eh,ee[10]=ec,ee[11]=el,ee[12]=eo,ee[13]=r):r=ee[13];let eu=r,ef=`${en?"fixed left-0 right-0 w-full rounded-none border-x-0 border-t border-b z-30":"absolute top-4 right-4 w-72 z-50"}`;if(ee[14]!==en?(a=en?{top:"calc(72px + env(safe-area-inset-top, 0px))"}:void 0,ee[14]=en,ee[15]=a):a=ee[15],ee[16]!==el||ee[17]!==eo?(l=(0,i.jsxs)(ti,{className:"text-sm font-sans",children:["Tile (",el,", ",eo,")"]}),ee[16]=el,ee[17]=eo,ee[18]=l):l=ee[18],ee[19]===Symbol.for("react.memo_cache_sentinel")?(o=(0,i.jsx)(tc,{size:14}),ee[19]=o):o=ee[19],ee[20]!==ea?(s=(0,i.jsx)(f,{variant:"ghost",size:"icon-sm",onClick:ea,children:o}),ee[20]=ea,ee[21]=s):s=ee[21],ee[22]!==l||ee[23]!==s?(c=(0,i.jsxs)(ta,{className:"pb-2 flex flex-row items-center justify-between",children:[l,s]}),ee[22]=l,ee[23]=s,ee[24]=c):c=ee[24],ee[25]===Symbol.for("react.memo_cache_sentinel")?(d=(0,i.jsx)("span",{className:"text-muted-foreground",children:"Building"}),ee[25]=d):d=ee[25],ee[26]!==et.building.type){let e;ee[28]===Symbol.for("react.memo_cache_sentinel")?(e=/_/g,ee[28]=e):e=ee[28],h=et.building.type.replace(e," "),ee[26]=et.building.type,ee[27]=h}else h=ee[27];ee[29]!==h?(u=(0,i.jsxs)("div",{className:"flex justify-between",children:[d,(0,i.jsx)("span",{className:"capitalize",children:h})]}),ee[29]=h,ee[30]=u):u=ee[30],ee[31]===Symbol.for("react.memo_cache_sentinel")?(m=(0,i.jsx)("span",{className:"text-muted-foreground",children:"Zone"}),ee[31]=m):m=ee[31];let em="residential"===et.zone?"default":"commercial"===et.zone?"secondary":"industrial"===et.zone?"outline":"secondary",eg="residential"===et.zone?"bg-green-500/20 text-green-400":"commercial"===et.zone?"bg-blue-500/20 text-blue-400":"industrial"===et.zone?"bg-amber-500/20 text-amber-400":"",ep="none"===et.zone?"Unzoned":et.zone;ee[32]!==em||ee[33]!==eg||ee[34]!==ep?(g=(0,i.jsxs)("div",{className:"flex justify-between",children:[m,(0,i.jsx)(ak,{variant:em,className:eg,children:ep})]}),ee[32]=em,ee[33]=eg,ee[34]=ep,ee[35]=g):g=ee[35],ee[36]===Symbol.for("react.memo_cache_sentinel")?(p=(0,i.jsx)("span",{className:"text-muted-foreground",children:"Level"}),ee[36]=p):p=ee[36],ee[37]!==et.building.level?(x=(0,i.jsxs)("div",{className:"flex justify-between",children:[p,(0,i.jsxs)("span",{children:[et.building.level,"/5"]})]}),ee[37]=et.building.level,ee[38]=x):x=ee[38],ee[39]===Symbol.for("react.memo_cache_sentinel")?(y=(0,i.jsx)("span",{className:"text-muted-foreground",children:"Population"}),ee[39]=y):y=ee[39],ee[40]!==et.building.population?(b=(0,i.jsxs)("div",{className:"flex justify-between",children:[y,(0,i.jsx)("span",{children:et.building.population})]}),ee[40]=et.building.population,ee[41]=b):b=ee[41],ee[42]===Symbol.for("react.memo_cache_sentinel")?(w=(0,i.jsx)("span",{className:"text-muted-foreground",children:"Jobs"}),ee[42]=w):w=ee[42],ee[43]!==et.building.jobs?(v=(0,i.jsxs)("div",{className:"flex justify-between",children:[w,(0,i.jsx)("span",{children:et.building.jobs})]}),ee[43]=et.building.jobs,ee[44]=v):v=ee[44],ee[45]===Symbol.for("react.memo_cache_sentinel")?(_=(0,i.jsx)(tO,{}),ee[45]=_):_=ee[45],ee[46]===Symbol.for("react.memo_cache_sentinel")?(M=(0,i.jsx)("span",{className:"text-muted-foreground",children:"Power"}),ee[46]=M):M=ee[46];let ex=et.building.powered?"default":"destructive",ey=et.building.powered?"Connected":"No Power";ee[47]!==ex||ee[48]!==ey?(S=(0,i.jsxs)("div",{className:"flex justify-between",children:[M,(0,i.jsx)(ak,{variant:ex,children:ey})]}),ee[47]=ex,ee[48]=ey,ee[49]=S):S=ee[49],ee[50]===Symbol.for("react.memo_cache_sentinel")?(k=(0,i.jsx)("span",{className:"text-muted-foreground",children:"Water"}),ee[50]=k):k=ee[50];let eb=et.building.watered?"default":"destructive",ew=et.building.watered?"bg-cyan-500/20 text-cyan-400":"",ev=et.building.watered?"Connected":"No Water";ee[51]!==eb||ee[52]!==ew||ee[53]!==ev?(P=(0,i.jsxs)("div",{className:"flex justify-between",children:[k,(0,i.jsx)(ak,{variant:eb,className:ew,children:ev})]}),ee[51]=eb,ee[52]=ew,ee[53]=ev,ee[54]=P):P=ee[54],ee[55]===Symbol.for("react.memo_cache_sentinel")?(T=(0,i.jsx)("span",{className:"text-muted-foreground",children:"Land Value"}),ee[55]=T):T=ee[55],ee[56]!==et.landValue?(C=(0,i.jsxs)("div",{className:"flex justify-between",children:[T,(0,i.jsxs)("span",{children:["$",et.landValue]})]}),ee[56]=et.landValue,ee[57]=C):C=ee[57],ee[58]===Symbol.for("react.memo_cache_sentinel")?(N=(0,i.jsx)("span",{className:"text-muted-foreground",children:"Pollution"}),ee[58]=N):N=ee[58];let e_=et.pollution>50?"text-red-400":et.pollution>25?"text-amber-400":"text-green-400";return ee[59]!==et.pollution?(z=Math.round(et.pollution),ee[59]=et.pollution,ee[60]=z):z=ee[60],ee[61]!==e_||ee[62]!==z?(I=(0,i.jsxs)("div",{className:"flex justify-between",children:[N,(0,i.jsxs)("span",{className:e_,children:[z,"%"]})]}),ee[61]=e_,ee[62]=z,ee[63]=I):I=ee[63],ee[64]!==et.building.fireProgress||ee[65]!==et.building.onFire?(R=et.building.onFire&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(tO,{}),(0,i.jsxs)("div",{className:"flex justify-between text-red-400",children:[(0,i.jsx)("span",{children:"ON FIRE!"}),(0,i.jsxs)("span",{children:[Math.round(et.building.fireProgress),"% damage"]})]})]}),ee[64]=et.building.fireProgress,ee[65]=et.building.onFire,ee[66]=R):R=ee[66],ee[67]===Symbol.for("react.memo_cache_sentinel")?(Y=(0,i.jsx)(tO,{}),X=(0,i.jsx)("div",{className:"text-[10px] text-muted-foreground uppercase tracking-wider mb-2",children:"Service Coverage"}),ee[67]=Y,ee[68]=X):(Y=ee[67],X=ee[68]),ee[69]===Symbol.for("react.memo_cache_sentinel")?(A=(0,i.jsx)("span",{className:"text-muted-foreground",children:"Police"}),ee[69]=A):A=ee[69],ee[70]!==er.police||ee[71]!==el||ee[72]!==eo?(O=Math.round(er.police[eo][el]),ee[70]=er.police,ee[71]=el,ee[72]=eo,ee[73]=O):O=ee[73],ee[74]!==O?(E=(0,i.jsxs)("div",{className:"flex justify-between",children:[A,(0,i.jsxs)("span",{children:[O,"%"]})]}),ee[74]=O,ee[75]=E):E=ee[75],ee[76]===Symbol.for("react.memo_cache_sentinel")?($=(0,i.jsx)("span",{className:"text-muted-foreground",children:"Fire"}),ee[76]=$):$=ee[76],ee[77]!==er.fire||ee[78]!==el||ee[79]!==eo?(B=Math.round(er.fire[eo][el]),ee[77]=er.fire,ee[78]=el,ee[79]=eo,ee[80]=B):B=ee[80],ee[81]!==B?(L=(0,i.jsxs)("div",{className:"flex justify-between",children:[$,(0,i.jsxs)("span",{children:[B,"%"]})]}),ee[81]=B,ee[82]=L):L=ee[82],ee[83]===Symbol.for("react.memo_cache_sentinel")?(V=(0,i.jsx)("span",{className:"text-muted-foreground",children:"Health"}),ee[83]=V):V=ee[83],ee[84]!==er.health||ee[85]!==el||ee[86]!==eo?(W=Math.round(er.health[eo][el]),ee[84]=er.health,ee[85]=el,ee[86]=eo,ee[87]=W):W=ee[87],ee[88]!==W?(D=(0,i.jsxs)("div",{className:"flex justify-between",children:[V,(0,i.jsxs)("span",{children:[W,"%"]})]}),ee[88]=W,ee[89]=D):D=ee[89],ee[90]===Symbol.for("react.memo_cache_sentinel")?(F=(0,i.jsx)("span",{className:"text-muted-foreground",children:"Education"}),ee[90]=F):F=ee[90],ee[91]!==er.education||ee[92]!==el||ee[93]!==eo?(J=Math.round(er.education[eo][el]),ee[91]=er.education,ee[92]=el,ee[93]=eo,ee[94]=J):J=ee[94],ee[95]!==J?(U=(0,i.jsxs)("div",{className:"flex justify-between",children:[F,(0,i.jsxs)("span",{children:[J,"%"]})]}),ee[95]=J,ee[96]=U):U=ee[96],ee[97]!==E||ee[98]!==L||ee[99]!==D||ee[100]!==U?(H=(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[E,L,D,U]}),ee[97]=E,ee[98]=L,ee[99]=D,ee[100]=U,ee[101]=H):H=ee[101],ee[102]!==eu||ee[103]!==eh?(G=eh&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(tO,{}),(0,i.jsx)("div",{className:"text-[10px] text-muted-foreground uppercase tracking-wider mb-2",children:"Upgrade"}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,i.jsx)("span",{className:"text-muted-foreground",children:"Coverage Range"}),(0,i.jsxs)("span",{className:"font-mono",children:[eh.currentEffectiveRange,"  ",eh.nextEffectiveRange," tiles"]})]}),(0,i.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,i.jsx)("span",{className:"text-muted-foreground",children:"Upgrade Cost"}),(0,i.jsxs)("span",{className:`font-mono ${eh.canAfford?"text-foreground":"text-red-400"}`,children:["$",eh.cost.toLocaleString()]})]}),(0,i.jsxs)(f,{onClick:eu,onMouseDown:aI,disabled:!eh.canAfford||eh.isUnderConstruction||eh.isAbandoned,className:"w-full",size:"sm",children:["Upgrade to Level ",eh.currentLevel+1]}),!eh.canAfford&&(0,i.jsx)("p",{className:"text-xs text-muted-foreground text-center",children:"Insufficient funds"}),eh.isUnderConstruction&&(0,i.jsx)("p",{className:"text-xs text-muted-foreground text-center",children:"Building under construction"}),eh.isAbandoned&&(0,i.jsx)("p",{className:"text-xs text-muted-foreground text-center",children:"Building is abandoned"})]})]}),ee[102]=eu,ee[103]=eh,ee[104]=G):G=ee[104],ee[105]!==u||ee[106]!==g||ee[107]!==x||ee[108]!==b||ee[109]!==v||ee[110]!==S||ee[111]!==P||ee[112]!==C||ee[113]!==I||ee[114]!==R||ee[115]!==H||ee[116]!==G?(Z=(0,i.jsxs)(tn,{className:"space-y-3 text-sm",children:[u,g,x,b,v,_,S,P,C,I,R,Y,X,H,G]}),ee[105]=u,ee[106]=g,ee[107]=x,ee[108]=b,ee[109]=v,ee[110]=S,ee[111]=P,ee[112]=C,ee[113]=I,ee[114]=R,ee[115]=H,ee[116]=G,ee[117]=Z):Z=ee[117],ee[118]!==ef||ee[119]!==a||ee[120]!==Z||ee[121]!==c?(K=(0,i.jsxs)(tr,{className:ef,style:a,onClick:aR,children:[c,Z]}),ee[118]=ef,ee[119]=a,ee[120]=Z,ee[121]=c,ee[122]=K):K=ee[122],K}function aI(e){return e.stopPropagation()}function aR(e){e.stopPropagation()}let aY=new Set(["police_station","fire_station","hospital","school","university"]),aX=new Set(["park","park_large","tennis","basketball_courts","playground_small","playground_large","baseball_field_small","soccer_field_small","football_field","baseball_stadium","community_center","swimming_pool","skate_park","mini_golf_course","bleachers_field","go_kart_track","amphitheater","greenhouse_garden","animal_pens_farm","cabin_house","campground","marina_docks_small","pier_large","roller_coaster_small","community_garden","pond_park","park_gate","mountain_lodge","mountain_trailhead","office_building_small"]),aA=(0,k.msg)("Minimap"),aO=l.memo(function(e){let t,r,a,o,s,c,d,h,u,f,m,g,p,x=(0,n.c)(35),{onNavigate:y,viewport:b,compact:w}=e,v=void 0!==w&&w,{state:_}=eL(),{grid:M,gridSize:S,tick:j}=_,P=(0,l.useRef)(null),T=(0,l.useRef)(null),C=(0,l.useRef)(-1),N=(0,l.useRef)(null),z=(0,k.useMessages)(),I=v?100:140;x[0]!==M||x[1]!==S||x[2]!==I||x[3]!==j||x[4]!==b?(t=()=>{let e=P.current;if(!e)return;let t=e.getContext("2d");if(!t)return;let r=I/S,a=N.current!==M;if(N.current=M,-1===C.current||j-C.current>=10||a){C.current=j,t.fillStyle="#0b1723",t.fillRect(0,0,I,I);for(let e=0;e<S;e++)for(let a=0;a<S;a++){let i=M[e][a],n=i.building.type,l="#2d5a3d";"water"===n?l="#0ea5e9":"road"===n?l="#6b7280":"tree"===n?l="#166534":i.building.onFire?l="#ef4444":"residential"===i.zone&&"grass"!==n?l="#22c55e":"residential"===i.zone?l="#14532d":"commercial"===i.zone&&"grass"!==n?l="#38bdf8":"commercial"===i.zone?l="#1d4ed8":"industrial"===i.zone&&"grass"!==n?l="#f59e0b":"industrial"===i.zone?l="#b45309":aY.has(n)?l="#c084fc":"power_plant"===n?l="#f97316":"water_tower"===n?l="#06b6d4":aX.has(n)&&(l="#84cc16"),t.fillStyle=l,t.fillRect(a*r,e*r,Math.ceil(r),Math.ceil(r))}T.current=t.getImageData(0,0,I,I)}else T.current&&t.putImageData(T.current,0,0);if(b){let{offset:e,zoom:a,canvasSize:i}=b,n=(t,r)=>{let i=(t-e.x)/a,n=(r-e.y)/a;return{gridX:(i/32+n/19.2)/2,gridY:(n/19.2-i/32)/2}},l=n(0,0),o=n(i.width,0),s=n(0,i.height),c=n(i.width,i.height);t.strokeStyle="rgba(255, 255, 255, 0.85)",t.lineWidth=2,t.beginPath(),t.moveTo(l.gridX*r,l.gridY*r),t.lineTo(o.gridX*r,o.gridY*r),t.lineTo(c.gridX*r,c.gridY*r),t.lineTo(s.gridX*r,s.gridY*r),t.closePath(),t.stroke()}},r=[M,S,b,j,aY,aX,I],x[0]=M,x[1]=S,x[2]=I,x[3]=j,x[4]=b,x[5]=t,x[6]=r):(t=x[5],r=x[6]),(0,l.useEffect)(t,r);let[R,Y]=(0,l.useState)(!1);x[7]!==S||x[8]!==I||x[9]!==y?(a=e=>{if(!y)return;let t=P.current;if(!t)return;let r=t.getBoundingClientRect(),a=e.clientX-r.left,i=e.clientY-r.top,n=I/S;y(Math.max(0,Math.min(S-1,Math.floor(a/n))),Math.max(0,Math.min(S-1,Math.floor(i/n))))},x[7]=S,x[8]=I,x[9]=y,x[10]=a):a=x[10];let X=a;x[11]!==X?(o=e=>{Y(!0),X(e)},x[11]=X,x[12]=o):o=x[12];let A=o;x[13]!==R||x[14]!==X?(s=e=>{R&&X(e)},x[13]=R,x[14]=X,x[15]=s):s=x[15];let O=s;x[16]===Symbol.for("react.memo_cache_sentinel")?(c=()=>{Y(!1)},x[16]=c):c=x[16];let E=c;x[17]===Symbol.for("react.memo_cache_sentinel")?(d=()=>{Y(!1)},x[17]=d):d=x[17];let $=d;x[18]!==R?(u=()=>{if(R){let e=()=>Y(!1);return window.addEventListener("mouseup",e),()=>window.removeEventListener("mouseup",e)}},h=[R],x[18]=R,x[19]=h,x[20]=u):(h=x[19],u=x[20]),(0,l.useEffect)(u,h);let B=`fixed shadow-lg bg-card/90 border-border/70 z-50 ${v?"bottom-[calc(92px+env(safe-area-inset-bottom))] right-3 p-2":"bottom-6 right-8 p-3"}`;return x[21]!==v||x[22]!==z?(f=!v&&(0,i.jsx)("div",{className:"text-[10px] uppercase tracking-[0.12em] text-muted-foreground font-semibold mb-2",children:z(aA)}),x[21]=v,x[22]=z,x[23]=f):f=x[23],x[24]!==A||x[25]!==O||x[26]!==I?(m=(0,i.jsx)("canvas",{ref:P,width:I,height:I,className:"block rounded-md border border-border/60 cursor-pointer select-none",onMouseDown:A,onMouseMove:O,onMouseUp:E,onMouseLeave:$}),x[24]=A,x[25]=O,x[26]=I,x[27]=m):m=x[27],x[28]!==v?(g=!v&&(0,i.jsxs)("div",{className:"mt-2 grid grid-cols-4 gap-1 text-[8px]",children:[(0,i.jsxs)("div",{className:"flex items-center gap-1",children:[(0,i.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-sm"}),(0,i.jsx)("span",{className:"text-muted-foreground",children:"R"})]}),(0,i.jsxs)("div",{className:"flex items-center gap-1",children:[(0,i.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-sm"}),(0,i.jsx)("span",{className:"text-muted-foreground",children:"C"})]}),(0,i.jsxs)("div",{className:"flex items-center gap-1",children:[(0,i.jsx)("div",{className:"w-2 h-2 bg-amber-500 rounded-sm"}),(0,i.jsx)("span",{className:"text-muted-foreground",children:"I"})]}),(0,i.jsxs)("div",{className:"flex items-center gap-1",children:[(0,i.jsx)("div",{className:"w-2 h-2 bg-pink-500 rounded-sm"}),(0,i.jsx)("span",{className:"text-muted-foreground",children:"S"})]})]}),x[28]=v,x[29]=g):g=x[29],x[30]!==B||x[31]!==f||x[32]!==m||x[33]!==g?(p=(0,i.jsxs)(tr,{className:B,children:[f,m,g]}),x[30]=B,x[31]=f,x[32]=m,x[33]=g,x[34]=p):p=x[34],p}),aE={population:(0,k.msg)("Population"),jobs:(0,k.msg)("Jobs"),funds:(0,k.msg)("Funds"),monthly:(0,k.msg)("Monthly"),tax:(0,k.msg)("Tax"),happiness:(0,k.msg)("Happiness"),health:(0,k.msg)("Health"),education:(0,k.msg)("Education"),safety:(0,k.msg)("Safety"),environment:(0,k.msg)("Environment")},a$=e=>{let t=(0,n.c)(3),{hour:r}=e;if(r<6||r>=20){let e;return t[0]===Symbol.for("react.memo_cache_sentinel")?(e=(0,i.jsx)("svg",{className:"w-4 h-4 text-blue-300",viewBox:"0 0 24 24",fill:"currentColor",children:(0,i.jsx)("path",{d:"M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z"})}),t[0]=e):e=t[0],e}if(r>=6&&r<8||r>=18&&r<20){let e;return t[1]===Symbol.for("react.memo_cache_sentinel")?(e=(0,i.jsx)("svg",{className:"w-4 h-4 text-orange-400",viewBox:"0 0 24 24",fill:"currentColor",children:(0,i.jsx)("path",{d:"M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.758 17.303a.75.75 0 00-1.061-1.06l-1.591 1.59a.75.75 0 001.06 1.061l1.591-1.59zM6 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016 12zM6.697 7.757a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 00-1.061 1.06l1.59 1.591z"})}),t[1]=e):e=t[1],e}{let e;return t[2]===Symbol.for("react.memo_cache_sentinel")?(e=(0,i.jsx)("svg",{className:"w-4 h-4 text-yellow-400",viewBox:"0 0 24 24",fill:"currentColor",children:(0,i.jsx)("path",{d:"M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.758 17.303a.75.75 0 00-1.061-1.06l-1.591 1.59a.75.75 0 001.06 1.061l1.591-1.59zM6 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016 12zM6.697 7.757a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 00-1.061 1.06l1.59 1.591z"})}),t[2]=e):e=t[2],e}};function aB(e){let t,r,a,l=(0,n.c)(8),{value:o,label:s,variant:c}=e,d=void 0===c?"default":c;l[0]!==s?(t=(0,i.jsx)("div",{className:"text-[10px] text-muted-foreground uppercase tracking-wider font-medium mb-0.5",children:s}),l[0]=s,l[1]=t):t=l[1];let h=`text-sm font-mono tabular-nums font-semibold ${"success"===d?"text-green-500":"warning"===d?"text-amber-500":"destructive"===d?"text-red-500":"text-foreground"}`;return l[2]!==h||l[3]!==o?(r=(0,i.jsx)("div",{className:h,children:o}),l[2]=h,l[3]=o,l[4]=r):r=l[4],l[5]!==t||l[6]!==r?(a=(0,i.jsxs)("div",{className:"flex flex-col items-start min-w-[70px]",children:[t,r]}),l[5]=t,l[6]=r,l[7]=a):a=l[7],a}function aL(e){let t,r,a,l,o,s,c=(0,n.c)(15),{label:d,demand:h,color:u}=e,f=Math.abs(h)/2,m=`text-[10px] font-bold ${u}`;c[0]!==d||c[1]!==m?(t=(0,i.jsx)("span",{className:m,children:d}),c[0]=d,c[1]=m,c[2]=t):t=c[2],c[3]===Symbol.for("react.memo_cache_sentinel")?(r=(0,i.jsx)("div",{className:"absolute left-0 right-0 top-1/2 h-px bg-border"}),c[3]=r):r=c[3],c[4]!==u?(a=u.replace("text-","bg-"),c[4]=u,c[5]=a):a=c[5];let g=`absolute left-0 right-0 ${a}`,p=`${f}%`,x=h>=0?`${50-f}%`:"50%";return c[6]!==p||c[7]!==x?(l={height:p,top:x},c[6]=p,c[7]=x,c[8]=l):l=c[8],c[9]!==g||c[10]!==l?(o=(0,i.jsxs)("div",{className:"w-3 h-8 bg-secondary relative rounded-sm overflow-hidden",children:[r,(0,i.jsx)("div",{className:g,style:l})]}),c[9]=g,c[10]=l,c[11]=o):o=c[11],c[12]!==t||c[13]!==o?(s=(0,i.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[t,o]}),c[12]=t,c[13]=o,c[14]=s):s=c[14],s}function aV(e){let t,r,a,l,o,s=(0,n.c)(13),{icon:c,label:d,value:h}=e,u=h>=70?"text-green-500":h>=40?"text-amber-500":"text-red-500";s[0]!==c?(t=(0,i.jsx)("span",{className:"text-muted-foreground",children:c}),s[0]=c,s[1]=t):t=s[1],s[2]!==d?(r=(0,i.jsx)("span",{className:"text-muted-foreground",children:d}),s[2]=d,s[3]=r):r=s[3];let f=`font-mono ${u}`;return s[4]!==h?(a=Math.round(h),s[4]=h,s[5]=a):a=s[5],s[6]!==f||s[7]!==a?(l=(0,i.jsxs)("span",{className:f,children:[a,"%"]}),s[6]=f,s[7]=a,s[8]=l):l=s[8],s[9]!==t||s[10]!==r||s[11]!==l?(o=(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[t,r,l]}),s[9]=t,s[10]=r,s[11]=l,s[12]=o):o=s[12],o}let aW=l.memo(function(){let e,t,r,a,l,o,s,c,d,h,u,f,m,g,p,x,y=(0,n.c)(36),{state:b}=eL(),{stats:w}=b,v=(0,k.useMessages)();y[0]===Symbol.for("react.memo_cache_sentinel")?(e=(0,i.jsx)(tp,{size:12}),y[0]=e):e=y[0],y[1]!==v?(t=v(aE.happiness),y[1]=v,y[2]=t):t=y[2];let _=String(t);y[3]!==w.happiness||y[4]!==_?(r=(0,i.jsx)(aV,{icon:e,label:_,value:w.happiness}),y[3]=w.happiness,y[4]=_,y[5]=r):r=y[5],y[6]===Symbol.for("react.memo_cache_sentinel")?(a=(0,i.jsx)(tx,{size:12}),y[6]=a):a=y[6],y[7]!==v?(l=v(aE.health),y[7]=v,y[8]=l):l=y[8];let M=String(l);y[9]!==w.health||y[10]!==M?(o=(0,i.jsx)(aV,{icon:a,label:M,value:w.health}),y[9]=w.health,y[10]=M,y[11]=o):o=y[11],y[12]===Symbol.for("react.memo_cache_sentinel")?(s=(0,i.jsx)(ty,{size:12}),y[12]=s):s=y[12],y[13]!==v?(c=v(aE.education),y[13]=v,y[14]=c):c=y[14];let S=String(c);y[15]!==w.education||y[16]!==S?(d=(0,i.jsx)(aV,{icon:s,label:S,value:w.education}),y[15]=w.education,y[16]=S,y[17]=d):d=y[17],y[18]===Symbol.for("react.memo_cache_sentinel")?(h=(0,i.jsx)(tb,{size:12}),y[18]=h):h=y[18],y[19]!==v?(u=v(aE.safety),y[19]=v,y[20]=u):u=y[20];let j=String(u);y[21]!==w.safety||y[22]!==j?(f=(0,i.jsx)(aV,{icon:h,label:j,value:w.safety}),y[21]=w.safety,y[22]=j,y[23]=f):f=y[23],y[24]===Symbol.for("react.memo_cache_sentinel")?(m=(0,i.jsx)(tw,{size:12}),y[24]=m):m=y[24],y[25]!==v?(g=v(aE.environment),y[25]=v,y[26]=g):g=y[26];let P=String(g);return y[27]!==w.environment||y[28]!==P?(p=(0,i.jsx)(aV,{icon:m,label:P,value:w.environment}),y[27]=w.environment,y[28]=P,y[29]=p):p=y[29],y[30]!==d||y[31]!==f||y[32]!==p||y[33]!==r||y[34]!==o?(x=(0,i.jsxs)("div",{className:"h-8 bg-secondary/50 border-b border-border flex items-center justify-center gap-8 text-xs",children:[r,o,d,f,p]}),y[30]=d,y[31]=f,y[32]=p,y[33]=r,y[34]=o,y[35]=x):x=y[35],x}),aD=l.memo(function(){let e,t,r,a,l,o,s,c,d,h,u,m,g,p,x,y,b,w,v,_,M,S,j,P,T,C,N,z,I,R,Y,X,A,O,E,$,B,L,V,W,D,F,J,U=(0,n.c)(103),{state:H,setSpeed:G,setTaxRate:q,visualHour:Q}=eL(),{stats:Z,year:K,month:ee,day:et,speed:er,taxRate:ea,cityName:ei}=H,en=(0,k.useMessages)();U[0]===Symbol.for("react.memo_cache_sentinel")?(e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],U[0]=e):e=U[0];let el=e,eo=String(ee);U[1]!==eo?(t=eo.padStart(2,"0"),U[1]=eo,U[2]=t):t=U[2];let es=String(et);U[3]!==es?(r=es.padStart(2,"0"),U[3]=es,U[4]=r):r=U[4];let ec=`${t}-${r}-${K}`;U[5]!==ei?(a=(0,i.jsx)("div",{className:"flex items-center gap-2",children:(0,i.jsx)("h1",{className:"text-foreground font-semibold text-sm",children:ei})}),U[5]=ei,U[6]=a):a=U[6];let ed=el[ee-1];U[7]!==ed||U[8]!==K?(l=(0,i.jsx)(ri,{asChild:!0,children:(0,i.jsxs)("span",{children:[ed," ",K]})}),U[7]=ed,U[8]=K,U[9]=l):l=U[9],U[10]!==ec?(o=(0,i.jsx)(rn,{children:(0,i.jsx)("p",{children:ec})}),U[10]=ec,U[11]=o):o=U[11],U[12]!==l||U[13]!==o?(s=(0,i.jsxs)(ra,{children:[l,o]}),U[12]=l,U[13]=o,U[14]=s):s=U[14],U[15]!==Q?(c=(0,i.jsx)(a$,{hour:Q}),U[15]=Q,U[16]=c):c=U[16],U[17]!==c||U[18]!==s?(d=(0,i.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground text-xs font-mono tabular-nums",children:[s,c]}),U[17]=c,U[18]=s,U[19]=d):d=U[19],U[20]!==d||U[21]!==a?(h=(0,i.jsxs)("div",{children:[a,d]}),U[20]=d,U[21]=a,U[22]=h):h=U[22],U[23]===Symbol.for("react.memo_cache_sentinel")?(u=[0,1,2,3],U[23]=u):u=U[23],U[24]!==G||U[25]!==er?(m=(0,i.jsx)("div",{className:"flex items-center gap-0 bg-secondary rounded-md p-0",children:u.map(e=>(0,i.jsx)(f,{onClick:()=>G(e),variant:er===e?"default":"ghost",size:"icon-sm",className:"h-7 w-7 p-0 m-0",title:0===e?"Pause":1===e?"Normal":2===e?"Fast":"Very Fast",children:0===e?(0,i.jsx)(ts,{size:12}):1===e?(0,i.jsx)(to,{size:12}):2===e?(0,i.jsxs)("div",{className:"flex items-center -space-x-[5px]",children:[(0,i.jsx)(to,{size:12}),(0,i.jsx)(to,{size:12})]}):(0,i.jsxs)("div",{className:"flex items-center -space-x-[7px]",children:[(0,i.jsx)(to,{size:12}),(0,i.jsx)(to,{size:12}),(0,i.jsx)(to,{size:12})]})},e))}),U[24]=G,U[25]=er,U[26]=m):m=U[26],U[27]!==h||U[28]!==m?(g=(0,i.jsxs)("div",{className:"flex items-center gap-6",children:[h,m]}),U[27]=h,U[28]=m,U[29]=g):g=U[29],U[30]!==Z.population?(p=Z.population.toLocaleString(),U[30]=Z.population,U[31]=p):p=U[31],U[32]!==en?(x=en(aE.population),U[32]=en,U[33]=x):x=U[33];let eh=String(x);U[34]!==p||U[35]!==eh?(y=(0,i.jsx)(aB,{value:p,label:eh}),U[34]=p,U[35]=eh,U[36]=y):y=U[36],U[37]!==Z.jobs?(b=Z.jobs.toLocaleString(),U[37]=Z.jobs,U[38]=b):b=U[38],U[39]!==en?(w=en(aE.jobs),U[39]=en,U[40]=w):w=U[40];let eu=String(w);U[41]!==b||U[42]!==eu?(v=(0,i.jsx)(aB,{value:b,label:eu}),U[41]=b,U[42]=eu,U[43]=v):v=U[43],U[44]!==Z.money?(_=Z.money.toLocaleString(),U[44]=Z.money,U[45]=_):_=U[45];let ef=`$${_}`;U[46]!==en?(M=en(aE.funds),U[46]=en,U[47]=M):M=U[47];let em=String(M),eg=Z.money<0?"destructive":Z.money<1e3?"warning":"success";U[48]!==ef||U[49]!==em||U[50]!==eg?(S=(0,i.jsx)(aB,{value:ef,label:em,variant:eg}),U[48]=ef,U[49]=em,U[50]=eg,U[51]=S):S=U[51],U[52]!==y||U[53]!==v||U[54]!==S?(j=(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[y,v,S]}),U[52]=y,U[53]=v,U[54]=S,U[55]=j):j=U[55];let ep=Z.income-Z.expenses;U[56]!==ep?(P=ep.toLocaleString(),U[56]=ep,U[57]=P):P=U[57];let ex=`$${P}`;U[58]!==en?(T=en(aE.monthly),U[58]=en,U[59]=T):T=U[59];let ey=String(T),eb=Z.income-Z.expenses>=0?"success":"destructive";return U[60]!==ex||U[61]!==ey||U[62]!==eb?(C=(0,i.jsx)(aB,{value:ex,label:ey,variant:eb}),U[60]=ex,U[61]=ey,U[62]=eb,U[63]=C):C=U[63],U[64]===Symbol.for("react.memo_cache_sentinel")?(N=(0,i.jsx)(tO,{orientation:"vertical",className:"h-8"}),U[64]=N):N=U[64],U[65]!==Z.demand.residential?(z=(0,i.jsx)(aL,{label:"R",demand:Z.demand.residential,color:"text-green-500"}),U[65]=Z.demand.residential,U[66]=z):z=U[66],U[67]!==Z.demand.commercial?(I=(0,i.jsx)(aL,{label:"C",demand:Z.demand.commercial,color:"text-blue-500"}),U[67]=Z.demand.commercial,U[68]=I):I=U[68],U[69]!==Z.demand.industrial?(R=(0,i.jsx)(aL,{label:"I",demand:Z.demand.industrial,color:"text-amber-500"}),U[69]=Z.demand.industrial,U[70]=R):R=U[70],U[71]!==z||U[72]!==I||U[73]!==R?(Y=(0,i.jsxs)("div",{className:"flex items-center gap-1.5",children:[z,I,R]}),U[71]=z,U[72]=I,U[73]=R,U[74]=Y):Y=U[74],U[75]===Symbol.for("react.memo_cache_sentinel")?(X=(0,i.jsx)(tO,{orientation:"vertical",className:"h-8"}),U[75]=X):X=U[75],U[76]!==en?(A=en(aE.tax),U[76]=en,U[77]=A):A=U[77],U[78]!==A?(O=(0,i.jsx)("span",{className:"text-muted-foreground text-xs",children:A}),U[78]=A,U[79]=O):O=U[79],U[80]!==ea?(E=[ea],U[80]=ea,U[81]=E):E=U[81],U[82]!==q?($=e=>q(e[0]),U[82]=q,U[83]=$):$=U[83],U[84]!==E||U[85]!==$?(B=(0,i.jsx)(tX,{value:E,onValueChange:$,min:0,max:100,step:1,className:"w-14"}),U[84]=E,U[85]=$,U[86]=B):B=U[86],U[87]!==ea?(L=(0,i.jsxs)("span",{className:"text-foreground text-xs font-mono tabular-nums w-7",children:[ea,"%"]}),U[87]=ea,U[88]=L):L=U[88],U[89]!==O||U[90]!==B||U[91]!==L?(V=(0,i.jsxs)("div",{className:"flex items-center gap-1.5",children:[O,B,L]}),U[89]=O,U[90]=B,U[91]=L,U[92]=V):V=U[92],U[93]===Symbol.for("react.memo_cache_sentinel")?(W=(0,i.jsx)(tO,{orientation:"vertical",className:"h-8"}),D=(0,i.jsx)(t3,{iconOnly:!1,variant:"ghost",iconSize:14}),U[93]=W,U[94]=D):(W=U[93],D=U[94]),U[95]!==C||U[96]!==Y||U[97]!==V?(F=(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[C,N,Y,X,V,W,D]}),U[95]=C,U[96]=Y,U[97]=V,U[98]=F):F=U[98],U[99]!==g||U[100]!==j||U[101]!==F?(J=(0,i.jsxs)("div",{className:"h-14 bg-card border-b border-border flex items-center justify-between px-4",children:[g,j,F]}),U[99]=g,U[100]=j,U[101]=F,U[102]=J):J=U[102],J}),aF=["#d97777","#d4a01f","#2ba67a","#4d84c8","#9a6ac9"],aJ=["#f59e0b","#ef4444","#3b82f6","#10b981","#9333ea"],aU=["#ffe4c4","#ffd5b8","#ffc8a8","#fdbf7e","#e0ac69","#c68642","#8d5524","#613318"],aH=["#ef4444","#f97316","#eab308","#22c55e","#3b82f6","#8b5cf6","#ec4899","#ffffff","#1f2937"],aG=["#1f2937","#374151","#4b5563","#1e3a8a","#7c2d12","#365314"],aq=["#ef4444","#3b82f6","#22c55e","#f97316","#8b5cf6","#1f2937","#ffffff"],aQ=["#e74c3c","#3498db","#2ecc71","#f1c40f","#9b59b6","#e67e22","#1abc9c","#ff69b4"],aZ=["#ffffff","#1e40af","#dc2626","#059669","#7c3aed"],aK={737:0,777:1,747:2,a380:3,seaplane:4,g650:5},a0=["737","737","737","777","777","747","g650"],a1={sw:{col:0,mirrorX:!1,mirrorY:!1,baseAngle:3*Math.PI/4+.26},ne:{col:1,mirrorX:!1,mirrorY:!1,baseAngle:-Math.PI/4+.17},w:{col:2,mirrorX:!1,mirrorY:!1,baseAngle:Math.PI},n:{col:3,mirrorX:!1,mirrorY:!1,baseAngle:3*Math.PI/2},se:{col:0,mirrorX:!0,mirrorY:!1,baseAngle:Math.PI/4-.26},nw:{col:1,mirrorX:!1,mirrorY:!0,baseAngle:Math.PI/4-.26},e:{col:2,mirrorX:!0,mirrorY:!1,baseAngle:0},s:{col:3,mirrorX:!1,mirrorY:!0,baseAngle:Math.PI/2}},a2=["seaplane","g650"],a5={ne:{col:3,mirrorX:!0,mirrorY:!1,baseAngle:-Math.PI/4-.69},se:{col:3,mirrorX:!0,mirrorY:!0,baseAngle:3*Math.PI/4-.78},nw:{col:3,mirrorX:!1,mirrorY:!1,baseAngle:3*Math.PI/2}},a3={737:.152,777:.184,747:.196,a380:.224,g650:.112,seaplane:.09},a4=["#ffffff","#1e40af","#dc2626","#f97316","#059669"],a9=["#dc2626","#ffffff","#1e3a8a","#f97316","#059669"],a6="/assets/water.png",a8=["#ffffff","#1e3a5f","#8b4513","#2f4f4f","#c41e3a","#1e90ff"],a7=["#2c3e50","#34495e","#7f8c8d","#c0392b","#27ae60","#2980b9"],ie=["baseball_stadium","amusement_park","marina_docks_small","pier_large"],it=["#ff4444","#ff6b6b","#44ff44","#6bff6b","#4444ff","#6b6bff","#ffff44","#ffff6b","#ff44ff","#ff6bff","#44ffff","#6bffff","#ff8844","#ffaa44","#ffffff","#ffffee"];function ir(e,t){let r=Math.hypot(t.dx,t.dy)||1;return{step:e,vec:t,angle:Math.atan2(t.dy,t.dx),normal:{nx:-t.dy/r,ny:t.dx/r}}}let ia={north:ir({x:-1,y:0},{dx:-32,dy:-19.2}),east:ir({x:0,y:-1},{dx:32,dy:-19.2}),south:ir({x:1,y:0},{dx:32,dy:19.2}),west:ir({x:0,y:1},{dx:-32,dy:19.2})},ii={north:"south",east:"west",south:"north",west:"east"},il=new Set(["grass","empty","water","road","tree","park","park_large","tennis"]),io=new Set(["house_small","house_medium","mansion","apartment_low","apartment_high"]),is=new Set(["shop_small","shop_medium","office_low","office_high","mall"]),ic=-Math.PI/4,id=[.7,1,1.4],ih=[.85,1,.9],iu={0:[2,4,5,0,3],1:[2,4,5,0,3],2:[2,4,5,0,3],3:[2,4,5,0,3],4:[2,4,5,0,3],5:[3,5,4,0,4],6:[4,6,3,0,5],7:[5,5,3,0,5],8:[6,4,3,0,5],9:[7,3,3,0,4],10:[8,2,4,1,4],11:[9,2,4,1,3],12:[9,2,4,2,3],13:[8,2,4,3,3],14:[8,2,4,3,3],15:[7,2,4,3,4],16:[6,3,4,2,4],17:[5,4,4,2,5],18:[4,5,4,1,6],19:[3,5,5,1,5],20:[2,5,5,0,4],21:[2,4,5,0,3],22:[2,4,5,0,3],23:[2,4,5,0,3]},im=[6,3,4,1,4],ig=["cumulus","stratus","cirrus","cumulonimbus","altocumulus"],ip={cumulus:{opacityMin:.2,opacityMax:.4,layerRestriction:-1,speedMult:1,scaleMin:.7,scaleMax:1.5,puffCountMin:5,puffCountMax:9,puffStretchX:[1,1],puffStretchY:[1,1]},stratus:{opacityMin:.25,opacityMax:.45,layerRestriction:0,speedMult:.85,scaleMin:1,scaleMax:1.6,puffCountMin:8,puffCountMax:14,puffStretchX:[2,3],puffStretchY:[.4,.6]},cirrus:{opacityMin:.06,opacityMax:.18,layerRestriction:2,speedMult:1.5,scaleMin:.8,scaleMax:1.4,puffCountMin:2,puffCountMax:5,puffStretchX:[2,4],puffStretchY:[.3,.5]},cumulonimbus:{opacityMin:.3,opacityMax:.5,layerRestriction:0,speedMult:.7,scaleMin:1.2,scaleMax:1.9,puffCountMin:6,puffCountMax:10,puffStretchX:[1,1.2],puffStretchY:[1,1.3]},altocumulus:{opacityMin:.15,opacityMax:.35,layerRestriction:1,speedMult:1.1,scaleMin:.6,scaleMax:1.2,puffCountMin:4,puffCountMax:8,puffStretchX:[1,1.5],puffStretchY:[.7,1]}},ix=new Int16Array(2048),iy=new Int16Array(2048),ib=new Int16Array(2048),iw=new Int16Array(2048),iv=new Uint8Array(65536);function i_(e,t,r,a){if(r<0||a<0||r>=t||a>=t)return!1;let i=e[a][r],n=i.building.type;return"bridge"===n?"rail"!==i.building.bridgeTrackType:"road"===n}function iM(e,t,r,a){let i=[];return i_(e,t,r-1,a)&&i.push("north"),i_(e,t,r,a-1)&&i.push("east"),i_(e,t,r+1,a)&&i.push("south"),i_(e,t,r,a+1)&&i.push("west"),i}let iS=new Int16Array(4096),ik=new Int16Array(4096),ij=new Int16Array(4096),iP=new Uint8Array(65536),iT=[-1,1,0,0,-1,-1,1,1],iC=[0,0,-1,1,-1,1,-1,1];function iN(e,t,r,a){for(let i=0;i<8;i++){let n=r+iT[i],l=a+iC[i];if(i_(e,t,n,l))return{x:n,y:l}}let i=t*t;if(i>iP.length)return function(e,t,r,a){let i=[{x:r,y:a,dist:0}],n=new Set;for(n.add(a*t+r);i.length>0;){let r=i.shift();if(r.dist>20)break;for(let a=0;a<8;a++){let l=r.x+iT[a],o=r.y+iC[a];if(l<0||o<0||l>=t||o>=t)continue;let s=o*t+l;if(!n.has(s)){if(n.add(s),i_(e,t,l,o))return{x:l,y:o};i.push({x:l,y:o,dist:r.dist+1})}}}return null}(e,t,r,a);for(let e=0;e<i;e++)iP[e]=0;let n=0,l=1;for(iS[0]=r,ik[0]=a,ij[0]=0,iP[a*t+r]=1;n<l&&l<4096;){let r=iS[n],a=ik[n],i=ij[n];if(n++,i>20)break;for(let n=0;n<8;n++){let o=r+iT[n],s=a+iC[n];if(o<0||s<0||o>=t||s>=t)continue;let c=s*t+o;if(!iP[c]){if(iP[c]=1,i_(e,t,o,s))return{x:o,y:s};iS[l]=o,ik[l]=s,ij[l]=i+1,l++}}}return null}function iz(e,t,r,a,i,n){let l=iN(e,t,i,n);if(!l)return null;let o=iN(e,t,r,a);if(!o)return null;if(o.x===l.x&&o.y===l.y)return[{x:o.x,y:o.y}];let s=t*t;if(s>iv.length)return function(e,t,r,a){let i=[{x:r.x,y:r.y,path:[{x:r.x,y:r.y}]}],n=new Set;n.add(`${r.x},${r.y}`);let l=[{dx:-1,dy:0},{dx:1,dy:0},{dx:0,dy:-1},{dx:0,dy:1}];for(;i.length>0;){let r=i.shift();if(r.x===a.x&&r.y===a.y)return r.path;for(let{dx:a,dy:o}of l){let l=r.x+a,s=r.y+o,c=`${l},${s}`;!(l<0||s<0||l>=t||s>=t||n.has(c))&&i_(e,t,l,s)&&(n.add(c),i.push({x:l,y:s,path:[...r.path,{x:l,y:s}]}))}}return null}(e,t,o,l);for(let e=0;e<s;e++)iv[e]=0;let c=0,d=1;ix[0]=o.x,iy[0]=o.y,ib[0]=-1,iw[0]=-1,iv[o.y*t+o.x]=1;let h=[-1,1,0,0],u=[0,0,-1,1],f=-1;for(;c<d&&d<2048;){let r=ix[c],a=iy[c],i=c;if(c++,r===l.x&&a===l.y){f=i;break}for(let i=0;i<4;i++){let n=r+h[i],l=a+u[i];if(n<0||l<0||n>=t||l>=t)continue;let o=l*t+n;!iv[o]&&i_(e,t,n,l)&&(iv[o]=1,ix[d]=n,iy[d]=l,ib[d]=r,iw[d]=a,d++)}}if(-1===f)return null;let m=[],g=f;for(;g>=0;){m.push({x:ix[g],y:iy[g]});let e=ib[g],t=iw[g];if(-1===e)break;let r=-1;for(let a=g-1;a>=0;a--)if(ix[a]===e&&iy[a]===t){r=a;break}g=r}return m.reverse()}function iI(e,t,r,a){let i=r-e,n=a-t;return -1===i&&0===n?"north":1===i&&0===n?"south":0===i&&-1===n?"east":0===i&&1===n?"west":null}function iR(e,t,r,a){return{screenX:32*(e-t)+r,screenY:19.2*(e+t)+a}}function iY(e,t,r,a){let i=e-r-32,n=t-a-19.2;return{gridX:Math.round((i/32+n/19.2)/2),gridY:Math.round((n/19.2-i/32)/2)}}let iX={none:{top:"#4a7c3f",left:"#3d6634",right:"#5a8f4f",stroke:"#2d4a26"},residential:{top:"#2d5a2d",left:"#1d4a1d",right:"#3d6a3d",stroke:"#22c55e"},commercial:{top:"#2a4a6a",left:"#1a3a5a",right:"#3a5a7a",stroke:"#3b82f6"},industrial:{top:"#6a4a2a",left:"#5a3a1a",right:"#7a5a3a",stroke:"#f59e0b"}},iA={none:"transparent",residential:"#22c55e",commercial:"#3b82f6",industrial:"#f59e0b"},iO={top:"#6b7280",left:"#4b5563",right:"#9ca3af",stroke:"#374151"},iE="#d4a574";function i$(e,t,r=64,a=38.4){return{top:{x:e+r/2,y:t},right:{x:e+r,y:t+a/2},bottom:{x:e+r/2,y:t+a},left:{x:e,y:t+a/2}}}let iB={dx:.707,dy:.707},iL={dx:-.707,dy:.707},iV={dx:-.707,dy:-.707},iW={dx:.707,dy:-.707};function iD(e,t,r,a,i={}){let{drawStroke:n=!0,strokeWidth:l=.5,dashed:o=!1,dashPattern:s=[4,2]}=i,c=i$(t,r);e.fillStyle=a.top,e.beginPath(),e.moveTo(c.top.x,c.top.y),e.lineTo(c.right.x,c.right.y),e.lineTo(c.bottom.x,c.bottom.y),e.lineTo(c.left.x,c.left.y),e.closePath(),e.fill(),n&&(e.strokeStyle=a.stroke,e.lineWidth=l,o&&e.setLineDash(s),e.stroke(),o&&e.setLineDash([]))}function iF(e,t,r,a,i,n){let l=t+a/2,o=t+a,s=r+i/2,c=t+a/2,d=r+i,h=r+i/2;if(e.fillStyle="#a67c52",e.beginPath(),e.moveTo(l,r),e.lineTo(o,s),e.lineTo(c,d),e.lineTo(t,h),e.closePath(),e.fill(),n>=.8){e.fillStyle="#8b6914";for(let n=0;n<10;n++){let l=(17*t+31*r+7*n)%100,o=(l%40-20)/100*a,s=(3*l%40-20)/100*i,c=t+a/2+o,d=r+i/2+s;e.beginPath(),e.arc(c,d,.67,0,2*Math.PI),e.fill()}}n>=.6&&(e.strokeStyle="#6b4423",e.lineWidth=.5,e.beginPath(),e.moveTo(l,r),e.lineTo(o,s),e.lineTo(c,d),e.lineTo(t,h),e.closePath(),e.stroke())}function iJ(e,t,r,a,i,n,l){let o=.707*l,s=e-r,c=t-a,d=Math.hypot(s,c);return{x:e-s/d*o+i*l,y:t-c/d*o+n*l}}function iU(e,t,r,a,i,n,l,o,s,c){let d=.707*o,h=a-t,u=i-r,f=Math.hypot(h,u),m=h/f,g=u/f,p=t,x=r,y=a,b=i;s&&f>2*d&&(p=t+m*d,x=r+g*d),c&&f>2*d&&(y=a-m*d,b=i-g*d),e.fillStyle=iE,e.beginPath(),e.moveTo(p,x),e.lineTo(y,b),e.lineTo(y+n*o,b+l*o),e.lineTo(p+n*o,x+l*o),e.closePath(),e.fill(),e.strokeStyle="#b8956a",e.lineWidth=1.5,e.beginPath(),e.moveTo(p+n*o,x+l*o),e.lineTo(y+n*o,b+l*o),e.stroke()}function iH(e,t,r,a,i,n,l){let o=iJ(t.x,t.y,r.x,r.y,a.dx,a.dy,l),s=iJ(t.x,t.y,i.x,i.y,n.dx,n.dy,l);e.fillStyle=iE,e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(o.x,o.y),e.lineTo(s.x,s.y),e.closePath(),e.fill()}let iG={house_small:{top:"#4ade80",left:"#22c55e",right:"#86efac",height:.6},house_medium:{top:"#4ade80",left:"#22c55e",right:"#86efac",height:.8},mansion:{top:"#22c55e",left:"#16a34a",right:"#4ade80",height:1},apartment_low:{top:"#22c55e",left:"#16a34a",right:"#4ade80",height:1.2},apartment_high:{top:"#16a34a",left:"#15803d",right:"#22c55e",height:1.8},shop_small:{top:"#60a5fa",left:"#3b82f6",right:"#93c5fd",height:.5},shop_medium:{top:"#60a5fa",left:"#3b82f6",right:"#93c5fd",height:.7},office_low:{top:"#3b82f6",left:"#2563eb",right:"#60a5fa",height:1.3},office_high:{top:"#2563eb",left:"#1d4ed8",right:"#3b82f6",height:2},mall:{top:"#1d4ed8",left:"#1e40af",right:"#2563eb",height:1},factory_small:{top:"#fbbf24",left:"#f59e0b",right:"#fcd34d",height:.6},factory_medium:{top:"#f59e0b",left:"#d97706",right:"#fbbf24",height:.9},factory_large:{top:"#d97706",left:"#b45309",right:"#f59e0b",height:1.2},warehouse:{top:"#fbbf24",left:"#f59e0b",right:"#fcd34d",height:.7},police_station:{top:"#818cf8",left:"#6366f1",right:"#a5b4fc",height:.8},fire_station:{top:"#f87171",left:"#ef4444",right:"#fca5a5",height:.8},hospital:{top:"#f472b6",left:"#ec4899",right:"#f9a8d4",height:1.2},school:{top:"#c084fc",left:"#a855f7",right:"#d8b4fe",height:.8},university:{top:"#a855f7",left:"#9333ea",right:"#c084fc",height:1},park:{top:"#2dd4bf",left:"#14b8a6",right:"#5eead4",height:.2},park_large:{top:"#14b8a6",left:"#0d9488",right:"#2dd4bf",height:.3},tennis:{top:"#5eead4",left:"#2dd4bf",right:"#99f6e4",height:.2},tree:{top:"#22c55e",left:"#16a34a",right:"#4ade80",height:.5},power_plant:{top:"#9ca3af",left:"#6b7280",right:"#d1d5db",height:1},water_tower:{top:"#60a5fa",left:"#3b82f6",right:"#93c5fd",height:1.4},subway_station:{top:"#6b7280",left:"#4b5563",right:"#9ca3af",height:.5},stadium:{top:"#fbbf24",left:"#f59e0b",right:"#fcd34d",height:.8},museum:{top:"#e879f9",left:"#d946ef",right:"#f0abfc",height:.9},airport:{top:"#9ca3af",left:"#6b7280",right:"#d1d5db",height:.4},space_program:{top:"#f1f5f9",left:"#e2e8f0",right:"#f8fafc",height:1.5},city_hall:{top:"#fbbf24",left:"#f59e0b",right:"#fcd34d",height:1.2},amusement_park:{top:"#fb7185",left:"#f43f5e",right:"#fda4af",height:.8},default:{top:"#9ca3af",left:"#6b7280",right:"#d1d5db",height:.6}},iq={r:255,g:0,b:0},iQ=new Map,iZ=null,iK=new Set;async function i0(){return null!==iZ?iZ:new Promise(e=>{let t=new Image;t.onload=()=>{e(iZ=t.width>0&&t.height>0)},t.onerror=()=>{iZ=!1,e(!1)},t.src="data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoBAAEAAwA0JaQAA3AA/vuUAAA="})}function i1(e){return new Promise((t,r)=>{let a=new Image;a.onload=()=>{iQ.set(e,a),iK.forEach(e=>e()),t(a)},a.onerror=r,a.src=e})}async function i2(e){if(iQ.has(e))return iQ.get(e);let t=e.endsWith(".png")?e.replace(/\.png$/,".webp"):null;if(t&&await i0())try{let r=await i1(t);return iQ.set(e,r),r}catch{console.debug(`WebP not available for ${e}, using PNG`)}return i1(e)}function i5(e,t=!0){let r=t?`${e}_filtered`:e;return iQ.has(r)?Promise.resolve(iQ.get(r)):i2(e).then(e=>t?(function(e,t=155){return new Promise((r,a)=>{try{console.log("Starting background color filtering...",{imageSize:`${e.naturalWidth||e.width}x${e.naturalHeight||e.height}`,threshold:t,backgroundColor:iq});let i=document.createElement("canvas");i.width=e.naturalWidth||e.width,i.height=e.naturalHeight||e.height;let n=i.getContext("2d");if(!n)return void a(Error("Could not get canvas context"));n.drawImage(e,0,0);let l=n.getImageData(0,0,i.width,i.height),o=l.data;console.log(`Processing ${o.length/4} pixels...`);let s=0;for(let e=0;e<o.length;e+=4){let r=o[e],a=o[e+1],i=o[e+2];Math.sqrt(Math.pow(r-iq.r,2)+Math.pow(a-iq.g,2)+Math.pow(i-iq.b,2))<=t&&(o[e+3]=0,s++)}let c=o.length/4,d=s>0?(s/c*100).toFixed(2):"0.00";console.log(`Filtered ${s} pixels (${d}%) from sprite sheet`),n.putImageData(l,0,0);let h=new Image;h.onload=()=>{console.log("Filtered image created successfully"),r(h)},h.onerror=e=>{console.error("Failed to create filtered image:",e),a(Error("Failed to create filtered image"))},h.src=i.toDataURL()}catch(e){a(e)}})})(e).then(e=>(iQ.set(r,e),e)):e)}function i3(e,t=!1){let r=t?`${e}_filtered`:e;return iQ.get(r)}let i4="/assets/sprites_red_water_new_planes.png",i9=new WeakMap,i6={e:[337.5,22.5],se:[22.5,67.5],s:[67.5,112.5],sw:[112.5,157.5],w:[157.5,202.5],nw:[202.5,247.5],n:[247.5,292.5],ne:[292.5,337.5]};function i8(e,t){let r,a=e%(2*Math.PI);a<0&&(a+=2*Math.PI);let i=180*a/Math.PI;if(r=i>=337.5||i<22.5?"e":i>=22.5&&i<67.5?"se":i>=67.5&&i<112.5?"s":i>=112.5&&i<157.5?"sw":i>=157.5&&i<202.5?"w":i>=202.5&&i<247.5?"nw":i>=247.5&&i<292.5?"n":"ne",t&&i9.has(t)){let e=i9.get(t);if(e!==r){let t=["e","se","s","sw","w","nw","n","ne"],a=t.indexOf(e),n=t.indexOf(r);if(1===Math.abs(n-a)||0===a&&7===n||7===a&&0===n){let[t,r]=i6[e]||[0,360],a=Math.min(Math.abs(i-t),Math.abs(i-(t+360))),n=Math.min(Math.abs(i-r),Math.abs(i-(r-360)));if(a<5||n<5)return e}}}return t&&i9.set(t,r),r}function i7(e,t){let r=e%(2*Math.PI);r<0&&(r+=2*Math.PI);let a=r-t;for(;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=2*Math.PI;return a}function ne(e,t,r,a){let i=aK[e];if(void 0===i)return null;let n=a1[t];if(a2.includes(e)&&a5[t]&&(n=a5[t]),!n)return null;let l=r/5,o=a/6,s=0,c=0;return"737"===e&&(c=3===n.col?-70:-8),"777"===e&&(3===n.col?(s=70,c=-70):s=8),"747"===e&&(3===n.col?(s=70,c=-70):s=8),"g650"===e&&(s=12),"seaplane"===e&&("sw"===t?(s=40,c=-40):s=120),{sx:n.col*l,sy:i*o+s,sw:l,sh:o-s-c,mirrorX:n.mirrorX,mirrorY:n.mirrorY,baseAngle:n.baseAngle}}function nt(e,t,r,a,i){e.save(),e.translate(t.x,t.y),e.rotate(t.angle);let n=.7+.5*t.altitude;if(e.scale(n,n),e.fillStyle=t.color,e.beginPath(),e.ellipse(0,0,20,4,0,0,2*Math.PI),e.fill(),e.beginPath(),e.moveTo(5,-3),e.lineTo(-5,-20),e.lineTo(-10,-18),e.lineTo(-5,-3),e.closePath(),e.fill(),e.beginPath(),e.moveTo(5,3),e.lineTo(-5,20),e.lineTo(-10,18),e.lineTo(-5,3),e.closePath(),e.fill(),e.beginPath(),e.moveTo(-15,0),e.lineTo(-18,5),e.lineTo(-20,4),e.lineTo(-18,0),e.closePath(),e.fill(),r>=20||r<6){let t=Math.sin(8*a)>.85;e.fillStyle="#ff3333",i||(e.shadowColor="#ff0000",e.shadowBlur=15),e.beginPath(),e.arc(-7,-18,1.5,0,2*Math.PI),e.fill(),e.fillStyle="#33ff33",i||(e.shadowColor="#00ff00",e.shadowBlur=15),e.beginPath(),e.arc(-7,18,1.5,0,2*Math.PI),e.fill(),e.fillStyle="#ffffff",i||(e.shadowColor="#ffffff",e.shadowBlur=10),e.beginPath(),e.arc(-20,0,1,0,2*Math.PI),e.fill(),t&&(e.fillStyle="#ffffff",i||(e.shadowBlur=30),e.beginPath(),e.arc(-9,-17,2,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(-9,17,2,0,2*Math.PI),e.fill()),e.shadowBlur=0}e.restore()}function nr(e,t,r,a,i){e.save(),e.translate(t.x,t.y),e.rotate(t.angle);let n=t.altitude>.1?.7+.5*t.altitude:.85;if(e.scale(n,n),e.fillStyle=t.color,e.fillStyle="#4a5568",e.beginPath(),e.ellipse(-2,8,12,2,0,0,2*Math.PI),e.fill(),e.beginPath(),e.ellipse(-2,-8,12,2,0,0,2*Math.PI),e.fill(),e.fillStyle=t.color,e.beginPath(),e.ellipse(0,0,15,3,0,0,2*Math.PI),e.fill(),e.beginPath(),e.moveTo(2,-3),e.lineTo(-6,-18),e.lineTo(-10,-16),e.lineTo(-6,-3),e.closePath(),e.fill(),e.beginPath(),e.moveTo(2,3),e.lineTo(-6,18),e.lineTo(-10,16),e.lineTo(-6,3),e.closePath(),e.fill(),e.beginPath(),e.moveTo(-12,0),e.lineTo(-16,4),e.lineTo(-18,3),e.lineTo(-15,0),e.closePath(),e.fill(),r>=20||r<6){let t=Math.sin(8*a)>.85;e.fillStyle="#ff3333",i||(e.shadowColor="#ff0000",e.shadowBlur=15),e.beginPath(),e.arc(-8,-16,1.5,0,2*Math.PI),e.fill(),e.fillStyle="#33ff33",i||(e.shadowColor="#00ff00",e.shadowBlur=15),e.beginPath(),e.arc(-8,16,1.5,0,2*Math.PI),e.fill(),e.fillStyle="#ffffff",i||(e.shadowColor="#ffffff",e.shadowBlur=10),e.beginPath(),e.arc(-18,0,1,0,2*Math.PI),e.fill(),t&&(e.fillStyle="#ffffff",i||(e.shadowBlur=30),e.beginPath(),e.arc(-9,-15,2,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(-9,15,2,0,2*Math.PI),e.fill()),e.shadowBlur=0}e.restore()}let na=new Set(["house_small","house_medium","mansion","apartment_low","apartment_high"]),ni=new Set(["school","university"]),nn=new Set(["shop_small","shop_medium","office_low","office_high","mall"]),nl=new Set(["factory_small","factory_medium","factory_large","warehouse"]),no=new Set(["school","university","hospital","mall","office_low","office_high","city_hall","museum","stadium","rail_station","subway_station","airport","community_center","park","park_large","park_gate"]),ns=new Set(["park","park_large","tennis","basketball_courts","playground_small","playground_large","baseball_field_small","soccer_field_small","football_field","baseball_stadium","community_center","swimming_pool","skate_park","mini_golf_course","bleachers_field","go_kart_track","amphitheater","greenhouse_garden","animal_pens_farm","cabin_house","campground","marina_docks_small","pier_large","roller_coaster_small","community_garden","pond_park","park_gate","mountain_lodge","mountain_trailhead"]),nc=["basketball_courts","tennis","soccer_field_small","baseball_field_small","football_field","baseball_stadium","stadium","swimming_pool","skate_park"],nd=["park","park_large","community_garden","pond_park","greenhouse_garden","amphitheater","campground","marina_docks_small","pier_large"],nh=["playground_small","playground_large","mini_golf_course","go_kart_track","roller_coaster_small","amusement_park","mountain_trailhead"],nu=["shop_small","shop_medium","office_low","office_high","mall","school","university","hospital","museum","community_center","factory_small","factory_medium","factory_large","warehouse","police_station","fire_station","city_hall","rail_station","subway_station","mountain_lodge"];function nf(e,t){if(!e||t<=0)return[];let r=[];for(let a=0;a<t;a++)for(let i=0;i<t;i++){let t=e[a][i].building.type;"marina_docks_small"===t?r.push({x:i,y:a,type:"marina"}):"pier_large"===t&&r.push({x:i,y:a,type:"pier"})}return r}function nm(e,t,r,a){if(!e||t<=0)return null;for(let[i,n]of[[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[-1,1],[1,-1],[1,1]]){let l=r+i,o=a+n;if(l>=0&&l<t&&o>=0&&o<t&&"water"===e[o][l].building.type)return{x:l,y:o}}return null}let ng=null,np=null;function nx(e,t,r,a){if(!e||t<=0)return!1;let i=Math.floor(r/64+a/38.4),n=Math.floor(a/38.4-r/64);return!(i<0)&&!(i>=t)&&!(n<0)&&!(n>=t)&&"water"===e[n][i].building.type}let ny=["park","park_large","tennis","basketball_courts","playground_small","playground_large","baseball_field_small","soccer_field_small","football_field","baseball_stadium","swimming_pool","skate_park","mini_golf_course","bleachers_field","community_garden","pond_park","amphitheater","community_center","campground","marina_docks_small","pier_large","amusement_park","stadium","museum"],nb=["shop_small","shop_medium","office_low","office_high","mall","school","university","hospital","museum","community_center","factory_small","factory_medium","factory_large","warehouse","police_station","fire_station","city_hall","rail_station","subway_station","mountain_lodge"],nw=["shop_small","shop_medium","mall"],nv={basketball_courts:["playing_basketball","watching_game"],tennis:["playing_tennis","watching_game"],soccer_field_small:["playing_soccer","watching_game"],baseball_field_small:["playing_baseball","watching_game"],football_field:["playing_soccer","watching_game"],baseball_stadium:["watching_game","sitting_bench"],stadium:["watching_game","sitting_bench"],bleachers_field:["watching_game","sitting_bench"],swimming_pool:["swimming"],skate_park:["skateboarding","watching_game"],playground_small:["playground"],playground_large:["playground","sitting_bench"],mini_golf_course:["walking_dog","sitting_bench"],go_kart_track:["watching_game"],roller_coaster_small:["watching_game"],amusement_park:["walking_dog","sitting_bench","watching_game"],park:["sitting_bench","picnicking","walking_dog"],park_large:["sitting_bench","picnicking","walking_dog"],community_garden:["sitting_bench","picnicking"],pond_park:["sitting_bench","picnicking","walking_dog"],campground:["sitting_bench","picnicking"],amphitheater:["watching_game","sitting_bench"],greenhouse_garden:["sitting_bench"],mountain_trailhead:["jogging","walking_dog"],marina_docks_small:["sitting_bench","walking_dog"],pier_large:["sitting_bench","walking_dog"],shop_small:["shopping"],shop_medium:["shopping"],mall:["shopping"],office_low:["working"],office_high:["working"],office_building_small:["working"],factory_small:["working"],factory_medium:["working"],factory_large:["working"],warehouse:["working"],school:["studying"],university:["studying"],museum:["watching_game","sitting_bench"],community_center:["sitting_bench","watching_game"]},n_=["playing_basketball","playing_tennis","playing_soccer","playing_baseball"];function nM(e){let t=nv[e];return t&&t.length>0?t[Math.floor(Math.random()*t.length)]:"none"}function nS(e){return nb.includes(e)}function nk(e){return nw.includes(e)}function nj(){return{x:(Math.random()-.5)*20,y:(Math.random()-.5)*10}}function nP(e,t,r,a,i,n,l,o,s){let c="park"===n&&.05>Math.random(),d=("commercial"===n||"industrial"===n)&&.15>Math.random(),h=.15>Math.random(),u=l[o];return{id:e,tileX:u.x,tileY:u.y,direction:s,progress:Math.random(),speed:.12+.08*Math.random(),age:0,maxAge:120+180*Math.random(),skinColor:aU[Math.floor(Math.random()*aU.length)],shirtColor:aH[Math.floor(Math.random()*aH.length)],pantsColor:aG[Math.floor(Math.random()*aG.length)],hasHat:h,hatColor:h?aq[Math.floor(Math.random()*aq.length)]:"#000000",walkOffset:Math.random()*Math.PI*2,sidewalkSide:.5>Math.random()?"left":"right",destType:n,homeX:t,homeY:r,destX:a,destY:i,returningHome:!1,path:l,pathIndex:o,state:"walking",activity:"none",activityProgress:0,activityDuration:0,buildingEntryProgress:0,socialTarget:null,activityOffsetX:0,activityOffsetY:0,activityAnimTimer:Math.random()*Math.PI*2,hasBall:!1,hasDog:c,hasBag:d,hasBeachMat:!1,matColor:aQ[Math.floor(Math.random()*aQ.length)],beachTileX:-1,beachTileY:-1,beachEdge:null}}function nT(e,t,r){let a=t[e.destY]?.[e.destX];if(!a)return;let i=a.building.type;if(ny.includes(i)){let t=nM(i);e.state="at_recreation",e.activity=t,e.activityProgress=0,e.activityDuration=20+100*Math.random();let r=nj();e.activityOffsetX=r.x,e.activityOffsetY=r.y,n_.includes(t)&&(e.hasBall=!0)}else if(nk(i)){e.state="approaching_shop",e.buildingEntryProgress=0,e.activityDuration=15+45*Math.random();let t=nj();e.activityOffsetX=.5*t.x,e.activityOffsetY=.3*t.y,e.activity="shopping"}else nS(i)?(e.state="entering_building",e.buildingEntryProgress=0,e.activityDuration=15+45*Math.random(),e.activity=nM(i)):e.returningHome=!0}let nC=["#2c1810","#4a3728","#8b4513","#d4a574","#f5deb3","#1a1a1a","#8b0000"];function nN(e,t){return"north"===e?"left"===t?-2:-6:"south"===e?"left"===t?2:6:"east"===e?"left"===t?-6:-2:"left"===t?6:2}function nz(e,t,r,a,i){e.fillStyle=nC[i%nC.length],e.beginPath(),e.arc(t,r-.3*a,1.1*a,Math.PI,0),e.fill(),e.beginPath(),e.ellipse(t+.8*a,r+.3*a,.4*a,.9*a,.3,0,2*Math.PI),e.fill()}function nI(e,t,r,a=1,i="all"){let n=t.filter(e=>"inside_building"!==e.state);if("recreation"===i?n=n.filter(e=>"at_recreation"===e.state||"at_beach"===e.state||"approaching_shop"===e.state||"shopping"===e.activity&&("entering_building"===e.state||"exiting_building"===e.state)):"non-recreation"===i&&(n=n.filter(e=>"at_recreation"!==e.state&&"at_beach"!==e.state&&"approaching_shop"!==e.state&&("shopping"!==e.activity||"entering_building"!==e.state&&"exiting_building"!==e.state))),0===n.length)return;let l=a<.55,o=a<.75;e.lineCap="round";for(let t=0;t<n.length;t++){let a,i,d=n[t];if("at_recreation"===d.state){let{screenX:e,screenY:t}=iR(d.destX,d.destY,0,0);a=e+32+d.activityOffsetX,i=t+19.2+d.activityOffsetY}else if("at_beach"===d.state)if("beach_swimming"===d.activity){let{screenX:e,screenY:t}=iR(d.beachTileX,d.beachTileY,0,0);a=e+32+.5*d.activityOffsetX,i=t+19.2+.5*d.activityOffsetY}else{let{screenX:e,screenY:t}=iR(d.tileX,d.tileY,0,0);a=e+32+.3*d.activityOffsetX,i=t+19.2+.3*d.activityOffsetY}else if("approaching_shop"===d.state){let{screenX:e,screenY:t}=iR(d.tileX,d.tileY,0,0),{screenX:r,screenY:n}=iR(d.destX,d.destY,0,0),l=e+32,o=t+19.2,s=ia[d.direction],c="left"===d.sidewalkSide?-10:10,h=nN(d.direction,d.sidewalkSide),u=l+s.vec.dx+s.normal.nx*c,f=o+s.vec.dy+s.normal.ny*c+h,m=r+32,g=n+19.2+8,p=d.buildingEntryProgress;a=u+(m-u)*p+d.activityOffsetX*p,i=f+(g-f)*p+d.activityOffsetY*p}else if("entering_building"===d.state||"exiting_building"===d.state){let{screenX:e,screenY:t}=iR(d.destX,d.destY,0,0);if("shopping"===d.activity){let r="entering_building"===d.state?d.buildingEntryProgress:1-d.buildingEntryProgress;a=e+32+d.activityOffsetX*(1-r),i=t+19.2+8*(1-r)-5*r}else a=e+32,i=t+19.2}else if("socializing"===d.state){let{screenX:e,screenY:t}=iR(d.tileX,d.tileY,0,0),r=e+32,n=t+19.2,l=ia[d.direction],o="left"===d.sidewalkSide?-10:10,s=nN(d.direction,d.sidewalkSide);a=r+l.vec.dx*d.progress+l.normal.nx*o+d.activityOffsetX,i=n+l.vec.dy*d.progress+l.normal.ny*o+d.activityOffsetY+s}else if("idle"===d.state){let{screenX:e,screenY:t}=iR(d.tileX,d.tileY,0,0),r=e+32,n=t+19.2,l=ia[d.direction],o="left"===d.sidewalkSide?-10:10,s=nN(d.direction,d.sidewalkSide);a=r+l.vec.dx*d.progress+l.normal.nx*o,i=n+l.vec.dy*d.progress+l.normal.ny*o+s}else{let{screenX:e,screenY:t}=iR(d.tileX,d.tileY,0,0),r=e+32,n=t+19.2,l=ia[d.direction],o="left"===d.sidewalkSide?-10:10,s=nN(d.direction,d.sidewalkSide);a=r+l.vec.dx*d.progress+l.normal.nx*o,i=n+l.vec.dy*d.progress+l.normal.ny*o+s}if(a<r.viewLeft-50||a>r.viewRight+50||i<r.viewTop-60||i>r.viewBottom+60)continue;let h=function(e){if("shopping"===e.activity)switch(e.state){case"approaching_shop":default:return 1;case"entering_building":return e.buildingEntryProgress<.5?1:1-(e.buildingEntryProgress-.5)*2;case"exiting_building":return e.buildingEntryProgress>.5?1:2*e.buildingEntryProgress;case"inside_building":return 0}switch(e.state){case"entering_building":case"exiting_building":return 1-e.buildingEntryProgress;case"inside_building":return 0;default:return 1}}(d);if(!(h<=0)){if(e.save(),e.translate(a,i),h<1&&(e.globalAlpha=h),l){var s,c;(s=e).fillStyle=(c=d).shirtColor,s.beginPath(),s.arc(0,-1.7,2.1,0,2*Math.PI),s.fill(),s.fillStyle=c.skinColor,s.beginPath(),s.arc(0,-4.3,1.3,0,2*Math.PI),s.fill(),e.restore();continue}if(o){"at_recreation"===d.state?function(e,t){let r=Math.sin(t.activityAnimTimer);e.fillStyle=t.skinColor,e.beginPath(),e.arc(0,-3.5999999999999996,.8999999999999999,0,2*Math.PI),e.fill(),e.fillStyle=t.shirtColor,e.beginPath(),e.ellipse(.3*r,-1.5,.75,1.2,0,0,2*Math.PI),e.fill(),e.strokeStyle=t.pantsColor,e.lineWidth=.44999999999999996,e.beginPath(),e.moveTo(-.3,-.3),e.lineTo(-.44999999999999996,1.5),e.moveTo(.3,-.3),e.lineTo(.44999999999999996,1.5),e.stroke(),t.hasBall&&(e.fillStyle="#ff6b35",e.beginPath(),e.arc(1.2,.6,.44999999999999996,0,2*Math.PI),e.fill())}(e,d):function(e,t){let r=.5*Math.sin(t.walkOffset);e.fillStyle=t.skinColor,e.beginPath(),e.arc(0,(-12+r)*.3,.8999999999999999,0,2*Math.PI),e.fill(),e.fillStyle=t.shirtColor,e.beginPath(),e.ellipse(0,(-5+r)*.3,.75,1.2,0,0,2*Math.PI),e.fill(),e.strokeStyle=t.pantsColor,e.lineWidth=.44999999999999996;let a=2*Math.sin(t.walkOffset);e.beginPath(),e.moveTo(0,(-1+r)*.3),e.lineTo(.3*a,1.5),e.moveTo(0,(-1+r)*.3),e.lineTo(-(.3*a),1.5),e.stroke()}(e,d),e.restore();continue}switch(d.activity){case"playing_basketball":!function(e,t){let r=2*Math.abs(Math.sin(1.5*t.activityAnimTimer)),a=4*Math.sin(3*t.activityAnimTimer);e.fillStyle=t.skinColor,e.beginPath(),e.arc(0,(-12+r)*.32,.96,0,2*Math.PI),e.fill(),e.fillStyle=t.shirtColor,e.beginPath(),e.ellipse(0,(-5+r)*.32,.96,1.44,0,0,2*Math.PI),e.fill(),e.fillStyle=t.pantsColor,e.fillRect(-.64,(-1+r)*.32,1.28,.96),e.strokeStyle=t.skinColor,e.lineWidth=.48,e.beginPath(),e.moveTo(-.32,(2+r)*.32),e.lineTo(-.64,(6+r)*.32),e.stroke(),e.beginPath(),e.moveTo(.32,(2+r)*.32),e.lineTo(.64,(6+r)*.32),e.stroke(),e.strokeStyle=t.skinColor,e.lineWidth=.384,e.beginPath(),e.moveTo(-.64,(-6+r)*.32),e.lineTo((-3+.3*a)*.32,(-1+r)*.32),e.stroke(),e.beginPath(),e.moveTo(.64,(-6+r)*.32),e.lineTo((4+.3*a)*.32,(2+Math.abs(a))*.32),e.stroke(),e.fillStyle="#ff6b35",e.beginPath(),e.arc((4+.3*a)*.32,(4+Math.abs(a)+r)*.32,.64,0,2*Math.PI),e.fill(),e.strokeStyle="#8B4513",e.lineWidth=.096,e.beginPath(),e.arc((4+.3*a)*.32,(4+Math.abs(a)+r)*.32,.64,0,Math.PI),e.stroke()}(e,d);break;case"playing_tennis":!function(e,t){let r=5*Math.sin(+t.activityAnimTimer);e.fillStyle=t.skinColor,e.beginPath(),e.arc(0,-3.7199999999999998,.9299999999999999,0,2*Math.PI),e.fill(),e.fillStyle="#ffffff",e.beginPath(),e.ellipse(0,-4.34,1.24,.31,0,0,Math.PI),e.fill(),e.fillStyle=t.shirtColor,e.beginPath(),e.ellipse(0,-1.55,.775,1.24,0,0,2*Math.PI),e.fill(),e.fillStyle="#ffffff",e.fillRect(-.775,-.31,1.55,.775),e.strokeStyle=t.skinColor,e.lineWidth=.46499999999999997,e.beginPath(),e.moveTo(-.31,.46499999999999997),e.lineTo(-.46499999999999997,1.8599999999999999),e.stroke(),e.beginPath(),e.moveTo(.31,.46499999999999997),e.lineTo(.62,1.8599999999999999),e.stroke(),e.strokeStyle=t.skinColor,e.lineWidth=.372,e.beginPath(),e.moveTo(-.62,-1.8599999999999999),e.lineTo(-.9299999999999999,-.62),e.stroke(),e.beginPath(),e.moveTo(.62,-1.8599999999999999),e.lineTo((4+.5*r)*.31,(-8+.3*Math.abs(r))*.31),e.stroke(),e.strokeStyle="#444444",e.lineWidth=.248,e.beginPath(),e.moveTo((4+.5*r)*.31,(-8+.3*Math.abs(r))*.31),e.lineTo((7+r)*.31,(-12+.5*Math.abs(r))*.31),e.stroke(),e.strokeStyle="#228B22",e.lineWidth=.31,e.beginPath(),e.ellipse((8+r)*.31,(-14+.5*Math.abs(r))*.31,.775,.9299999999999999,.1*r,0,2*Math.PI),e.stroke()}(e,d);break;case"playing_soccer":!function(e,t){let r=4*Math.sin(2*t.activityAnimTimer),a=Math.abs(Math.sin(2.5*t.activityAnimTimer));e.fillStyle=t.skinColor,e.beginPath(),e.arc(0,(-12+a)*.31,.9299999999999999,0,2*Math.PI),e.fill(),e.fillStyle=t.shirtColor,e.beginPath(),e.ellipse(0,(-5+a)*.31,.775,1.24,0,0,2*Math.PI),e.fill(),e.fillStyle=t.pantsColor,e.fillRect(-.62,(-1+a)*.31,1.24,.775),e.strokeStyle=t.skinColor,e.lineWidth=.46499999999999997,e.beginPath(),e.moveTo(-.31,(1.5+a)*.31),e.lineTo((-1.5-.2*r)*.31,(6+a)*.31),e.stroke(),e.beginPath(),e.moveTo(.31,(1.5+a)*.31),e.lineTo((2+r)*.31,(4+a-.3*Math.abs(r))*.31),e.stroke(),Math.abs(r)>2&&(e.fillStyle="#ffffff",e.beginPath(),e.arc((4+1.5*r)*.31,(3+a)*.31,.46499999999999997,0,2*Math.PI),e.fill(),e.strokeStyle="#000000",e.lineWidth=.093,e.stroke()),e.strokeStyle=t.skinColor,e.lineWidth=.372,e.beginPath(),e.moveTo(-.62,(-6+a)*.31),e.lineTo((-3-.2*r)*.31,(-2+a)*.31),e.stroke(),e.beginPath(),e.moveTo(.62,(-6+a)*.31),e.lineTo((3+.2*r)*.31,(-2+a)*.31),e.stroke()}(e,d);break;case"playing_baseball":!function(e,t){let r=6*Math.sin(+t.activityAnimTimer);e.fillStyle=t.skinColor,e.beginPath(),e.arc(0,-3.7199999999999998,.9299999999999999,0,2*Math.PI),e.fill(),e.fillStyle=t.shirtColor,e.beginPath(),e.arc(0,-4.03,1.085,Math.PI,0),e.fill(),e.fillRect(-1.24,-4.03,1.24,.31),e.fillStyle="#ffffff",e.beginPath(),e.ellipse(0,-1.55,.775,1.24,0,0,2*Math.PI),e.fill(),e.fillStyle=t.pantsColor,e.fillRect(-.62,-.31,1.24,1.24),e.strokeStyle=t.pantsColor,e.lineWidth=.62,e.beginPath(),e.moveTo(-.31,.9299999999999999),e.lineTo(-.46499999999999997,2.17),e.stroke(),e.beginPath(),e.moveTo(.31,.9299999999999999),e.lineTo(.46499999999999997,2.17),e.stroke(),e.strokeStyle=t.skinColor,e.lineWidth=.372,e.beginPath(),e.moveTo(-.62,-1.8599999999999999),e.lineTo((-1+.3*r)*.31,-2.79),e.stroke(),e.beginPath(),e.moveTo(.62,-1.8599999999999999),e.lineTo((1+.5*r)*.31,-2.79),e.stroke(),e.strokeStyle="#8B4513",e.lineWidth=.46499999999999997,e.beginPath(),e.moveTo(.4*r*.31,-2.79),e.lineTo(1.2*r*.31,-4.96),e.stroke()}(e,d);break;case"swimming":!function(e,t){let r=Math.sin(2*t.activityAnimTimer),a=1.5*Math.sin(+t.activityAnimTimer);e.fillStyle="rgba(59, 130, 246, 0.3)",e.beginPath(),e.ellipse(0,.44,1.76,.66,0,0,2*Math.PI),e.fill(),e.fillStyle=t.skinColor,e.beginPath(),e.arc(0,(-3+a)*.22,.66,0,2*Math.PI),e.fill(),e.fillStyle=t.shirtColor,e.beginPath(),e.arc(0,(-4+a)*.22,.66,Math.PI,0),e.fill(),e.fillStyle="#333333",e.fillRect(-.66,(-3+a)*.22,1.32,.22),e.strokeStyle=t.skinColor,e.lineWidth=.33,e.beginPath(),e.moveTo(-.44,(0+a)*.22),e.lineTo((-5+3*r)*.22,(-2+2*r)*.22),e.stroke(),e.beginPath(),e.moveTo(.44,(0+a)*.22),e.lineTo((5-3*r)*.22,(-2-2*r)*.22),e.stroke(),e.fillStyle="rgba(255, 255, 255, 0.5)";let i=2*Math.abs(r);e.beginPath(),e.arc((-5+3*r)*.22,0,.22*i,0,2*Math.PI),e.fill()}(e,d);break;case"beach_swimming":!function(e,t){let r=Math.sin(1.8*t.activityAnimTimer),a=1.5*Math.sin(1.2*t.activityAnimTimer),i=.5*Math.sin(.8*t.activityAnimTimer);e.fillStyle="rgba(255, 255, 255, 0.2)",e.beginPath(),e.ellipse(0,.48,2.4+2*Math.abs(r),.96,0,0,2*Math.PI),e.fill(),e.fillStyle="rgba(30, 100, 180, 0.25)",e.beginPath(),e.ellipse(0,.24,2.16,.84,0,0,2*Math.PI),e.fill(),e.fillStyle=t.skinColor,e.beginPath(),e.arc(.24*i,(-2+a)*.24,.768,0,2*Math.PI),e.fill(),e.fillStyle=nC[t.id%nC.length],e.beginPath(),e.arc(.24*i,(-3.5+a)*.24,.72,Math.PI,0),e.fill(),e.strokeStyle=t.skinColor,e.lineWidth=.48;let n=1.8*t.activityAnimTimer;Math.sin(n)>0&&(e.beginPath(),e.moveTo((-3+i)*.24,(0+a)*.24),e.quadraticCurveTo((-6+4*Math.sin(n))*.24,(-3+2*Math.cos(n)+a)*.24,(-8+2*Math.sin(n))*.24,(1+a)*.24),e.stroke());let l=1.8*t.activityAnimTimer+Math.PI;Math.sin(l)>0&&(e.beginPath(),e.moveTo((3+i)*.24,(0+a)*.24),e.quadraticCurveTo((6+4*Math.sin(l))*.24,(-3+2*Math.cos(l)+a)*.24,(8+2*Math.sin(l))*.24,(1+a)*.24),e.stroke()),-.8>Math.sin(n)&&(e.fillStyle="rgba(255, 255, 255, 0.6)",e.beginPath(),e.arc((-7+i)*.24,(1+a)*.24,.48,0,2*Math.PI),e.fill()),-.8>Math.sin(l)&&(e.fillStyle="rgba(255, 255, 255, 0.6)",e.beginPath(),e.arc((7+i)*.24,(1+a)*.24,.48,0,2*Math.PI),e.fill()),.4*Math.abs(Math.sin(3.5*t.activityAnimTimer))>.2&&(e.fillStyle="rgba(255, 255, 255, 0.3)",e.beginPath(),e.ellipse(0,1.44,.96,.48,0,0,2*Math.PI),e.fill())}(e,d);break;case"lying_on_mat":!function(e,t){let r=.3*Math.sin(.3*t.activityAnimTimer),a=0;switch(t.beachEdge){case"north":case"south":a=Math.PI/4;break;case"east":case"west":a=-Math.PI/4}e.save(),e.rotate(a);e.fillStyle="rgba(0, 0, 0, 0.15)",e.beginPath(),e.ellipse(.22,.44,2.4200000000000004,1.2100000000000002,0,0,2*Math.PI),e.fill(),e.fillStyle=t.matColor,e.fillRect(-2.2,-1.1,4.4,2.2),e.fillStyle=nA(t.matColor,-30),e.fillRect(-2.2,-.66,4.4,.33),e.fillRect(-2.2,.1100000000000001,4.4,.33),e.fillRect(-2.2,.77,4.4,.33),e.strokeStyle=nA(t.matColor,-50),e.lineWidth=.11,e.strokeRect(-2.2,-1.1,4.4,2.2),t.id%2==0?(e.fillStyle=t.shirtColor,e.beginPath(),e.ellipse(0,.22*r,.66,1.1,Math.PI/2,0,2*Math.PI),e.fill(),e.fillStyle=t.skinColor,e.beginPath(),e.arc(-1.32,.22*r,.55,0,2*Math.PI),e.fill(),e.fillStyle=nC[t.id%nC.length],e.beginPath(),e.arc(-1.32,.22*r,.55,.3*Math.PI,1.7*Math.PI),e.fill(),e.strokeStyle=t.skinColor,e.lineWidth=.33,e.beginPath(),e.moveTo(-.44,(r-2)*.22),e.lineTo(-1.76,(r-3)*.22),e.stroke(),e.beginPath(),e.moveTo(-.44,(r+2)*.22),e.lineTo(-1.76,(r+3)*.22),e.stroke(),e.fillStyle=t.pantsColor,e.beginPath(),e.ellipse(1.1,.22*r,.44,.66,Math.PI/2,0,2*Math.PI),e.fill(),e.fillStyle=t.skinColor,e.beginPath(),e.arc(1.76,(r-1)*.22,.22,0,2*Math.PI),e.arc(1.76,(r+1)*.22,.22,0,2*Math.PI)):(e.fillStyle=t.shirtColor,e.beginPath(),e.ellipse(0,.22*r,.66,1.1,Math.PI/2,0,2*Math.PI),e.fill(),e.fillStyle=t.skinColor,e.beginPath(),e.arc(-1.32,.22*r,.55,0,2*Math.PI),e.fill(),e.fillStyle="#333",e.beginPath(),e.moveTo(-1.54,(r-.5)*.22),e.lineTo(-1.43,(r-.5)*.22),e.moveTo(-1.21,(r-.5)*.22),e.lineTo(-1.1,(r-.5)*.22),e.stroke(),e.strokeStyle=t.skinColor,e.lineWidth=.33,e.beginPath(),e.moveTo(-.44,(r-2.5)*.22),e.lineTo(.66,(r-4)*.22),e.stroke(),e.beginPath(),e.moveTo(-.44,(r+2.5)*.22),e.lineTo(.66,(r+4)*.22),e.stroke(),e.fillStyle=t.pantsColor,e.beginPath(),e.ellipse(1.1,.22*r,.44,.66,Math.PI/2,0,2*Math.PI),e.fill(),e.fillStyle=t.skinColor,e.beginPath(),e.arc(1.76,(r-1.5)*.22,.22,0,2*Math.PI),e.arc(1.76,(r+1.5)*.22,.22,0,2*Math.PI)),e.fill(),e.restore()}(e,d);break;case"skateboarding":!function(e,t){let r=Math.sin(1.5*t.activityAnimTimer),a=1.5*Math.abs(r);e.fillStyle="#8B4513",e.fillRect(-1.1500000000000001,(5+a)*.23,2.3000000000000003,.34500000000000003),e.fillStyle="#333333",e.beginPath(),e.arc(-.6900000000000001,(7+a)*.23,.23,0,2*Math.PI),e.arc(.6900000000000001,(7+a)*.23,.23,0,2*Math.PI),e.fill(),e.fillStyle=t.skinColor,e.beginPath(),e.arc(.23*r,(-10+a)*.23,.6900000000000001,0,2*Math.PI),e.fill(),e.fillStyle="#333333",e.beginPath(),e.arc(.23*r,(-11+a)*.23,.805,Math.PI,0),e.fill(),e.fillStyle=t.shirtColor,e.beginPath(),e.ellipse(.23*r,(-4+a)*.23,.5750000000000001,.805,0,0,2*Math.PI),e.fill(),e.strokeStyle=t.pantsColor,e.lineWidth=.46,e.beginPath(),e.moveTo((-1+r)*.23,(0+a)*.23),e.quadraticCurveTo((-3+r)*.23,(3+a)*.23,(-2+r)*.23,(5+a)*.23),e.stroke(),e.beginPath(),e.moveTo((1+r)*.23,(0+a)*.23),e.quadraticCurveTo((3+r)*.23,(3+a)*.23,(2+r)*.23,(5+a)*.23),e.stroke(),e.strokeStyle=t.skinColor,e.lineWidth=.276,e.beginPath(),e.moveTo((-2+r)*.23,(-5+a)*.23),e.lineTo((-6-r)*.23,(-3+a)*.23),e.stroke(),e.beginPath(),e.moveTo((2+r)*.23,(-5+a)*.23),e.lineTo((6+r)*.23,(-3+a)*.23),e.stroke()}(e,d);break;case"sitting_bench":!function(e,t){let r=.3*Math.sin(.5*t.activityAnimTimer);e.fillStyle="#8B4513",e.fillRect(-1.32,.44,2.64,.44),e.fillRect(-1.1,.88,.33,.66),e.fillRect(.77,.88,.33,.66),e.fillStyle=t.skinColor,e.beginPath(),e.arc(0,(-8+r)*.22,.66,0,2*Math.PI),e.fill(),t.id%2==0&&nz(e,0,(-8+r)*.22,.66,t.id),t.hasHat&&(e.fillStyle=t.hatColor,e.beginPath(),e.ellipse(0,(-11+r)*.22,.88,.33,0,0,2*Math.PI),e.fill()),e.fillStyle=t.shirtColor,e.beginPath(),e.ellipse(0,(-2+r)*.22,.55,.88,0,0,2*Math.PI),e.fill(),e.fillStyle=t.pantsColor,e.fillRect(-.44,.22,.88,.44),e.strokeStyle=t.pantsColor,e.lineWidth=.44,e.beginPath(),e.moveTo(-.22,.66),e.lineTo(-.22,1.54),e.stroke(),e.beginPath(),e.moveTo(.22,.66),e.lineTo(.22,1.54),e.stroke(),e.strokeStyle=t.skinColor,e.lineWidth=.264,e.beginPath(),e.moveTo(-.44,(-3+r)*.22),e.lineTo(-.88,.22),e.stroke(),e.beginPath(),e.moveTo(.44,(-3+r)*.22),e.lineTo(.88,.22),e.stroke()}(e,d);break;case"picnicking":!function(e,t){let r=nY[t.id%nY.length];e.fillStyle=r.main,e.fillRect(-1.76,0,3.52,1.76),e.fillStyle=r.accent,e.fillRect(-1.32,.44,.88,.88),e.fillRect(.44,.44,.88,.88),e.fillStyle=t.skinColor,e.beginPath(),e.arc(0,-1.76,.66,0,2*Math.PI),e.fill(),t.id%2==0&&nz(e,0,-1.76,.66,t.id),e.fillStyle=t.shirtColor,e.beginPath(),e.ellipse(0,-.44,.55,.88,0,0,2*Math.PI),e.fill(),e.strokeStyle=t.pantsColor,e.lineWidth=.44,e.beginPath(),e.moveTo(-.22,.44),e.lineTo(.44,1.1),e.stroke(),e.beginPath(),e.moveTo(.22,.44),e.lineTo(-.44,1.1),e.stroke(),e.fillStyle="#8B4513",e.fillRect(1.1,.22,.88,.66)}(e,d);break;case"jogging":!function(e,t){let r=t.walkOffset,a=2*Math.abs(Math.sin(2*r));e.fillStyle=t.skinColor,e.beginPath(),e.arc(0,(-12+a)*.2,.6000000000000001,0,2*Math.PI),e.fill(),t.id%2==0&&nz(e,0,(-12+a)*.2,.6000000000000001,t.id),e.fillStyle=t.shirtColor,e.fillRect(-.6000000000000001,(-13+a)*.2,1.2000000000000002,.30000000000000004),e.fillStyle=t.shirtColor,e.beginPath(),e.ellipse(0,(-5+a)*.2,.45999999999999996,.8,0,0,2*Math.PI),e.fill(),e.fillStyle=t.pantsColor,e.fillRect(-.4,(-1+a)*.2,.8,.4),e.strokeStyle=t.skinColor,e.lineWidth=.30000000000000004;let i=5*Math.sin(r),n=5*Math.sin(r+Math.PI);e.beginPath(),e.moveTo(0,(1+a)*.2),e.lineTo(.2*i,(6+a)*.2),e.stroke(),e.beginPath(),e.moveTo(0,(1+a)*.2),e.lineTo(.2*n,(6+a)*.2),e.stroke(),e.strokeStyle=t.skinColor,e.lineWidth=.24;let l=3*Math.sin(r+Math.PI),o=3*Math.sin(r);e.beginPath(),e.moveTo(-.4,(-6+a)*.2),e.lineTo((-3+l)*.2,(-2+a)*.2),e.stroke(),e.beginPath(),e.moveTo(.4,(-6+a)*.2),e.lineTo((3+o)*.2,(-2+a)*.2),e.stroke()}(e,d);break;case"walking_dog":nR(e,d);break;case"playground":!function(e,t){let r=8*Math.sin(1.5*t.activityAnimTimer),a=3*Math.cos(1.5*t.activityAnimTimer);e.strokeStyle="#666666",e.lineWidth=.2,e.beginPath(),e.moveTo(-.4,-4),e.lineTo((-2+a)*.2,(-8+.2*Math.abs(r))*.2),e.stroke(),e.beginPath(),e.moveTo(.4,-4),e.lineTo((2+a)*.2,(-8+.2*Math.abs(r))*.2),e.stroke(),e.fillStyle=t.skinColor,e.beginPath(),e.arc(.2*a,(-10+.2*Math.abs(r))*.2,.5,0,2*Math.PI),e.fill(),e.fillStyle=t.shirtColor,e.beginPath(),e.ellipse(.2*a,(-4+.1*Math.abs(r))*.2,.4,.6000000000000001,0,0,2*Math.PI),e.fill(),e.strokeStyle=t.pantsColor,e.lineWidth=.30000000000000004,e.beginPath(),e.moveTo(.2*a,(-1+.1*Math.abs(r))*.2),e.lineTo((a+.3*r)*.2,.8),e.stroke(),e.beginPath(),e.moveTo(.2*a,(-1+.1*Math.abs(r))*.2),e.lineTo((a+.2*r)*.2,.8),e.stroke(),e.strokeStyle=t.skinColor,e.lineWidth=.2,e.beginPath(),e.moveTo((a-1.5)*.2,(-5+.15*Math.abs(r))*.2),e.lineTo((-2+a)*.2,(-8+.2*Math.abs(r))*.2),e.stroke(),e.beginPath(),e.moveTo((a+1.5)*.2,(-5+.15*Math.abs(r))*.2),e.lineTo((2+a)*.2,(-8+.2*Math.abs(r))*.2),e.stroke()}(e,d);break;case"watching_game":!function(e,t){let r=Math.sin(2*t.activityAnimTimer)>.7;e.fillStyle=t.skinColor,e.beginPath(),e.arc(0,(-12+(r?-1:0))*.22,.66,0,2*Math.PI),e.fill(),t.id%2==0?nz(e,0,(-12+(r?-1:0))*.22,.66,t.id):(e.fillStyle=t.shirtColor,e.beginPath(),e.arc(0,(-13+(r?-1:0))*.22,.77,Math.PI,0),e.fill()),e.fillStyle=t.shirtColor,e.beginPath(),e.ellipse(0,-1.1,.55,.88,0,0,2*Math.PI),e.fill(),e.fillStyle=t.pantsColor,e.fillRect(-.44,-.22,.88,.66),e.strokeStyle=t.pantsColor,e.lineWidth=.44,e.beginPath(),e.moveTo(-.22,.44),e.lineTo(-.33,1.54),e.stroke(),e.beginPath(),e.moveTo(.22,.44),e.lineTo(.33,1.54),e.stroke(),e.strokeStyle=t.skinColor,e.lineWidth=.264,r?(e.beginPath(),e.moveTo(-.44,-1.32),e.lineTo(-.88,-3.08),e.stroke(),e.beginPath(),e.moveTo(.44,-1.32),e.lineTo(.88,-3.08)):(e.beginPath(),e.moveTo(-.44,-1.32),e.lineTo(-.66,-.22),e.stroke(),e.beginPath(),e.moveTo(.44,-1.32),e.lineTo(.66,-.22)),e.stroke()}(e,d);break;case"shopping":"approaching_shop"===d.state?nX(e,d):"entering_building"===d.state||"exiting_building"===d.state?function(e,t){let r=.5*Math.sin(t.walkOffset);e.fillStyle=t.skinColor,e.beginPath(),e.arc(0,(-12+r)*.28,.8400000000000001,0,2*Math.PI),e.fill(),t.id%2==0&&(e.fillStyle=["#2c1810","#4a3728","#8b4513","#d4a574","#f5deb3","#1a1a1a"][t.id%6],e.beginPath(),e.arc(0,(-13+r)*.28,.8400000000000001,Math.PI,0),e.fill()),e.fillStyle=t.shirtColor,e.beginPath(),e.ellipse(0,(-5+r)*.28,.7000000000000001,1.12,0,0,2*Math.PI),e.fill();let a=1.5*Math.sin(t.walkOffset);e.strokeStyle=t.pantsColor,e.lineWidth=.42000000000000004,e.beginPath(),e.moveTo(0,(-1+r)*.28),e.lineTo((-1+a)*.28,(5+r)*.28),e.stroke(),e.beginPath(),e.moveTo(0,(-1+r)*.28),e.lineTo((1-a)*.28,(5+r)*.28),e.stroke(),e.strokeStyle=t.skinColor,e.lineWidth=.336;let i=.5*a;e.beginPath(),e.moveTo(-.56,(-6+r)*.28),e.lineTo((-3-i)*.28,(-2+r)*.28),e.stroke(),t.hasBag&&"exiting_building"===t.state?(e.fillStyle="#e74c3c",e.fillRect(.56,(-4+r)*.28,.8400000000000001,1.12),e.strokeStyle="#c0392b",e.lineWidth=.14,e.beginPath(),e.moveTo(.7000000000000001,(-4+r)*.28),e.lineTo(.7000000000000001,(-5+r)*.28),e.moveTo(1.2600000000000002,(-4+r)*.28),e.lineTo(1.2600000000000002,(-5+r)*.28),e.stroke(),e.strokeStyle=t.skinColor,e.lineWidth=.336,e.beginPath(),e.moveTo(.56,(-6+r)*.28),e.lineTo(.8400000000000001,(-4+r)*.28)):(e.beginPath(),e.moveTo(.56,(-6+r)*.28),e.lineTo((3+i)*.28,(-2+r)*.28)),e.stroke()}(e,d):nR(e,d);break;default:"socializing"===d.state?function(e,t){let r=2*Math.sin(+t.activityAnimTimer);e.fillStyle=t.skinColor,e.beginPath(),e.arc(0,-3.5999999999999996,.8999999999999999,0,2*Math.PI),e.fill(),t.id%2==0&&nz(e,0,-3.5999999999999996,.8999999999999999,t.id),e.fillStyle=t.shirtColor,e.beginPath(),e.ellipse(0,-1.5,.75,1.2,0,0,2*Math.PI),e.fill(),e.strokeStyle=t.pantsColor,e.lineWidth=.44999999999999996,e.beginPath(),e.moveTo(-.3,-.3),e.lineTo(-.44999999999999996,1.5),e.stroke(),e.beginPath(),e.moveTo(.3,-.3),e.lineTo(.44999999999999996,1.5),e.stroke(),e.strokeStyle=t.skinColor,e.lineWidth=.36,e.beginPath(),e.moveTo(-.6,-1.7999999999999998),e.lineTo((-4+r)*.3,(-4+.5*Math.abs(r))*.3),e.stroke(),e.beginPath(),e.moveTo(.6,-1.7999999999999998),e.lineTo((4-r)*.3,(-4+.5*Math.abs(r))*.3),e.stroke(),Math.sin(2.5*t.activityAnimTimer)>0&&(e.fillStyle="#666666",e.beginPath(),e.arc(1.5,-4.2,.24,0,2*Math.PI),e.arc(2.1,-4.5,.18,0,2*Math.PI),e.arc(2.55,-4.6499999999999995,.12,0,2*Math.PI),e.fill())}(e,d):"idle"===d.state?function(e,t){let r=.3*Math.sin(.5*t.activityAnimTimer);e.fillStyle=t.skinColor,e.beginPath(),e.arc(0,(-12+r)*.3,.8999999999999999,0,2*Math.PI),e.fill(),t.id%2!=0||t.hasHat||nz(e,0,(-12+r)*.3,.8999999999999999,t.id),t.hasHat&&(e.fillStyle=t.hatColor,e.beginPath(),e.ellipse(0,(-15+r)*.3,1.2,.44999999999999996,0,0,2*Math.PI),e.fill()),e.fillStyle=t.shirtColor,e.beginPath(),e.ellipse(0,(-5+r)*.3,.75,1.2,0,0,2*Math.PI),e.fill(),e.strokeStyle=t.pantsColor,e.lineWidth=.44999999999999996,e.beginPath(),e.moveTo(-.3,(-1+r)*.3),e.lineTo(-.3,(5+r)*.3),e.stroke(),e.beginPath(),e.moveTo(.3,(-1+r)*.3),e.lineTo(.3,(5+r)*.3),e.stroke(),e.strokeStyle=t.skinColor,e.lineWidth=.36,e.beginPath(),e.moveTo(-.6,(-6+r)*.3),e.lineTo(-.75,(-1+r)*.3),e.stroke(),e.beginPath(),e.moveTo(.6,(-6+r)*.3),e.lineTo(.75,(-1+r)*.3),e.stroke(),t.hasBag&&(e.fillStyle="#8B4513",e.fillRect(.8999999999999999,(-4+r)*.3,.6,.8999999999999999))}(e,d):"approaching_shop"===d.state?nX(e,d):nR(e,d)}e.restore()}}}function nR(e,t){var r;let a=.8*Math.sin(t.walkOffset),i=.5*Math.sin(.5*t.walkOffset),n=3*Math.sin(t.walkOffset);e.fillStyle=t.skinColor,e.beginPath(),e.arc(.3*i,(-12+a)*.3,.8999999999999999,0,2*Math.PI),e.fill(),t.id%2==0&&nz(e,.3*i,(-12+a)*.3,.8999999999999999,t.id),e.fillStyle=t.shirtColor,e.beginPath(),e.ellipse(.3*i,(-5+a)*.3,.75,1.2,0,0,2*Math.PI),e.fill(),e.strokeStyle=t.pantsColor,e.lineWidth=.44999999999999996,e.beginPath(),e.moveTo(.3*i,(-1+a)*.3),e.lineTo((i-1+n)*.3,(5+a)*.3),e.moveTo(.3*i,(-1+a)*.3),e.lineTo((i+1-n)*.3,(5+a)*.3),e.stroke(),e.strokeStyle=t.skinColor,e.lineWidth=.36;let l=.67*n;e.beginPath(),e.moveTo((i-2)*.3,(-6+a)*.3),e.lineTo((i-3-l)*.3,(-2+a)*.3),e.moveTo((i+2)*.3,(-6+a)*.3),e.lineTo((i+3+l)*.3,(-2+a)*.3),e.stroke(),t.hasDog&&((r=e).fillStyle="#8B4513",r.beginPath(),r.ellipse(2.08,1.56,1.04,.52,0,0,2*Math.PI),r.arc(3.12,1.04,.52,0,2*Math.PI),r.fill(),r.strokeStyle="#8B4513",r.lineWidth=.13,r.beginPath(),r.moveTo(-.52,-.52),r.lineTo(2.08,1.3),r.stroke())}let nY=[{main:"#d4a5a5",accent:"#f5e6e6"},{main:"#a5c4d4",accent:"#e6f0f5"},{main:"#b5d4a5",accent:"#e6f5e6"},{main:"#d4cfa5",accent:"#f5f3e6"},{main:"#c4a5d4",accent:"#f0e6f5"},{main:"#d4b5a5",accent:"#f5ece6"}];function nX(e,t){let r=.6*Math.sin(t.walkOffset),a=.4*Math.sin(.5*t.walkOffset),i=2.5*Math.sin(t.walkOffset);e.fillStyle=t.skinColor,e.beginPath(),e.arc(.28*a,(-12+r)*.28,.8400000000000001,0,2*Math.PI),e.fill(),t.id%2==0&&(e.fillStyle=["#2c1810","#4a3728","#8b4513","#d4a574","#f5deb3","#1a1a1a"][t.id%6],e.beginPath(),e.arc(.28*a,(-13+r)*.28,.8400000000000001,Math.PI,0),e.fill()),e.fillStyle=t.shirtColor,e.beginPath(),e.ellipse(.28*a,(-5+r)*.28,.7000000000000001,1.12,0,0,2*Math.PI),e.fill(),e.strokeStyle=t.pantsColor,e.lineWidth=.42000000000000004,e.beginPath(),e.moveTo(.28*a,(-1+r)*.28),e.lineTo((a-1+i)*.28,(5+r)*.28),e.stroke(),e.beginPath(),e.moveTo(.28*a,(-1+r)*.28),e.lineTo((a+1-i)*.28,(5+r)*.28),e.stroke(),e.strokeStyle=t.skinColor,e.lineWidth=.336;let n=.6*i;e.beginPath(),e.moveTo((a-2)*.28,(-6+r)*.28),e.lineTo((a-3-n)*.28,(-2+r)*.28),e.stroke(),e.beginPath(),e.moveTo((a+2)*.28,(-6+r)*.28),e.lineTo((a+3+n)*.28,(-2+r)*.28),e.stroke()}function nA(e,t){let r=parseInt(e.replace("#",""),16),a=Math.min(255,Math.max(0,(r>>16)+t)),i=Math.min(255,Math.max(0,(r>>8&255)+t)),n=Math.min(255,Math.max(0,(255&r)+t));return`#${(a<<16|i<<8|n).toString(16).padStart(6,"0")}`}let nO="#4a4a4a",nE="#fbbf24",n$="#ef4444",nB="#fbbf24",nL="#22c55e",nV="#1f2937";function nW(e,t,r,a){if(r<0||a<0||r>=t||a>=t)return!1;let i=e[a][r],n=i.building.type;return"bridge"===n?"rail"!==i.building.bridgeTrackType:"road"===n}function nD(e,t,r,a){return{north:nW(e,t,r-1,a),east:nW(e,t,r,a-1),south:nW(e,t,r+1,a),west:nW(e,t,r,a+1)}}function nF(e){let t=e%7.6;return t<3?"green_ns":t<3.8?"yellow_ns":t<6.8?"green_ew":"yellow_ew"}function nJ(e,t){return"north"===e||"south"===e?"green_ns"===t||"yellow_ns"===t:"green_ew"===t||"yellow_ew"===t}function nU(e,t,r,a,i,n){if(n<.6)return;let l={nw:{x:5.12,y:16.128},ne:{x:32,y:3.072},sw:{x:32,y:35.328},se:{x:58.88,y:22.272}}[i],o=t+l.x,s=r+l.y,c=6*(n>.8?1:.8),d=1.5*(n>.8?1:.8);e.strokeStyle="#374151",e.lineWidth=.8,e.beginPath(),e.moveTo(o,s),e.lineTo(o,s-c),e.stroke();let h=2*d,u=4*d;e.fillStyle="#1f2937",e.fillRect(o-h/2,s-c-u,h,u);let f=!1,m=!1,g=!1;"nw"===i||"se"===i?"green_ns"===a?g=!0:"yellow_ns"===a?m=!0:f=!0:"green_ew"===a?g=!0:"yellow_ew"===a?m=!0:f=!0;let p=1.2*d,x=s-c-u+.8*d;e.fillStyle=f?n$:nV,e.beginPath(),e.arc(o,x,.6*d,0,2*Math.PI),e.fill(),f&&(e.shadowColor=n$,e.shadowBlur=2,e.fill(),e.shadowBlur=0),e.fillStyle=m?nB:nV,e.beginPath(),e.arc(o,x+p,.6*d,0,2*Math.PI),e.fill(),m&&(e.shadowColor=nB,e.shadowBlur=2,e.fill(),e.shadowBlur=0),e.fillStyle=g?nL:nV,e.beginPath(),e.arc(o,x+2*p,.6*d,0,2*Math.PI),e.fill(),g&&(e.shadowColor=nL,e.shadowBlur=2,e.fill(),e.shadowBlur=0)}let nH="#6a6a6a",nG="#404040",nq="#7a8088",nQ=["#1e40af","#dc2626","#059669","#7c3aed","#ea580c","#0891b2"],nZ=["#8B4513","#696969","#2F4F4F","#8B0000","#006400","#4682B4"],nK=["#C0C0C0","#1e40af","#059669","#7c3aed"];function n0(e){return+("north"!==e&&"east"!==e)}function n1(e,t,r,a){if(r<0||a<0||r>=t||a>=t)return!1;let i=e[a][r];return"rail"===i.building.type||"road"===i.building.type&&!0===i.hasRailOverlay||"bridge"===i.building.type&&"rail"===i.building.bridgeTrackType}function n2(e,t,r,a){if(r<0||a<0||r>=t||a>=t)return!1;let i=e[a][r];return"rail_station"===i.building.type||"empty"===i.building.type&&(!!(r>0)&&e[a][r-1]?.building.type==="rail_station"||!!(a>0)&&e[a-1][r]?.building.type==="rail_station"||!!(r>0)&&!!(a>0)&&e[a-1][r-1]?.building.type==="rail_station")||!1}function n5(e,t,r,a){if(r<0||a<0||r>=t||a>=t)return!1;let i=e[a][r];return"rail"===i.building.type||n2(e,t,r,a)||"road"===i.building.type&&!0===i.hasRailOverlay||"bridge"===i.building.type&&"rail"===i.building.bridgeTrackType}function n3(e,t,r,a){return{north:n5(e,t,r-1,a),east:n5(e,t,r,a-1),south:n5(e,t,r+1,a),west:n5(e,t,r,a+1)}}function n4(e){let{north:t,east:r,south:a,west:i}=e,n=[t,r,a,i].filter(Boolean).length;if(4===n)return"junction_cross";if(3===n){if(!t)return"junction_t_n";if(!r)return"junction_t_e";if(!a)return"junction_t_s";if(!i)return"junction_t_w"}if(t&&a&&!r&&!i)return"straight_ns";if(r&&i&&!t&&!a)return"straight_ew";if(t&&r&&!a&&!i)return"curve_ne";if(t&&i&&!a&&!r)return"curve_nw";if(a&&r&&!t&&!i)return"curve_se";if(a&&i&&!t&&!r)return"curve_sw";if(1===n){if(t)return"terminus_s";if(r)return"terminus_w";if(a)return"terminus_n";if(i)return"terminus_e"}return"single"}let n9={x:.894427,y:.447214},n6={x:-.894427,y:.447214},n8={x:-n6.x,y:-n6.y},n7={x:-n9.x,y:-n9.y};function le(e,t,r){return{x:e.x+t.x*r,y:e.y+t.y*r}}function lt(e,t,r,a,i){i<.6||(e.save(),e.translate(t,r),e.rotate({north:-(.75*Math.PI),east:-(.25*Math.PI),south:.25*Math.PI,west:.75*Math.PI}[a]),e.fillStyle="#dc2626",e.fillRect(-4,-1.25,2.5,2.5),e.fillStyle="#ffffff",e.fillRect(-3.375,-1.25,1.25,2.5),e.restore())}function lr(e,t,r,a){let i=(r,a)=>{if(r<0||a<0||r>=t||a>=t)return!1;let i=e[a][r];return"rail"===i.building.type||n2(e,t,r,a)||"road"===i.building.type&&!0===i.hasRailOverlay||"bridge"===i.building.type&&"rail"===i.building.bridgeTrackType};return{north:i(r-1,a),east:i(r,a-1),south:i(r+1,a),west:i(r,a+1)}}function la(e,t,r,a){return!(r<0)&&!(a<0)&&!(r>=t)&&!(a>=t)&&"road"===e[a][r].building.type}function li(e,t,r,a){if(r<0||a<0||r>=t||a>=t)return!1;let i=e[a][r];if("road"!==i.building.type||!i.hasRailOverlay)return!1;let n=function(e,t,r,a){if(!la(e,t,r,a))return"none";let i=la(e,t,r-1,a),n=la(e,t,r+1,a),l=la(e,t,r,a-1),o=la(e,t,r,a+1),s=i||n,c=l||o;return s&&c?"intersection":s?"ns":c?"ew":"none"}(e,t,r,a),l=lr(e,t,r,a),o=l.north||l.south,s=l.east||l.west;return"intersection"===n||!!o&&!!s||"ns"===n&&!!s&&!o||"ew"===n&&!!o&&!s}function ln(e,t){let r=[];for(let a=0;a<t;a++)for(let i=0;i<t;i++)li(e,t,i,a)&&r.push({x:i,y:a});return r}let ll="#1f2937",lo="#ef4444";function ls(e,t,r,a,i,n,l){if(l<.5)return;let o={nw:{x:7.68,y:18.432},ne:{x:33.28,y:.768},sw:{x:30.72,y:37.632},se:{x:56.32,y:19.968}}[a],s=t+o.x,c=r+o.y,d=(l>=.8?1:.85)*.7,h=14*d,u=2.5*d,f=5*d;e.strokeStyle="#374151",e.lineWidth=2*d,e.beginPath(),e.moveTo(s,c),e.lineTo(s,c-h),e.stroke();let m=c-h+4*d,g=Math.floor(i/.5)%2==0;e.fillStyle=n&&g?lo:ll,e.beginPath(),e.arc(s-.5*f,m,u,0,2*Math.PI),e.fill(),e.fillStyle=n&&!g?lo:ll,e.beginPath(),e.arc(s+.5*f,m,u,0,2*Math.PI),e.fill(),n&&l>=.7&&(e.save(),e.shadowColor=lo,e.shadowBlur=8*d,e.fillStyle=lo,g?(e.beginPath(),e.arc(s-.5*f,m,u,0,2*Math.PI)):(e.beginPath(),e.arc(s+.5*f,m,u,0,2*Math.PI)),e.fill(),e.restore())}function lc(e,t,r,a,i,n,l,o){if(n<.6)return;let s={nw:{x:9.6,y:19.2,dir:1,tilt:-30},ne:{x:35.2,y:1.92,dir:-1,tilt:-30},sw:{x:28.8,y:36.48,dir:1,tilt:30},se:{x:54.4,y:19.2,dir:-1,tilt:30}}[a],c=t+s.x,d=r+s.y,h=n>=.8?1:.85,u=18*h,f=1.1*h,m=(i+i/90*(o??s.tilt))*Math.PI/180,g=c+(l??s.dir)*Math.sin(m)*u,p=d-Math.cos(m)*u;e.save();let x=g-c,y=p-d,b=Math.sqrt(x*x+y*y),w=Math.atan2(y,x);e.translate(c,d),e.rotate(w),e.fillStyle="#fbbf24",e.fillRect(0,-f/2,b,f),e.fillStyle="#1f2937";let v=b/8;for(let t=0;t<4;t++)e.fillRect(v*(2*t+1),-f/2,.7*v,f);e.restore(),e.fillStyle="#4b5563",e.beginPath(),e.arc(c,d,.7*f,0,2*Math.PI),e.fill()}function ld(e,t,r,a){let i=[];return n5(e,t,r-1,a)&&i.push("north"),n5(e,t,r,a-1)&&i.push("east"),n5(e,t,r+1,a)&&i.push("south"),n5(e,t,r,a+1)&&i.push("west"),i}function lh(e,t){let r=0;for(let a=0;a<t;a++)for(let i=0;i<t;i++){let t=e[a][i];("rail"===t.building.type||"road"===t.building.type&&!0===t.hasRailOverlay||"bridge"===t.building.type&&"rail"===t.building.bridgeTrackType)&&r++}return r}function lu(e,t,r){let{isApproaching:a,isOccupied:i,distance:n}=function(e,t,r,a=3){let i=1/0,n=!1;for(let a of e){let e=Math.abs(a.tileX-t)+Math.abs(a.tileY-r);for(let e of(a.tileX===t&&a.tileY===r&&(n=!0,i=0),a.carriages))e.tileX===t&&e.tileY===r&&(n=!0,i=0);let l={north:{dx:-1,dy:0},east:{dx:0,dy:-1},south:{dx:1,dy:0},west:{dx:0,dy:1}}[a.direction],o=t-a.tileX,s=r-a.tileY;o*l.dx+s*l.dy>0&&(i=Math.min(i,Math.max(0,e-a.progress)))}return{isApproaching:i<=a,distance:i,isOccupied:n}}(e,t,r);return i||a&&n<=1?"closed":a?"warning":"open"}function lf(e,t,r){let a=lu(e,t,r);return"closed"===a||"warning"===a}let lm={armed_robbery:{name:"Armed Robbery",description:"Armed suspect threatening civilians. Weapon drawn.",severity:"critical",duration:45,weight:3},mugging:{name:"Mugging",description:"Victim being robbed on the street. Suspect fleeing.",severity:"high",duration:30,weight:5},assault:{name:"Assault",description:"Physical altercation in progress. Multiple individuals.",severity:"high",duration:25,weight:6},aggravated_assault:{name:"Aggravated Assault",description:"Violent attack with potential weapon. Victim injured.",severity:"critical",duration:40,weight:2},carjacking:{name:"Carjacking",description:"Armed suspect stealing vehicle from driver.",severity:"critical",duration:35,weight:2},kidnapping:{name:"Kidnapping",description:"Individual being forced into vehicle. Urgent response.",severity:"critical",duration:50,weight:1},hostage_situation:{name:"Hostage Situation",description:"Armed suspect holding hostages. Negotiator needed.",severity:"critical",duration:60,weight:.5},gang_violence:{name:"Gang Violence",description:"Rival groups in confrontation. Multiple suspects.",severity:"critical",duration:40,weight:2},shooting:{name:"Shots Fired",description:"Gunshots reported. Possible casualties.",severity:"critical",duration:45,weight:1},stabbing:{name:"Stabbing",description:"Knife attack reported. Medical response needed.",severity:"critical",duration:40,weight:1.5},burglary:{name:"Burglary",description:"Break-in detected. Suspect inside building.",severity:"high",duration:30,weight:8},home_invasion:{name:"Home Invasion",description:"Intruder in occupied residence. Residents in danger.",severity:"critical",duration:35,weight:3},commercial_burglary:{name:"Commercial Burglary",description:"Business break-in in progress. Alarm triggered.",severity:"high",duration:28,weight:6},car_theft:{name:"Car Theft",description:"Vehicle being stolen. Suspect breaking into car.",severity:"medium",duration:22,weight:10},bike_theft:{name:"Bike Theft",description:"Bicycle being stolen. Suspect cutting lock.",severity:"low",duration:15,weight:12},package_theft:{name:"Package Theft",description:"Porch pirate stealing delivered packages.",severity:"low",duration:12,weight:15},shoplifting:{name:"Shoplifting",description:"Theft in progress at retail store. Suspect fleeing.",severity:"low",duration:15,weight:20},smash_and_grab:{name:"Smash & Grab",description:"Window smashed. Multiple suspects grabbing merchandise.",severity:"high",duration:25,weight:4},warehouse_theft:{name:"Warehouse Theft",description:"Large-scale theft at industrial facility.",severity:"high",duration:35,weight:3},construction_theft:{name:"Construction Theft",description:"Equipment or materials being stolen from site.",severity:"medium",duration:25,weight:5},fraud:{name:"Fraud",description:"Suspected fraud scheme. Victim reporting financial loss.",severity:"medium",duration:30,weight:4},identity_theft:{name:"Identity Theft",description:"Personal information being used fraudulently.",severity:"medium",duration:30,weight:3},credit_card_fraud:{name:"Credit Card Fraud",description:"Unauthorized card transactions in progress.",severity:"medium",duration:25,weight:5},insurance_fraud:{name:"Insurance Fraud",description:"Staged accident or false claim detected.",severity:"medium",duration:35,weight:2},embezzlement:{name:"Embezzlement",description:"Employee caught stealing company funds.",severity:"high",duration:40,weight:1},counterfeiting:{name:"Counterfeiting",description:"Fake currency or goods being distributed.",severity:"high",duration:35,weight:2},disturbance:{name:"Public Disturbance",description:"Loud argument escalating. Crowd gathering.",severity:"low",duration:18,weight:25},public_intoxication:{name:"Public Intoxication",description:"Heavily intoxicated individual causing disruption.",severity:"low",duration:15,weight:18},disorderly_conduct:{name:"Disorderly Conduct",description:"Individual refusing to comply. Causing scene.",severity:"low",duration:18,weight:15},noise_complaint:{name:"Noise Complaint",description:"Excessive noise disturbing neighborhood.",severity:"low",duration:12,weight:20},loitering:{name:"Loitering",description:"Suspicious individuals hanging around property.",severity:"low",duration:10,weight:12},trespassing:{name:"Trespassing",description:"Unauthorized person on private property.",severity:"low",duration:15,weight:14},public_urination:{name:"Public Urination",description:"Indecent act in public area.",severity:"low",duration:8,weight:10},street_racing:{name:"Street Racing",description:"Vehicles racing at dangerous speeds.",severity:"high",duration:20,weight:4},illegal_dumping:{name:"Illegal Dumping",description:"Unauthorized waste being dumped.",severity:"low",duration:20,weight:6},drug_dealing:{name:"Drug Deal",description:"Suspected narcotics transaction in progress.",severity:"high",duration:20,weight:8},drug_possession:{name:"Drug Possession",description:"Individual with suspected controlled substances.",severity:"medium",duration:18,weight:10},illegal_dispensary:{name:"Illegal Dispensary",description:"Unlicensed drug operation discovered.",severity:"high",duration:35,weight:2},public_drug_use:{name:"Public Drug Use",description:"Individual using substances openly.",severity:"low",duration:15,weight:12},hit_and_run:{name:"Hit & Run",description:"Driver fled after collision. Possible injuries.",severity:"high",duration:25,weight:6},dui:{name:"DUI",description:"Suspected impaired driver. Erratic behavior.",severity:"high",duration:22,weight:7},reckless_driving:{name:"Reckless Driving",description:"Vehicle driving dangerously. Endangering others.",severity:"medium",duration:18,weight:10},traffic_violation:{name:"Traffic Violation",description:"Moving violation observed. Driver being cited.",severity:"low",duration:12,weight:25},parking_violation:{name:"Parking Violation",description:"Illegally parked vehicle blocking access.",severity:"low",duration:10,weight:20},illegal_street_vendor:{name:"Illegal Vendor",description:"Unlicensed vendor operating without permit.",severity:"low",duration:15,weight:8},vandalism:{name:"Vandalism",description:"Property being damaged or destroyed.",severity:"medium",duration:18,weight:12},graffiti:{name:"Graffiti",description:"Individual spray painting building or surface.",severity:"low",duration:15,weight:15},arson_attempt:{name:"Attempted Arson",description:"Individual attempting to start fire. Urgent.",severity:"critical",duration:30,weight:2},property_damage:{name:"Property Damage",description:"Intentional destruction of property in progress.",severity:"medium",duration:20,weight:8},broken_windows:{name:"Broken Windows",description:"Windows being smashed. Possible burglary.",severity:"medium",duration:18,weight:10},suspicious_activity:{name:"Suspicious Activity",description:"Unknown individual acting strangely near building.",severity:"low",duration:15,weight:18},prowler:{name:"Prowler",description:"Individual lurking around property at night.",severity:"medium",duration:18,weight:8},stalking:{name:"Stalking",description:"Person being followed by unknown individual.",severity:"high",duration:25,weight:3},domestic_disturbance:{name:"Domestic Disturbance",description:"Heated argument at residence. Possible violence.",severity:"high",duration:25,weight:10},animal_cruelty:{name:"Animal Cruelty",description:"Animal being mistreated or endangered.",severity:"medium",duration:20,weight:3},illegal_gambling:{name:"Illegal Gambling",description:"Unlicensed gambling operation discovered.",severity:"medium",duration:30,weight:2},prostitution:{name:"Prostitution",description:"Illegal activity reported in area.",severity:"medium",duration:20,weight:4},solicitation:{name:"Solicitation",description:"Aggressive soliciting of passersby.",severity:"low",duration:12,weight:8}},lg=Object.keys(lm),lp={structural:{name:"Structure Fire",description:"Flames spreading through building. Multiple floors at risk. Evacuate immediately.",severity:"major"},electrical:{name:"Electrical Fire",description:"Electrical system overload. Smoke billowing from outlets. Power lines sparking.",severity:"moderate"},kitchen:{name:"Kitchen Fire",description:"Cooking fire out of control. Grease flames spreading rapidly. Ventilation compromised.",severity:"moderate"},industrial:{name:"Industrial Fire",description:"Factory blaze with heavy smoke. Hazardous materials may be involved. Wide perimeter needed.",severity:"catastrophic"},chemical:{name:"Chemical Fire",description:"Toxic chemical combustion. Dangerous fumes spreading. Specialized response required.",severity:"catastrophic"},vehicle:{name:"Vehicle Fire",description:"Car engulfed in flames. Risk of fuel tank explosion. Keep clear.",severity:"minor"},brush:{name:"Brush Fire",description:"Vegetation fire spreading with wind. Nearby structures threatened.",severity:"moderate"},explosion:{name:"Explosion",description:"Building rocked by blast. Structural integrity compromised. Possible casualties.",severity:"catastrophic"},gas_leak:{name:"Gas Fire",description:"Natural gas ignited. Continuous flame from leak. Shut-off valve needed.",severity:"major"},arson:{name:"Arson Fire",description:"Deliberately set fire detected. Accelerant used. Fire spreading rapidly.",severity:"major"}},lx=Object.keys(lp);function ly(e){return{x:e.x,y:e.y}}function lb(e,t){return e+t.policeCoverage}function lw(e){return"shop_small"===e.buildingType||"shop_medium"===e.buildingType||"mall"===e.buildingType}function lv(e){return"shop_small"===e.buildingType||"shop_medium"===e.buildingType||"mall"===e.buildingType}function l_(e){return nc.includes(e.buildingType)||nh.includes(e.buildingType)}function lM(e){return"commercial"===e.type}let lS=new Set(["park_large","baseball_field_small","football_field","mini_golf_course","go_kart_track","amphitheater","greenhouse_garden","marina_docks_small","roller_coaster_small","mountain_lodge","playground_large","mountain_trailhead"]),lk=new Set(["park","park_large","tennis","basketball_courts","playground_small","playground_large","baseball_field_small","soccer_field_small","football_field","skate_park","mini_golf_course","bleachers_field","go_kart_track","amphitheater","greenhouse_garden","animal_pens_farm","cabin_house","campground","marina_docks_small","pier_large","roller_coaster_small","community_garden","pond_park","park_gate","mountain_lodge","mountain_trailhead"]),lj={small:[{asphalt:nO,barrier:"#707070",accent:"#606060",support:"#404040"},{asphalt:"#454545",barrier:"#606060",accent:"#555555",support:"#353535"},{asphalt:"#3d3d3d",barrier:"#585858",accent:"#484848",support:"#303030"}],medium:[{asphalt:nO,barrier:"#808080",accent:"#707070",support:"#505050"},{asphalt:"#454545",barrier:"#707070",accent:"#606060",support:"#454545"},{asphalt:"#3d3d3d",barrier:"#656565",accent:"#555555",support:"#404040"}],large:[{asphalt:"#3d3d3d",barrier:"#4682B4",accent:"#5a8a8a",support:"#3a5a5a"},{asphalt:nO,barrier:"#708090",accent:"#607080",support:"#405060"}],suspension:[{asphalt:"#3d3d3d",barrier:"#707070",accent:"#606060",support:"#909090",cable:"#DC143C"},{asphalt:"#3d3d3d",barrier:"#606060",accent:"#555555",support:"#808080",cable:"#708090"},{asphalt:"#3d3d3d",barrier:"#656560",accent:"#555550",support:"#858580",cable:"#5a7a5a"}]};function lP(e,t,r,a,i){let n,l;if("suspension"!==a.bridgeType||i<.5)return;let o=a.bridgeOrientation||"ns",s=a.bridgeVariant||0,c=a.bridgePosition||"middle",d=a.bridgeIndex??0,h=a.bridgeSpan??1,u=r+3.84*("rail"===(a.bridgeTrackType||"road")),f=t+32,m=u+19.2;"ns"===o?(n={x:t+16,y:u+9.6},l={x:t+48,y:u+28.799999999999997}):(n={x:t+48,y:u+9.6},l={x:t+16,y:u+28.799999999999997});let g=l.x-n.x,p=l.y-n.y,x=Math.hypot(g,p),y=-p/x,b=g/x,w=f+28.8*y,v=m+28.8*b,_=f-28.8*y,M=m-28.8*b,S=v<M?{x:_,y:M}:{x:w,y:v},k=Math.floor((h-1)/2),j=void 0!==a.bridgeSpan&&a.bridgeSpan>1,P="middle"===c&&(j&&h>6&&d===k||!j&&(t/64+u/38.4)%5==2);if("start"!==c&&"end"!==c&&!P)return;let T=s%3,C=["#909090","#808080","#858580"][T],N=["#606060","#555555","#555550"][T];e.fillStyle=C,e.fillRect((v<M?{x:w,y:v}:{x:_,y:M}).x-1.5,m-22+-5-4,3,22),e.fillStyle=N,e.fillRect(S.x-2.5,m-27+8+35-6,5,6),e.fillStyle=C,e.fillRect(S.x-1.5,m-27+8,3,29)}let lT={x:.894427,y:.447214},lC={x:-.894427,y:.447214},lN=5,lz=8,lI=6,lR=10;function lY(e){let t=ia[e.direction];return{x:e.tileX+t.step.x*e.progress,y:e.tileY+t.step.y*e.progress}}function lX(e,t,r,a,i){let n=ld(t,r,a,i);if(0===n.length)return null;let l=n4(n3(t,r,a,i)),o=ii[e],s=n.filter(e=>e!==o);if(0===s.length)return o;switch(l){case"straight_ns":case"straight_ew":case"junction_t_n":case"junction_t_e":case"junction_t_s":case"junction_t_w":case"junction_cross":if(s.includes(e))return e;return s[0];case"curve_ne":case"curve_nw":case"curve_se":case"curve_sw":return s[0];case"terminus_n":case"terminus_e":case"terminus_s":case"terminus_w":return o;default:return s[0]||o}}function lA(e,t,r){let a=t*r;e.smokeParticles=e.smokeParticles.filter(e=>(e.age+=a,!(e.age>=e.maxAge)&&(e.x+=e.vx*a,e.y+=e.vy*a,e.vx*=.98,e.vy*=.995,e.size+=.8*a,!0)))}function lO(e){let t=1e4*Math.sin(e);return t-Math.floor(t)}function lE(e,t){let r=e.replace("#",""),a=Math.max(0,parseInt(r.substr(0,2),16)*(1-t)),i=Math.max(0,parseInt(r.substr(2,2),16)*(1-t)),n=Math.max(0,parseInt(r.substr(4,2),16)*(1-t));return`rgb(${Math.round(a)}, ${Math.round(i)}, ${Math.round(n)})`}function l$(e,t){let r=43758.5453*Math.sin(e+12.9898*t);return r-Math.floor(r)}let lB="isocity-native-bridge-dispatch";function lL(e){return"number"==typeof e&&Number.isFinite(e)?e:void 0}function lV(){let[e]=(0,l.useState)(lW);return e}function lW(){let e;return{host:"ios"===(e=new URLSearchParams(window.location.search)).get("host")?"ios":"web",gestureMode:"native"===e.get("gesture")?"native":"web"}}function lD(){window.bridge&&"function"==typeof window.bridge.dispatch||(window.bridge={dispatch:e=>{window.dispatchEvent(new CustomEvent(lB,{detail:e}))}})}function lF(e){lD();let t={type:e.type,payload:e.payload??null};try{window.webkit?.messageHandlers?.bridge?.postMessage(t)}catch{}}function lJ(e){let t,r,a,o,s,c,d,h,u,m,g,p,x,y,b,w,v,_,M,S,P,T,C,N,z,I,R,Y,X,A,O,E,L,V,W,D,F,J,U,H,G,Q,Z,K,ee,et,er,ei,en,el,eo,es,ec,ed,eh,eu,ef,em,eg,ep,e_,eM,eS,ek,ej,eP,eT,eC,eN,ez,eI,eR,eY,eX,eA,eO,eE,e$,eB,eV,eW,eD,eF,eJ,eU,eH,eG,eq,eQ,eZ,eK,e0,e1,e2,e5,e3,e4,e9,e6,e8,e7,te,tt,tr,ta,ti,tn,tl,to,ts,tc,td,tu,tf,tm,tg,tp,tx,ty,tw,tv,t_,tM,tS,tk,tj,tP,tT,tC,tN,tz,tI,tR=(0,n.c)(462),{overlayMode:tY,selectedTile:tX,setSelectedTile:tA,isMobile:tO,navigationTarget:tE,onNavigationComplete:t$,onViewportChange:tL,onBargeDelivery:tV}=e,tF=void 0!==tO&&tO,{state:tH,latestStateRef:tG,placeAtTile:tq,finishTrackDrag:tQ,connectToCity:tZ,checkAndDiscoverCities:tK,currentSpritePack:t0,visualHour:t1}=eL(),{grid:t2,gridSize:t5,selectedTool:t3,speed:t4,adjacentCities:t9,waterBodies:t6,gameVersion:t8}=tH,t7=lV(),re="ios"===t7.host&&"native"===t7.gestureMode,rt=(0,k.useMessages)(),rr=(0,k.useGT)(),ra=(0,l.useRef)(null),ri=(0,l.useRef)(null),rn=(0,l.useRef)(null),rl=(0,l.useRef)(null),ro=(0,l.useRef)(null),rs=(0,l.useRef)(null),rc=(0,l.useRef)(null),rd=(0,l.useRef)(null),rh=(0,l.useRef)(0),ru=tF?200:620,rf=tF?100:160;tR[0]!==ru||tR[1]!==rf?(t={x:ru,y:rf},tR[0]=ru,tR[1]=rf,tR[2]=t):t=tR[2];let[rm,rg]=(0,l.useState)(t),[rp,rx]=(0,l.useState)(!1),[ry,rb]=(0,l.useState)(!1),[rw,rv]=(0,l.useState)(!1),r_=(0,l.useRef)(!1),rM=(0,l.useRef)(!1),rS=(0,l.useRef)(!1),rk=(0,l.useRef)(null),rj=(0,l.useRef)(tF?.6:1);tR[3]===Symbol.for("react.memo_cache_sentinel")?(r={x:0,y:0},tR[3]=r):r=tR[3];let[rP,rT]=(0,l.useState)(r),rC=(0,l.useRef)(null),[rN,rz]=(0,l.useState)(null),[rI,rR]=(0,l.useState)(null),[rY,rX]=(0,l.useState)(tF?.6:1),rA=tF?200:620,rO=tF?100:160,rE=tF?.6:1;tR[4]!==rA||tR[5]!==rO||tR[6]!==rE?(a={offsetX:rA,offsetY:rO,zoom:rE},tR[4]=rA,tR[5]=rO,tR[6]=rE,tR[7]=a):a=tR[7];let r$=(0,l.useRef)(a);tR[8]===Symbol.for("react.memo_cache_sentinel")?(o=[],tR[8]=o):o=tR[8];let rB=(0,l.useRef)(o),rH=(0,l.useRef)(0),rG=(0,l.useRef)(0);tR[9]===Symbol.for("react.memo_cache_sentinel")?(s=[],tR[9]=s):s=tR[9];let rq=(0,l.useRef)(s),rQ=(0,l.useRef)(0),rZ=(0,l.useRef)(0);tR[10]===Symbol.for("react.memo_cache_sentinel")?(c=[],tR[10]=c):c=tR[10];let rK=(0,l.useRef)(c),r0=(0,l.useRef)(0),r1=(0,l.useRef)(0);tR[11]===Symbol.for("react.memo_cache_sentinel")?(d=new Set,tR[11]=d):d=tR[11];let r2=(0,l.useRef)(d);tR[12]===Symbol.for("react.memo_cache_sentinel")?(h=new Set,tR[12]=h):h=tR[12];let r5=(0,l.useRef)(h);tR[13]===Symbol.for("react.memo_cache_sentinel")?(u=new Map,tR[13]=u):u=tR[13];let r3=(0,l.useRef)(u),r4=(0,l.useRef)(0);tR[14]===Symbol.for("react.memo_cache_sentinel")?(m=[],tR[14]=m):m=tR[14];let r9=(0,l.useRef)(m),r6=(0,l.useRef)(0),r8=(0,l.useRef)(0),r7=(0,l.useRef)(null),ae=(0,l.useRef)(null),at=(0,l.useRef)(rY),ar=(0,l.useRef)(null);tR[15]===Symbol.for("react.memo_cache_sentinel")?(g=[],tR[15]=g):g=tR[15];let aa=(0,l.useRef)(g),ai=(0,l.useRef)(0),an=(0,l.useRef)(0);tR[16]===Symbol.for("react.memo_cache_sentinel")?(p=[],tR[16]=p):p=tR[16];let al=(0,l.useRef)(p),ao=(0,l.useRef)(0),as=(0,l.useRef)(0);tR[17]===Symbol.for("react.memo_cache_sentinel")?(x=[],tR[17]=x):x=tR[17];let ac=(0,l.useRef)(x),ad=(0,l.useRef)(0),ah=(0,l.useRef)(0);tR[18]===Symbol.for("react.memo_cache_sentinel")?(y=[],tR[18]=y):y=tR[18];let au=(0,l.useRef)(y),af=(0,l.useRef)(0),am=(0,l.useRef)(0);tR[19]===Symbol.for("react.memo_cache_sentinel")?(b=[],tR[19]=b):b=tR[19];let ag=(0,l.useRef)(b),ap=(0,l.useRef)(0),ax=(0,l.useRef)(0);tR[20]===Symbol.for("react.memo_cache_sentinel")?(w=[],tR[20]=w):w=tR[20];let ay=(0,l.useRef)(w),ab=(0,l.useRef)(0),aw=(0,l.useRef)(0),av=(0,l.useRef)(0),a_=(0,l.useRef)(0);tR[21]===Symbol.for("react.memo_cache_sentinel")?(v=new Map,tR[21]=v):v=tR[21];let aM=(0,l.useRef)(v);tR[22]===Symbol.for("react.memo_cache_sentinel")?(_=[],tR[22]=_):_=tR[22];let aS=(0,l.useRef)(_);tR[23]===Symbol.for("react.memo_cache_sentinel")?(M=[],tR[23]=M):M=tR[23];let ak=(0,l.useRef)(M),aj=(0,l.useRef)(0),aP=(0,l.useRef)(0),aT=(0,l.useRef)(!1),aC=(0,l.useRef)(0),aN=(0,l.useRef)(-1);tR[24]===Symbol.for("react.memo_cache_sentinel")?(S=[],tR[24]=S):S=tR[24];let aI=(0,l.useRef)(S),aR=(0,l.useRef)(-1);tR[25]===Symbol.for("react.memo_cache_sentinel")?(P=[],tR[25]=P):P=tR[25];let aY=(0,l.useRef)(P),aX=(0,l.useRef)(0),aA=(0,l.useRef)(0),aO=(0,l.useRef)(0);tR[26]===Symbol.for("react.memo_cache_sentinel")?(T={count:0,gridVersion:-1},tR[26]=T):T=tR[26];let aE=(0,l.useRef)(T);tR[27]===Symbol.for("react.memo_cache_sentinel")?(C={count:0,gridVersion:-1},tR[27]=C):C=tR[27];let a$=(0,l.useRef)(C);tR[28]===Symbol.for("react.memo_cache_sentinel")?(N={map:new Map,gridVersion:-1},tR[28]=N):N=tR[28];let aB=(0,l.useRef)(N),aL=(0,l.useRef)(0);tR[29]===Symbol.for("react.memo_cache_sentinel")?(z=new Map,tR[29]=z):z=tR[29];let aV=(0,l.useRef)(z),aW=(0,l.useRef)(-1);tR[30]===Symbol.for("react.memo_cache_sentinel")?(I={gradient:null,height:0},tR[30]=I):I=tR[30];let aD=(0,l.useRef)(I);tR[31]===Symbol.for("react.memo_cache_sentinel")?(R=[],tR[31]=R):R=tR[31],tR[32]===Symbol.for("react.memo_cache_sentinel")?(Y=[],tR[32]=Y):Y=tR[32],tR[33]===Symbol.for("react.memo_cache_sentinel")?(X=[],tR[33]=X):X=tR[33],tR[34]===Symbol.for("react.memo_cache_sentinel")?(A=[],tR[34]=A):A=tR[34],tR[35]===Symbol.for("react.memo_cache_sentinel")?(O=[],tR[35]=O):O=tR[35],tR[36]===Symbol.for("react.memo_cache_sentinel")?(E=[],tR[36]=E):E=tR[36],tR[37]===Symbol.for("react.memo_cache_sentinel")?(L=[],tR[37]=L):L=tR[37],tR[38]===Symbol.for("react.memo_cache_sentinel")?(V=[],tR[38]=V):V=tR[38],tR[39]===Symbol.for("react.memo_cache_sentinel")?(W=[],tR[39]=W):W=tR[39],tR[40]===Symbol.for("react.memo_cache_sentinel")?(D={buildingQueue:R,waterQueue:Y,roadQueue:X,bridgeQueue:A,railQueue:O,beachQueue:E,baseTileQueue:L,greenBaseTileQueue:V,overlayQueue:W},tR[40]=D):D=tR[40];let aU=(0,l.useRef)(D);tR[41]===Symbol.for("react.memo_cache_sentinel")?(F={width:1200,height:800},tR[41]=F):F=tR[41],tR[42]!==t2||tR[43]!==t5||tR[44]!==rm||tR[45]!==t4||tR[46]!==rY?(J={grid:t2,gridSize:t5,offset:rm,zoom:rY,speed:t4,canvasSize:F},tR[42]=t2,tR[43]=t5,tR[44]=rm,tR[45]=t4,tR[46]=rY,tR[47]=J):J=tR[47];let aH=(0,l.useRef)(J),[aG,aq]=(0,l.useState)(null);tR[48]===Symbol.for("react.memo_cache_sentinel")?(U=new Set,tR[48]=U):U=tR[48];let aQ=(0,l.useRef)(U),[aK]=(0,l.useState)(!0),[a1,a2]=(0,l.useState)(0);tR[49]===Symbol.for("react.memo_cache_sentinel")?(H={width:1200,height:800},tR[49]=H):H=tR[49];let[a5,ir]=(0,l.useState)(H),[ix,iy]=(0,l.useState)(null),[ib,iw]=(0,l.useState)(null),[iv,iS]=(0,l.useState)(null);tR[50]===Symbol.for("react.memo_cache_sentinel")?(G=new Set,tR[50]=G):G=tR[50];let ik=(0,l.useRef)(G);tR[51]===Symbol.for("react.memo_cache_sentinel")?(Q=["zone_residential","zone_commercial","zone_industrial","zone_dezone"],tR[51]=Q):Q=tR[51];let ij=Q.includes(t3),iP="select"!==t3,{findBuildingOrigin:iT,getTileMetadata:iC}=function(e,t){let r,a,i,l,o,s,c=(0,n.c)(21);if(c[0]!==e||c[1]!==t){r=new Map;let a=(r,a)=>!(r<0)&&!(a<0)&&!(r>=t)&&!(a>=t)&&"water"===e[a][r].building.type,i=new Map,n=new Map;for(let r=0;r<t;r++)for(let a=0;a<t;a++){let l=r*t+a,o=!1;for(let i=0;i<4&&!o;i++)for(let n=0;n<4&&!o;n++){let l=a-n,s=r-i;if(l>=0&&l<t&&s>=0&&s<t){let t=ea(e[s][l].building.type);(t.width>1||t.height>1)&&a>=l&&a<l+t.width&&r>=s&&r<s+t.height&&(o=!0)}}i.set(l,o);let s=!1;for(let i=0;i<4&&!s;i++)for(let n=0;n<4&&!s;n++){let l=a-n,o=r-i;if(l>=0&&l<t&&o>=0&&o<t){let t=e[o][l];if(lS.has(t.building.type)){let e=ea(t.building.type);a>=l&&a<l+e.width&&r>=o&&r<o+e.height&&(s=!0)}}}n.set(l,s)}let l=(r,a)=>{if(r<0||a<0||r>=t||a>=t)return!1;let i=e[a][r].building.type;return"road"===i||"bridge"===i};for(let o=0;o<t;o++)for(let s=0;s<t;s++){let c=o*t+s,d=e[o][s].building.type,h={north:a(s-1,o),east:a(s,o-1),south:a(s+1,o),west:a(s,o+1)},u=h.north||h.east||h.south||h.west||a(s-1,o-1)||a(s+1,o-1)||a(s-1,o+1)||a(s+1,o+1),f=i.get(c)||!1,m=n.get(c)||!1,g=lk.has(d)||"empty"===d&&m,p=!g&&"grass"!==d&&"empty"!==d&&"water"!==d&&"road"!==d&&"bridge"!==d&&"rail"!==d&&"tree"!==d,x="empty"===d&&f,y=(p||x)&&!g,b=("grass"===d||"empty"===d||"tree"===d)&&u,w="park"===d||"park_large"===d||"empty"===d&&m,v=!1,_=!1;if(p){let e=ea(d),t=e.width,r=e.height,a=!1,i=!1;for(let e=0;e<t&&!a;e++)l(s+e,o+r)&&(a=!0);if(!a)for(let e=0;e<r&&!a;e++)l(s+t,o+e)&&(a=!0);if(!a)for(let e=0;e<t&&!i;e++)l(s+e,o-1)&&(i=!0);if(!a&&!i)for(let e=0;e<r&&!i;e++)l(s-1,o+e)&&(i=!0);v=a||i,_=i&&!a}let M=!1,S=0;("road"===d||"bridge"===d)&&(l(s-1,o)&&S++,l(s+1,o)&&S++,l(s,o-1)&&S++,l(s,o+1)&&S++,M=S>=3),r.set(c,{isPartOfMultiTileBuilding:f,isPartOfParkBuilding:m,isAdjacentToWater:u,adjacentWaterDirs:h,needsGreyBase:y,needsGreenBaseOverWater:b,needsGreenBaseForPark:w,shouldFlipForRoad:_,hasAdjacentRoad:v,isIntersection:M,roadConnectionCount:S})}c[0]=e,c[1]=t,c[2]=r}else r=c[2];let d=r;c[3]!==t||c[4]!==d?(a=(e,r)=>d.get(r*t+e)?.isPartOfMultiTileBuilding??!1,c[3]=t,c[4]=d,c[5]=a):a=c[5];let h=a;c[6]!==t||c[7]!==d?(i=(e,r)=>d.get(r*t+e)?.isPartOfParkBuilding??!1,c[6]=t,c[7]=d,c[8]=i):i=c[8];let u=i;c[9]!==t||c[10]!==d?(l=(e,r)=>d.get(r*t+e)??null,c[9]=t,c[10]=d,c[11]=l):l=c[11];let f=l;c[12]!==e||c[13]!==t?(o=(r,a)=>{let i=e[a]?.[r];if(!i)return null;if("empty"!==i.building.type&&"grass"!==i.building.type&&"water"!==i.building.type&&"road"!==i.building.type&&"rail"!==i.building.type&&"tree"!==i.building.type){let e=ea(i.building.type);return e.width>1||e.height>1?{originX:r,originY:a,buildingType:i.building.type}:null}if("empty"===i.building.type)for(let i=0;i<4;i++)for(let n=0;n<4;n++){let l=r-n,o=a-i;if(l>=0&&l<t&&o>=0&&o<t){let t=e[o][l];if("empty"!==t.building.type&&"grass"!==t.building.type&&"water"!==t.building.type&&"road"!==t.building.type&&"tree"!==t.building.type){let e=ea(t.building.type);if((e.width>1||e.height>1)&&r>=l&&r<l+e.width&&a>=o&&a<o+e.height)return{originX:l,originY:o,buildingType:t.building.type}}}}return null},c[12]=e,c[13]=t,c[14]=o):o=c[14];let m=o;return c[15]!==m||c[16]!==f||c[17]!==h||c[18]!==u||c[19]!==d?(s={isPartOfMultiTileBuilding:h,findBuildingOrigin:m,isPartOfParkBuilding:u,getTileMetadata:f,tileMetadataMap:d},c[15]=m,c[16]=f,c[17]=h,c[18]=u,c[19]=d,c[20]=s):s=c[20],s}(t2,t5);tR[52]===Symbol.for("react.memo_cache_sentinel")?(Z={carsRef:rB,carIdRef:rH,carSpawnTimerRef:rG,busesRef:rq,busIdRef:rQ,busSpawnTimerRef:rZ,emergencyVehiclesRef:rK,emergencyVehicleIdRef:r0,emergencyDispatchTimerRef:r1,activeFiresRef:r2,activeCrimesRef:r5,activeCrimeIncidentsRef:r3,crimeSpawnTimerRef:r4,pedestriansRef:r9,pedestrianIdRef:r6,pedestrianSpawnTimerRef:r8,trafficLightTimerRef:aO,trainsRef:ay},tR[52]=Z):Z=tR[52];let iE=Z;tR[53]!==tH.services||tR[54]!==tH.stats?(K={services:tH.services,stats:tH.stats},tR[53]=tH.services,tR[54]=tH.stats,tR[55]=K):K=tR[55],tR[56]!==tF||tR[57]!==K?(ee={worldStateRef:aH,gridVersionRef:aL,cachedRoadTileCountRef:aE,cachedIntersectionMapRef:aB,state:K,isMobile:tF},tR[56]=tF,tR[57]=K,tR[58]=ee):ee=tR[58];let{spawnCrimeIncidents:iJ,updateCrimeIncidents:iq,updateEmergencyVehicles:iQ,updateCars:iZ,updateBuses:i0,updatePedestrians:i1,drawCars:i9,drawBuses:i6,drawPedestrians:ny,drawRecreationPedestrians:nb,drawEmergencyVehicles:nw,drawIncidentIndicators:nv}=function(e,t){let r,a,i,o,s,c,d,h,u,f,m,g,p,x,y,b,w,v,_,M,S,k,j,P,T,C,N,z,I,R,Y=(0,n.c)(148),{carsRef:X,carIdRef:A,carSpawnTimerRef:O,busesRef:E,busIdRef:$,busSpawnTimerRef:B,emergencyVehiclesRef:L,emergencyVehicleIdRef:V,emergencyDispatchTimerRef:W,activeFiresRef:D,activeCrimesRef:F,activeCrimeIncidentsRef:J,crimeSpawnTimerRef:U,pedestriansRef:H,pedestrianIdRef:G,pedestrianSpawnTimerRef:q,trafficLightTimerRef:Q,trainsRef:Z}=e,{worldStateRef:K,gridVersionRef:ee,cachedRoadTileCountRef:et,cachedIntersectionMapRef:er,state:ea,isMobile:ei}=t;Y[0]!==A||Y[1]!==X||Y[2]!==ei||Y[3]!==K?(r=()=>{let{grid:e,gridSize:t}=K.current;if(!e||t<=0)return!1;for(let r=0;r<20;r++){let r=Math.floor(Math.random()*t),a=Math.floor(Math.random()*t);if(!i_(e,t,r,a))continue;let i=iM(e,t,r,a);if(0===i.length)continue;let n=i[Math.floor(Math.random()*i.length)],l=4+2*Math.random(),o="north"===n||"east"===n?1:-1,s=ei?25+15*Math.random():45+30*Math.random();return A.current=A.current+1,X.current.push({id:A.current,tileX:r,tileY:a,direction:n,progress:.8*Math.random(),speed:(.35+.35*Math.random())*.7,age:0,maxAge:s,color:aF[Math.floor(Math.random()*aF.length)],laneOffset:o*l}),!0}return!1},Y[0]=A,Y[1]=X,Y[2]=ei,Y[3]=K,Y[4]=r):r=Y[4];let en=r;Y[5]!==K?(a=()=>{let{grid:e,gridSize:t}=K.current;if(!e||t<=0)return[];let r=[];for(let a=0;a<t;a++)for(let i=0;i<t;i++)na.has(e[a][i].building.type)&&r.push({x:i,y:a});return r},Y[5]=K,Y[6]=a):a=Y[6];let el=a;Y[7]!==K?(i=()=>{let{grid:e,gridSize:t}=K.current;if(!e||t<=0)return[];let r=[];for(let a=0;a<t;a++)for(let i=0;i<t;i++){let t=e[a][i].building.type;ni.has(t)?r.push({x:i,y:a,type:"school"}):nn.has(t)?r.push({x:i,y:a,type:"commercial"}):nl.has(t)?r.push({x:i,y:a,type:"industrial"}):ns.has(t)&&r.push({x:i,y:a,type:"park"})}return r},Y[7]=K,Y[8]=i):i=Y[8];let eo=i;Y[9]!==K?(o=()=>{let{grid:e,gridSize:t}=K.current;if(!e||t<=0)return[];let r=[];for(let a=0;a<t;a++)for(let i=0;i<t;i++)no.has(e[a][i].building.type)&&r.push({x:i,y:a});return r},Y[9]=K,Y[10]=o):o=Y[10];let es=o;Y[11]!==es||Y[12]!==K?(s=()=>{let{grid:e,gridSize:t}=K.current;if(!e||t<=0)return null;let r=es();if(r.length<2)return null;for(let a=0;a<10;a++){let a=r[Math.floor(Math.random()*r.length)],i=r[Math.floor(Math.random()*r.length)];a.x===i.x&&a.y===i.y&&(i=r[(r.indexOf(a)+1)%r.length]);let n=iz(e,t,a.x,a.y,i.x,i.y);if(n&&n.length>0)return{path:n,stops:[a,i]}}return null},Y[11]=es,Y[12]=K,Y[13]=s):s=Y[13];let ec=s;Y[14]!==es||Y[15]!==K?(c=e=>{let{grid:t,gridSize:r}=K.current;if(!t||r<=0)return null;let a=es();if(a.length<2)return null;for(let i=0;i<10;i++){let i=a[Math.floor(Math.random()*a.length)];if(i.x===e.x&&i.y===e.y)continue;let n=iz(t,r,e.x,e.y,i.x,i.y);if(n&&n.length>0)return{path:n,stops:[e,i]}}return null},Y[14]=es,Y[15]=K,Y[16]=c):c=Y[16];let ed=c;Y[17]!==ec||Y[18]!==$||Y[19]!==E||Y[20]!==K?(d=()=>{let{grid:e,gridSize:t}=K.current;if(!e||t<=0)return!1;let r=ec();if(!r)return!1;let a=r.path[0],i="south";if(r.path.length>1){let e=r.path[1],t=iI(a.x,a.y,e.x,e.y);t&&(i=t)}else{let r=iM(e,t,a.x,a.y);r.length>0&&(i=r[Math.floor(Math.random()*r.length)])}let n=6+2.5*Math.random(),l="north"===i||"east"===i?1:-1;return $.current=$.current+1,E.current.push({id:$.current,tileX:a.x,tileY:a.y,direction:i,progress:0,speed:.3+.15000000000000002*Math.random(),age:0,maxAge:160+120*Math.random(),color:aJ[Math.floor(Math.random()*aJ.length)],laneOffset:l*n,path:r.path,pathIndex:0,stopTimer:0,stops:r.stops}),!0},Y[17]=ec,Y[18]=$,Y[19]=E,Y[20]=K,Y[21]=d):d=Y[21];let eh=d;Y[22]!==K?(h=()=>{let{grid:e,gridSize:t}=K.current;if(!e||t<=0)return[];let r=[];for(let a=0;a<t;a++)for(let i=0;i<t;i++){let t=e[a][i].building.type;nc.includes(t)?r.push({x:i,y:a,type:"sports",buildingType:t}):nd.includes(t)?r.push({x:i,y:a,type:"relaxation",buildingType:t}):nh.includes(t)?r.push({x:i,y:a,type:"active",buildingType:t}):ns.has(t)&&r.push({x:i,y:a,type:"general",buildingType:t})}return r},Y[22]=K,Y[23]=h):h=Y[23];let eu=h;Y[24]!==K?(u=()=>{let{grid:e,gridSize:t}=K.current;return function(e,t){if(!e||t<=0)return[];let r=[];for(let a=0;a<t;a++)for(let i=0;i<t;i++){let t=e[a][i],n=t.building.type;nu.includes(n)&&t.building.constructionProgress>=100&&!t.building.abandoned&&r.push({x:i,y:a,buildingType:n})}return r}(e,t)},Y[24]=K,Y[25]=u):u=Y[25];let ef=u;Y[26]!==K?(f=()=>{let{grid:e,gridSize:t}=K.current;return function(e,t){let r=[],a=["marina_docks_small","pier_large"];for(let i=0;i<t;i++)for(let n=0;n<t;n++){let l=e[i]?.[n];if(l&&"water"===l.building.type)for(let l of[{dx:-1,dy:0,edge:"north"},{dx:0,dy:-1,edge:"east"},{dx:1,dy:0,edge:"south"},{dx:0,dy:1,edge:"west"}]){let o=n+l.dx,s=i+l.dy;if(o<0||o>=t||s<0||s>=t)continue;let c=e[s]?.[o];c&&("water"===c.building.type||a.includes(c.building.type)||r.push({waterX:n,waterY:i,landX:o,landY:s,edge:l.edge}))}}return r}(e,t)},Y[26]=K,Y[27]=f):f=Y[27];let em=f;Y[28]!==em||Y[29]!==ef||Y[30]!==eo||Y[31]!==eu||Y[32]!==el||Y[33]!==G||Y[34]!==H||Y[35]!==K?(m=()=>{let{grid:e,gridSize:t}=K.current;if(!e||t<=0)return!1;let r=el();if(0===r.length)return!1;let a=eo();if(0===a.length)return!1;let i=Math.random();if(i<.1){let a=em();if(a.length>0){let i=0===a.length?null:a[Math.floor(Math.random()*a.length)];if(i){let a=r[Math.floor(Math.random()*r.length)];G.current=G.current+1;let n=function(e,t,r,a,i,n){let l=iN(r,a,t.landX,t.landY);if(!l)return null;let o=iz(r,a,l.x,l.y,i,n);if(!o||0===o.length)return null;let s=nP(e,i,n,t.landX,t.landY,"beach",o,0,"south"),c=.6>Math.random();if(s.state="at_beach",s.activity=c?"beach_swimming":"lying_on_mat",s.activityProgress=.3*Math.random(),s.activityDuration=30+150*Math.random(),s.beachTileX=t.waterX,s.beachTileY=t.waterY,s.beachEdge=t.edge,c){let e=nj();s.activityOffsetX=.5*e.x,s.activityOffsetY=.5*e.y}else{s.hasBeachMat=!0;let e=nj();s.activityOffsetX=.8*e.x,s.activityOffsetY=.4*e.y}return c?(s.tileX=t.waterX,s.tileY=t.waterY):(s.tileX=t.landX,s.tileY=t.landY),s}(G.current,i,e,t,a.x,a.y);if(n)return H.current.push(n),!0}}}if(i<.65){let i,n=r[Math.floor(Math.random()*r.length)],l=a[Math.floor(Math.random()*a.length)],o=a.filter(lM);if(.35>Math.random()&&o.length>0){let{grid:e}=K.current,t=o.filter(t=>{let r=e[t.y]?.[t.x],a=r?.building.type;return"shop_small"===a||"shop_medium"===a||"mall"===a});l=t.length>0?t[Math.floor(Math.random()*t.length)]:o[Math.floor(Math.random()*o.length)]}else if(.25>Math.random()&&"park"===l.type){let{grid:e}=K.current,t=a.filter(t=>{if("park"!==t.type)return!1;let r=e[t.y]?.[t.x],a=r?.building.type;return a&&(nc.includes(a)||nh.includes(a))});t.length>0&&(l=t[Math.floor(Math.random()*t.length)])}let s=iz(e,t,n.x,n.y,l.x,l.y);if(!s||0===s.length)return!1;if("commercial"===l.type&&s.length>3){let e=Math.floor(.5*s.length);i=e+Math.floor(Math.random()*(s.length-e))}else i=Math.floor(Math.random()*s.length);let c=s[i],d="south";if(i+1<s.length){let e=s[i+1],t=iI(c.x,c.y,e.x,e.y);t&&(d=t)}else if(i>0){let e=s[i-1],t=iI(e.x,e.y,c.x,c.y);t&&(d=t)}G.current=G.current+1;let h=nP(G.current,n.x,n.y,l.x,l.y,l.type,s,i,d);return H.current.push(h),!0}if(i<.83){let a=eu();if(0===a.length)return!1;let i=a[Math.floor(Math.random()*a.length)];if(.5>Math.random()){let e=a.filter(l_);e.length>0&&(i=e[Math.floor(Math.random()*e.length)])}let n=r[Math.floor(Math.random()*r.length)];G.current=G.current+1;let l=function(e,t,r,a,i,n,l){let o=a[r]?.[t];if(!o)return null;let s=iN(a,i,t,r);if(!s)return null;let c=iz(a,i,s.x,s.y,n,l);if(!c||0===c.length)return null;let d=nP(e,n,l,t,r,"park",c,0,"south"),h=nM(o.building.type);d.state="at_recreation",d.activity=h,d.activityProgress=.5*Math.random(),d.activityDuration=20+100*Math.random();let u=nj();return d.activityOffsetX=u.x,d.activityOffsetY=u.y,n_.includes(h)&&(d.hasBall=!0),d.tileX=t,d.tileY=r,d}(G.current,i.x,i.y,e,t,n.x,n.y);return!!l&&(H.current.push(l),!0)}if(i<.88){let a=ef();if(0===a.length)return!1;let i=a.filter(lv),n=i.length>0&&.7>Math.random()?i:a,l=n[Math.floor(Math.random()*n.length)],o=r[Math.floor(Math.random()*r.length)];G.current=G.current+1;let s=function(e,t,r,a,i,n,l){var o;let s=a[r]?.[t];if(!s||!nS(s.building.type))return null;let c=iN(a,i,t,r);if(!c)return null;let d=iz(a,i,c.x,c.y,n,l);if(!d||0===d.length)return null;let h=nP(e,n,l,t,r,"school"===(o=s.building.type)||"university"===o?"school":"shop_small"===o||"shop_medium"===o||"mall"===o||"office_low"===o||"office_high"===o?"commercial":"factory_small"===o||"factory_medium"===o||"factory_large"===o||"warehouse"===o?"industrial":"home",d,0,"south");return h.state="inside_building",h.buildingEntryProgress=1,h.activity=nM(s.building.type),h.activityProgress=.6*Math.random(),h.activityDuration=15+45*Math.random(),h.tileX=c.x,h.tileY=c.y,h}(G.current,l.x,l.y,e,t,o.x,o.y);return!!s&&(H.current.push(s),!0)}if(i<.95){let a=ef().filter(lw);if(0===a.length)return!1;let i=a[Math.floor(Math.random()*a.length)],n=r[Math.floor(Math.random()*r.length)];G.current=G.current+1;let l=function(e,t,r,a,i,n,l){let o=a[r]?.[t];if(!o||!nk(o.building.type))return null;let s=iN(a,i,t,r);if(!s)return null;let c=iz(a,i,s.x,s.y,n,l);if(!c||0===c.length)return null;let d=nP(e,n,l,t,r,"commercial",c,0,"south");d.state="approaching_shop",d.buildingEntryProgress=.8*Math.random(),d.activity="shopping",d.activityDuration=15+45*Math.random();let h=nj();return d.activityOffsetX=.5*h.x,d.activityOffsetY=.3*h.y,d.tileX=s.x,d.tileY=s.y,d}(G.current,i.x,i.y,e,t,n.x,n.y);return!!l&&(H.current.push(l),!0)}let n=ef();if(0===n.length)return!1;let l=n[Math.floor(Math.random()*n.length)],o=r[Math.floor(Math.random()*r.length)];G.current=G.current+1;let s=function(e,t,r,a,i,n,l){let o=iN(a,i,t,r);if(!o)return null;let s=iz(a,i,o.x,o.y,n,l);if(!s||0===s.length)return null;let c="south";if(s.length>1){let e=s[1],t=iI(o.x,o.y,e.x,e.y);t&&(c=t)}let d=nP(e,n,l,t,r,"home",s,0,c);return d.state="exiting_building",d.buildingEntryProgress=1,d.returningHome=!0,d}(G.current,l.x,l.y,e,t,o.x,o.y);return!!s&&(H.current.push(s),!0)},Y[28]=em,Y[29]=ef,Y[30]=eo,Y[31]=eu,Y[32]=el,Y[33]=G,Y[34]=H,Y[35]=K,Y[36]=m):m=Y[36];let eg=m;Y[37]!==K?(g=e=>{let{grid:t,gridSize:r}=K.current;if(!t||r<=0)return[];let a=[];for(let i=0;i<r;i++)for(let n=0;n<r;n++)t[i][n].building.type===e&&a.push({x:n,y:i});return a},Y[37]=K,Y[38]=g):g=Y[38];let ep=g;Y[39]!==K?(p=()=>{let{grid:e,gridSize:t}=K.current;if(!e||t<=0)return[];let r=[];for(let a=0;a<t;a++)for(let i=0;i<t;i++)e[a][i].building.onFire&&r.push({x:i,y:a});return r},Y[39]=K,Y[40]=p):p=Y[40];let ex=p;Y[41]!==J||Y[42]!==U||Y[43]!==ea.services.police||Y[44]!==ea.stats.population||Y[45]!==K?(x=e=>{let{grid:t,gridSize:r,speed:a}=K.current;if(!t||r<=0||0===a||(U.current=U.current-e*(1===a?1:2===a?2:3),U.current>0))return;U.current=3+2*Math.random();let i=[];for(let e=0;e<r;e++)for(let a=0;a<r;a++){let r=t[e][a],n="grass"!==r.building.type&&"water"!==r.building.type&&"road"!==r.building.type&&"bridge"!==r.building.type&&"tree"!==r.building.type&&"empty"!==r.building.type,l=r.building.population>0||r.building.jobs>0;if(n&&l){let t=ea.services.police[e]?.[a]||0;i.push({x:a,y:e,policeCoverage:t})}}if(0===i.length)return;let n=i.reduce(lb,0)/i.length,l=n<20?.4:n<40?.25:n<60?.15:.08,o=Math.max(2,Math.floor(ea.stats.population/500));if(J.current.size>=o)return;let s=.3>Math.random()?2:1;for(let e=0;e<s&&!(J.current.size>=o);e++){if(Math.random()>l)continue;let e=i.filter(e=>{let t=`${e.x},${e.y}`;return!J.current.has(t)&&Math.random()<Math.max(.1,1-e.policeCoverage/100)});if(0===e.length)continue;let t=e[Math.floor(Math.random()*e.length)],r=`${t.x},${t.y}`,a=function(){let e=Math.random()*lg.reduce((e,t)=>e+lm[t].weight,0);for(let t of lg)if((e-=lm[t].weight)<=0)return t;return lg[0]}(),n=lm[a]?.duration||20;J.current.set(r,{x:t.x,y:t.y,type:a,timeRemaining:n})}},Y[41]=J,Y[42]=U,Y[43]=ea.services.police,Y[44]=ea.stats.population,Y[45]=K,Y[46]=x):x=Y[46];let ey=x;Y[47]!==J||Y[48]!==F||Y[49]!==K?(y=e=>{let{speed:t}=K.current;if(0===t)return;let r=1===t?1:2===t?2:3,a=[];for(let[t,i]of J.current){if(F.current.has(t))continue;let n=i.timeRemaining-e*r;n<=0?a.push(t):J.current.set(t,{...i,timeRemaining:n})}for(let e=0;e<a.length;e++)J.current.delete(a[e])},Y[47]=J,Y[48]=F,Y[49]=K,Y[50]=y):y=Y[50];let eb=y;Y[51]!==J?(b=()=>Array.from(J.current.values()).map(ly),Y[51]=J,Y[52]=b):b=Y[52];let ew=b;Y[53]!==V||Y[54]!==L||Y[55]!==K?(w=(e,t,r,a,i)=>{let{grid:n,gridSize:l}=K.current;if(!n||l<=0)return!1;let o=iz(n,l,t,r,a,i);if(!o||0===o.length)return!1;let s=o[0],c="south";if(o.length>=2){let e=o[1],t=iI(s.x,s.y,e.x,e.y);t&&(c=t)}return V.current=V.current+1,L.current.push({id:V.current,type:e,tileX:s.x,tileY:s.y,direction:c,progress:0,speed:"fire_truck"===e?.8:.9,state:"dispatching",stationX:t,stationY:r,targetX:a,targetY:i,path:o,pathIndex:0,respondTime:0,laneOffset:0,flashTimer:0}),!0},Y[53]=V,Y[54]=L,Y[55]=K,Y[56]=w):w=Y[56];let ev=w;Y[57]!==F||Y[58]!==D||Y[59]!==ev||Y[60]!==ew||Y[61]!==ex||Y[62]!==ep||Y[63]!==K?(v=()=>{let{grid:e,gridSize:t,speed:r}=K.current;if(!e||t<=0||0===r)return;let a=ex(),i=ep("fire_station");for(let e of a){let t=`${e.x},${e.y}`;if(D.current.has(t))continue;let r=null,a=1/0;for(let t of i){let i=Math.abs(t.x-e.x)+Math.abs(t.y-e.y);i<a&&(a=i,r=t)}r&&ev("fire_truck",r.x,r.y,e.x,e.y)&&D.current.add(t)}let n=ew(),l=ep("police_station"),o=0,s=Math.max(3,Math.min(6,2*l.length));for(let e of n){if(o>=s)break;let t=`${e.x},${e.y}`;if(F.current.has(t))continue;let r=null,a=1/0;for(let t of l){let i=Math.abs(t.x-e.x)+Math.abs(t.y-e.y);i<a&&(a=i,r=t)}r&&ev("police_car",r.x,r.y,e.x,e.y)&&(F.current.add(t),o++)}},Y[57]=F,Y[58]=D,Y[59]=ev,Y[60]=ew,Y[61]=ex,Y[62]=ep,Y[63]=K,Y[64]=v):v=Y[64];let e_=v;Y[65]!==J||Y[66]!==F||Y[67]!==D||Y[68]!==W||Y[69]!==L||Y[70]!==e_||Y[71]!==K?(_=e=>{let{grid:t,gridSize:r,speed:a}=K.current;if(!t||r<=0){L.current=[];return}let i=0===a?0:1===a?1:2===a?2.5:4;W.current=W.current-e,W.current<=0&&(e_(),W.current=1.5);let n=[];for(let a of[...L.current]){if(a.flashTimer=a.flashTimer+8*e,"responding"===a.state){if(!i_(t,r,a.tileX,a.tileY)){let e=`${a.targetX},${a.targetY}`;"fire_truck"===a.type?D.current.delete(e):(F.current.delete(e),J.current.delete(e));continue}a.respondTime=a.respondTime+e*i;let l="fire_truck"===a.type?8:5;if(a.respondTime>=l){let e=`${a.targetX},${a.targetY}`;"police_car"===a.type&&J.current.delete(e);let i=iz(t,r,a.tileX,a.tileY,a.stationX,a.stationY);if(i&&i.length>=2){a.path=i,a.pathIndex=0,a.state="returning",a.progress=0;let e=i[1],t=iI(a.tileX,a.tileY,e.x,e.y);t&&(a.direction=t)}else if(i&&1===i.length){let e=`${a.targetX},${a.targetY}`;"fire_truck"===a.type?D.current.delete(e):F.current.delete(e);continue}else{let e=`${a.targetX},${a.targetY}`;"fire_truck"===a.type?D.current.delete(e):F.current.delete(e);continue}}n.push(a);continue}if(!i_(t,r,a.tileX,a.tileY)){let e=`${a.targetX},${a.targetY}`;"fire_truck"===a.type?D.current.delete(e):(F.current.delete(e),J.current.delete(e));continue}if(a.tileX<0||a.tileX>=r||a.tileY<0||a.tileY>=r){let e=`${a.targetX},${a.targetY}`;"fire_truck"===a.type?D.current.delete(e):(F.current.delete(e),J.current.delete(e));continue}a.progress=a.progress+a.speed*e*i;let l=!1;if(1===a.path.length&&"dispatching"===a.state){a.state="responding",a.respondTime=0,a.progress=0,n.push(a);continue}for(;a.progress>=1&&a.pathIndex<a.path.length-1;){a.pathIndex=a.pathIndex+1,a.progress=a.progress-1;let e=a.path[a.pathIndex];if(e.x<0||e.x>=r||e.y<0||e.y>=r){l=!0;break}if(a.tileX=e.x,a.tileY=e.y,a.pathIndex>=a.path.length-1){"dispatching"===a.state?(a.state="responding",a.respondTime=0,a.progress=0):"returning"===a.state&&(l=!0);break}if(a.pathIndex+1<a.path.length){let e=a.path[a.pathIndex+1],t=iI(a.tileX,a.tileY,e.x,e.y);t&&(a.direction=t)}}if(l){let e=`${a.targetX},${a.targetY}`;"fire_truck"===a.type?D.current.delete(e):(F.current.delete(e),J.current.delete(e));continue}n.push(a)}L.current=n},Y[65]=J,Y[66]=F,Y[67]=D,Y[68]=W,Y[69]=L,Y[70]=e_,Y[71]=K,Y[72]=_):_=Y[72];let eM=_;Y[73]!==er||Y[74]!==ee?(M=(e,t,r,a)=>{if(!i_(e,t,r,a))return!1;let i=ee.current;if(er.current.gridVersion!==i){let r=new Map;for(let a=0;a<t;a++)for(let i=0;i<t;i++)if(i_(e,t,i,a)){let n=iM(e,t,i,a);r.set(a*t+i,n.length>=3)}er.current={map:r,gridVersion:i}}return er.current.map.get(a*t+r)??!1},Y[73]=er,Y[74]=ee,Y[75]=M):M=Y[75];let eS=M;Y[76]!==et||Y[77]!==O||Y[78]!==X||Y[79]!==ee||Y[80]!==eS||Y[81]!==ei||Y[82]!==en||Y[83]!==Q||Y[84]!==Z||Y[85]!==K?(S=e=>{let t,{grid:r,gridSize:a,speed:i,zoom:n}=K.current;if(n<Math.max(ei?.45:.4,.25)){X.current=[];return}if(!r||a<=0)return;let l=0===i?0:1===i?1:2===i?2.5:4,o=ee.current;if(et.current.gridVersion===o)t=et.current.count;else{t=0;for(let e=0;e<a;e++)for(let i=0;i<a;i++){let a=r[e][i].building.type;("road"===a||"bridge"===a)&&t++}et.current={count:t,gridVersion:o}}let s=Math.floor(t*(ei?.15:.5)),c=ei?Math.min(60,Math.max(10,s)):Math.min(800,Math.max(15,s));if(O.current=O.current-e,X.current.length<c&&O.current<=0){let e=c-X.current.length,t=ei?Math.min(1,e):Math.min(e>50?4:2,e),r=0;for(let e=0;e<t;e++)en()&&r++;O.current=r>0?ei?.8+.4*Math.random():.3+.4*Math.random():.1}let d=nF(Q.current),h=new Map;for(let e of X.current){let t=e.tileY*a+e.tileX;h.has(t)||h.set(t,[]),h.get(t).push(e)}let u=[];for(let t of[...X.current]){if(t.age=t.age+e*l,t.age>t.maxAge)continue;if(!i_(r,a,t.tileX,t.tileY)){let e=!1;for(let i=1;i<=5&&!e;i++)for(let n=-i;n<=i&&!e;n++)for(let l=-i;l<=i&&!e;l++)if(Math.abs(l)===i||Math.abs(n)===i){let i=t.tileX+l,o=t.tileY+n;if(i_(r,a,i,o)){t.tileX=i,t.tileY=o,t.progress=.5;let n=iM(r,a,i,o);n.length>0&&(t.direction=n[Math.floor(Math.random()*n.length)]),e=!0}}u.push(t);continue}let i=!1,n=ia[t.direction],o=t.tileX+n.step.x,s=t.tileY+n.step.y,c=eS(r,a,t.tileX,t.tileY),f=eS(r,a,o,s);if(c||!f||nJ(t.direction,d)||(i=!0),!i){let e=Z.current;li(r,a,t.tileX,t.tileY)&&lf(e,t.tileX,t.tileY)&&t.progress<.3&&(i=!0),!i&&t.progress>.5&&li(r,a,o,s)&&lf(e,o,s)&&(i=!0)}if(!i){for(let e of h.get(t.tileY*a+t.tileX)||[])if(e.id!==t.id&&e.direction===t.direction&&e.progress>t.progress&&e.progress-t.progress<.25){i=!0;break}if(!i&&t.progress>.7){for(let e of h.get(s*a+o)||[])if(e.direction===t.direction&&e.progress<.3){i=!0;break}}}i||(t.progress=t.progress+t.speed*e*l);let m=0;for(;t.progress>=1&&m<4;){m++;let e=ia[t.direction],i=t.tileX+e.step.x,n=t.tileY+e.step.y;if(!i_(r,a,i,n)){let e=iM(r,a,t.tileX,t.tileY);if(e.length>0){let r=e.filter(e=>e!==t.direction),a=r.length>0?r[Math.floor(Math.random()*r.length)]:e[Math.floor(Math.random()*e.length)];t.direction=a,t.progress=.1,t.laneOffset=("north"===a||"east"===a?1:-1)*(4+2*Math.random())}else t.progress=.5;break}t.tileX=i,t.tileY=n,t.progress=t.progress-1;let l=function(e,t,r,a,i){let n=iM(t,r,a,i);if(0===n.length)return null;let l=t[i]?.[a];if(l?.building.type==="bridge"&&n.includes(e))return e;let o={north:{dx:-1,dy:0},south:{dx:1,dy:0},east:{dx:0,dy:-1},west:{dx:0,dy:1}},s=n.filter(e=>{let n=o[e],l=a+n.dx,s=i+n.dy;if(l<0||s<0||l>=r||s>=r)return!1;let c=t[s]?.[l];if(!c)return!1;if("bridge"===c.building.type){if("rail"===c.building.bridgeTrackType)return!1;let t=c.building.bridgeOrientation;return"ns"===t&&("north"===e||"south"===e)||"ew"===t&&("east"===e||"west"===e)}return"road"===c.building.type});if(0===s.length)return null;let c=ii[e],d=s.filter(e=>e!==c),h=d.length>0?d:s;return h[Math.floor(Math.random()*h.length)]}(t.direction,r,a,t.tileX,t.tileY);if(l)l!==t.direction&&(t.laneOffset=("north"===l||"east"===l?1:-1)*(4+2*Math.random())),t.direction=l;else{let e=iM(r,a,t.tileX,t.tileY);if(e.length>0){let r=e[Math.floor(Math.random()*e.length)];t.direction=r,t.laneOffset=("north"===r||"east"===r?1:-1)*(4+2*Math.random())}}}u.push(t)}X.current=u},Y[76]=et,Y[77]=O,Y[78]=X,Y[79]=ee,Y[80]=eS,Y[81]=ei,Y[82]=en,Y[83]=Q,Y[84]=Z,Y[85]=K,Y[86]=S):S=Y[86];let ek=S;Y[87]!==ed||Y[88]!==B||Y[89]!==E||Y[90]!==et||Y[91]!==ee||Y[92]!==eS||Y[93]!==ei||Y[94]!==eh||Y[95]!==ea.stats.population||Y[96]!==Q||Y[97]!==Z||Y[98]!==K?(k=e=>{let t,{grid:r,gridSize:a,speed:i,zoom:n}=K.current;if(n<.35||!r||a<=0||ea.stats.population<600){E.current=[];return}let l=0===i?0:1===i?1:2===i?2.5:4,o=ee.current;if(et.current.gridVersion===o)t=et.current.count;else{t=0;for(let e=0;e<a;e++)for(let i=0;i<a;i++){let a=r[e][i].building.type;("road"===a||"bridge"===a)&&t++}et.current={count:t,gridVersion:o}}let s=Math.min(ei?8:35,Math.max(2,Math.floor(Math.max(1,Math.floor(t/120))*(1+2*Math.min(1,ea.stats.population/4e3)))));B.current=B.current-e,E.current.length<s&&B.current<=0&&(eh()?B.current=2.5+3.5*Math.random():B.current=1.5);let c=nF(Q.current),d=[];for(let t of[...E.current]){if(t.age=t.age+e*l,t.age>t.maxAge)continue;if(t.stopTimer>0){t.stopTimer=t.stopTimer-e*l,d.push(t);continue}let i=!1,n=ia[t.direction],o=t.tileX+n.step.x,s=t.tileY+n.step.y,h=eS(r,a,t.tileX,t.tileY),u=eS(r,a,o,s);for(h||!u||nJ(t.direction,c)||(i=!0),!i&&(li(r,a,t.tileX,t.tileY)&&lf(Z.current,t.tileX,t.tileY)&&t.progress<.3&&(i=!0),!i&&t.progress>.5&&li(r,a,o,s)&&lf(Z.current,o,s)&&(i=!0)),i||(t.progress=t.progress+t.speed*e*l);t.progress>=1&&t.pathIndex<t.path.length-1;){t.pathIndex=t.pathIndex+1,t.progress=t.progress-1;let e=t.path[t.pathIndex];if(t.tileX=e.x,t.tileY=e.y,t.pathIndex+1<t.path.length){let e=t.path[t.pathIndex+1],r=iI(t.tileX,t.tileY,e.x,e.y);r&&(r!==t.direction&&(t.laneOffset=("north"===r||"east"===r?1:-1)*(6+2.5*Math.random())),t.direction=r)}}if(t.pathIndex>=t.path.length-1&&t.progress>=1){t.progress=0,t.stopTimer=1.6+1.9*Math.random();let e=ed(t.stops[1]??{x:t.tileX,y:t.tileY});if(!e)continue;let r=e.path[0];if(t.tileX=r.x,t.tileY=r.y,t.path=e.path,t.pathIndex=0,t.stops=e.stops,e.path.length>1){let a=e.path[1],i=iI(r.x,r.y,a.x,a.y);i&&(t.direction=i,t.laneOffset=("north"===i||"east"===i?1:-1)*(6+2.5*Math.random()))}}d.push(t)}E.current=d},Y[87]=ed,Y[88]=B,Y[89]=E,Y[90]=et,Y[91]=ee,Y[92]=eS,Y[93]=ei,Y[94]=eh,Y[95]=ea.stats.population,Y[96]=Q,Y[97]=Z,Y[98]=K,Y[99]=k):k=Y[99];let ej=k;Y[100]!==et||Y[101]!==ee||Y[102]!==ei||Y[103]!==q||Y[104]!==H||Y[105]!==eg||Y[106]!==Q||Y[107]!==K?(j=e=>{let t,{grid:r,gridSize:a,speed:i,zoom:n}=K.current;if(n<Math.max(ei?.55:.5,.25)||!r||a<=0){H.current=[];return}let l=0===i?0:1===i?1:2===i?2.5:4,o=ee.current;if(et.current.gridVersion===o)t=et.current.count;else{t=0;for(let e=0;e<a;e++)for(let i=0;i<a;i++){let a=r[e][i].building.type;("road"===a||"bridge"===a)&&t++}et.current={count:t,gridVersion:o}}let s=ei?.5:1.7,c=Math.min(ei?80:560,Math.max(ei?20:150,t*s));if(q.current=q.current-e,H.current.length<c&&q.current<=0){let e=Math.min(ei?5:25,c-H.current.length);for(let t=0;t<e;t++)eg();q.current=ei?.15:.03}let d=H.current,h=[],u=nF(Q.current);for(let t=0;t<d.length;t++){let i=d[t];if(function(e,t,r,a,i,n){var l,o,s,c,d,h,u,f,m,g,p,x;if(e.age+=t,e.age>e.maxAge)return!1;switch(e.activityAnimTimer+=4*t,e.state){case"walking":return function(e,t,r,a,i,n){if(e.walkOffset+=8*t,(e.id+Math.floor(10*e.age))%60==0){if(.02>Math.random()){let t=function(e,t){let r=Math.min(20,t.length),a=e.id%Math.max(1,t.length-r),i=null;for(let n=0;n<r;n++){let r=(a+n)%t.length,l=t[r];if(l.id===e.id||"walking"!==l.state||null!==l.socialTarget)continue;let o=Math.abs(l.tileX-e.tileX)+Math.abs(l.tileY-e.tileY);if(1===o)return l;0!==o||i||l.sidewalkSide===e.sidewalkSide||(i=l)}return i}(e,n);if(t)return e.state="socializing",e.socialTarget=t.id,e.activityDuration=4,e.activityProgress=0,t.state="socializing",t.socialTarget=e.id,t.activityDuration=4,t.activityProgress=0,e.activityOffsetX=-8,e.activityOffsetY=0,t.activityOffsetX=8,t.activityOffsetY=0,!0}if(.01>Math.random())return e.state="idle",e.activityDuration=1+2*Math.random(),e.activityProgress=0,!0}if(e.progress<.1&&!i_(a,i,e.tileX,e.tileY))return!1;for(e.progress+=e.speed*t*r;e.progress>=1&&e.pathIndex<e.path.length-1;){e.pathIndex++,e.progress-=1;let t=e.path[e.pathIndex];if(t.x<0||t.x>=i||t.y<0||t.y>=i)return!1;if(e.tileX=t.x,e.tileY=t.y,e.pathIndex>=e.path.length-1)if(!e.returningHome)return nT(e,a,i),!0;else return!1;if(e.pathIndex+1<e.path.length){let t=e.path[e.pathIndex+1],r=iI(e.tileX,e.tileY,t.x,t.y);r&&(e.direction=r)}}if(e.progress>=1&&e.pathIndex>=e.path.length-1)if(e.returningHome)return!1;else nT(e,a,i);return!0}(e,t,r,a,i,n);case"approaching_shop":return l=e,o=t,s=r,l.walkOffset+=6*o,l.buildingEntryProgress+=o*s/3,l.buildingEntryProgress>=1&&(l.state="entering_building",l.buildingEntryProgress=0),!0;case"entering_building":return c=e,d=t,h=r,c.buildingEntryProgress+=d*h/2,c.buildingEntryProgress>=1&&(c.state="inside_building",c.buildingEntryProgress=1,c.activityProgress=0),!0;case"inside_building":return u=e,f=t,m=r,u.activityProgress+=f*m/u.activityDuration,u.activityProgress>=1&&(u.state="exiting_building",u.buildingEntryProgress=1,"shopping"===u.activity&&(u.hasBag=!0)),!0;case"exiting_building":return function(e,t,r,a,i){if(e.buildingEntryProgress-=t*r/2,e.buildingEntryProgress<=0){e.buildingEntryProgress=0,e.activity="none";let t=iz(a,i,e.destX,e.destY,e.homeX,e.homeY);if(!t||!(t.length>0))return!1;if(e.path=t,e.pathIndex=0,e.progress=0,e.tileX=t[0].x,e.tileY=t[0].y,e.state="walking",e.returningHome=!0,t.length>1){let r=t[1],a=iI(t[0].x,t[0].y,r.x,r.y);a&&(e.direction=a)}}return!0}(e,t,r,a,i);case"at_recreation":return function(e,t,r,a,i){if((e.activityProgress+=t*r/e.activityDuration,"jogging"===e.activity)?(e.walkOffset+=10*t,e.activityOffsetX=15*Math.sin(.5*e.activityAnimTimer),e.activityOffsetY=15*Math.cos(.3*e.activityAnimTimer)*.6):"walking_dog"===e.activity&&(e.walkOffset+=4*t,e.activityOffsetX=10*Math.sin(.2*e.activityAnimTimer),e.activityOffsetY=10*Math.cos(.15*e.activityAnimTimer)*.6),e.activityProgress>=1){e.hasBall=!1,e.activity="none";let t=iz(a,i,e.destX,e.destY,e.homeX,e.homeY);if(!t||!(t.length>0))return!1;if(e.path=t,e.pathIndex=0,e.progress=0,e.tileX=t[0].x,e.tileY=t[0].y,e.state="walking",e.returningHome=!0,t.length>1){let r=t[1],a=iI(t[0].x,t[0].y,r.x,r.y);a&&(e.direction=a)}}return!0}(e,t,r,a,i);case"at_beach":return function(e,t,r,a,i){if((e.activityProgress+=t*r/e.activityDuration,"beach_swimming"===e.activity)?(e.walkOffset+=3*t,e.activityOffsetX+=(.1*Math.sin(.3*e.activityAnimTimer)-.02*e.activityOffsetX)*t*10,e.activityOffsetY+=(.05*Math.cos(.2*e.activityAnimTimer)-.02*e.activityOffsetY)*t*10,e.activityOffsetX=Math.max(-6,Math.min(6,e.activityOffsetX)),e.activityOffsetY=Math.max(-3,Math.min(3,e.activityOffsetY))):"lying_on_mat"===e.activity&&.001>Math.random()&&(e.activityOffsetX+=(Math.random()-.5)*.5,e.activityOffsetY+=(Math.random()-.5)*.25),e.activityProgress>=1){e.activity="none",e.hasBeachMat=!1,e.beachEdge=null;let t=iz(a,i,e.destX,e.destY,e.homeX,e.homeY);if(!t||!(t.length>0))return!1;if(e.path=t,e.pathIndex=0,e.progress=0,e.tileX=t[0].x,e.tileY=t[0].y,e.state="walking",e.returningHome=!0,t.length>1){let r=t[1],a=iI(t[0].x,t[0].y,r.x,r.y);a&&(e.direction=a)}}return!0}(e,t,r,a,i);case"idle":return g=e,p=t,x=r,g.activityProgress+=p*x/g.activityDuration,g.activityProgress>=1&&(g.state="walking",g.activityProgress=0),!0;case"socializing":return function(e,t,r,a){if(e.activityProgress+=t*r/e.activityDuration,null!==e.socialTarget){let t=a.find(t=>t.id===e.socialTarget);if(!t||"socializing"!==t.state||t.socialTarget!==e.id)return e.state="walking",e.socialTarget=null,e.activityProgress=0,e.activityOffsetX=0,e.activityOffsetY=0,!0}if(e.activityProgress>=1){if(null!==e.socialTarget){let t=a.find(t=>t.id===e.socialTarget);t&&"socializing"===t.state&&(t.activityProgress=1)}e.state="walking",e.socialTarget=null,e.activityProgress=0,e.activityOffsetX=0,e.activityOffsetY=0}return!0}(e,t,r,n);default:return!0}}(i,e,l,r,a,d)){if("walking"===i.state&&i.progress>.4&&i.pathIndex+1<i.path.length&&i.id%5!=0){let e=i.path[i.pathIndex+1],t=0;i_(r,a,e.x-1,e.y)&&t++,t<3&&i_(r,a,e.x,e.y-1)&&t++,t<3&&i_(r,a,e.x+1,e.y)&&t++,t<3&&i_(r,a,e.x,e.y+1)&&t++,t>=3&&!nJ(i.direction,u)&&(i.progress=Math.min(i.progress,.5))}h.push(i)}}H.current=h},Y[100]=et,Y[101]=ee,Y[102]=ei,Y[103]=q,Y[104]=H,Y[105]=eg,Y[106]=Q,Y[107]=K,Y[108]=j):j=Y[108];let eP=j;Y[109]!==X||Y[110]!==ei||Y[111]!==K?(P=e=>{let{offset:t,zoom:r,grid:a,gridSize:i}=K.current,n=e.canvas,l=window.devicePixelRatio||1;e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,n.width,n.height),r<(ei?.45:.4)||a&&!(i<=0)&&0!==X.current.length&&(e.save(),e.scale(l*r,l*r),e.translate(t.x/r,t.y/r),X.current.forEach(t=>{let{screenX:r,screenY:a}=iR(t.tileX,t.tileY,0,0),i=ia[t.direction],n=r+32+i.vec.dx*t.progress+i.normal.nx*t.laneOffset,l=a+19.2+i.vec.dy*t.progress+i.normal.ny*t.laneOffset;e.save(),e.translate(n,l),e.rotate(i.angle),e.fillStyle=t.color,e.beginPath(),e.moveTo(-5,-2.5),e.lineTo(5,-2.5),e.lineTo(6,0),e.lineTo(5,2.5),e.lineTo(-5,2.5),e.closePath(),e.fill(),e.fillStyle="rgba(255, 255, 255, 0.6)",e.fillRect(-2,-1.4,3.5,2.8),e.fillStyle="#111827",e.fillRect(-5,-2,1.2,4),e.restore()}),e.restore())},Y[109]=X,Y[110]=ei,Y[111]=K,Y[112]=P):P=Y[112];let eT=P;Y[113]!==E||Y[114]!==K?(T=e=>{let{offset:t,zoom:r,grid:a,gridSize:i}=K.current,n=e.canvas,l=window.devicePixelRatio||1;if(r<.35||!a||i<=0||0===E.current.length)return;e.save(),e.scale(l*r,l*r),e.translate(t.x/r,t.y/r);let o=n.width/(l*r),s=n.height/(l*r),c=-t.x/r-64,d=-t.y/r-76.8,h=o-t.x/r+64,u=s-t.y/r+76.8;E.current.forEach(t=>{let{screenX:r,screenY:a}=iR(t.tileX,t.tileY,0,0),i=ia[t.direction],n=r+32+i.vec.dx*t.progress+i.normal.nx*t.laneOffset,l=a+19.2+i.vec.dy*t.progress+i.normal.ny*t.laneOffset;if(!(n<c-60)&&!(n>h+60)&&!(l<d-80)&&!(l>u+80)){e.save(),e.translate(n,l),e.rotate(i.angle),e.fillStyle=t.color,e.fillRect(-12,-4.2,24,8.4),e.fillStyle="rgba(255, 255, 255, 0.25)",e.fillRect(-9.600000000000001,-2.94,16.799999999999997,3.7800000000000002),e.fillStyle="rgba(191, 219, 254, 0.8)";for(let t=0;t<4;t++){let r=-8.399999999999999+12*t*.45;e.fillRect(r,-2.3100000000000005,3,4.620000000000001)}e.fillStyle="#111827",e.fillRect(-11.399999999999999,-3.7800000000000002,1.2000000000000002,7.5600000000000005),e.fillStyle="#fbbf24",e.fillRect(10.2,-1.47,1.2000000000000002,2.94),e.restore()}}),e.restore()},Y[113]=E,Y[114]=K,Y[115]=T):T=Y[115];let eC=T;Y[116]!==ei||Y[117]!==H||Y[118]!==K?(C=e=>{let{offset:t,zoom:r,grid:a,gridSize:i}=K.current,n=e.canvas,l=window.devicePixelRatio||1;if(r<(ei?.55:.5)||!a||i<=0||0===H.current.length)return;e.save(),e.scale(l*r,l*r),e.translate(t.x/r,t.y/r);let o=n.width/(l*r),s=n.height/(l*r),c={viewLeft:-t.x/r-64,viewTop:-t.y/r-76.8,viewRight:o-t.x/r+64,viewBottom:s-t.y/r+76.8};nI(e,H.current,c,r,"non-recreation"),e.restore()},Y[116]=ei,Y[117]=H,Y[118]=K,Y[119]=C):C=Y[119];let eN=C;Y[120]!==ei||Y[121]!==H||Y[122]!==K?(N=e=>{let{offset:t,zoom:r,grid:a,gridSize:i}=K.current,n=e.canvas,l=window.devicePixelRatio||1;if(r<(ei?.55:.5)||!a||i<=0||0===H.current.length)return;e.save(),e.scale(l*r,l*r),e.translate(t.x/r,t.y/r);let o=n.width/(l*r),s=n.height/(l*r),c={viewLeft:-t.x/r-64,viewTop:-t.y/r-76.8,viewRight:o-t.x/r+64,viewBottom:s-t.y/r+76.8};nI(e,H.current,c,r,"recreation"),e.restore()},Y[120]=ei,Y[121]=H,Y[122]=K,Y[123]=N):N=Y[123];let ez=N;Y[124]!==L||Y[125]!==K?(z=e=>{let{offset:t,zoom:r,grid:a,gridSize:i}=K.current,n=e.canvas,l=window.devicePixelRatio||1;if(!a||i<=0||0===L.current.length)return;e.save(),e.scale(l*r,l*r),e.translate(t.x/r,t.y/r);let o=n.width/(l*r),s=n.height/(l*r),c=-t.x/r-64,d=-t.y/r-76.8,h=o-t.x/r+64,u=s-t.y/r+76.8;L.current.forEach(t=>{let{screenX:r,screenY:a}=iR(t.tileX,t.tileY,0,0),i=ia[t.direction],n=r+32+i.vec.dx*t.progress+i.normal.nx*t.laneOffset,l=a+19.2+i.vec.dy*t.progress+i.normal.ny*t.laneOffset;if(n<c-40||n>h+40||l<d-60||l>u+60)return;e.save(),e.translate(n,l),e.rotate(i.angle);let o="fire_truck"===t.type?"#dc2626":"#1e40af",s="fire_truck"===t.type?14:11;e.fillStyle=o,e.beginPath(),e.moveTo(-(.6*s),-3),e.lineTo(.6*s,-3),e.lineTo((s+2)*.6,0),e.lineTo(.6*s,3),e.lineTo(-(.6*s),3),e.closePath(),e.fill(),e.fillStyle="fire_truck"===t.type?"#fbbf24":"#ffffff",e.fillRect(-(.6*s*.5),-1.7999999999999998,.6*s,1.0799999999999998),e.fillStyle="rgba(200, 220, 255, 0.7)",e.fillRect(-1.2,-1.7999999999999998,3,3.5999999999999996);let f=Math.sin(t.flashTimer)>0,m=Math.sin(t.flashTimer+Math.PI)>0;"fire_truck"===t.type?(e.fillStyle=f?"#ff0000":"#880000",e.fillRect(-3.5999999999999996,-4.2,1.7999999999999998,1.7999999999999998),e.fillStyle=m?"#ff0000":"#880000",e.fillRect(1.7999999999999998,-4.2,1.7999999999999998,1.7999999999999998),(f||m)&&(e.shadowColor="#ff0000",e.shadowBlur=6,e.fillStyle="rgba(255, 0, 0, 0.4)",e.fillRect(-4.8,-4.8,9.6,2.4),e.shadowBlur=0)):(e.fillStyle=f?"#ff0000":"#880000",e.fillRect(-3,-4.2,1.7999999999999998,1.7999999999999998),e.fillStyle=m?"#0066ff":"#003388",e.fillRect(1.2,-4.2,1.7999999999999998,1.7999999999999998),(f||m)&&(e.shadowColor=f?"#ff0000":"#0066ff",e.shadowBlur=6,e.fillStyle=f?"rgba(255, 0, 0, 0.4)":"rgba(0, 100, 255, 0.4)",e.fillRect(-4.2,-4.8,8.4,2.4),e.shadowBlur=0)),e.fillStyle="#111827",e.fillRect(-(.6*s),-2.4,1.2,4.8),e.restore()}),e.restore()},Y[124]=L,Y[125]=K,Y[126]=z):z=Y[126];let eI=z,eR=(0,l.useRef)(0);Y[127]!==J||Y[128]!==K?(I=(e,t)=>{let{offset:r,zoom:a,grid:i,gridSize:n}=K.current,l=e.canvas,o=window.devicePixelRatio||1;if(!i||n<=0)return;eR.current=eR.current+t;let s=eR.current;e.save(),e.scale(o*a,o*a),e.translate(r.x/a,r.y/a);let c=l.width/(o*a),d=l.height/(o*a),h=-r.x/a-128,u=-r.y/a-153.6,f=c-r.x/a+128,m=d-r.y/a+153.6;for(let t of J.current.values()){let{screenX:r,screenY:a}=iR(t.x,t.y,0,0),i=r+32,n=a+19.2;if(i<h||i>f||n<u||n>m)continue;let l=.3*Math.sin(4*s)+.7,o=.5*Math.sin(3*s)+.5;e.beginPath(),e.arc(i,n-8,18+6*o,0,2*Math.PI),e.strokeStyle=`rgba(59, 130, 246, ${.25*(1-o)})`,e.lineWidth=2,e.stroke();let c=e.createRadialGradient(i,n-8,0,i,n-8,14*l);c.addColorStop(0,`rgba(59, 130, 246, ${.5*l})`),c.addColorStop(.5,`rgba(59, 130, 246, ${.2*l})`),c.addColorStop(1,"rgba(59, 130, 246, 0)"),e.beginPath(),e.arc(i,n-8,14*l,0,2*Math.PI),e.fillStyle=c,e.fill(),e.save(),e.translate(i,n-12),e.fillStyle=`rgba(30, 64, 175, ${.9*l})`,e.beginPath(),e.moveTo(0,-7),e.lineTo(6,-4),e.lineTo(6,2),e.quadraticCurveTo(0,8,0,8),e.quadraticCurveTo(0,8,-6,2),e.lineTo(-6,-4),e.closePath(),e.fill(),e.strokeStyle=`rgba(147, 197, 253, ${l})`,e.lineWidth=1,e.stroke(),e.fillStyle="#ffffff",e.fillRect(-1,-4,2,5),e.beginPath(),e.arc(0,4,1.5,0,2*Math.PI),e.fill(),e.restore()}for(let t=0;t<n;t++)for(let r=0;r<n;r++){if(!i[t][r].building.onFire)continue;let{screenX:a,screenY:n}=iR(r,t,0,0),l=a+32,o=n+19.2;if(l<h||l>f||o<u||o>m)continue;let c=.3*Math.sin(6*s)+.7,d=.5*Math.sin(4*s)+.5;e.beginPath(),e.arc(l,o-12,22+8*d,0,2*Math.PI),e.strokeStyle=`rgba(239, 68, 68, ${.3*(1-d)})`,e.lineWidth=2,e.stroke(),e.save(),e.translate(l,o-15),e.fillStyle=`rgba(220, 38, 38, ${.9*c})`,e.beginPath(),e.moveTo(0,-8),e.lineTo(8,5),e.lineTo(-8,5),e.closePath(),e.fill(),e.strokeStyle=`rgba(252, 165, 165, ${c})`,e.lineWidth=1,e.stroke(),e.fillStyle="#fbbf24",e.beginPath(),e.moveTo(0,-3),e.quadraticCurveTo(2.5,0,2,2.5),e.quadraticCurveTo(.5,1.5,0,2.5),e.quadraticCurveTo(-.5,1.5,-2,2.5),e.quadraticCurveTo(-2.5,0,0,-3),e.fill(),e.restore()}e.restore()},Y[127]=J,Y[128]=K,Y[129]=I):I=Y[129];let eY=I;return Y[130]!==ev||Y[131]!==eC||Y[132]!==eT||Y[133]!==eI||Y[134]!==eY||Y[135]!==eN||Y[136]!==ez||Y[137]!==ew||Y[138]!==ey||Y[139]!==eg||Y[140]!==en||Y[141]!==ej||Y[142]!==ek||Y[143]!==eb||Y[144]!==e_||Y[145]!==eM||Y[146]!==eP?(R={spawnRandomCar:en,spawnPedestrian:eg,spawnCrimeIncidents:ey,updateCrimeIncidents:eb,findCrimeIncidents:ew,dispatchEmergencyVehicle:ev,updateEmergencyDispatch:e_,updateEmergencyVehicles:eM,updateCars:ek,updateBuses:ej,updatePedestrians:eP,drawCars:eT,drawBuses:eC,drawPedestrians:eN,drawRecreationPedestrians:ez,drawEmergencyVehicles:eI,drawIncidentIndicators:eY},Y[130]=ev,Y[131]=eC,Y[132]=eT,Y[133]=eI,Y[134]=eY,Y[135]=eN,Y[136]=ez,Y[137]=ew,Y[138]=ey,Y[139]=eg,Y[140]=en,Y[141]=ej,Y[142]=ek,Y[143]=eb,Y[144]=e_,Y[145]=eM,Y[146]=eP,Y[147]=R):R=Y[147],R}(iE,ee);tR[59]===Symbol.for("react.memo_cache_sentinel")?(et={airplanesRef:aa,airplaneIdRef:ai,airplaneSpawnTimerRef:an,helicoptersRef:al,helicopterIdRef:ao,helicopterSpawnTimerRef:as},tR[59]=et):et=tR[59];let nC=et;tR[60]!==tF?(er={worldStateRef:aH,gridVersionRef:aL,cachedPopulationRef:a$,isMobile:tF},tR[60]=tF,tR[61]=er):er=tR[61];let{updateAirplanes:nN,updateHelicopters:nz}=function(e,t){let{airplanesRef:r,airplaneIdRef:a,airplaneSpawnTimerRef:i,helicoptersRef:n,helicopterIdRef:o,helicopterSpawnTimerRef:s}=e,{worldStateRef:c,gridVersionRef:d,cachedPopulationRef:h,isMobile:u}=t,f=(0,l.useCallback)(()=>{let{grid:e,gridSize:t}=c.current;if(!e||t<=0)return[];let r=[];for(let a=0;a<t;a++)for(let i=0;i<t;i++)"airport"===e[a][i].building.type&&r.push({x:i,y:a});return r},[c]),m=(0,l.useCallback)(()=>{let{grid:e,gridSize:t}=c.current;if(!e||t<=0)return[];let r=[];for(let a=0;a<t;a++)for(let i=0;i<t;i++){let t=e[a][i].building.type;"hospital"===t?r.push({x:i,y:a,type:"hospital",size:2}):"airport"===t?r.push({x:i,y:a,type:"airport",size:4}):"police_station"===t?r.push({x:i,y:a,type:"police",size:1}):"mall"===t&&(31*i+17*a)%100>=50&&r.push({x:i,y:a,type:"mall",size:3})}return r},[c]);return{updateAirplanes:(0,l.useCallback)(e=>{let t,{grid:n,gridSize:l,speed:o,zoom:s}=c.current;if(!n||l<=0||0===o)return;if(s<0){r.current=[];return}let m=f(),g=d.current;if(h.current.gridVersion===g)t=h.current.count;else{t=0;for(let e=0;e<l;e++)for(let r=0;r<l;r++)t+=n[e][r].building.population||0;h.current={count:t,gridVersion:g}}if(0===m.length||t<2e3){r.current=[];return}let p=Math.min(80,Math.max(25,3*Math.floor(t/2e3))),x=1===o?1:2===o?1.5:2;if(i.current-=e,r.current.length<p&&i.current<=0){let e=m[Math.floor(Math.random()*m.length)],{screenX:t,screenY:n}=iR(e.x,e.y,0,0),o=t+128,s=n+76.8;if(.5>Math.random()){let t=Math.random()*Math.PI*2,i=a0[Math.floor(Math.random()*a0.length)];r.current.push({id:a.current++,x:o,y:s,angle:t,state:"taking_off",speed:30+20*Math.random(),altitude:0,targetAltitude:1,airportX:e.x,airportY:e.y,stateProgress:0,contrail:[],lifeTime:30+20*Math.random(),color:aZ[Math.floor(Math.random()*aZ.length)],planeType:i})}else{let t,i,n=38.4*l/2,c=64*l;switch(Math.floor(4*Math.random())){case 0:t=0+(Math.random()-.5)*c,i=n-c/2-200;break;case 1:t=0+c/2+200,i=n+(Math.random()-.5)*c/2;break;case 2:t=0+(Math.random()-.5)*c,i=n+c/2+200;break;default:t=0-c/2-200,i=n+(Math.random()-.5)*c/2}let d=Math.atan2(s-i,o-t),h=a0[Math.floor(Math.random()*a0.length)];r.current.push({id:a.current++,x:t,y:i,angle:d,state:"flying",speed:80+40*Math.random(),altitude:1,targetAltitude:1,airportX:e.x,airportY:e.y,stateProgress:0,contrail:[],lifeTime:30+20*Math.random(),color:aZ[Math.floor(Math.random()*aZ.length)],planeType:h})}i.current=2+5*Math.random()}let y=[];for(let t of r.current){let r=u?.8:3,a=u?.06:.02;if(t.contrail=t.contrail.map(t=>({...t,age:t.age+e,opacity:Math.max(0,1-t.age/r)})).filter(e=>e.age<r),t.altitude>.7&&(t.stateProgress+=e,t.stateProgress>=a)){t.stateProgress-=a;let e=t.x-40*Math.cos(t.angle),r=t.y-40*Math.sin(t.angle)+8;t.contrail.push({x:e,y:r,age:0,opacity:1})}switch(t.state){case"taking_off":t.x+=Math.cos(t.angle)*t.speed*e*x,t.y+=Math.sin(t.angle)*t.speed*e*x,t.altitude=Math.min(1,t.altitude+.3*e),t.speed=Math.min(120,t.speed+20*e),t.altitude>=1&&(t.state="flying");break;case"flying":{t.x+=Math.cos(t.angle)*t.speed*e*x,t.y+=Math.sin(t.angle)*t.speed*e*x,t.lifeTime-=e;let{screenX:r,screenY:a}=iR(t.airportX,t.airportY,0,0),i=r+128,n=a+76.8;if(400>Math.hypot(t.x-i,t.y-n)&&t.lifeTime<10)t.state="landing",t.targetAltitude=0,t.angle=Math.atan2(n-t.y,i-t.x);else if(t.lifeTime<=0)continue;break}case"landing":{let{screenX:r,screenY:a}=iR(t.airportX,t.airportY,0,0),i=r+128,n=a+76.8,l=Math.atan2(n-t.y,i-t.x);if(t.angle=l,t.x+=Math.cos(t.angle)*t.speed*e*x,t.y+=Math.sin(t.angle)*t.speed*e*x,t.altitude=Math.max(0,t.altitude-.25*e),t.speed=Math.max(30,t.speed-15*e),50>Math.hypot(t.x-i,t.y-n)||t.altitude<=0)continue;break}case"taxiing":continue}y.push(t)}r.current=y},[c,d,h,r,a,i,f,u]),updateHelicopters:(0,l.useCallback)(e=>{let t,{grid:r,gridSize:a,speed:i,zoom:l}=c.current;if(!r||a<=0||0===i)return;if(l<.2){n.current=[];return}let f=m(),g=d.current;if(h.current.gridVersion===g)t=h.current.count;else{t=0;for(let e=0;e<a;e++)for(let i=0;i<a;i++)t+=r[e][i].building.population||0;h.current={count:t,gridVersion:g}}if(f.length<2||t<3e3){n.current=[];return}let p=Math.min(60,Math.max(6,Math.min(Math.floor(t/1e3),Math.floor(2.5*f.length)))),x=1===i?1:2===i?1.5:2;if(s.current-=e,n.current.length<p&&s.current<=0){let e=Math.floor(Math.random()*f.length),t=f[e],r=f.filter((t,r)=>r!==e);if(r.length>0){let e=r[Math.floor(Math.random()*r.length)],{screenX:a,screenY:i}=iR(t.x,t.y,0,0),l=a+64*t.size/2,s=i+38.4*t.size/2,{screenX:c,screenY:d}=iR(e.x,e.y,0,0),h=c+64*e.size/2,u=d+38.4*e.size/2,f=Math.atan2(u-s,h-l),m=.8+.6*Math.random(),g=Math.PI/4+Math.PI/6*Math.random();n.current.push({id:o.current++,x:l,y:s,angle:f,state:"taking_off",speed:15+10*Math.random(),altitude:0,targetAltitude:.5,originX:t.x,originY:t.y,originType:t.type,destX:e.x,destY:e.y,destType:e.type,destScreenX:h,destScreenY:u,stateProgress:0,rotorWash:[],rotorAngle:0,color:a9[Math.floor(Math.random()*a9.length)],searchlightAngle:0,searchlightSweepSpeed:m,searchlightSweepRange:g,searchlightBaseAngle:f+Math.PI/2})}s.current=.8+2.2*Math.random()}let y=[];for(let t of n.current){t.rotorAngle+=25*e,t.searchlightAngle+=e*t.searchlightSweepSpeed,t.searchlightBaseAngle=t.angle+Math.PI/2;let r=u?.4:1,a=u?.08:.04;if(t.rotorWash=t.rotorWash.map(t=>({...t,age:t.age+e,opacity:Math.max(0,1-t.age/r)})).filter(e=>e.age<r),t.altitude>.2&&"flying"===t.state&&(t.stateProgress+=e,t.stateProgress>=a)){t.stateProgress-=a;let e=t.angle+Math.PI;t.rotorWash.push({x:t.x+6*Math.cos(e),y:t.y+6*Math.sin(e),age:0,opacity:1})}switch(t.state){case"taking_off":t.altitude=Math.min(.5,t.altitude+.4*e),t.speed=Math.min(50,t.speed+15*e),t.altitude>=.3&&(t.x+=Math.cos(t.angle)*t.speed*e*x*.5,t.y+=Math.sin(t.angle)*t.speed*e*x*.5),t.altitude>=.5&&(t.state="flying");break;case"flying":t.x+=Math.cos(t.angle)*t.speed*e*x,t.y+=Math.sin(t.angle)*t.speed*e*x,80>Math.hypot(t.x-t.destScreenX,t.y-t.destScreenY)&&(t.state="landing",t.targetAltitude=0);break;case"landing":{let r=Math.hypot(t.x-t.destScreenX,t.y-t.destScreenY);if(t.speed=Math.max(10,t.speed-20*e),r>15){let r=Math.atan2(t.destScreenY-t.y,t.destScreenX-t.x);t.angle=r,t.x+=Math.cos(t.angle)*t.speed*e*x,t.y+=Math.sin(t.angle)*t.speed*e*x}if(t.altitude=Math.max(0,t.altitude-.3*e),t.altitude<=0&&r<20)continue}}y.push(t)}n.current=y},[c,d,h,n,o,s,m,u]),findAirportsCallback:f,findHeliportsCallback:m}}(nC,er);tR[62]===Symbol.for("react.memo_cache_sentinel")?(ei={seaplanesRef:ac,seaplaneIdRef:ad,seaplaneSpawnTimerRef:ah},tR[62]=ei):ei=tR[62];let nR=ei;tR[63]!==tF?(en={worldStateRef:aH,gridVersionRef:aL,cachedPopulationRef:a$,isMobile:tF},tR[63]=tF,tR[64]=en):en=tR[64];let{updateSeaplanes:nY}=function(e,t){let{seaplanesRef:r,seaplaneIdRef:a,seaplaneSpawnTimerRef:i}=e,{worldStateRef:n,gridVersionRef:o,cachedPopulationRef:s,isMobile:c}=t,d=(0,l.useCallback)(()=>{let{grid:e,gridSize:t}=n.current;return function(e,t,r=15){if(!e||t<=0)return[];let a=[[-1,0],[1,0],[0,-1],[0,1]],i=new Set,n=[];for(let l=0;l<t;l++)for(let o=0;o<t;o++){let s=`${o},${l}`;if(i.has(s)||"water"!==e[l][o].building.type)continue;let c=[],d=[{x:o,y:l}];for(i.add(s);d.length>0;){let r=d.shift();for(let[n,l]of(c.push(r),a)){let a=r.x+n,o=r.y+l,s=`${a},${o}`;a>=0&&a<t&&o>=0&&o<t&&!i.has(s)&&"water"===e[o][a].building.type&&(i.add(s),d.push({x:a,y:o}))}}if(c.length>=r){let e=c.reduce((e,t)=>e+t.x,0)/c.length,t=c.reduce((e,t)=>e+t.y,0)/c.length,r=c[0],a=1/0;for(let i of c){let n=Math.hypot(i.x-e,i.y-t);n<a&&(a=n,r=i)}let{screenX:i,screenY:l}=iR(r.x,r.y,0,0);n.push({centerX:r.x,centerY:r.y,screenX:i+32,screenY:l+19.2,size:c.length,waterTiles:c})}}return n}(e,t,12)},[n]),h=(0,l.useCallback)(()=>{let{grid:e,gridSize:t}=n.current;return nf(e,t)},[n]),u=(0,l.useCallback)((e,t)=>{let{grid:r,gridSize:a}=n.current;return nx(r,a,e,t)},[n]);return{updateSeaplanes:(0,l.useCallback)(e=>{let t,{grid:l,gridSize:f,speed:m,zoom:g}=n.current;if(!l||f<=0||0===m)return;if(g<.3){r.current=[];return}let p=d(),x=h(),y=o.current;if(s.current.gridVersion===y)t=s.current.count;else{t=0;for(let e=0;e<f;e++)for(let r=0;r<f;r++)t+=l[e][r].building.population||0;s.current={count:t,gridVersion:y}}if(0===p.length||t<3e3){r.current=[];return}let b=Math.min(c?5:25,Math.max(c?1:3,Math.min(Math.floor(t/2e3),Math.floor(5*p.length)))),w=1===m?1:2===m?1.5:2;if(i.current-=e,r.current.length<b&&i.current<=0){let e=p[Math.floor(Math.random()*p.length)],t=function(e,t,r,a){let i=new Set(t.map(e=>`${e.x},${e.y}`)),n=[];for(let t of e){let e=nm(r,a,t.x,t.y);e&&i.has(`${e.x},${e.y}`)&&n.push({dock:t,waterTile:e})}return n}(x,e.waterTiles,l,f),n=null,o=null,s=null,c=null,d="taxiing_water",h=function(e){let t=e.waterTiles[Math.floor(Math.random()*e.waterTiles.length)],{screenX:r,screenY:a}=iR(t.x,t.y,0,0);return{x:t.x,y:t.y,screenX:r+32,screenY:a+19.2}}(e);if(t.length>0){let e=t[Math.floor(Math.random()*t.length)];n=e.waterTile.x,o=e.waterTile.y;let r=iR(e.waterTile.x,e.waterTile.y,0,0);s=r.screenX+32,c=r.screenY+19.2,d=.6>Math.random()?"taxiing_to_dock":"taxiing_water"}let u=Math.random()*Math.PI*2;r.current.push({id:a.current++,x:h.screenX,y:h.screenY,angle:u,targetAngle:u,state:d,speed:18*(.8+.4*Math.random()),altitude:0,targetAltitude:0,bayTileX:e.centerX,bayTileY:e.centerY,bayScreenX:e.screenX,bayScreenY:e.screenY,stateProgress:0,contrail:[],wake:[],wakeSpawnProgress:0,lifeTime:25+25*Math.random(),taxiTime:4+6*Math.random(),color:a4[Math.floor(Math.random()*a4.length)],dockTileX:n,dockTileY:o,dockScreenX:s,dockScreenY:c,dockTime:8+12*Math.random(),flightCount:0}),i.current=4+6*Math.random()}let v=[];for(let t of r.current){let r=c?.8:3,a=c?.06:.02;t.contrail=t.contrail.map(t=>({...t,age:t.age+e,opacity:Math.max(0,1-t.age/r)})).filter(e=>e.age<r);let i=c?.6:2;if(t.wake=t.wake.map(t=>({...t,age:t.age+e,opacity:Math.max(0,1-t.age/i)})).filter(e=>e.age<i),t.altitude>.7&&(t.stateProgress+=e,t.stateProgress>=a)){t.stateProgress-=a;let e=t.x-25*Math.cos(t.angle),r=t.y-25*Math.sin(t.angle)+-2;t.contrail.push({x:e,y:r,age:0,opacity:1})}let n=t.x,l=t.y;switch(t.state){case"taxiing_to_dock":{if(null===t.dockScreenX||null===t.dockScreenY){t.state="taxiing_water";break}if(!u(t.x,t.y))continue;let r=Math.hypot(t.x-t.dockScreenX,t.y-t.dockScreenY),a=Math.atan2(t.dockScreenY-t.y,t.dockScreenX-t.x);t.targetAngle=a;let i=t.targetAngle-t.angle;for(;i>Math.PI;)i-=2*Math.PI;for(;i<-Math.PI;)i+=2*Math.PI;let o=Math.PI*e*2;t.angle+=Math.max(-o,Math.min(o,i)),r<60?t.speed=Math.max(6,t.speed-15*e):r<100&&(t.speed=Math.max(12,t.speed-8*e)),u(n=t.x+Math.cos(t.angle)*t.speed*e*w,l=t.y+Math.sin(t.angle)*t.speed*e*w)||(n=t.x,l=t.y);let s=c?.08:.03;t.wakeSpawnProgress+=e,t.wakeSpawnProgress>=s&&(t.wakeSpawnProgress-=s,t.wake.push({x:t.x+-8*Math.cos(t.angle),y:t.y+-8*Math.sin(t.angle),age:0,opacity:1})),r<25&&(t.state="docked",t.speed=0,t.wake=[],t.dockTime=8+12*Math.random());break}case"docked":if(t.dockTime-=e,t.speed=0,null!==t.dockScreenX&&null!==t.dockScreenY&&!u(t.dockScreenX,t.dockScreenY))continue;if(null!==t.dockScreenX&&null!==t.dockScreenY&&(n=t.dockScreenX,l=t.dockScreenY),t.dockTime<=0){t.state="taxiing_water",t.speed=18*(.8+.4*Math.random()),t.taxiTime=4+6*Math.random();let e=Math.atan2(t.bayScreenY-t.y,t.bayScreenX-t.x);t.angle=e+(Math.random()-.5)*.5,t.targetAngle=t.angle}break;case"taxiing_water":{if(t.taxiTime-=e,!u(t.x,t.y))continue;let r=t.angle%(2*Math.PI);r<0&&(r+=2*Math.PI),t.angle=r;let a=t.targetAngle%(2*Math.PI);a<0&&(a+=2*Math.PI),t.targetAngle=a;let i=Math.hypot(t.x-t.bayScreenX,t.y-t.bayScreenY),o=Math.atan2(t.bayScreenY-t.y,t.bayScreenX-t.x),s=o%(2*Math.PI);s<0&&(s+=2*Math.PI),i>100?(t.targetAngle=s+(Math.random()-.5)*.5,t.targetAngle=t.targetAngle%(2*Math.PI),t.targetAngle<0&&(t.targetAngle+=2*Math.PI)):i>50?.01>Math.random()&&(t.targetAngle=t.angle+(Math.random()-.5)*Math.PI/4,t.targetAngle=t.targetAngle%(2*Math.PI),t.targetAngle<0&&(t.targetAngle+=2*Math.PI)):.005>Math.random()&&(t.targetAngle=t.angle+(Math.random()-.5)*Math.PI/6,t.targetAngle=t.targetAngle%(2*Math.PI),t.targetAngle<0&&(t.targetAngle+=2*Math.PI));let d=.5*t.speed,h=!u(t.x+Math.cos(t.angle)*d,t.y+Math.sin(t.angle)*d);h&&(t.targetAngle=s);let f=t.targetAngle-t.angle;for(;f>Math.PI;)f-=2*Math.PI;for(;f<-Math.PI;)f+=2*Math.PI;let m=Math.PI*e*(h?3:1.5),g=Math.max(-m,Math.min(m,f));t.angle+=g,t.angle=t.angle%(2*Math.PI),t.angle<0&&(t.angle+=2*Math.PI),u(n=t.x+Math.cos(t.angle)*t.speed*e*w,l=t.y+Math.sin(t.angle)*t.speed*e*w)||(t.targetAngle=s,n=t.x,l=t.y);let p=c?.08:.03;t.wakeSpawnProgress+=e,t.wakeSpawnProgress>=p&&(t.wakeSpawnProgress-=p,t.wake.push({x:t.x+-8*Math.cos(t.angle),y:t.y+-8*Math.sin(t.angle),age:0,opacity:1})),t.taxiTime<=0&&(t.state="taking_off",t.speed=60,t.angle=o+(Math.random()-.5)*.8,t.targetAngle=t.angle);break}case"taking_off":if(t.speed=Math.min(100,t.speed+50*e),t.altitude=Math.min(1,t.altitude+.6*e),n=t.x+Math.cos(t.angle)*t.speed*e*w,l=t.y+Math.sin(t.angle)*t.speed*e*w,t.altitude<.3){let r=c?.04:.015;t.wakeSpawnProgress+=e,t.wakeSpawnProgress>=r&&(t.wakeSpawnProgress-=r,t.wake.push({x:t.x+-10*Math.cos(t.angle),y:t.y+-10*Math.sin(t.angle),age:0,opacity:1}))}t.altitude>=1&&(t.state="flying",t.speed=70+30*Math.random(),t.flightCount++);break;case"flying":{n=t.x+Math.cos(t.angle)*t.speed*e*w,l=t.y+Math.sin(t.angle)*t.speed*e*w,t.lifeTime-=e;let r=Math.hypot(t.x-t.bayScreenX,t.y-t.bayScreenY);if(r>1600)continue;if(t.lifeTime<=5){let a=Math.atan2(t.bayScreenY-t.y,t.bayScreenX-t.x)-t.angle;for(;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=2*Math.PI;let i=Math.PI*e*.8;if(t.angle+=Math.max(-i,Math.min(i,a)),r<300)if(!u(t.bayScreenX,t.bayScreenY))continue;else t.state="landing",t.targetAltitude=0}else if(t.lifeTime<=0)continue;.01>Math.random()&&(t.angle+=(Math.random()-.5)*.2);break}case"landing":{if(t.speed=Math.max(60,t.speed-15*e),t.altitude=Math.max(0,t.altitude-.25*e),!u(t.bayScreenX,t.bayScreenY))continue;let r=Math.atan2(t.bayScreenY-t.y,t.bayScreenX-t.x)-t.angle;for(;r>Math.PI;)r-=2*Math.PI;for(;r<-Math.PI;)r+=2*Math.PI;let a=Math.PI*e*.5;t.angle+=Math.max(-a,Math.min(a,r)),n=t.x+Math.cos(t.angle)*t.speed*e*w,l=t.y+Math.sin(t.angle)*t.speed*e*w,t.altitude<=.1&&(t.state="splashdown");break}case"splashdown":if(t.altitude=0,t.speed=Math.max(0,t.speed-25*e),u(n=t.x+Math.cos(t.angle)*t.speed*e*w,l=t.y+Math.sin(t.angle)*t.speed*e*w)||(n=t.x,l=t.y,t.speed=0),t.speed>5){let r=c?.04:.015;t.wakeSpawnProgress+=e,t.wakeSpawnProgress>=r&&(t.wakeSpawnProgress-=r,t.wake.push({x:t.x+-10*Math.cos(t.angle),y:t.y+-10*Math.sin(t.angle),age:0,opacity:1}))}if(t.speed<=1){if(t.flightCount>=3||!u(t.x,t.y))continue;null!==t.dockScreenX&&null!==t.dockScreenY?(t.state="taxiing_to_dock",t.speed=18*(.8+.4*Math.random())):(t.state="taxiing_water",t.speed=18*(.8+.4*Math.random()),t.taxiTime=4+6*Math.random()),t.lifeTime=25+25*Math.random()}}t.x=n,t.y=l,v.push(t)}r.current=v},[n,o,s,r,a,i,d,h,u,c]),findBaysCallback:d,findDocksCallback:h}}(nR,en);tR[65]===Symbol.for("react.memo_cache_sentinel")?(el={bargesRef:ag,bargeIdRef:ap,bargeSpawnTimerRef:ax},tR[65]=el):el=tR[65];let nX=el;tR[66]!==tF||tR[67]!==tV||tR[68]!==t1?(eo={worldStateRef:aH,isMobile:tF,visualHour:t1,onBargeDelivery:tV},tR[66]=tF,tR[67]=tV,tR[68]=t1,tR[69]=eo):eo=tR[69];let{updateBarges:nA,drawBarges:n$}=function(e,t){let{bargesRef:r,bargeIdRef:a,bargeSpawnTimerRef:i}=e,{worldStateRef:n,isMobile:o,visualHour:s,onBargeDelivery:c}=t,d=(0,l.useCallback)(()=>{let{grid:e,gridSize:t}=n.current;return function(e,t){if(!e||t<=0)return[];let r=new Set,a=new Set,i=[];for(let r=0;r<t;r++)for(let n of[{x:0,y:r},{x:t-1,y:r},{x:r,y:0},{x:r,y:t-1}])if("water"===e[n.y][n.x].building.type){let e=`${n.x},${n.y}`;a.has(e)||(i.push(n),a.add(e))}let n=[[-1,0],[1,0],[0,-1],[0,1]];for(;i.length>0;){let{x:l,y:o}=i.shift();for(let[s,c]of(r.add(`${l},${o}`),n)){let r=l+s,n=o+c,d=`${r},${n}`;r>=0&&r<t&&n>=0&&n<t&&!a.has(d)&&"water"===e[n][r].building.type&&(a.add(d),i.push({x:r,y:n}))}}let l=[];for(let a=0;a<t;a++)for(let i=0;i<t;i++)if("marina_docks_small"===e[a][i].building.type){let e=!1;for(let t of[{nx:i-1,ny:a-1},{nx:i,ny:a-1},{nx:i+1,ny:a-1},{nx:i+2,ny:a-1},{nx:i-1,ny:a+2},{nx:i,ny:a+2},{nx:i+1,ny:a+2},{nx:i+2,ny:a+2},{nx:i-1,ny:a},{nx:i-1,ny:a+1},{nx:i+2,ny:a},{nx:i+2,ny:a+1}])if(r.has(`${t.nx},${t.ny}`)){e=!0;break}e&&l.push({x:i,y:a,type:"marina"})}return l}(e,t)},[n]),h=(0,l.useCallback)(()=>{let{grid:e,gridSize:t}=n.current;return function(e,t){if(!e||t<=0)return[];let r=[];for(let a=0;a<t;a++){if("water"===e[a][0].building.type){let{screenX:e,screenY:t}=iR(0,a,0,0);r.push({x:0,y:a,screenX:e+32,screenY:t+19.2,edge:"west"})}if("water"===e[a][t-1].building.type){let{screenX:e,screenY:i}=iR(t-1,a,0,0);r.push({x:t-1,y:a,screenX:e+32,screenY:i+19.2,edge:"east"})}if("water"===e[0][a].building.type){let{screenX:e,screenY:t}=iR(a,0,0,0);r.push({x:a,y:0,screenX:e+32,screenY:t+19.2,edge:"north"})}if("water"===e[t-1][a].building.type){let{screenX:e,screenY:i}=iR(a,t-1,0,0);r.push({x:a,y:t-1,screenX:e+32,screenY:i+19.2,edge:"south"})}}return r}(e,t)},[n]),u=(0,l.useCallback)((e,t)=>{let{grid:r,gridSize:a}=n.current;if(!r||a<=0)return null;for(let i of[{nx:e-1,ny:t},{nx:e-1,ny:t+1},{nx:e+2,ny:t},{nx:e+2,ny:t+1},{nx:e,ny:t-1},{nx:e+1,ny:t-1},{nx:e,ny:t+2},{nx:e+1,ny:t+2},{nx:e-1,ny:t-1},{nx:e+2,ny:t-1},{nx:e-1,ny:t+2},{nx:e+2,ny:t+2}])if(i.nx>=0&&i.nx<a&&i.ny>=0&&i.ny<a&&"water"===r[i.ny][i.nx].building.type)return{x:i.nx,y:i.ny};return null},[n]),f=(0,l.useCallback)((e,t)=>{let{grid:r,gridSize:a}=n.current;return nx(r,a,e,t)},[n]);return{updateBarges:(0,l.useCallback)(e=>{let{grid:t,gridSize:l,speed:s,zoom:m}=n.current;if(!t||l<=0||0===s)return;if(m<.25){r.current=[];return}let g=d(),p=h();if(0===g.length||0===p.length){r.current=[];return}let x=1===s?1:2===s?1.5:2,y=o?2:4;if(i.current-=e,r.current.length<y&&i.current<=0){let e=p[Math.floor(Math.random()*p.length)],t=g[Math.floor(Math.random()*g.length)],n=u(t.x,t.y);if(n){let{screenX:i,screenY:l}=iR(n.x,n.y,0,0),o=Math.atan2(l+19.2-e.screenY,i+32-e.screenX);r.current.push({id:a.current++,x:e.screenX,y:e.screenY,angle:o,targetAngle:o,state:"approaching",speed:8+4*Math.random(),spawnEdge:e.edge,spawnScreenX:e.screenX,spawnScreenY:e.screenY,targetMarinaX:t.x,targetMarinaY:t.y,targetScreenX:i+32,targetScreenY:l+19.2,age:0,color:a7[Math.floor(Math.random()*a7.length)],wake:[],wakeSpawnProgress:0,cargoType:Math.floor(3*Math.random()),cargoValue:Math.floor(100+250*Math.random()),dockTime:0,maxDockTime:8+7*Math.random()})}i.current=8+12*Math.random()}let b=[];for(let t of r.current){t.age+=e;let r=o?.8:2;t.wake=t.wake.map(t=>({...t,age:t.age+e,opacity:Math.max(0,1-t.age/r)})).filter(e=>e.age<r);let a=Math.hypot(t.x-t.targetScreenX,t.y-t.targetScreenY),i=t.x,n=t.y;switch(t.state){case"approaching":{let r=Math.atan2(t.targetScreenY-t.y,t.targetScreenX-t.x);t.targetAngle=r;let l=t.targetAngle-t.angle;for(;l>Math.PI;)l-=2*Math.PI;for(;l<-Math.PI;)l+=2*Math.PI;if(t.angle+=l*Math.min(1,+e),i=t.x+Math.cos(t.angle)*t.speed*e*x,n=t.y+Math.sin(t.angle)*t.speed*e*x,a<80&&(t.state="docking"),t.age>120)continue;break}case"docking":{t.speed=Math.max(3,t.speed-3*e);let r=Math.atan2(t.targetScreenY-t.y,t.targetScreenX-t.x);t.targetAngle=r;let l=t.targetAngle-t.angle;for(;l>Math.PI;)l-=2*Math.PI;for(;l<-Math.PI;)l+=2*Math.PI;t.angle+=l*Math.min(1,1.5*e),i=t.x+Math.cos(t.angle)*t.speed*e*x,n=t.y+Math.sin(t.angle)*t.speed*e*x,a<25&&(t.state="docked",t.dockTime=0,t.wake=[]);break}case"docked":t.dockTime+=e*x,t.dockTime>=t.maxDockTime&&(t.state="departing",t.speed=3,t.age=0,t.targetScreenX=t.spawnScreenX,t.targetScreenY=t.spawnScreenY,c&&c(t.cargoValue,t.cargoType));break;case"departing":{t.speed=Math.min(12,t.speed+2*e);let r=Math.atan2(t.targetScreenY-t.y,t.targetScreenX-t.x);t.targetAngle=r;let a=t.targetAngle-t.angle;for(;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=2*Math.PI;t.angle+=a*Math.min(1,+e),i=t.x+Math.cos(t.angle)*t.speed*e*x,n=t.y+Math.sin(t.angle)*t.speed*e*x,t.age>3&&(t.state="leaving");break}case"leaving":{let r=Math.atan2(t.targetScreenY-t.y,t.targetScreenX-t.x);t.targetAngle=r;let a=t.targetAngle-t.angle;for(;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=2*Math.PI;if(t.angle+=a*Math.min(1,+e),i=t.x+Math.cos(t.angle)*t.speed*e*x,n=t.y+Math.sin(t.angle)*t.speed*e*x,50>Math.hypot(t.x-t.spawnScreenX,t.y-t.spawnScreenY)||t.age>60)continue}}if("docked"!==t.state){if(!f(i,n))continue;t.x=i,t.y=n;let r=o?.08:.05;t.wakeSpawnProgress+=e,t.wakeSpawnProgress>=r&&(t.wakeSpawnProgress-=r,t.wake.push({x:t.x+-12*Math.cos(t.angle)+8*Math.cos(t.angle+Math.PI/2),y:t.y+-12*Math.sin(t.angle)+8*Math.sin(t.angle+Math.PI/2),age:0,opacity:1}),t.wake.push({x:t.x+-12*Math.cos(t.angle)+8*Math.cos(t.angle-Math.PI/2),y:t.y+-12*Math.sin(t.angle)+8*Math.sin(t.angle-Math.PI/2),age:0,opacity:1}))}b.push(t)}r.current=b},[n,r,a,i,d,h,u,f,o,c]),drawBarges:(0,l.useCallback)(e=>{let{offset:t,zoom:a,grid:i,gridSize:l}=n.current,c=e.canvas,d=window.devicePixelRatio||1;if(a<.25||!i||l<=0||0===r.current.length)return;e.save(),e.scale(d*a,d*a),e.translate(t.x/a,t.y/a);let h=c.width/(d*a),u=c.height/(d*a),f=-t.x/a-150,m=-t.y/a-150,g=h-t.x/a+150,p=u-t.y/a+150,x=!o||a>=.45;for(let t of r.current){if(x&&t.wake.length>0)for(let r of t.wake){if(r.x<f||r.x>g||r.y<m||r.y>p)continue;let t=2+3*r.age,a=.5*r.opacity;e.fillStyle=`rgba(200, 220, 255, ${a})`,e.beginPath(),e.arc(r.x,r.y,t,0,2*Math.PI),e.fill()}if(!(t.x<f)&&!(t.x>g)&&!(t.y<m)&&!(t.y>p)){if(e.save(),e.translate(t.x,t.y),e.rotate(t.angle),e.scale(.9,.9),"docked"!==t.state){let r=Math.min(.6,t.speed/15);e.fillStyle=`rgba(255, 255, 255, ${r})`,e.beginPath(),e.ellipse(-18,0,6,4,0,0,2*Math.PI),e.fill()}if(e.fillStyle=t.color,e.beginPath(),e.moveTo(20,0),e.lineTo(15,-10),e.lineTo(-18,-10),e.lineTo(-20,-8),e.lineTo(-20,8),e.lineTo(-18,10),e.lineTo(15,10),e.lineTo(20,0),e.closePath(),e.fill(),e.strokeStyle="#1a1a1a",e.lineWidth=.8,e.stroke(),e.fillStyle="#555555",e.fillRect(-15,-8,30,16),0===t.cargoType){let t=["#c0392b","#27ae60","#2980b9","#f39c12"];for(let r=0;r<2;r++)for(let a=0;a<3;a++)e.fillStyle=t[(3*r+a)%t.length],e.fillRect(-12+8*a,-6+6*r,7,5),e.strokeStyle="#222",e.lineWidth=.3,e.strokeRect(-12+8*a,-6+6*r,7,5)}else if(1===t.cargoType)e.fillStyle="#8b7355",e.beginPath(),e.moveTo(-12,6),e.quadraticCurveTo(-8,-4,0,-5),e.quadraticCurveTo(8,-4,12,6),e.lineTo(-12,6),e.closePath(),e.fill(),e.strokeStyle="#5c4d3d",e.lineWidth=.5,e.stroke();else{e.fillStyle="#3498db";for(let t=0;t<2;t++)e.beginPath(),e.ellipse(-6+12*t,0,5,6,0,0,2*Math.PI),e.fill(),e.strokeStyle="#2980b9",e.lineWidth=.5,e.stroke()}e.fillStyle="#ecf0f1",e.fillRect(-16,-4,6,8),e.strokeStyle="#333",e.lineWidth=.4,e.strokeRect(-16,-4,6,8),e.fillStyle="#2c3e50",e.fillRect(-15,-2,4,2),e.strokeStyle="#666",e.lineWidth=1.2,e.beginPath(),e.moveTo(-13,-4),e.lineTo(-13,-12),e.stroke(),(s>=20||s<6)&&(e.fillStyle="#ffffff",o||(e.shadowColor="#ffffcc",e.shadowBlur=15),e.beginPath(),e.arc(-13,-13,o?1.8:1.2,0,2*Math.PI),e.fill(),e.fillStyle="#ff3333",o||(e.shadowColor="#ff0000",e.shadowBlur=10),e.beginPath(),e.arc(-15,8,o?1.2:.8,0,2*Math.PI),e.fill(),e.fillStyle="#33ff33",o||(e.shadowColor="#00ff00",e.shadowBlur=10),e.beginPath(),e.arc(-15,-8,o?1.2:.8,0,2*Math.PI),e.fill(),e.fillStyle="#ffffff",o||(e.shadowColor="#ffffff",e.shadowBlur=8),e.beginPath(),e.arc(-20,0,o?1:.6,0,2*Math.PI),e.fill(),e.shadowBlur=0),e.restore()}}e.restore()},[n,r,s,o])}}(nX,eo);tR[70]===Symbol.for("react.memo_cache_sentinel")?(es={boatsRef:au,boatIdRef:af,boatSpawnTimerRef:am},tR[70]=es):es=tR[70];let nB=es;tR[71]!==tF||tR[72]!==t1?(ec={worldStateRef:aH,isMobile:tF,visualHour:t1},tR[71]=tF,tR[72]=t1,tR[73]=ec):ec=tR[73];let{updateBoats:nL,drawBoats:nV}=function(e,t){let{boatsRef:r,boatIdRef:a,boatSpawnTimerRef:i}=e,{worldStateRef:n,isMobile:o,visualHour:s}=t,c=(0,l.useCallback)(()=>{let{grid:e,gridSize:t}=n.current;return nf(e,t)},[n]),d=(0,l.useCallback)((e,t)=>{let{grid:r,gridSize:a}=n.current;return nm(r,a,e,t)},[n]),h=(0,l.useCallback)((e,t)=>{let{grid:r,gridSize:a}=n.current;return nx(r,a,e,t)},[n]),u=(0,l.useCallback)((e,t)=>{let{grid:r,gridSize:a}=n.current;return function(e,t,r,a){let i=function(e,t,r,a,i=200){if(!e||t<=0)return[];let n=new Set,l=[],o=[{x:r,y:a}],s=[[-1,0],[1,0],[0,-1],[0,1]];for(;o.length>0&&l.length<i;){let{x:r,y:a}=o.shift(),i=`${r},${a}`;if(!n.has(i)){if(n.add(i),!(r<0)&&!(r>=t)&&!(a<0)&&!(a>=t)&&"water"===e[a][r].building.type)for(let[e,t]of(l.push({x:r,y:a}),s)){let i=r+e,l=a+t;n.has(`${i},${l}`)||o.push({x:i,y:l})}}}return l}(e,t,r,a);if(i.length<3)return[];let n=Math.min(6,Math.max(2,Math.floor(i.length/10))),l=[],o=new Set,s=i.reduce((e,t)=>e+t.x,0)/i.length,c=i.reduce((e,t)=>e+t.y,0)/i.length,d=i.map((e,t)=>({...e,idx:t,distFromCenter:Math.hypot(e.x-s,e.y-c)}));d.sort((e,t)=>t.distFromCenter-e.distFromCenter+(Math.random()-.5)*3);for(let e=0;e<n&&e<d.length;e++){let t=d[e],r=!1;for(let e of l)if(3>Math.hypot(t.x-e.tileX,t.y-e.tileY)){r=!0;break}if(!r){let{screenX:e,screenY:r}=iR(t.x,t.y,0,0);l.push({screenX:e+32,screenY:r+19.2,tileX:t.x,tileY:t.y}),o.add(t.idx)}}for(;l.length<n&&l.length<i.length;){let e=Math.floor(Math.random()*i.length);if(!o.has(e)){let t=i[e],{screenX:r,screenY:a}=iR(t.x,t.y,0,0);l.push({screenX:r+32,screenY:a+19.2,tileX:t.x,tileY:t.y}),o.add(e)}}return l}(r,a,e,t)},[n]);return{updateBoats:(0,l.useCallback)(e=>{let{grid:t,gridSize:l,speed:s,zoom:f}=n.current;if(!t||l<=0||0===s)return;if(f<.3){r.current=[];return}let m=c();if(0===m.length){r.current=[];return}let g=o?.5:1.5,p=Math.min(o?4:12,Math.floor(m.length*g)),x=1===s?1:2===s?1.5:2;if(i.current-=e,r.current.length<p&&i.current<=0){let e=m[Math.floor(Math.random()*m.length)],t=d(e.x,e.y);if(t){let i=u(t.x,t.y),{screenX:n,screenY:l}=iR(t.x,t.y,0,0),o=n+32,s=l+19.2,c=o,d=s;i.length>0&&(c=i[0].screenX,d=i[0].screenY);let h=Math.atan2(d-l,c-n);r.current.push({id:a.current++,x:o,y:s,angle:h,targetAngle:h,state:"departing",speed:15+10*Math.random(),originX:e.x,originY:e.y,destX:e.x,destY:e.y,destScreenX:c,destScreenY:d,age:0,color:a8[Math.floor(Math.random()*a8.length)],wake:[],wakeSpawnProgress:0,sizeVariant:.7>Math.random()?0:1,tourWaypoints:i,tourWaypointIndex:0,homeScreenX:o,homeScreenY:s})}i.current=1+2*Math.random()}let y=[];for(let t of r.current){t.age+=e;let r=o?.6:2;t.wake=t.wake.map(t=>({...t,age:t.age+e,opacity:Math.max(0,1-t.age/r)})).filter(e=>e.age<r);let a=Math.hypot(t.x-t.destScreenX,t.y-t.destScreenY),i=t.x,n=t.y;switch(t.state){case"departing":i=t.x+Math.cos(t.angle)*t.speed*e*x,n=t.y+Math.sin(t.angle)*t.speed*e*x,t.age>2&&(t.tourWaypoints.length>0?(t.state="touring",t.tourWaypointIndex=0,t.destScreenX=t.tourWaypoints[0].screenX,t.destScreenY=t.tourWaypoints[0].screenY):(t.state="sailing",t.destScreenX=t.homeScreenX,t.destScreenY=t.homeScreenY));break;case"touring":{let r=Math.atan2(t.destScreenY-t.y,t.destScreenX-t.x);t.targetAngle=r;let l=t.targetAngle-t.angle;for(;l>Math.PI;)l-=2*Math.PI;for(;l<-Math.PI;)l+=2*Math.PI;if(t.angle+=l*Math.min(1,1.8*e),i=t.x+Math.cos(t.angle)*t.speed*e*x,n=t.y+Math.sin(t.angle)*t.speed*e*x,a<40)if(t.tourWaypointIndex++,t.tourWaypointIndex<t.tourWaypoints.length){let e=t.tourWaypoints[t.tourWaypointIndex];t.destScreenX=e.screenX,t.destScreenY=e.screenY}else t.state="sailing",t.destScreenX=t.homeScreenX,t.destScreenY=t.homeScreenY,t.age=0;if(t.age>120)continue;break}case"sailing":{let r=Math.atan2(t.destScreenY-t.y,t.destScreenX-t.x);t.targetAngle=r;let l=t.targetAngle-t.angle;for(;l>Math.PI;)l-=2*Math.PI;for(;l<-Math.PI;)l+=2*Math.PI;if(t.angle+=l*Math.min(1,2*e),i=t.x+Math.cos(t.angle)*t.speed*e*x,n=t.y+Math.sin(t.angle)*t.speed*e*x,a<60&&(t.state="arriving"),t.age>60)continue;break}case"arriving":{t.speed=Math.max(5,t.speed-8*e);let r=Math.atan2(t.destScreenY-t.y,t.destScreenX-t.x);t.targetAngle=r;let l=t.targetAngle-t.angle;for(;l>Math.PI;)l-=2*Math.PI;for(;l<-Math.PI;)l+=2*Math.PI;t.angle+=l*Math.min(1,3*e),i=t.x+Math.cos(t.angle)*t.speed*e*x,n=t.y+Math.sin(t.angle)*t.speed*e*x,a<15&&(t.state="docked",t.age=0,t.wake=[]);break}case"docked":if(t.age>3+3*Math.random()){let e=d(t.originX,t.originY);e&&(t.tourWaypoints=u(e.x,e.y),t.tourWaypointIndex=0),t.state="departing",t.speed=15+10*Math.random(),t.age=0,t.tourWaypoints.length>0?(t.destScreenX=t.tourWaypoints[0].screenX,t.destScreenY=t.tourWaypoints[0].screenY):(t.destScreenX=t.homeScreenX+(Math.random()-.5)*200,t.destScreenY=t.homeScreenY+(Math.random()-.5)*200);let r=Math.atan2(t.destScreenY-t.y,t.destScreenX-t.x);t.angle=r,t.targetAngle=r}}if("docked"!==t.state){if(!h(i,n))continue;t.x=i,t.y=n;let r=o?.08:.03;t.wakeSpawnProgress+=e,t.wakeSpawnProgress>=r&&(t.wakeSpawnProgress-=r,t.wake.push({x:t.x+-6*Math.cos(t.angle),y:t.y+-6*Math.sin(t.angle),age:0,opacity:1}))}y.push(t)}r.current=y},[n,r,a,i,c,d,h,u,o]),drawBoats:(0,l.useCallback)(e=>{let{offset:t,zoom:a,grid:i,gridSize:l}=n.current,c=e.canvas,d=window.devicePixelRatio||1;if(a<.3||!i||l<=0||0===r.current.length)return;e.save(),e.scale(d*a,d*a),e.translate(t.x/a,t.y/a);let h=c.width/(d*a),u=c.height/(d*a),f=-t.x/a-100,m=-t.y/a-100,g=h-t.x/a+100,p=u-t.y/a+100,x=!o||a>=.45;for(let t of r.current){if(x&&t.wake.length>0)for(let r of t.wake){if(r.x<f||r.x>g||r.y<m||r.y>p)continue;let t=1.2+2*r.age,a=.5*r.opacity;e.fillStyle=`rgba(200, 220, 255, ${a})`,e.beginPath(),e.arc(r.x,r.y,t,0,2*Math.PI),e.fill()}if(t.x<f||t.x>g||t.y<m||t.y>p)continue;e.save(),e.translate(t.x,t.y),e.rotate(t.angle);let r=0===t.sizeVariant?.5:.65;if(e.scale(r,r),"docked"!==t.state){let r=Math.min(.5,t.speed/30);e.fillStyle=`rgba(255, 255, 255, ${r})`,e.beginPath(),e.ellipse(-7,0,3,2,0,0,2*Math.PI),e.fill()}e.fillStyle=t.color,e.beginPath(),e.moveTo(10,0),e.quadraticCurveTo(8,-4,0,-4),e.lineTo(-8,-3),e.lineTo(-8,3),e.lineTo(0,4),e.quadraticCurveTo(8,4,10,0),e.closePath(),e.fill(),e.strokeStyle="#1a1a1a",e.lineWidth=.5,e.stroke(),e.fillStyle="#ffffff"===t.color?"hsl(0, 0%, 95%)":"#1e3a5f"===t.color?"hsl(210, 52%, 35%)":"#8b4513"===t.color?"hsl(30, 75%, 40%)":"#2f4f4f"===t.color?"hsl(180, 25%, 35%)":"#c41e3a"===t.color?"hsl(350, 75%, 50%)":"hsl(210, 80%, 50%)",e.beginPath(),e.ellipse(0,0,5,2,0,0,2*Math.PI),e.fill(),e.fillStyle="#f5f5f5",e.fillRect(-3,-1.5,4,3),e.strokeStyle="#333",e.lineWidth=.3,e.strokeRect(-3,-1.5,4,3),e.strokeStyle="#666",e.lineWidth=1,e.beginPath(),e.moveTo(2,0),e.lineTo(2,-8),e.stroke(),e.fillStyle="#ff4444",e.beginPath(),e.moveTo(2,-8),e.lineTo(5,-7),e.lineTo(2,-6),e.closePath(),e.fill(),(s>=20||s<6)&&(e.fillStyle="#ffffff",o||(e.shadowColor="#ffffcc",e.shadowBlur=12),e.beginPath(),e.arc(2,-9,o?1.2:.8,0,2*Math.PI),e.fill(),e.fillStyle="#ff3333",o||(e.shadowColor="#ff0000",e.shadowBlur=8),e.beginPath(),e.arc(-6,2,o?1:.6,0,2*Math.PI),e.fill(),e.fillStyle="#33ff33",o||(e.shadowColor="#00ff00",e.shadowBlur=8),e.beginPath(),e.arc(-6,-2,o?1:.6,0,2*Math.PI),e.fill(),e.shadowBlur=0),e.restore()}e.restore()},[n,r,s]),findMarinasAndPiersCallback:c,findAdjacentWaterTileCallback:d,isOverWaterCallback:h,generateTourWaypointsCallback:u}}(nB,ec);tR[74]===Symbol.for("react.memo_cache_sentinel")?(ed={fireworksRef:ak,fireworkIdRef:aj,fireworkSpawnTimerRef:aP,fireworkShowActiveRef:aT,fireworkShowStartTimeRef:aC,fireworkLastHourRef:aN,factorySmogRef:aI,smogLastGridVersionRef:aR,cloudsRef:aY,cloudIdRef:aX,cloudSpawnTimerRef:aA},tR[74]=ed):ed=tR[74];let n5=ed;tR[75]!==tF?(eh={worldStateRef:aH,gridVersionRef:aL,isMobile:tF},tR[75]=tF,tR[76]=eh):eh=tR[76];let{updateFireworks:la,drawFireworks:ll,updateSmog:lo,drawSmog:lB,updateClouds:lW,drawClouds:lD}=function(e,t){let{fireworksRef:r,fireworkIdRef:a,fireworkSpawnTimerRef:i,fireworkShowActiveRef:n,fireworkShowStartTimeRef:o,fireworkLastHourRef:s,factorySmogRef:c,smogLastGridVersionRef:d,cloudsRef:h,cloudIdRef:u,cloudSpawnTimerRef:f}=e,{worldStateRef:m,gridVersionRef:g,isMobile:p}=t,x=(0,l.useCallback)(()=>{let{grid:e,gridSize:t}=m.current;return function(e,t,r){if(!e||t<=0)return[];ng!==r&&(ng=r,np=new Set(r));let a=np,i=[];for(let r=0;r<t;r++)for(let n=0;n<t;n++){let t=e[r][n].building.type;a.has(t)&&i.push({x:n,y:r,type:t})}return i}(e,t,ie)},[m]),y=(0,l.useCallback)(()=>{let{grid:e,gridSize:t}=m.current;return function(e,t){if(!e||t<=0)return[];let r=[];for(let a=0;a<t;a++)for(let i=0;i<t;i++){let t=e[a][i],n=t.building.type;("factory_medium"===n||"factory_large"===n)&&t.building.powered&&!t.building.abandoned&&t.building.constructionProgress>=100&&r.push({x:i,y:a,type:n})}return r}(e,t)},[m]),b=(0,l.useCallback)((e,t)=>{let{grid:l,gridSize:c,speed:d,zoom:h}=m.current;if(!l||c<=0||0===d)return;if(p||h<.3){r.current=[];return}let u=t>=20||t<5;if(t!==s.current){let e=s.current>=20||s.current>=0&&s.current<5;s.current=t,20===t&&!e&&.35>Math.random()&&x().length>0&&(n.current=!0,o.current=0),!u&&e&&(n.current=!1,r.current=[])}if(!u||!n.current){r.current.length>0&&!n.current&&(r.current=[]);return}if(o.current+=e,o.current>45){n.current=!1;return}let f=x();if(0===f.length){n.current=!1;return}let g=1===d?1:2===d?1.5:2;if(i.current-=e,i.current<=0){let e=f[Math.floor(Math.random()*f.length)],{screenX:t,screenY:n}=iR(e.x,e.y,0,0),l=t+32+(Math.random()-.5)*32,o=n+19.2,s=o-50-50*Math.random();r.current.push({id:a.current++,x:l,y:o,vx:(Math.random()-.5)*20,vy:-180,state:"launching",targetY:s,color:it[Math.floor(Math.random()*it.length)],particles:[],age:0,sourceTileX:e.x,sourceTileY:e.y}),i.current=.3+.8999999999999999*Math.random()}let y=[];for(let t of r.current){switch(t.age+=e,t.state){case"launching":if(t.x+=t.vx*e*g,t.y+=t.vy*e*g,t.y<=t.targetY){t.state="exploding",t.age=0;for(let e=0;e<40;e++){let r=e/40*Math.PI*2+.3*Math.random(),a=120*(.5+.5*Math.random());t.particles.push({x:t.x,y:t.y,vx:Math.cos(r)*a,vy:Math.sin(r)*a,age:0,maxAge:1.5*(.7+.3*Math.random()),color:t.color,size:2+2*Math.random(),trail:[]})}}break;case"exploding":{let r=!0;for(let a of t.particles){for(a.trail.push({x:a.x,y:a.y,age:0});a.trail.length>8;)a.trail.shift();for(let t of a.trail)t.age+=e;a.trail=a.trail.filter(e=>e.age<.3),a.age+=e,a.x+=a.vx*e*g,a.y+=a.vy*e*g,a.vy+=150*e,a.vx*=.98,a.vy*=.98,a.age<a.maxAge&&(r=!1)}r&&(t.state="fading",t.age=0);break}case"fading":if(t.age>.5)continue}y.push(t)}r.current=y},[m,r,a,i,n,o,s,x,p]),w=(0,l.useCallback)(e=>{let{offset:t,zoom:a,grid:i,gridSize:n}=m.current,l=e.canvas,o=window.devicePixelRatio||1;if(!i||n<=0||0===r.current.length)return;e.save(),e.scale(o*a,o*a),e.translate(t.x/a,t.y/a);let s=l.width/(o*a),c=l.height/(o*a),d=-t.x/a-100,h=-t.y/a-200,u=s-t.x/a+100,f=c-t.y/a+100;for(let t of r.current)if(!(t.x<d)&&!(t.x>u)&&!(t.y<h)&&!(t.y>f)){if("launching"===t.state){let r=e.createLinearGradient(t.x,t.y,t.x-.1*t.vx,t.y-.1*t.vy);r.addColorStop(0,t.color),r.addColorStop(1,"rgba(255, 200, 100, 0)"),e.strokeStyle=r,e.lineWidth=3,e.lineCap="round",e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(t.x-.08*t.vx,t.y-.08*t.vy),e.stroke(),e.fillStyle="#ffffff",e.beginPath(),e.arc(t.x,t.y,2,0,2*Math.PI),e.fill(),e.fillStyle=t.color,e.globalAlpha=.5,e.beginPath(),e.arc(t.x,t.y,4,0,2*Math.PI),e.fill(),e.globalAlpha=1}else if("exploding"===t.state||"fading"===t.state){for(let r of t.particles){let t=Math.max(0,1-r.age/r.maxAge);if(!(t<=0)){if(r.trail.length>1){e.strokeStyle=r.color,e.lineWidth=.5*r.size,e.lineCap="round",e.globalAlpha=.3*t,e.beginPath(),e.moveTo(r.trail[0].x,r.trail[0].y);for(let t=1;t<r.trail.length;t++)e.lineTo(r.trail[t].x,r.trail[t].y);e.lineTo(r.x,r.y),e.stroke()}e.globalAlpha=t,e.fillStyle=r.color,e.beginPath(),e.arc(r.x,r.y,r.size*t,0,2*Math.PI),e.fill(),e.fillStyle="#ffffff",e.globalAlpha=.7*t,e.beginPath(),e.arc(r.x,r.y,r.size*t*.5,0,2*Math.PI),e.fill()}}e.globalAlpha=1}}e.restore()},[m,r]),v=(0,l.useCallback)(e=>{let{grid:t,gridSize:r,speed:a,zoom:i}=m.current;if(!t||r<=0||0===a)return;if(i<.35){c.current=[];return}if(i>1.8)return;let n=e*([0,1,2,4][a]||1),l=p?12:25,o=p?5:8,s=p?2:1,h=g.current;if(d.current!==h){d.current=h;let e=y(),t=new Map;for(let e of c.current)t.set(`${e.tileX},${e.tileY}`,e);c.current=e.map(e=>{let r=`${e.x},${e.y}`,a=t.get(r),{screenX:i,screenY:n}=iR(e.x,e.y,0,0),l="factory_large"===e.type?76.8:38.4,o="factory_large"===e.type?-46.08:-26.88;return a&&a.buildingType===e.type?(a.screenX=i+l,a.screenY=n+o,a):{tileX:e.x,tileY:e.y,screenX:i+l,screenY:n+o,buildingType:e.type,particles:[],spawnTimer:Math.random()}})}for(let e of c.current){let t=("factory_large"===e.buildingType?.2:.4)*s;for(e.spawnTimer+=n;e.spawnTimer>=t&&e.particles.length<l;){e.spawnTimer-=t;let r=e.screenX+(Math.random()-.5)*8,a=e.screenY+(Math.random()-.5)*4,i=(Math.random()-.5)*16,n=-12*(.8+.4*Math.random()),l=8+12*Math.random(),s=o*(.7+.6*Math.random());e.particles.push({x:r,y:a,vx:i,vy:n,age:0,maxAge:s,size:l,opacity:.25*(.8+.4*Math.random())})}e.particles.length>=l&&(e.spawnTimer=0),e.particles=e.particles.filter(e=>(e.age+=n,!(e.age>=e.maxAge)&&(e.x+=e.vx*n,e.y+=e.vy*n,e.vx*=.995,e.vy*=.998,e.size+=.5*n,!0)))}},[m,g,c,d,y,p]),_=(0,l.useCallback)(e=>{let{offset:t,zoom:r,grid:a,gridSize:i}=m.current,n=e.canvas,l=window.devicePixelRatio||1;if(!a||i<=0||0===c.current.length)return;let o=1;if(r>1.8)return;r>1.2&&(o=1-(r-1.2)/.6000000000000001),e.save(),e.scale(l*r,l*r),e.translate(t.x/r,t.y/r);let s=n.width/(l*r),d=n.height/(l*r),h=-t.x/r-100,u=-t.y/r-200,f=s-t.x/r+100,g=d-t.y/r+100;for(let t of c.current)for(let r of t.particles){let t;if(r.x<h||r.x>f||r.y<u||r.y>g)continue;let a=r.age/r.maxAge;t=a<.1?a/.1:1-(a-.1)/.9;let i=r.opacity*t*o;if(i<=.01)continue;e.fillStyle=`rgba(100, 100, 110, ${i})`,e.beginPath(),e.arc(r.x,r.y,r.size,0,2*Math.PI),e.fill();let n=.6*r.size;e.fillStyle=`rgba(140, 140, 150, ${.5*i})`,e.beginPath(),e.arc(r.x,r.y-.1*r.size,n,0,2*Math.PI),e.fill()}e.restore()},[m,c]),M=(0,l.useCallback)(e=>{let t=iu[Math.floor(e)%24]??im,r=Math.random()*t.reduce((e,t)=>e+t,0);for(let e=0;e<ig.length;e++)if((r-=t[e])<=0)return ig[e];return ig[0]},[]),S=(e,t)=>e+(Math.random()-.5)*t,k=(0,l.useCallback)(e=>{let t=ip[e],[r,a]=t.puffStretchX,[i,n]=t.puffStretchY,l=()=>r+Math.random()*(a-r),o=()=>i+Math.random()*(n-i),s=[];switch(e){case"cumulus":{s.push({offsetX:S(0,6),offsetY:S(0,5),size:S(42,10),opacity:.9,stretchX:void 0,stretchY:void 0});let e=4+Math.floor(2*Math.random());for(let t=0;t<e;t++){let r=t/e*Math.PI*2+.3,a=S(18,6);s.push({offsetX:Math.cos(r)*a+S(0,5),offsetY:Math.sin(r)*a*.7+S(0,4),size:S(32,8),opacity:.75+.2*Math.random()})}let t=2+Math.floor(2*Math.random());for(let e=0;e<t;e++){let r=e/t*Math.PI*2+.7,a=S(38,8);s.push({offsetX:Math.cos(r)*a+S(0,6),offsetY:Math.sin(r)*a*.6+S(0,5),size:S(24,6),opacity:.6+.25*Math.random()})}break}case"stratus":{let e=7+Math.floor(4*Math.random());for(let t=0;t<e;t++){let r=e>1?t/(e-1)-.5:0;s.push({offsetX:130*r+S(0,10),offsetY:S(2,6),size:S(48,12),opacity:.7+.2*Math.random(),stretchX:l(),stretchY:o()})}break}case"cirrus":{let e=[[-40,3],[-15,-1],[10,2],[38,-2]],t=2+Math.floor(2*Math.random());for(let r=0;r<t;r++){let[t,a]=e[r];s.push({offsetX:S(t,8),offsetY:S(a,4),size:S(28,6),opacity:.5+.3*Math.random(),stretchX:l(),stretchY:o()})}break}case"cumulonimbus":s.push({offsetX:S(-18,6),offsetY:S(22,5),size:S(38,8),opacity:.85,portion:"base"}),s.push({offsetX:S(12,6),offsetY:S(18,5),size:S(36,8),opacity:.85,portion:"base"}),s.push({offsetX:S(-8,5),offsetY:S(6,4),size:S(32,6),opacity:.8,portion:"base"}),s.push({offsetX:S(10,5),offsetY:S(2,4),size:S(30,6),opacity:.8,portion:"top"}),s.push({offsetX:S(0,8),offsetY:S(-12,4),size:S(28,6),opacity:.9,portion:"top"}),s.push({offsetX:S(-15,6),offsetY:S(-8,4),size:S(24,4),opacity:.85,portion:"top"});break;case"altocumulus":for(let e of[-50,-25,0,25,50])s.push({offsetX:S(e,6),offsetY:S(-5,3),size:S(26,6),opacity:.65+.2*Math.random(),stretchX:l(),stretchY:o()});for(let e of[-38,-12,12,38])s.push({offsetX:S(e,6),offsetY:S(6,3),size:S(24,5),opacity:.6+.2*Math.random(),stretchX:l(),stretchY:o()});break;default:s.push({offsetX:0,offsetY:0,size:40,opacity:.85});for(let e=0;e<4;e++){let t=e/4*Math.PI*2;s.push({offsetX:20*Math.cos(t)+S(0,5),offsetY:14*Math.sin(t)+S(0,4),size:S(30,6),opacity:.7})}}return s},[]),j=(0,l.useCallback)((e,t)=>{let r,a,{canvasSize:i,zoom:n,offset:l}=m.current,o=window.devicePixelRatio||1,s=t?.cloudType??M(e),c=ip[s],d=i.width/(o*n),f=i.height/(o*n),g=-l.x/n,p=-l.y/n,x=Math.cos(ic),y=Math.sin(ic);t?.position?(r=t.position.x,a=t.position.y):.5>Math.random()?(r=g-150,a=p+Math.random()*f):(r=g+Math.random()*d*.5,a=p+f+75);let b=c.layerRestriction>=0?c.layerRestriction:Math.floor(3*Math.random()),w=(8+16*Math.random())*c.speedMult,v=c.scaleMin+Math.random()*(c.scaleMax-c.scaleMin),_=c.opacityMin+Math.random()*(c.opacityMax-c.opacityMin),S={id:u.current++,x:r,y:a,vx:x*w*id[b],vy:y*w*id[b],scale:v,opacity:_*ih[b],puffs:k(s),layer:b,cloudType:s};return h.current.push(S),{x:r,y:a,cloudType:s}},[m,u,h,k,M]),P=(0,l.useCallback)((e,t)=>{let{canvasSize:r,zoom:a,offset:i,speed:n}=m.current;if(0===n)return;if(a<.2){h.current=[];return}let l=p?10:18,o=p?4.5:2.5;if(f.current+=e,f.current>=o&&h.current.length<l){f.current=0;let e=j(t);if(h.current.length<l&&.28>Math.random()){let r=Math.cos(ic),a=Math.sin(ic),i=-(55+35*Math.random()),n=(Math.random()-.5)*44;j(t,{position:{x:e.x+r*i+-a*n,y:e.y+a*i+r*n},cloudType:e.cloudType}),f.current=-(.4*o)}}let s=window.devicePixelRatio||1,c=r.width/(s*a);r.height;let d=-i.x/a,u=-i.y/a,g=d+c;h.current=h.current.filter(t=>(t.x+=t.vx*e,t.y+=t.vy*e,!(t.x>g+300)&&!(t.y<u-300)))},[m,h,f,p,j]),T=(e,t,r)=>{switch(e){case"cumulus":return[[0,`rgba(255, 255, 255, ${r})`],[.4,`rgba(250, 250, 252, ${.9*r})`],[.7,`rgba(245, 245, 250, ${.5*r})`],[1,"rgba(240, 240, 248, 0)"]];case"stratus":return[[0,`rgba(220, 222, 228, ${r})`],[.35,`rgba(200, 204, 212, ${.9*r})`],[.65,`rgba(185, 190, 200, ${.5*r})`],[1,"rgba(175, 180, 192, 0)"]];case"cirrus":return[[0,`rgba(255, 255, 255, ${.9*r})`],[.3,`rgba(248, 250, 255, ${.6*r})`],[.6,`rgba(240, 245, 252, ${.25*r})`],[1,"rgba(235, 240, 250, 0)"]];case"cumulonimbus":if("base"===t)return[[0,`rgba(120, 125, 140, ${r})`],[.3,`rgba(100, 108, 125, ${.9*r})`],[.6,`rgba(85, 92, 110, ${.5*r})`],[1,"rgba(70, 78, 95, 0)"]];return[[0,`rgba(255, 255, 255, ${r})`],[.4,`rgba(248, 248, 252, ${.85*r})`],[.7,`rgba(240, 242, 248, ${.4*r})`],[1,"rgba(235, 238, 245, 0)"]];case"altocumulus":return[[0,`rgba(238, 240, 245, ${r})`],[.4,`rgba(225, 228, 235, ${.85*r})`],[.7,`rgba(210, 215, 225, ${.45*r})`],[1,"rgba(200, 206, 218, 0)"]];default:return[[0,`rgba(255,255,255,${r})`],[1,"rgba(240,240,245,0)"]]}},C=(e,t,r,a,i,n,l)=>{e.fillStyle=l,e.beginPath();let o=a*i,s=a*n;.5>Math.abs(o-s)?e.arc(t,r,a,0,2*Math.PI):e.ellipse(t,r,o,s,0,0,2*Math.PI),e.fill()};return{updateFireworks:b,drawFireworks:w,updateSmog:v,drawSmog:_,updateClouds:P,drawClouds:(0,l.useCallback)((e,t)=>{let{offset:r,zoom:a,canvasSize:i}=m.current,n=e.canvas,l=window.devicePixelRatio||1;if(0===h.current.length||a<.2)return;let o=1;if(a>1.6)return;a>1&&(o=1-(a-1)/.6000000000000001);let s=1;t>=20||t<6?s=.6:t>=18&&t<20?s=1-(t-18)/2*.4:t>=6&&t<8&&(s=.6+(t-6)/2*.4),e.save(),e.scale(l*a,l*a),e.translate(r.x/a,r.y/a);let c=n.width/(l*a),d=n.height/(l*a),u=-r.x/a-150,f=-r.y/a-150,g=c-r.x/a+150,p=d-r.y/a+150,x=c*d,y=[...h.current].sort((e,t)=>e.layer-t.layer),b=0;for(let e of y){if(e.x<u||e.x>g||e.y<f||e.y>p)continue;let t=0;for(let r of e.puffs){let a=r.size*e.scale*(r.stretchX??1),i=r.size*e.scale*(r.stretchY??1),n=Math.sqrt(r.offsetX*r.offsetX+r.offsetY*r.offsetY)+Math.max(a,i);n>t&&(t=n)}b+=Math.PI*t*t}let w=x>0?b/x:0,v=1;for(let t of(w>.35&&(v=Math.max(0,1-(w-.35)/.35)),y)){if(t.x<u||t.x>g||t.y<f||t.y>p)continue;let r=t.opacity*s*o*v;for(let a of t.puffs){let i=t.x+a.offsetX*t.scale,n=t.y+a.offsetY*t.scale,l=a.size*t.scale,o=r*a.opacity,s=a.stretchX??1,c=a.stretchY??1,d=Math.max(l*s,l*c);if(o<=.01)continue;let h=T(t.cloudType,a.portion,o),u=e.createRadialGradient(i,n,0,i,n,d);for(let[e,t]of h)u.addColorStop(e,t);C(e,i,n,l,s,c,u)}let a="cirrus"===t.cloudType?0:"stratus"===t.cloudType?.1:.15;if(a>0){let i=t.y+8*t.scale;for(let n of t.puffs){let l=t.x+n.offsetX*t.scale,o=i+n.offsetY*t.scale,s=n.size*t.scale*.9,c=n.stretchX??1,d=n.stretchY??1,h=r*n.opacity*a;if(h<=.01)continue;let u=e.createRadialGradient(l,o,0,l,o,s*Math.max(c,d));u.addColorStop(0,`rgba(160, 168, 185, ${h})`),u.addColorStop(.5,`rgba(175, 182, 198, ${.5*h})`),u.addColorStop(1,"rgba(190, 195, 208, 0)"),C(e,l,o,s,c,d,u)}}}e.restore()},[m,h]),findFireworkBuildingsCallback:x,findSmogFactoriesCallback:y}}(n5,eh);tR[77]!==t2||tR[78]!==t5?(eu=()=>{aH.current.grid=t2,aH.current.gridSize=t5,aL.current=aL.current+1,aS.current=ln(t2,t5)},ef=[t2,t5],tR[77]=t2,tR[78]=t5,tR[79]=eu,tR[80]=ef):(eu=tR[79],ef=tR[80]),(0,l.useEffect)(eu,ef),tR[81]!==tG?(em=()=>{let e,t=0,r=()=>{e=requestAnimationFrame(r);let a=tG.current;if(a&&a.grid!==aH.current.grid){aH.current.grid=a.grid,aH.current.gridSize=a.gridSize;let e=aL.current+1;e!==t&&(t=e,aL.current=e,aS.current=ln(a.grid,a.gridSize))}};return e=requestAnimationFrame(r),()=>cancelAnimationFrame(e)},eg=[tG],tR[81]=tG,tR[82]=em,tR[83]=eg):(em=tR[82],eg=tR[83]),(0,l.useEffect)(em,eg),tR[84]!==rm?(ep=()=>{aH.current.offset=rm},e_=[rm],tR[84]=rm,tR[85]=ep,tR[86]=e_):(ep=tR[85],e_=tR[86]),(0,l.useEffect)(ep,e_),tR[87]!==rY?(eM=()=>{aH.current.zoom=rY},eS=[rY],tR[87]=rY,tR[88]=eM,tR[89]=eS):(eM=tR[88],eS=tR[89]),(0,l.useEffect)(eM,eS),tR[90]!==t4?(ek=()=>{aH.current.speed=t4},ej=[t4],tR[90]=t4,tR[91]=ek,tR[92]=ej):(ek=tR[91],ej=tR[92]),(0,l.useEffect)(ek,ej),tR[93]!==a5?(eP=()=>{aH.current.canvasSize=a5},eT=[a5],tR[93]=a5,tR[94]=eP,tR[95]=eT):(eP=tR[94],eT=tR[95]),(0,l.useEffect)(eP,eT),tR[96]===Symbol.for("react.memo_cache_sentinel")?(eC=()=>{rB.current=[],rH.current=0,rG.current=0,rK.current=[],r0.current=0,r1.current=0,r2.current.clear(),r5.current.clear(),r3.current.clear(),r4.current=0,r9.current=[],r6.current=0,r8.current=0,aa.current=[],ai.current=0,an.current=0,al.current=[],ao.current=0,as.current=0,ac.current=[],ad.current=0,ah.current=0,au.current=[],af.current=0,am.current=0,ag.current=[],ap.current=0,ax.current=0,ay.current=[],ab.current=0,aw.current=0,ak.current=[],aj.current=0,aP.current=0,aT.current=!1,aI.current=[],aR.current=-1,aY.current=[],aX.current=0,aA.current=0,aO.current=0},tR[96]=eC):eC=tR[96],tR[97]!==t8?(eN=[t8],tR[97]=t8,tR[98]=eN):eN=tR[98],(0,l.useEffect)(eC,eN),tR[99]!==ry?(ez=()=>{r_.current=ry},eI=[ry],tR[99]=ry,tR[100]=ez,tR[101]=eI):(ez=tR[100],eI=tR[101]),(0,l.useEffect)(ez,eI),tR[102]!==rY?(eR=()=>{rj.current=rY},eY=[rY],tR[102]=rY,tR[103]=eR,tR[104]=eY):(eR=tR[103],eY=tR[104]),(0,l.useEffect)(eR,eY),tR[105]!==rm.x||tR[106]!==rm.y||tR[107]!==rY?(eX=()=>{r$.current={offsetX:rm.x,offsetY:rm.y,zoom:rY}},eA=[rm.x,rm.y,rY],tR[105]=rm.x,tR[106]=rm.y,tR[107]=rY,tR[108]=eX,tR[109]=eA):(eX=tR[108],eA=tR[109]),(0,l.useEffect)(eX,eA),tR[110]!==a5||tR[111]!==rm||tR[112]!==tL||tR[113]!==rY?(eO=()=>{tL?.({offset:rm,zoom:rY,canvasSize:a5}),lF({type:"camera.changed",payload:{offsetX:rm.x,offsetY:rm.y,zoom:rY,canvasWidth:a5.width,canvasHeight:a5.height}})},eE=[rm,rY,a5,tL],tR[110]=a5,tR[111]=rm,tR[112]=tL,tR[113]=rY,tR[114]=eO,tR[115]=eE):(eO=tR[114],eE=tR[115]),(0,l.useEffect)(eO,eE),tR[116]!==re?(e$=()=>{if(re)return;let e=ik.current,t=t=>{if(function(e){return!!e?.closest('input, textarea, select, [contenteditable="true"]')}(t.target))return;let r=t.key.toLowerCase();["w","a","s","d","arrowup","arrowleft","arrowdown","arrowright"].includes(r)&&(e.add(r),t.preventDefault())},r=t=>{let r=t.key.toLowerCase();e.delete(r)},a=0,i=performance.now(),n=t=>{a=requestAnimationFrame(n);let r=Math.min((t-i)/1e3,.05);if(i=t,!e.size)return;let l=0,o=0;if((e.has("w")||e.has("arrowup"))&&(o+=520*r),(e.has("s")||e.has("arrowdown"))&&(o-=520*r),(e.has("a")||e.has("arrowleft"))&&(l+=520*r),(e.has("d")||e.has("arrowright"))&&(l-=520*r),0!==l||0!==o){let{zoom:e,gridSize:t,canvasSize:r}=aH.current,a=100-(t-1)*64/2*e,i=r.width-100- -(64*(t-1))/2*e,n=100-(t-1)*38.4*e,s=r.height-100-0*e;rg(e=>({x:Math.max(a,Math.min(i,e.x+l)),y:Math.max(n,Math.min(s,e.y+o))}))}};return window.addEventListener("keydown",t),window.addEventListener("keyup",r),a=requestAnimationFrame(n),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",r),cancelAnimationFrame(a),e.clear()}},eB=[re],tR[116]=re,tR[117]=e$,tR[118]=eB):(e$=tR[117],eB=tR[118]),(0,l.useEffect)(e$,eB),tR[119]!==tF||tR[120]!==t1?(eV=e=>{let{offset:t,zoom:r,grid:a,gridSize:i}=aH.current,n=e.canvas,l=window.devicePixelRatio||1;if(!a||i<=0||0===aa.current.length)return;e.save(),e.scale(l*r,l*r),e.translate(t.x/r,t.y/r);let o=n.width/(l*r),s=n.height/(l*r),c={viewLeft:-t.x/r-200,viewTop:-t.y/r-200,viewRight:o-t.x/r+200,viewBottom:s-t.y/r+200};!function(e,t,r,a,i,n=!1){if(0===t.length)return;let l=i3(i4,!1);for(let o of t){if(o.contrail.length>0){for(let t of(e.save(),o.contrail)){if(t.x<r.viewLeft||t.x>r.viewRight||t.y<r.viewTop||t.y>r.viewBottom)continue;let a=3+8*t.age,i=.4*t.opacity*o.altitude;e.fillStyle=`rgba(255, 255, 255, ${i})`,e.beginPath(),e.arc(t.x,t.y,a,0,2*Math.PI),e.fill()}e.restore()}if(o.x<r.viewLeft-80||o.x>r.viewRight+80||o.y<r.viewTop-80||o.y>r.viewBottom+80)continue;let t=i8(o.angle,o);if(o.altitude<.8){let t=(1-o.altitude)*18,r=.25*(1-o.altitude),a=a3[o.planeType]||.6,i=(.55+.35*o.altitude)*a;e.save(),e.translate(o.x+t,o.y+.5*t),e.scale(i,.5*i),e.fillStyle=`rgba(0, 0, 0, ${r})`,e.beginPath(),e.ellipse(0,0,50,20,0,0,2*Math.PI),e.fill(),e.restore()}if(l){let r=ne(o.planeType,t,l.naturalWidth||l.width,l.naturalHeight||l.height);if(r){e.save(),e.translate(o.x,o.y);let t=i7(o.angle,r.baseAngle);e.rotate(t);let s=(a3[o.planeType]||.3)*(.7+.5*o.altitude),c=r.mirrorX?-s:s,d=r.mirrorY?-s:s;e.scale(c,d),e.drawImage(l,r.sx,r.sy,r.sw,r.sh,-r.sw/2,-r.sh/2,r.sw,r.sh),e.restore(),(a>=20||a<6)&&function(e,t,r,a,i,n,l,o){let s=Math.sin(8*r)>.85,c=Math.sin(4*r)>.7,d=a?1.25:1,h=1.8*d,u=36*i,f=15*i,m=12*i,g=t.angle-Math.PI/2,p=t.x+Math.cos(t.angle)*m,x=t.y+Math.sin(t.angle)*m,y=p+Math.cos(g)*u,b=x+Math.sin(g)*u,w=p-Math.cos(g)*u,v=x-Math.sin(g)*u,_=t.x-Math.cos(t.angle)*f,M=t.y-Math.sin(t.angle)*f,S=t.angle%(2*Math.PI);S<0&&(S+=2*Math.PI);let k=180*S/Math.PI;e.save(),(k>=315||k<135)&&(e.fillStyle="#ff3333",a||(e.shadowColor="#ff0000",e.shadowBlur=12),e.beginPath(),e.arc(y,b,d,0,2*Math.PI),e.fill(),s&&(e.fillStyle="#ffffff",a||(e.shadowColor="#ffffff",e.shadowBlur=25),e.beginPath(),e.arc(y,b,h,0,2*Math.PI),e.fill())),k>=135&&k<315&&(e.fillStyle="#33ff33",a||(e.shadowColor="#00ff00",e.shadowBlur=12),e.beginPath(),e.arc(w,v,d,0,2*Math.PI),e.fill(),s&&(e.fillStyle="#ffffff",a||(e.shadowColor="#ffffff",e.shadowBlur=25),e.beginPath(),e.arc(w,v,h,0,2*Math.PI),e.fill())),k>=180&&k<360&&(e.fillStyle="#ffffff",a||(e.shadowColor="#ffffff",e.shadowBlur=8),e.beginPath(),e.arc(_,M,.8*d,0,2*Math.PI),e.fill()),c&&(e.fillStyle="#ff4444",a||(e.shadowColor="#ff0000",e.shadowBlur=15),e.beginPath(),e.arc(t.x,t.y,d,0,2*Math.PI),e.fill()),e.shadowBlur=0,e.restore()}(e,o,i,n,s,r.baseAngle,r.mirrorX,r.mirrorY)}else nt(e,o,a,i,n)}else nt(e,o,a,i,n)}}(e,aa.current,c,t1,av.current,tF),e.restore()},tR[119]=tF,tR[120]=t1,tR[121]=eV):eV=tR[121];let lJ=eV;tR[122]!==tF||tR[123]!==t1?(eW=e=>{let{offset:t,zoom:r,grid:a,gridSize:i}=aH.current,n=e.canvas,l=window.devicePixelRatio||1;if(!a||i<=0||0===al.current.length)return;e.save(),e.scale(l*r,l*r),e.translate(t.x/r,t.y/r);let o=n.width/(l*r),s=n.height/(l*r),c={viewLeft:-t.x/r-100,viewTop:-t.y/r-100,viewRight:o-t.x/r+100,viewBottom:s-t.y/r+100};!function(e,t,r,a,i,n=!1,l=1){if(0===t.length)return;let o=a>=20||a<6,s=l>=.5;if(o&&!n&&s)for(let a of t){if(a.altitude<.3||"landing"===a.state)continue;let t=Math.sin(a.searchlightAngle)*a.searchlightSweepRange,i=a.searchlightBaseAngle+t,n=40+60*a.altitude,l=a.x+Math.cos(i)*n,o=a.y+Math.sin(i)*n*.6;if(l<r.viewLeft-80||l>r.viewRight+80||o<r.viewTop-80||o>r.viewBottom+80)continue;let s=25+20*a.altitude,c=e.createRadialGradient(l,o,0,l,o,s),d=.25+.05*Math.sin(.3*a.searchlightAngle);c.addColorStop(0,`rgba(255, 250, 220, ${d})`),c.addColorStop(.3,`rgba(255, 245, 200, ${.7*d})`),c.addColorStop(.7,`rgba(255, 240, 180, ${.3*d})`),c.addColorStop(1,"rgba(255, 235, 160, 0)"),e.save(),e.translate(l,o),e.rotate(.1*i),e.scale(1,.5),e.fillStyle=c,e.beginPath(),e.arc(0,0,s,0,2*Math.PI),e.fill(),e.restore()}for(let l of t){if(l.rotorWash.length>0){for(let t of(e.save(),l.rotorWash)){if(t.x<r.viewLeft||t.x>r.viewRight||t.y<r.viewTop||t.y>r.viewBottom)continue;let a=1.5+4*t.age,i=.25*t.opacity*l.altitude;e.fillStyle=`rgba(200, 200, 200, ${i})`,e.beginPath(),e.arc(t.x,t.y,a,0,2*Math.PI),e.fill()}e.restore()}if(l.x<r.viewLeft-30||l.x>r.viewRight+30||l.y<r.viewTop-30||l.y>r.viewBottom+30)continue;let t=(.5-l.altitude)*10+3,c=.5+.3*l.altitude,d=.25*(.6-.3*l.altitude);e.save(),e.translate(l.x+t,l.y+.5*t),e.rotate(l.angle),e.scale(c,.5*c),e.fillStyle=`rgba(0, 0, 0, ${d})`,e.beginPath(),e.ellipse(0,0,10,4,0,0,2*Math.PI),e.fill(),e.restore(),e.save(),e.translate(l.x,l.y),e.rotate(l.angle);let h=.5+.3*l.altitude;if(e.scale(h,h),e.fillStyle=l.color,e.beginPath(),e.ellipse(0,0,8,4,0,0,2*Math.PI),e.fill(),e.fillStyle="#87ceeb",e.beginPath(),e.ellipse(5,0,3,2.5,0,0,2*Math.PI),e.fill(),e.fillStyle=l.color,e.beginPath(),e.moveTo(-6,-1),e.lineTo(-16,-.5),e.lineTo(-16,.5),e.lineTo(-6,1),e.closePath(),e.fill(),e.fillStyle="#374151",e.beginPath(),e.ellipse(-15,0,1,3,0,0,2*Math.PI),e.fill(),e.strokeStyle="#374151",e.lineWidth=.8,e.beginPath(),e.moveTo(-4,3.5),e.lineTo(4,3.5),e.moveTo(-2,4),e.lineTo(-2,6),e.lineTo(2,6),e.lineTo(2,4),e.moveTo(-4,-3.5),e.lineTo(4,-3.5),e.moveTo(-2,-4),e.lineTo(-2,-6),e.lineTo(2,-6),e.lineTo(2,-4),e.stroke(),a>=20||a<6){let t=Math.sin(8*i)>.82;e.fillStyle="#ff3333",n||(e.shadowColor="#ff0000",e.shadowBlur=10),e.beginPath(),e.arc(0,5,n?1.2:.8,0,2*Math.PI),e.fill(),e.fillStyle="#33ff33",n||(e.shadowColor="#00ff00",e.shadowBlur=10),e.beginPath(),e.arc(0,-5,n?1.2:.8,0,2*Math.PI),e.fill(),t&&(e.fillStyle="#ff4444",n||(e.shadowColor="#ff0000",e.shadowBlur=25),e.beginPath(),e.arc(-14,0,n?2.5:2,0,2*Math.PI),e.fill(),n||(e.shadowBlur=12),e.beginPath(),e.arc(-14,0,n?1.5:1,0,2*Math.PI),e.fill()),e.shadowBlur=0}e.restore(),e.save(),e.translate(l.x,l.y),e.fillStyle="#1f2937",e.beginPath(),e.arc(0,0,2*h,0,2*Math.PI),e.fill();let u=12*h;if(e.strokeStyle=`rgba(100, 100, 100, ${.4+.1*Math.sin(4*l.rotorAngle)})`,e.lineWidth=1.5*h,e.beginPath(),e.arc(0,0,u,0,2*Math.PI),e.stroke(),e.strokeStyle="rgba(50, 50, 50, 0.6)",e.lineWidth=1.5*h,e.beginPath(),e.moveTo(Math.cos(l.rotorAngle)*u,Math.sin(l.rotorAngle)*u),e.lineTo(Math.cos(l.rotorAngle+Math.PI)*u,Math.sin(l.rotorAngle+Math.PI)*u),e.stroke(),e.beginPath(),e.moveTo(Math.cos(l.rotorAngle+Math.PI/2)*u,Math.sin(l.rotorAngle+Math.PI/2)*u),e.lineTo(Math.cos(l.rotorAngle+1.5*Math.PI)*u,Math.sin(l.rotorAngle+1.5*Math.PI)*u),e.stroke(),e.restore(),o&&!n&&s&&l.altitude>.3&&"landing"!==l.state){let t=Math.sin(l.searchlightAngle)*l.searchlightSweepRange,r=l.searchlightBaseAngle+t,a=40+60*l.altitude,i=l.x+Math.cos(r)*a,n=l.y+Math.sin(r)*a*.6;e.save();let o=e.createLinearGradient(l.x,l.y,i,n);o.addColorStop(0,"rgba(255, 250, 220, 0.4)"),o.addColorStop(.3,"rgba(255, 250, 220, 0.15)"),o.addColorStop(1,"rgba(255, 250, 220, 0.02)");let s=r+Math.PI/2,c=r-Math.PI/2,d=25+20*l.altitude,h=i+Math.cos(s)*d*.6,u=n+Math.sin(s)*d*.3,f=i+Math.cos(c)*d*.6,m=n+Math.sin(c)*d*.3;e.fillStyle=o,e.beginPath(),e.moveTo(l.x,l.y),e.lineTo(h,u),e.lineTo(f,m),e.closePath(),e.fill();let g=.5+.3*l.altitude;e.fillStyle="rgba(255, 255, 240, 0.9)",e.shadowColor="#ffffcc",e.shadowBlur=8,e.beginPath(),e.arc(l.x,l.y+3*g,1.5,0,2*Math.PI),e.fill(),e.shadowBlur=0,e.restore()}}}(e,al.current,c,t1,av.current,tF,r),e.restore()},tR[122]=tF,tR[123]=t1,tR[124]=eW):eW=tR[124];let lK=eW;tR[125]!==tF||tR[126]!==t1?(eD=e=>{let{offset:t,zoom:r,grid:a,gridSize:i}=aH.current,n=e.canvas,l=window.devicePixelRatio||1;if(!a||i<=0||0===ac.current.length)return;e.save(),e.scale(l*r,l*r),e.translate(t.x/r,t.y/r);let o=n.width/(l*r),s=n.height/(l*r),c={viewLeft:-t.x/r-200,viewTop:-t.y/r-200,viewRight:o-t.x/r+200,viewBottom:s-t.y/r+200};!function(e,t,r,a,i,n=!1){if(0===t.length)return;let l=i3(i4,!1);for(let o of t){if(o.wake.length>0){for(let t of(e.save(),o.wake)){if(t.x<r.viewLeft||t.x>r.viewRight||t.y<r.viewTop||t.y>r.viewBottom)continue;let a=1.5+3*t.age,i=.5*t.opacity;e.fillStyle=`rgba(200, 220, 255, ${i})`,e.beginPath(),e.arc(t.x,t.y,a,0,2*Math.PI),e.fill()}e.restore()}if(o.contrail.length>0&&o.altitude>.5){for(let t of(e.save(),o.contrail)){if(t.x<r.viewLeft||t.x>r.viewRight||t.y<r.viewTop||t.y>r.viewBottom)continue;let a=2+5*t.age,i=.35*t.opacity*o.altitude;e.fillStyle=`rgba(255, 255, 255, ${i})`,e.beginPath(),e.arc(t.x,t.y,a,0,2*Math.PI),e.fill()}e.restore()}if(o.x<r.viewLeft-80||o.x>r.viewRight+80||o.y<r.viewTop-80||o.y>r.viewBottom+80)continue;let t=i8(o.angle,o);if(o.altitude>.1&&o.altitude<.8){let t=(1-o.altitude)*18,r=.25*(1-o.altitude),a=a3.seaplane||.16,i=(.55+.35*o.altitude)*a;e.save(),e.translate(o.x+t,o.y+.5*t),e.scale(i,.5*i),e.fillStyle=`rgba(0, 0, 0, ${r})`,e.beginPath(),e.ellipse(0,0,50,20,0,0,2*Math.PI),e.fill(),e.restore()}if(("taking_off"===o.state||"splashdown"===o.state)&&o.altitude<.3&&o.speed>15){let t=Math.min(.6,o.speed/80);e.save(),e.translate(o.x,o.y),e.rotate(o.angle),e.fillStyle=`rgba(200, 220, 255, ${t})`;let r=8+.2*o.speed,a=4+.1*o.speed;e.beginPath(),e.moveTo(-8,6),e.quadraticCurveTo(-r,10,-(1.5*r),a+5),e.quadraticCurveTo(-(.8*r),5,-8,6),e.fill(),e.beginPath(),e.moveTo(-8,-6),e.quadraticCurveTo(-r,-10,-(1.5*r),-a-5),e.quadraticCurveTo(-(.8*r),-5,-8,-6),e.fill(),e.restore()}if(l){let r=ne("seaplane",t,l.naturalWidth||l.width,l.naturalHeight||l.height);if(r){e.save(),e.translate(o.x,o.y);let t=i7(o.angle,r.baseAngle);e.rotate(t);let s=(a3.seaplane||.16)*(o.altitude>.1?.7+.5*o.altitude:.85),c=r.mirrorX?-s:s,d=r.mirrorY?-s:s;e.scale(c,d),e.drawImage(l,r.sx,r.sy,r.sw,r.sh,-r.sw/2,-r.sh/2,r.sw,r.sh),e.restore(),(a>=20||a<6)&&function(e,t,r,a,i){let n=Math.sin(8*r)>.85,l=Math.sin(4*r)>.7,o=a?1.25:1,s=1.8*o,c=30*i,d=12*i,h=10*i,u=t.angle-Math.PI/2,f=t.x+Math.cos(t.angle)*h,m=t.y+Math.sin(t.angle)*h,g=f+Math.cos(u)*c,p=m+Math.sin(u)*c,x=f-Math.cos(u)*c,y=m-Math.sin(u)*c,b=t.x-Math.cos(t.angle)*d,w=t.y-Math.sin(t.angle)*d,v=t.angle%(2*Math.PI);v<0&&(v+=2*Math.PI);let _=180*v/Math.PI;e.save(),(_>=315||_<135)&&(e.fillStyle="#ff3333",a||(e.shadowColor="#ff0000",e.shadowBlur=12),e.beginPath(),e.arc(g,p,o,0,2*Math.PI),e.fill(),n&&(e.fillStyle="#ffffff",a||(e.shadowColor="#ffffff",e.shadowBlur=25),e.beginPath(),e.arc(g,p,s,0,2*Math.PI),e.fill())),_>=135&&_<315&&(e.fillStyle="#33ff33",a||(e.shadowColor="#00ff00",e.shadowBlur=12),e.beginPath(),e.arc(x,y,o,0,2*Math.PI),e.fill(),n&&(e.fillStyle="#ffffff",a||(e.shadowColor="#ffffff",e.shadowBlur=25),e.beginPath(),e.arc(x,y,s,0,2*Math.PI),e.fill())),_>=180&&_<360&&(e.fillStyle="#ffffff",a||(e.shadowColor="#ffffff",e.shadowBlur=8),e.beginPath(),e.arc(b,w,.8*o,0,2*Math.PI),e.fill()),l&&(e.fillStyle="#ff4444",a||(e.shadowColor="#ff0000",e.shadowBlur=15),e.beginPath(),e.arc(t.x,t.y,o,0,2*Math.PI),e.fill()),e.shadowBlur=0,e.restore()}(e,o,i,n,s)}else nr(e,o,a,i,n)}else nr(e,o,a,i,n)}}(e,ac.current,c,t1,av.current,tF),e.restore()},tR[125]=tF,tR[126]=t1,tR[127]=eD):eD=tR[127];let l0=eD;tR[128]!==tF?(eF=e=>{let{grid:t,gridSize:r,speed:a}=aH.current;if(!t||r<=0||0===a)return;let i=lh(t,r);if(i<6){ay.current=[];return}let n=Math.min(tF?8:35,Math.ceil(i/(tF?12:6))),l=1===a?1:2===a?2:3,o=tF?4:1.5;if(aw.current=aw.current-e,ay.current.length<n&&aw.current<=0){let e=function(e,t,r){let a,i,n;if(6>lh(e,t))return null;let l=function(e,t){let r=[];for(let a=0;a<t;a++)for(let i=0;i<t;i++)"rail_station"===e[a][i].building.type&&r.push({x:i,y:a});return r}(e,t);if(l.length>0&&.7>Math.random()){let r=l[Math.floor(Math.random()*l.length)],o=function(e,t,r,a){for(let{dx:i,dy:n,dir:l}of[{dx:-1,dy:0,dir:"south"},{dx:0,dy:-1,dir:"west"},{dx:1,dy:0,dir:"north"},{dx:0,dy:1,dir:"east"}]){let o=r+i,s=a+n;if(n1(e,t,o,s))return{x:o,y:s,direction:l}}for(let{dx:i,dy:n}of[{dx:-1,dy:-1},{dx:-1,dy:1},{dx:1,dy:-1},{dx:1,dy:1},{dx:2,dy:0},{dx:0,dy:2},{dx:-2,dy:0},{dx:0,dy:-2}]){let l=r+i,o=a+n;if(n1(e,t,l,o)){let r=ld(e,t,l,o);if(r.length>0)return{x:l,y:o,direction:r[Math.floor(Math.random()*r.length)]}}}return null}(e,t,r.x,r.y);if(!o)return null;a=o.x,i=o.y,n=o.direction}else{let r=function(e,t){let r=[];for(let a=0;a<t;a++)for(let i=0;i<t;i++)n1(e,t,i,a)&&ld(e,t,i,a).length>=2&&r.push({x:i,y:a});if(0===r.length)for(let a=0;a<t;a++)for(let i=0;i<t;i++)n1(e,t,i,a)&&r.push({x:i,y:a});return 0===r.length?null:r[Math.floor(Math.random()*r.length)]}(e,t);if(!r)return null;let l=ld(e,t,a=r.x,i=r.y);if(0===l.length)return null;n=l[Math.floor(Math.random()*l.length)]}return"passenger"==(.5>Math.random()?"passenger":"freight")?function(e,t,r,a){let i=lN+Math.floor(Math.random()*(lz-lN+1)),n=nQ[Math.floor(Math.random()*nQ.length)],l=nK[Math.floor(Math.random()*nK.length)],o=[];o.push({type:"locomotive",color:n,tileX:t,tileY:r,progress:0,direction:a});for(let e=1;e<i-1;e++)o.push({type:"passenger",color:l,tileX:t,tileY:r,progress:-(.28*e),direction:a});return i>1&&o.push({type:"caboose",color:n,tileX:t,tileY:r,progress:-(.28*(i-1)),direction:a}),{id:e,type:"passenger",carriages:o,tileX:t,tileY:r,direction:a,progress:0,speed:.45+.15*Math.random(),path:[{x:t,y:r}],pathIndex:0,age:0,maxAge:120+30*Math.random(),color:n,atStation:!1,stationWaitTimer:0,smokeParticles:[],smokeSpawnTimer:0}}(r.current++,a,i,n):function(e,t,r,a){let i=lI+Math.floor(Math.random()*(lR-lI+1)),n=nQ[Math.floor(Math.random()*nQ.length)],l=[];l.push({type:"locomotive",color:n,tileX:t,tileY:r,progress:0,direction:a});let o=["freight_box","freight_tank","freight_flat"];for(let e=1;e<i-1;e++){let i=o[Math.floor(Math.random()*o.length)],n=nZ[Math.floor(Math.random()*nZ.length)];l.push({type:i,color:n,tileX:t,tileY:r,progress:-(.28*e),direction:a})}return i>1&&l.push({type:"caboose",color:"#8B0000",tileX:t,tileY:r,progress:-(.28*(i-1)),direction:a}),{id:e,type:"freight",carriages:l,tileX:t,tileY:r,direction:a,progress:0,speed:.35+.1*Math.random(),path:[{x:t,y:r}],pathIndex:0,age:0,maxAge:120+40*Math.random(),color:n,atStation:!1,stationWaitTimer:0,smokeParticles:[],smokeSpawnTimer:0}}(r.current++,a,i,n)}(t,r,ab);e&&ay.current.push(e),aw.current=o}let s=ay.current;ay.current=ay.current.filter(a=>(function(e,t,r,a,i,n=[],l=!1){if(e.age+=t*r,e.age>e.maxAge)return!1;if(e.atStation)return e.stationWaitTimer-=t*r,e.stationWaitTimer<=0&&(e.atStation=!1),!0;if(!n1(a,i,e.tileX,e.tileY)&&!n2(a,i,e.tileX,e.tileY))return!1;let o=1;for(let t of n){var s;if(t.id!==e.id&&0===(o=Math.min(o,(s=function(e,t,r,a){if(Math.abs(e.tileX-t.tileX)+Math.abs(e.tileY-t.tileY)>3||e.direction!==t.direction)return 1/0;let i=lY(e),n=function(e){let t=e.carriages[e.carriages.length-1];if(!t)return lY(e);let r=ia[t.direction];return{x:t.tileX+r.step.x*t.progress,y:t.tileY+r.step.y*t.progress}}(t),l=ia[e.direction],o=(n.x-i.x)*l.step.x+(n.y-i.y)*l.step.y;return o<-.3||Math.abs((n.x-i.x)*l.step.y-(n.y-i.y)*l.step.x)>.5?1/0:o}(e,t,0,0))>=.8?1:s<=.1?.3:.3+s/.8*.7)))break}for(e.progress+=e.speed*t*r*o;e.progress>=1;){let t=ia[e.direction],r=e.tileX+t.step.x,n=e.tileY+t.step.y;if(!n1(a,i,r,n)&&!n2(a,i,r,n)){let t=lX(e.direction,a,i,e.tileX,e.tileY);if(!t){e.direction=ii[e.direction],e.progress=.5;break}e.direction=t,e.progress=.1;break}e.tileX=r,e.tileY=n,e.progress-=1,n2(a,i,r,n)&&"passenger"===e.type&&(e.atStation=!0,e.stationWaitTimer=2);let l=lX(e.direction,a,i,e.tileX,e.tileY);l&&(e.direction=l),e.path.push({x:r,y:n}),e.pathIndex++,e.path.length>80&&(e.path.shift(),e.pathIndex--)}return function(e,t,r){let a=e.path[0];for(let t=0;t<e.carriages.length;t++){let r=e.carriages[t];if(0===t)r.tileX=e.tileX,r.tileY=e.tileY,r.progress=e.progress,r.direction=e.direction;else{let i=e.progress-.28*t,n=e.tileX,l=e.tileY,o=i,s=e.direction,c=e.pathIndex,d=!1;for(;o<0&&c>0;)if(o+=1,--c>=0&&c<e.path.length){let t=e.path[c];if(n=t.x,l=t.y,d=!0,c+1<e.path.length){let r=e.path[c+1],a=function(e,t,r,a){let i=r-e,n=a-t;return -1===i&&0===n?"north":1===i&&0===n?"south":0===i&&-1===n?"east":0===i&&1===n?"west":null}(t.x,t.y,r.x,r.y);a&&(s=a)}}!d&&o<0&&(n=a.x,l=a.y,o=0),o=Math.max(0,Math.min(.99,o)),r.tileX=n,r.tileY=l,r.progress=o,r.direction=s}}}(e,0,0),function(e,t,r,a,i,n){if("freight"!==e.type){e.smokeParticles=[];return}if(e.atStation)return lA(e,t,r);let l=n?6:12,o=n?.3:.15,s=function(e,t,r){let a=e.carriages[0];if(!a||"locomotive"!==a.type)return null;let{screenX:i,screenY:n}=iR(a.tileX,a.tileY,0,0),l=0===n0(a.direction)?1:-1,o=ia[a.direction],s=0,c=0,d=l;"north"===a.direction||"south"===a.direction?(s=lC.x,c=lC.y,d=-l):(s=lT.x,c=lT.y);let h=7.04*s*d,u=7.04*c*d,f=i+32+o.vec.dx*a.progress+h,m=n+19.2+o.vec.dy*a.progress+u,g=16.25;return{x:f+Math.cos(o.angle)*g*.3,y:m+Math.sin(o.angle)*g*.3-8,angle:o.angle}}(e,0,0);if(!s)return lA(e,t,r);for(e.smokeSpawnTimer+=t*r;e.smokeSpawnTimer>=o&&e.smokeParticles.length<l;){e.smokeSpawnTimer-=o;let t=s.x+(Math.random()-.5)*4,r=s.y+(Math.random()-.5)*2,a=8*Math.cos(s.angle+(Math.random()-.5)*.8)*.3+(Math.random()-.5)*4,i=-18*(.7+.6*Math.random()),n=2+2*Math.random(),l=1.8*(.6+.8*Math.random());e.smokeParticles.push({x:t,y:r,vx:a,vy:i,age:0,maxAge:l,size:n,opacity:.5*(.7+.6*Math.random())})}e.smokeParticles.length>=l&&(e.smokeSpawnTimer=0),lA(e,t,r)}(e,t,r,0,0,l),!0})(a,e,l,t,r,s,tF))},tR[128]=tF,tR[129]=eF):eF=tR[129];let l1=eF;tR[130]!==tF||tR[131]!==t1?(eJ=e=>{let{offset:t,zoom:r,grid:a,gridSize:i,canvasSize:n}=aH.current;!a||i<=0||0===ay.current.length||r<.35||function(e,t,r,a,i,n,l,o,s=!1){let c=window.devicePixelRatio||1;e.save(),e.scale(c*a,c*a),e.translate(r.x/a,r.y/a);let d=i.width/(c*a),h=i.height/(c*a),u=-r.x/a-128,f=-r.y/a-153.6,m=d-r.x/a+128,g=h-r.y/a+153.6;for(let r of[...t].sort((e,t)=>e.tileX+e.tileY-(t.tileX+t.tileY))){for(let t=r.carriages.length-1;t>=0;t--){let i=r.carriages[t],{screenX:c,screenY:d}=iR(i.tileX,i.tileY,0,0);c<u||c>m||d<f||d>g||function(e,t,r,a,i,n,l,o=!1){let s,c,d,{screenX:h,screenY:u}=iR(t.tileX,t.tileY,0,0),f="straight_ns";t.tileX>=0&&t.tileX<i&&t.tileY>=0&&t.tileY<i&&(f=n4(n3(a,i,t.tileX,t.tileY)));let m=0===n0(t.direction)?1:-1,g=function(e,t,r){let a=r+19.2,i={x:t+16,y:r+9.6},n={x:t+48,y:r+9.6},l={x:t+48,y:r+28.799999999999997},o={x:t+16,y:r+28.799999999999997},s={x:t+32,y:a};switch(e){case"curve_ne":return{from:i,to:n,control:s};case"curve_nw":return{from:i,to:o,control:s};case"curve_se":return{from:l,to:n,control:s};case"curve_sw":return{from:l,to:o,control:s};default:return null}}(f,h,u),p=g?function(e,t){switch(e){case"curve_ne":if("north"===t)return{entryT:1,exitT:0,entryDirection:"west"};if("east"===t)return{entryT:0,exitT:1,entryDirection:"south"};break;case"curve_nw":if("north"===t)return{entryT:1,exitT:0,entryDirection:"east"};if("west"===t)return{entryT:0,exitT:1,entryDirection:"south"};break;case"curve_se":if("south"===t)return{entryT:1,exitT:0,entryDirection:"west"};if("east"===t)return{entryT:0,exitT:1,entryDirection:"north"};break;case"curve_sw":if("south"===t)return{entryT:1,exitT:0,entryDirection:"east"};if("west"===t)return{entryT:0,exitT:1,entryDirection:"north"}}return null}(f,t.direction):null;if(g&&p){let{from:e,to:r,control:a}=g,{entryT:i,exitT:n,entryDirection:l}=p,o=t.direction,h=function(e,t,r,a,i=!1){let n=1-a,l=n*n*e.x+2*n*a*t.x+a*a*r.x,o=n*n*e.y+2*n*a*t.y+a*a*r.y,s=2*n*(t.x-e.x)+2*a*(r.x-t.x),c=2*n*(t.y-e.y)+2*a*(r.y-t.y);return i&&(s=-s,c=-c),{x:l,y:o,angle:Math.atan2(c,s)}}(e,a,r,i+(n-i)*t.progress,n<i),u=e=>{let t=0===n0(e)?1:-1;return"north"===e||"south"===e?{perp:lC,multiplier:-t}:{perp:lT,multiplier:t}},f=u(l),m=u(o),x=f.perp.x*f.multiplier,y=f.perp.y*f.multiplier,b=m.perp.x*m.multiplier,w=m.perp.y*m.multiplier,v=t.progress*t.progress*(3-2*t.progress),_=x+(b-x)*v,M=y+(w-y)*v,S=Math.hypot(_,M);s=h.x+(S>0?_/S:0)*7.04,c=h.y+(S>0?M/S:0)*7.04,d=h.angle}else{let e=h+32,r=u+19.2,a=ia[t.direction],i=0,n=0,l=m;"north"===t.direction||"south"===t.direction?(i=lC.x,n=lC.y,l=-m):(i=lT.x,n=lT.y);let o=7.04*i*l,f=7.04*n*l;s=e+a.vec.dx*t.progress+o,c=r+a.vec.dy*t.progress+f,d=a.angle}e.save(),e.translate(s,c),e.rotate(d);let x=r>=.8?.65:.55;switch(t.type){case"locomotive":!function(e,t,r,a,i,n=!1){let l=25*r,o=4.3*r;if(e.fillStyle=t,e.beginPath(),e.moveTo(-(.4*l),-o),e.lineTo(.5*l,-o),e.lineTo(.6*l,-(.5*o)),e.lineTo(.6*l,.5*o),e.lineTo(.5*l,o),e.lineTo(-(.4*l),o),e.closePath(),e.fill(),e.fillStyle=lE(t,.2),e.fillRect(-(.4*l),-(.8*o),.35*l,1.6*o),e.fillStyle="rgba(135, 206, 250, 0.8)",e.fillRect(-(.35*l),-(.5*o),.15*l,o),a>=20||a<5){let t=lO(i),a=lO(2*i),s=lO(3*i),c=.7+.6*t,d=.8+.6*a,h=.7+.5*s,u=.4+.3*lO(4*i);e.save(),n?(e.fillStyle="#ffffcc",e.beginPath(),e.arc(.55*l,0,.5*o*c,0,2*Math.PI),e.fill(),e.fillStyle="#ffffff",e.beginPath(),e.arc(.55*l,0,.25*o*c,0,2*Math.PI)):(e.shadowColor="#ffffff",e.shadowBlur=40*r*c,e.fillStyle="#ffffcc",e.beginPath(),e.arc(.55*l,0,.35*o*c,0,2*Math.PI),e.fill(),e.shadowBlur=30*r*c,e.fillStyle="#ffffaa",e.beginPath(),e.arc(.55*l,0,.28*o*c,0,2*Math.PI),e.fill(),e.shadowBlur=15*r*c,e.fillStyle="#ffffff",e.beginPath(),e.arc(.55*l,0,.2*o*c,0,2*Math.PI),e.fill(),e.shadowBlur=0,e.fillStyle="#ffffff",e.beginPath(),e.arc(.55*l,0,.12*o*c,0,2*Math.PI),e.fill(),e.globalAlpha=.5*u,e.fillStyle="#ffffcc",e.beginPath(),e.moveTo(.55*l,-(.25*o)*h),e.lineTo(.55*l+1.2*l*d,-(.8*o)*h),e.lineTo(.55*l+1.2*l*d,.8*o*h),e.lineTo(.55*l,.25*o*h),e.closePath(),e.fill(),e.globalAlpha=.3*u,e.fillStyle="#ffffff",e.beginPath(),e.moveTo(.55*l,-(.15*o)*h),e.lineTo(.55*l+.9*l*d,-(.5*o)*h),e.lineTo(.55*l+.9*l*d,.5*o*h),e.lineTo(.55*l,.15*o*h),e.closePath()),e.fill(),e.globalAlpha=1,e.restore()}else e.fillStyle="#ffff00",e.beginPath(),e.arc(.55*l,0,.2*o,0,2*Math.PI),e.fill();e.fillStyle="#1f2937",e.fillRect(-(.35*l),.9*o,.15*l,.3*o),e.fillRect(.1*l,.9*o,.15*l,.3*o),e.fillRect(-(.35*l),-(1.2*o),.15*l,.3*o),e.fillRect(.1*l,-(1.2*o),.15*l,.3*o)}(e,t.color,x,n,l,o);break;case"passenger":!function(e,t,r){let a=16*r,i=4.3*r;e.fillStyle=t,e.fillRect(-(.45*a),-i,.9*a,2*i),e.fillStyle=lE(t,.15),e.fillRect(-(.45*a),-(1.1*i),.9*a,.3*i),e.fillStyle="rgba(135, 206, 250, 0.7)";for(let t=0;t<4;t++){let r=-(.35*a)+t*a*.2;e.fillRect(r,-(.6*i),.1*a,1.2*i)}e.fillStyle="#1f2937",e.fillRect(-(.4*a),.9*i,.15*a,.3*i),e.fillRect(.25*a,.9*i,.15*a,.3*i)}(e,t.color,x);break;case"freight_box":!function(e,t,r){let a=28*r,i=4.3*r;e.fillStyle=t,e.fillRect(-(.45*a),-i,.9*a,2*i),e.fillStyle=lE(t,.2),e.fillRect(-(.15*a),-(.8*i),.3*a,1.6*i),e.strokeStyle="#333",e.lineWidth=1,e.beginPath(),e.moveTo(-(.2*a),-(.85*i)),e.lineTo(.2*a,-(.85*i)),e.stroke(),e.fillStyle="#1f2937",e.fillRect(-(.4*a),.9*i,.15*a,.3*i),e.fillRect(.25*a,.9*i,.15*a,.3*i)}(e,t.color,x);break;case"freight_tank":!function(e,t,r){let a=28*r,i=4.3*r;e.fillStyle="#333",e.fillRect(-(.45*a),.7*i,.9*a,.4*i),e.fillStyle=t,e.beginPath(),e.ellipse(0,0,.4*a,.9*i,0,0,2*Math.PI),e.fill(),e.fillStyle=function(e,t){let r=e.replace("#",""),a=Math.min(255,parseInt(r.substr(0,2),16)+(255-parseInt(r.substr(0,2),16))*.2),i=Math.min(255,parseInt(r.substr(2,2),16)+(255-parseInt(r.substr(2,2),16))*.2),n=Math.min(255,parseInt(r.substr(4,2),16)+(255-parseInt(r.substr(4,2),16))*.2);return`rgb(${Math.round(a)}, ${Math.round(i)}, ${Math.round(n)})`}(t,.2),e.beginPath(),e.ellipse(0,-(.3*i),.35*a,.3*i,0,0,2*Math.PI),e.fill(),e.fillStyle="#1f2937",e.fillRect(-(.4*a),.9*i,.15*a,.3*i),e.fillRect(.25*a,.9*i,.15*a,.3*i)}(e,t.color,x);break;case"freight_flat":!function(e,t,r){let a=28*r,i=4.3*r;e.fillStyle=t,e.fillRect(-(.45*a),-(.3*i),.9*a,.6*i),e.fillStyle=lE(t,.3),e.fillRect(-(.45*a),-i,.9*a,.2*i),e.fillRect(-(.45*a),.8*i,.9*a,.2*i),e.fillStyle="#8B4513",e.fillRect(-(.3*a),-(.2*i),.25*a,.4*i),e.fillRect(.1*a,-(.15*i),.2*a,.3*i),e.fillStyle="#1f2937",e.fillRect(-(.4*a),.9*i,.15*a,.3*i),e.fillRect(.25*a,.9*i,.15*a,.3*i)}(e,t.color,x);break;case"caboose":!function(e,t,r){let a=16*r*.9,i=4.3*r;e.fillStyle=t,e.fillRect(-(.45*a),-i,.9*a,2*i),e.fillStyle=lE(t,.1),e.fillRect(-(.15*a),-(1.3*i),.3*a,.5*i),e.fillStyle="rgba(135, 206, 250, 0.7)",e.fillRect(-(.35*a),-(.5*i),.15*a,i),e.fillRect(.2*a,-(.5*i),.15*a,i),e.fillRect(-(.1*a),-(1.2*i),.08*a,.3*i),e.fillRect(.02*a,-(1.2*i),.08*a,.3*i),e.fillStyle=lE(t,.2),e.fillRect(-(.55*a),-(.5*i),.1*a,i),e.strokeStyle="#333",e.lineWidth=.8,e.strokeRect(-(.55*a),-(.6*i),.12*a,1.2*i),e.fillStyle="#1f2937",e.fillRect(-(.35*a),.9*i,.15*a,.3*i),e.fillRect(.2*a,.9*i,.15*a,.3*i)}(e,t.color,x)}e.restore()}(e,i,a,n,l,o,r.id,s)}"freight"===r.type&&r.smokeParticles.length>0&&function(e,t,r,a,i,n){for(let l of t.smokeParticles){let t;if(l.x<r-50||l.x>a+50||l.y<i-100||l.y>n+50)continue;let o=l.age/l.maxAge;t=o<.15?o/.15:1-(o-.15)/.85;let s=l.opacity*t;!(s<=.01)&&(e.fillStyle=`rgba(40, 40, 45, ${s})`,e.beginPath(),e.arc(l.x,l.y,l.size,0,2*Math.PI),e.fill(),l.size>2&&(e.fillStyle=`rgba(70, 70, 80, ${.5*s})`,e.beginPath(),e.arc(l.x,l.y-.2*l.size,.4*l.size,0,2*Math.PI),e.fill()))}}(e,r,u,m,f,g)}e.restore()}(e,ay.current,t,r,n,a,i,t1,tF)},tR[130]=tF,tR[131]=t1,tR[132]=eJ):eJ=tR[132];let l2=eJ;tR[133]===Symbol.for("react.memo_cache_sentinel")?(eU=()=>{var e;return e=()=>{a2(lZ)},iK.add(e),()=>{iK.delete(e)}},eH=[],tR[133]=eU,tR[134]=eH):(eU=tR[133],eH=tR[134]),(0,l.useEffect)(eU,eH),tR[135]!==t0.abandonedSrc||tR[136]!==t0.constructionSrc||tR[137]!==t0.denseSrc||tR[138]!==t0.farmsSrc||tR[139]!==t0.infrastructureSrc||tR[140]!==t0.mansionsSrc||tR[141]!==t0.modernSrc||tR[142]!==t0.parksConstructionSrc||tR[143]!==t0.parksSrc||tR[144]!==t0.servicesSrc||tR[145]!==t0.shopsSrc||tR[146]!==t0.src||tR[147]!==t0.stationsSrc?(eG=()=>{i5(t0.src,!0).catch(console.error),i2(a6).catch(console.error);let e=setTimeout(()=>{t0.constructionSrc&&i5(t0.constructionSrc,!0).catch(console.error),t0.abandonedSrc&&i5(t0.abandonedSrc,!0).catch(console.error),t0.denseSrc&&i5(t0.denseSrc,!0).catch(console.error),t0.parksSrc&&i5(t0.parksSrc,!0).catch(console.error),t0.parksConstructionSrc&&i5(t0.parksConstructionSrc,!0).catch(console.error),t0.farmsSrc&&i5(t0.farmsSrc,!0).catch(console.error),t0.shopsSrc&&i5(t0.shopsSrc,!0).catch(console.error),t0.stationsSrc&&i5(t0.stationsSrc,!0).catch(console.error),t0.modernSrc&&i5(t0.modernSrc,!0).catch(console.error),t0.servicesSrc&&i5(t0.servicesSrc,!0).catch(console.error),t0.infrastructureSrc&&i5(t0.infrastructureSrc,!0).catch(console.error),t0.mansionsSrc&&i5(t0.mansionsSrc,!0).catch(console.error),i5("/assets/sprites_red_water_new_planes.png",!1).catch(console.error)},50);return()=>clearTimeout(e)},tR[135]=t0.abandonedSrc,tR[136]=t0.constructionSrc,tR[137]=t0.denseSrc,tR[138]=t0.farmsSrc,tR[139]=t0.infrastructureSrc,tR[140]=t0.mansionsSrc,tR[141]=t0.modernSrc,tR[142]=t0.parksConstructionSrc,tR[143]=t0.parksSrc,tR[144]=t0.servicesSrc,tR[145]=t0.shopsSrc,tR[146]=t0.src,tR[147]=t0.stationsSrc,tR[148]=eG):eG=tR[148],tR[149]!==t0?(eq=[t0],tR[149]=t0,tR[150]=eq):eq=tR[150],(0,l.useEffect)(eG,eq),tR[151]===Symbol.for("react.memo_cache_sentinel")?(eQ=()=>{let e=()=>{if(rc.current&&ra.current){let e=window.devicePixelRatio||1,t=rc.current.getBoundingClientRect();ra.current.style.width=`${t.width}px`,ra.current.style.height=`${t.height}px`,ri.current&&(ri.current.style.width=`${t.width}px`,ri.current.style.height=`${t.height}px`),rn.current&&(rn.current.style.width=`${t.width}px`,rn.current.style.height=`${t.height}px`),rl.current&&(rl.current.style.width=`${t.width}px`,rl.current.style.height=`${t.height}px`),ro.current&&(ro.current.style.width=`${t.width}px`,ro.current.style.height=`${t.height}px`),rs.current&&(rs.current.style.width=`${t.width}px`,rs.current.style.height=`${t.height}px`),ir({width:Math.round(t.width*e),height:Math.round(t.height*e)})}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},eZ=[],tR[151]=eQ,tR[152]=eZ):(eQ=tR[151],eZ=tR[152]),(0,l.useEffect)(eQ,eZ),tR[153]!==a5.height||tR[154]!==a5.width||tR[155]!==ib||tR[156]!==ix||tR[157]!==iC||tR[158]!==t2||tR[159]!==t5||tR[160]!==aK||tR[161]!==tF||tR[162]!==rm.x||tR[163]!==rm.y||tR[164]!==tY||tR[165]!==ij||tR[166]!==tH.services||tR[167]!==t6||tR[168]!==rY?(eK=()=>{let e=ra.current;if(!e||!aK)return;let t=e.getContext("2d");if(t)return null!==rd.current&&cancelAnimationFrame(rd.current),rd.current=requestAnimationFrame(()=>{var r,a;rd.current=null;let i=aH.current.speed,n=performance.now();if(n-rh.current<50*(3===i))return;rh.current=n;let l=window.devicePixelRatio||1;t.imageSmoothingEnabled=!1;let o=aD.current;if(!o.gradient||o.height!==e.height){let r=t.createLinearGradient(0,0,0,e.height);r.addColorStop(0,"#0f1419"),r.addColorStop(.5,"#141c24"),r.addColorStop(1,"#1a2a1f"),o.gradient=r,o.height=e.height}t.fillStyle=o.gradient,t.fillRect(0,0,e.width,e.height),t.save(),t.scale(l*rY,l*rY),t.translate(rm.x/rY,rm.y/rY);let s=e.width/(l*rY),c=e.height/(l*rY),d=-rm.x/rY-64,h=-rm.y/rY-76.8,u=s-rm.x/rY+64,f=c-rm.y/rY+76.8,m=Math.max(0,Math.floor((h-230.39999999999998)*2/38.4)),g=Math.min(2*t5-2,Math.ceil((f+38.4)*2/38.4)),p=aU.current;p.buildingQueue.length=0,p.waterQueue.length=0,p.roadQueue.length=0,p.bridgeQueue.length=0,p.railQueue.length=0,p.beachQueue.length=0,p.baseTileQueue.length=0,p.greenBaseTileQueue.length=0,p.overlayQueue.length=0;let x=p.buildingQueue,y=p.waterQueue,b=p.roadQueue,w=p.bridgeQueue,v=p.railQueue,_=p.beachQueue,M=p.baseTileQueue,S=p.greenBaseTileQueue,k=p.overlayQueue,j=function(e){for(let t=1;t<e.length;t++){let r=e[t],a=t-1;for(;a>=0&&e[a].depth>r.depth;)e[a+1]=e[a],a--;e[a+1]=r}},P=function(e,t){return!(e<0)&&!(e>=t5)&&!(t<0)&&!(t>=t5)&&"water"===t2[t][e].building.type},T=function(e,t){return!(e<0)&&!(e>=t5)&&!(t<0)&&!(t>=t5)&&"bridge"===t2[t][e].building.type},C=function(e,t){if(e<0||e>=t5||t<0||t>=t5)return!1;let r=t2[t][e].building.type;if("marina_docks_small"===r||"pier_large"===r)return!0;if("empty"===r)for(let r=0;r<=1;r++)for(let a=0;a<=1;a++){let i=e-a,n=t-r;if(i>=0&&n>=0&&i<t5&&n<t5&&"marina_docks_small"===t2[n][i].building.type&&e>=i&&e<i+2&&t>=n&&t<n+2)return!0}return!1},N={hasRoad:function(e,t){if(e<0||e>=t5||t<0||t>=t5)return!1;let r=t2[t][e].building.type;return"road"===r||"bridge"===r},getMergeInfo:function(e,t){let r=aL.current;aW.current!==r&&(aV.current.clear(),aW.current=r);let a=`${e},${t}`,i=aV.current.get(a);return i||(i=function(e,t,r,a){if(!nW(e,t,r,a))return{type:"single",orientation:"intersection",laneCount:1,hasMedian:!1,medianType:"none",positionInMerge:0,mergeWidth:1,side:"single"};let i=nD(e,t,r,a),n=[i.north,i.east,i.south,i.west].filter(Boolean).length,l=i.north||i.south,o=i.east||i.west;if(n>=3)return{type:"single",orientation:"intersection",laneCount:2,hasMedian:!1,medianType:"none",positionInMerge:0,mergeWidth:1,side:"center"};let s=0,c=0,d="single";if(l&&!o){nW(e,t,r,a+1)&&(nW(e,t,r-1,a+1)||nW(e,t,r+1,a+1)),nW(e,t,r,a-1)&&(nW(e,t,r-1,a-1)||nW(e,t,r+1,a-1));let i=0,n=0;for(let n=1;n<=3;n++)if(nW(e,t,r,a+n)){let l=nD(e,t,r,a+n);if(l.north||l.south)i++;else break}else break;for(let i=1;i<=3;i++)if(nW(e,t,r,a-i)){let l=nD(e,t,r,a-i);if(l.north||l.south)n++;else break}else break;return s=i+n+1,c=n,s>1&&(d=0===c?"right":c===s-1?"left":"center"),{type:s>=4?"highway":s>=2?"avenue":"single",orientation:"ns",laneCount:Math.min(2*s,6),hasMedian:s>=2,medianType:s>=3?"plants":s>=2?"line":"none",positionInMerge:c,mergeWidth:s,side:d}}if(o&&!l){nW(e,t,r-1,a)&&(nW(e,t,r-1,a-1)||nW(e,t,r-1,a+1)),nW(e,t,r+1,a)&&(nW(e,t,r+1,a-1)||nW(e,t,r+1,a+1));let i=0,n=0;for(let n=1;n<=3;n++)if(nW(e,t,r-n,a)){let l=nD(e,t,r-n,a);if(l.east||l.west)i++;else break}else break;for(let i=1;i<=3;i++)if(nW(e,t,r+i,a)){let l=nD(e,t,r+i,a);if(l.east||l.west)n++;else break}else break;return s=i+n+1,c=i,s>1&&(d=0===c?"left":c===s-1?"right":"center"),{type:s>=4?"highway":s>=2?"avenue":"single",orientation:"ew",laneCount:Math.min(2*s,6),hasMedian:s>=2,medianType:s>=3?"plants":s>=2?"line":"none",positionInMerge:c,mergeWidth:s,side:d}}return{type:"single",orientation:n>=2?"intersection":"ns",laneCount:1,hasMedian:!1,medianType:"none",positionInMerge:0,mergeWidth:1,side:"single"}}(t2,t5,e,t),aV.current.set(a,i)),i},isMobile:tF,isPanning:r_.current,isPinchZooming:rM.current,trafficLightTimer:aO.current},z=function(e,t,r,a,i){let n=i3(a6);if(!n)return;let l=t+32,o=r+19.2,s=n.naturalWidth||n.width,c=n.naturalHeight||n.height,d=(7919*a+6271*i)%1e3/1e3,h=(4177*a+9311*i)%1e3/1e3,u=.35*s,f=.35*c,m=s-u,g=c-f;e.save(),e.beginPath(),e.moveTo(t+32,r),e.lineTo(t+64,r+19.2),e.lineTo(t+32,r+38.4),e.lineTo(t,r+19.2),e.closePath(),e.clip();let p=f/u*73.6;e.globalAlpha=.95,e.drawImage(n,d*m,h*g,u,f,Math.round(l-36.8+(d-.5)*5.76),Math.round(o-p/2+(h-.5)*11.52*.3),Math.round(73.6),Math.round(p)),e.restore()},I=function(e,t,r,a){let i=a.building.type;if("road"===i)return void function(e,t,r,a,i,n,l){let{hasRoad:o,getMergeInfo:s,isMobile:c,isPanning:d,isPinchZooming:h,trafficLightTimer:u}=l,f=t+32,m=r+19.2,g=o(a-1,i),p=o(a,i-1),x=o(a+1,i),y=o(a,i+1),b=s(a,i),w=64*("highway"===b.type?.16:"avenue"===b.type?.15:.14),v="#9ca3af",_=t+16,M=r+9.6,S=t+48,k=r+9.6,j=t+48,P=r+28.799999999999997,T=t+16,C=r+28.799999999999997,N=(_-f)/Math.hypot(_-f,M-m),z=(M-m)/Math.hypot(_-f,M-m),I=(S-f)/Math.hypot(S-f,k-m),R=(k-m)/Math.hypot(S-f,k-m),Y=(j-f)/Math.hypot(j-f,P-m),X=(P-m)/Math.hypot(j-f,P-m),A=(T-f)/Math.hypot(T-f,C-m),O=(C-m)/Math.hypot(T-f,C-m),E=(e,t)=>({nx:-t,ny:e}),$={x:t+32,y:r},B={x:t+64,y:r+19.2},L={x:t+32,y:r+38.4},V={x:t,y:r+19.2},W=n>=.25,D=e=>{if("single"===b.type)return!0;if("ns"===b.orientation)return"east"===e?"right"===b.side:"west"!==e||"left"===b.side;if("ew"===b.orientation){if("north"===e)return"left"===b.side;if("south"===e)return"right"===b.side}return!0},F=(t,r,a,i,n,l,o=!1,s=!1)=>{let c=3.61984,d=a-t,h=i-r,u=Math.hypot(d,h),f=d/u,m=h/u,g=t,p=r,x=a,y=i;o&&u>2*c&&(g=t+f*c,p=r+m*c),s&&u>2*c&&(x=a-f*c,y=i-m*c),e.strokeStyle="#6b7280",e.lineWidth=1.5,e.beginPath(),e.moveTo(g,p),e.lineTo(x,y),e.stroke(),e.fillStyle=v,e.beginPath(),e.moveTo(g,p),e.lineTo(x,y),e.lineTo(x+5.12*n,y+5.12*l),e.lineTo(g+5.12*n,p+5.12*l),e.closePath(),e.fill()};W&&!g&&D("north")&&F(V.x,V.y,$.x,$.y,.707,.707,!y&&D("west"),!p&&D("east")),W&&!p&&D("east")&&F($.x,$.y,B.x,B.y,-.707,.707,!g&&D("north"),!x&&D("south")),W&&!x&&D("south")&&F(B.x,B.y,L.x,L.y,-.707,-.707,!p&&D("east"),!y&&D("west")),W&&!y&&D("west")&&F(L.x,L.y,V.x,V.y,.707,-.707,!x&&D("south"),!g&&D("north"));let J=3.61984;e.fillStyle=v;let U=(e,t,r,a,i,n)=>{let l=e-r,o=t-a,s=Math.hypot(l,o);return{x:e-l/s*J+5.12*i,y:t-o/s*J+5.12*n}};if(W&&!g&&!p&&D("north")&&D("east")){let t=U($.x,$.y,V.x,V.y,.707,.707),r=U($.x,$.y,B.x,B.y,-.707,.707);e.beginPath(),e.moveTo($.x,$.y),e.lineTo(t.x,t.y),e.lineTo(r.x,r.y),e.closePath(),e.fill()}if(W&&!p&&!x&&D("east")&&D("south")){let t=U(B.x,B.y,$.x,$.y,-.707,.707),r=U(B.x,B.y,L.x,L.y,-.707,-.707);e.beginPath(),e.moveTo(B.x,B.y),e.lineTo(t.x,t.y),e.lineTo(r.x,r.y),e.closePath(),e.fill()}if(W&&!x&&!y&&D("south")&&D("west")){let t=U(L.x,L.y,B.x,B.y,-.707,-.707),r=U(L.x,L.y,V.x,V.y,.707,-.707);e.beginPath(),e.moveTo(L.x,L.y),e.lineTo(t.x,t.y),e.lineTo(r.x,r.y),e.closePath(),e.fill()}if(W&&!y&&!g&&D("west")&&D("north")){let t=U(V.x,V.y,L.x,L.y,.707,-.707),r=U(V.x,V.y,$.x,$.y,.707,.707);e.beginPath(),e.moveTo(V.x,V.y),e.lineTo(t.x,t.y),e.lineTo(r.x,r.y),e.closePath(),e.fill()}if(e.fillStyle="highway"===b.type?"#3d3d3d":"avenue"===b.type?"#454545":nO,g){let t=f+(_-f)*.98,r=m+(M-m)*.98,a=E(N,z),i=.5*w;e.beginPath(),e.moveTo(f+a.nx*i,m+a.ny*i),e.lineTo(t+a.nx*i,r+a.ny*i),e.lineTo(t-a.nx*i,r-a.ny*i),e.lineTo(f-a.nx*i,m-a.ny*i),e.closePath(),e.fill()}if(p){let t=f+(S-f)*.98,r=m+(k-m)*.98,a=E(I,R),i=.5*w;e.beginPath(),e.moveTo(f+a.nx*i,m+a.ny*i),e.lineTo(t+a.nx*i,r+a.ny*i),e.lineTo(t-a.nx*i,r-a.ny*i),e.lineTo(f-a.nx*i,m-a.ny*i),e.closePath(),e.fill()}if(x){let t=f+(j-f)*.98,r=m+(P-m)*.98,a=E(Y,X),i=.5*w;e.beginPath(),e.moveTo(f+a.nx*i,m+a.ny*i),e.lineTo(t+a.nx*i,r+a.ny*i),e.lineTo(t-a.nx*i,r-a.ny*i),e.lineTo(f-a.nx*i,m-a.ny*i),e.closePath(),e.fill()}if(y){let t=f+(T-f)*.98,r=m+(C-m)*.98,a=E(A,O),i=.5*w;e.beginPath(),e.moveTo(f+a.nx*i,m+a.ny*i),e.lineTo(t+a.nx*i,r+a.ny*i),e.lineTo(t-a.nx*i,r-a.ny*i),e.lineTo(f-a.nx*i,m-a.ny*i),e.closePath(),e.fill()}let H=1.4*w;if(e.beginPath(),e.moveTo(f,m-H),e.lineTo(f+H,m),e.lineTo(f,m+H),e.lineTo(f-H,m),e.closePath(),e.fill(),W){e.fillStyle=v;let t=4.096,r=g&&p&&x&&y;g&&p&&(e.beginPath(),e.moveTo($.x,$.y),e.lineTo($.x-t,$.y+.5*t),e.lineTo($.x,$.y+t),e.lineTo($.x+t,$.y+.5*t),e.closePath(),e.fill()),p&&x&&(e.beginPath(),e.moveTo(B.x,B.y),r?(e.lineTo(B.x-.625*t,B.y-1.25*t),e.lineTo(B.x-1.25*t,B.y),e.lineTo(B.x-.625*t,B.y+1.25*t)):(e.lineTo(B.x-t,B.y-.5*t),e.lineTo(B.x-2*t,B.y),e.lineTo(B.x-t,B.y+.5*t)),e.closePath(),e.fill()),x&&y&&(e.beginPath(),e.moveTo(L.x,L.y),e.lineTo(L.x+t,L.y-.5*t),e.lineTo(L.x,L.y-t),e.lineTo(L.x-t,L.y-.5*t),e.closePath(),e.fill()),y&&g&&(e.beginPath(),e.moveTo(V.x,V.y),r?(e.lineTo(V.x+.625*t,V.y-1.25*t),e.lineTo(V.x+1.25*t,V.y),e.lineTo(V.x+.625*t,V.y+1.25*t)):(e.lineTo(V.x+t,V.y-.5*t),e.lineTo(V.x+2*t,V.y),e.lineTo(V.x+t,V.y+.5*t)),e.closePath(),e.fill())}if(n>=.5){let l=[g,p,x,y].filter(Boolean).length;if("single"!==b.type&&"center"===b.side&&(e.strokeStyle="#ffffff",e.lineWidth=.6,e.setLineDash([2,3]),"ns"===b.orientation&&(g||x)?(e.beginPath(),e.moveTo(f,m),g&&e.lineTo(_,M),e.moveTo(f,m),x&&e.lineTo(j,P),e.stroke()):"ew"===b.orientation&&(p||y)&&(e.beginPath(),e.moveTo(f,m),p&&e.lineTo(S,k),e.moveTo(f,m),y&&e.lineTo(T,C),e.stroke()),e.setLineDash([])),b.hasMedian&&b.mergeWidth>=2){let t=Math.floor(b.mergeWidth/2)-1;if(b.positionInMerge===t){if("ns"===b.orientation)if("plants"===b.medianType&&n>=.55){e.fillStyle="#6b7280",e.fillRect(T-3,C-2,6,P-C+4),e.fillStyle="#4a7c3f";let t=Math.floor(Math.abs(P-C)/10);for(let r=1;r<t;r++){let a=C+r/t*(P-C),i=T+r/t*(j-T);e.beginPath(),e.arc(i,a-1,2,0,2*Math.PI),e.fill()}}else e.strokeStyle=nE,e.lineWidth=1.2,e.setLineDash([]),e.beginPath(),e.moveTo(_+-1.5,M),e.lineTo(j+-1.5,P),e.stroke(),e.beginPath(),e.moveTo(_+-1.5+3,M),e.lineTo(j+-1.5+3,P),e.stroke();else if("ew"===b.orientation)if("plants"===b.medianType&&n>=.55){e.fillStyle="#6b7280",e.fillRect(S-2,k-3,T-S+4,6),e.fillStyle="#4a7c3f";let t=Math.floor(Math.abs(T-S)/10);for(let r=1;r<t;r++){let a=S+r/t*(T-S),i=k+r/t*(C-k);e.beginPath(),e.arc(a,i-1,2,0,2*Math.PI),e.fill()}}else e.strokeStyle=nE,e.lineWidth=1.2,e.setLineDash([]),e.beginPath(),e.moveTo(S,k+-1.5),e.lineTo(T,C+-1.5),e.stroke(),e.beginPath(),e.moveTo(S,k+-1.5+3),e.lineTo(T,C+-1.5+3),e.stroke()}}if(!([g,p,x,y].filter(Boolean).length>=3)){e.strokeStyle=nE,e.lineWidth=.8,e.setLineDash([1.5,2]),e.lineCap="round";let t=(e,t)=>!!o(e,t)&&[o(e-1,t),o(e,t-1),o(e+1,t),o(e,t+1)].filter(Boolean).length>=3;if(g)if(t(a-1,i)){let t=f+(_-f)*.58,r=m+(M-m)*.58;e.beginPath(),e.moveTo(f+0*N,m+0*z),e.lineTo(t,r),e.stroke()}else e.beginPath(),e.moveTo(f+0*N,m+0*z),e.lineTo(_+8*N,M+8*z),e.stroke();if(p)if(t(a,i-1)){let t=f+(S-f)*.58,r=m+(k-m)*.58;e.beginPath(),e.moveTo(f+0*I,m+0*R),e.lineTo(t,r),e.stroke()}else e.beginPath(),e.moveTo(f+0*I,m+0*R),e.lineTo(S+8*I,k+8*R),e.stroke();if(x)if(t(a+1,i)){let t=f+(j-f)*.58,r=m+(P-m)*.58;e.beginPath(),e.moveTo(f+0*Y,m+0*X),e.lineTo(t,r),e.stroke()}else e.beginPath(),e.moveTo(f+0*Y,m+0*X),e.lineTo(j+8*Y,P+8*X),e.stroke();if(y)if(t(a,i+1)){let t=f+(T-f)*.58,r=m+(C-m)*.58;e.beginPath(),e.moveTo(f+0*A,m+0*O),e.lineTo(t,r),e.stroke()}else e.beginPath(),e.moveTo(f+0*A,m+0*O),e.lineTo(T+8*A,C+8*O),e.stroke();e.setLineDash([]),e.lineCap="butt"}if("single"!==b.type&&n>=.65&&"center"!==b.side){var G,q,Q,Z,K;let t="single"===(G=b).type?"ns"===G.orientation?["north","south"]:"ew"===G.orientation?["east","west"]:["north","south","east","west"]:"ns"===G.orientation?"right"===G.side?["north"]:"left"===G.side?["south"]:["north","south"]:"ew"===G.orientation?"right"===G.side?["east"]:"left"===G.side?["west"]:["east","west"]:["north","south","east","west"];1===t.length&&(q=e,Q=f,Z=m,K=t[0],n<.8||(q.save(),q.translate(Q,Z),q.rotate({north:-(.75*Math.PI),east:-(.25*Math.PI),south:.25*Math.PI,west:.75*Math.PI}[K]),q.fillStyle="rgba(255, 255, 255, 0.6)",q.beginPath(),q.moveTo(0,-5),q.lineTo(3,0),q.lineTo(1,0),q.lineTo(1,5),q.lineTo(-1,5),q.lineTo(-1,0),q.lineTo(-3,0),q.closePath(),q.fill(),q.restore()))}if(!function(e){let{ctx:t,x:r,y:a,gridX:i,gridY:n,zoom:l,roadW:o,adj:s,hasRoad:c}=e;if(l<.75)return;let d=r+32,h=a+19.2,u={x:r+64,y:h},f=r+16,m=a+9.6,g=r+48,p=a+9.6,x=r+48,y=a+28.799999999999997,b=r+16,w=a+28.799999999999997,v=(f-d)/Math.hypot(f-d,m-h),_=(m-h)/Math.hypot(f-d,m-h),M=(g-d)/Math.hypot(g-d,p-h),S=(p-h)/Math.hypot(g-d,p-h),k=(x-d)/Math.hypot(x-d,y-h),j=(y-h)/Math.hypot(x-d,y-h),P=(b-d)/Math.hypot(b-d,w-h),T=(w-h)/Math.hypot(b-d,w-h),C=(e,t)=>!!c(e,t)&&[c(e-1,t),c(e,t-1),c(e+1,t),c(e,t+1)].filter(Boolean).length>=3,N=s.north&&C(i-1,n),z=s.east&&C(i,n-1),I=s.south&&C(i+1,n),R=s.west&&C(i,n+1);if(!N&&!z&&!I&&!R)return;t.strokeStyle="rgba(255, 255, 255, 0.5)",t.lineWidth=.7,t.setLineDash([]);let Y=d-r,X=a-h,A=Math.hypot(Y,X),O=u.x-d,E=u.y-a,$=Math.hypot(O,E),B=.22*o,L=.3*o,V=(e,r,a,i,n,l)=>{let o=d+(e-d)*.85,s=h+(r-h)*.85;for(let e=0;e<10;e++){let r=(e-4.5)*L,c=o+n*r,d=s+l*r;t.beginPath(),t.moveTo(c-a*B,d-i*B),t.lineTo(c+a*B,d+i*B),t.stroke()}};N&&V(f,m,v,_,Y/A,X/A),z&&V(g,p,M,S,O/$,E/$),I&&V(x,y,k,j,Y/A,X/A),R&&V(b,w,P,T,O/$,E/$)}({ctx:e,x:t,y:r,gridX:a,gridY:i,zoom:n,roadW:w,adj:{north:g,east:p,south:x,west:y},hasRoad:o}),l>=3&&n>=.45&&!(c&&(d||h))){let a=nF(u);g&&y&&nU(e,t,r,a,"nw",n),g&&p&&nU(e,t,r,a,"ne",n),x&&y&&nU(e,t,r,a,"sw",n),x&&p&&nU(e,t,r,a,"se",n)}}}(e,t,r,a.x,a.y,rY,N);if("bridge"===i)return void function(e,t,r,a,i,n,l){var o,s,c;let d,h,u,f,m,g,p,x,y,b,w,v,_,M,S,k,j,P,T,C,{bridgeType:N,orientation:z,variant:I,position:R,bridgeIndex:Y,bridgeSpan:X,isRailBridge:A}=(d=a.bridgeType||"large",h=a.bridgeOrientation||"ns",u=a.bridgeVariant||0,f=a.bridgePosition||"middle",m=a.bridgeIndex??0,g=a.bridgeSpan??1,{bridgeType:d,orientation:h,variant:u,position:f,bridgeIndex:m,bridgeSpan:g,trackType:p=a.bridgeTrackType||"road",isRailBridge:"rail"===p}),O=lj[N]?.[I]||lj.large[0],E=r+3.84*!!A,$=t+32,B=E+19.2,L=64*(A?.36:.45)*.5,{startEdge:V,endEdge:W,perpX:D,perpY:F}=(v={x:t+16,y:E+9.6},_={x:t+48,y:E+9.6},M={x:t+48,y:E+28.799999999999997},S={x:t+16,y:E+28.799999999999997},j=32/(k=Math.hypot(32,19.2)),P=19.2/k,T=-32/k,C=19.2/k,"ns"===z?(x={x:v.x,y:v.y},y={x:M.x,y:M.y},b=T,w=C):(x={x:_.x,y:_.y},y={x:S.x,y:S.y},b=j,w=P),{northEdge:v,eastEdge:_,southEdge:M,westEdge:S,startEdge:x,endEdge:y,perpX:b,perpY:w,neDirX:j,neDirY:P,nwDirX:T,nwDirY:C});if("suspension"!==N&&(Y%2==0||"start"===R||"end"===R)){let t={x:V.x+(W.x-V.x)*.35,y:V.y+(W.y-V.y)*.35};o=t.x,s=t.y,c=O.support,e.fillStyle="#606060",e.beginPath(),e.moveTo(o-4,s),e.lineTo(o-4,s+14),e.lineTo(o,s+14+2),e.lineTo(o,s+2),e.closePath(),e.fill(),e.fillStyle="#787878",e.beginPath(),e.moveTo(o,s+2),e.lineTo(o,s+14+2),e.lineTo(o+4,s+14),e.lineTo(o+4,s),e.closePath(),e.fill(),e.fillStyle=c,e.beginPath(),e.moveTo(o,s-2),e.lineTo(o+4,s),e.lineTo(o,s+2),e.lineTo(o-4,s),e.closePath(),e.fill()}let J=W.x-V.x,U=W.y-V.y,H=Math.hypot(J,U),G=J/H,q=U/H,Q=[],Z=(t,r)=>{let a=t.x+8*G*r,i=t.y+8*q*r,n={x:a+D*L,y:i+F*L},l={x:a-D*L,y:i-F*L},o={x:t.x+D*L,y:t.y-3+F*L},s={x:t.x-D*L,y:t.y-3-F*L};e.fillStyle=A?nq:O.asphalt,e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(o.x,o.y),e.lineTo(s.x,s.y),e.lineTo(l.x,l.y),e.closePath(),e.fill(),A||Q.push({extendedX:a,extendedY:i,connectorEdgeX:t.x,connectorEdgeY:t.y})},K=1===X;!A&&(("start"===R||K)&&Z(V,-1),("end"===R||K)&&Z(W,1));let ee=1.5*!!A,et={x:V.x-G*ee,y:V.y-q*ee},er={x:W.x+G*ee,y:W.y+q*ee},ea=et.y-3,ei=er.y-3,en={x:et.x+D*L,y:ea+F*L},el={x:et.x-D*L,y:ea-F*L},eo={x:er.x+D*L,y:ei+F*L},es={x:er.x-D*L,y:ei-F*L};if("suspension"===N&&l>=.5){let r=W.x-V.x,i=W.y-V.y,n=Math.hypot(r,i),l=-i/n,o=r/n,s=$+28.8*l,c=B+28.8*o,d=$-28.8*l,h=B-28.8*o,u=c<h?{x:d,y:h}:{x:s,y:c},f=Math.floor((X-1)/2),m=void 0!==a.bridgeSpan&&a.bridgeSpan>1,g="middle"===R&&(m&&X>6&&Y===f||!m&&(t/64+E/38.4)%5==2);if("start"===R||"end"===R||g){let t=I%3,r=["#909090","#808080","#858580"][t],a=["#606060","#555555","#555550"][t];e.fillStyle=r,e.fillRect((c<h?{x:s,y:c}:{x:d,y:h}).x-1.5,B-15+-5-2.5,3,15),e.fillStyle=a,e.fillRect(u.x-2.5,B-27+8+35-6,5,6),e.fillStyle=r,e.fillRect(u.x-1.5,B-27+8,3,29)}}if(e.fillStyle=A?nq:O.asphalt,e.beginPath(),e.moveTo(en.x,en.y),e.lineTo(eo.x,eo.y),e.lineTo(es.x,es.y),e.lineTo(el.x,el.y),e.closePath(),e.fill(),l>=.4){e.fillStyle=O.barrier;let t={x:et.x+D*(L+2),y:ea+F*(L+2)},r={x:er.x+D*(L+2),y:ei+F*(L+2)};e.beginPath(),e.moveTo(en.x,en.y),e.lineTo(eo.x,eo.y),e.lineTo(r.x,r.y),e.lineTo(t.x,t.y),e.closePath(),e.fill();let a={x:et.x-D*(L+2),y:ea-F*(L+2)},i={x:er.x-D*(L+2),y:ei-F*(L+2)};e.beginPath(),e.moveTo(el.x,el.y),e.lineTo(es.x,es.y),e.lineTo(i.x,i.y),e.lineTo(a.x,a.y),e.closePath(),e.fill()}if(A){if(l>=.4){let t=l>=.7?.85:.7;e.strokeStyle="#4a4a4a",e.lineWidth=1,e.lineCap="butt";let r=V.y-3,a=W.y-3;for(let t of[7.04,-7.04]){let i=V.x+D*t,n=r+F*t,l=W.x+D*t,o=a+F*t;for(let t=0;t<7;t++){let r=(t+.5)/7,a=i+(l-i)*r,s=n+(o-n)*r;e.beginPath(),e.moveTo(a+4.16*D,s+4.16*F),e.lineTo(a-4.16*D,s-4.16*F),e.stroke()}}for(let r of[7.04,-7.04]){let a=et.x+D*r,i=ea+F*r,n=er.x+D*r,l=ei+F*r;e.strokeStyle=nG,e.lineWidth=t+.3,e.lineCap="round",e.beginPath(),e.moveTo(a+1.92*D+.3,i+1.92*F+.3),e.lineTo(n+1.92*D+.3,l+1.92*F+.3),e.stroke(),e.beginPath(),e.moveTo(a-1.92*D+.3,i-1.92*F+.3),e.lineTo(n-1.92*D+.3,l-1.92*F+.3),e.stroke(),e.strokeStyle=nH,e.lineWidth=t,e.beginPath(),e.moveTo(a+1.92*D,i+1.92*F),e.lineTo(n+1.92*D,l+1.92*F),e.stroke(),e.beginPath(),e.moveTo(a-1.92*D,i-1.92*F),e.lineTo(n-1.92*D,l-1.92*F),e.stroke()}}}else l>=.6&&(e.strokeStyle="#ffffff",e.lineWidth=.5,e.setLineDash([1.5,2]),e.lineCap="round",W.x,V.x,W.y,V.y,e.setLineDash([1.5,2]),e.lineDashOffset=-((17*i+23*n)%100/100*3.5),e.beginPath(),e.moveTo(V.x,ea),e.lineTo(W.x,ei),e.stroke(),e.setLineDash([]),e.lineDashOffset=0,e.lineCap="butt");if("large"===N&&l>=.5&&!A&&X>1){e.strokeStyle=O.accent,e.lineWidth=1.5,e.beginPath(),e.moveTo(en.x,en.y-3),e.lineTo(eo.x,eo.y-3),e.stroke(),e.beginPath(),e.moveTo(el.x,el.y-5),e.lineTo(es.x,es.y-5),e.stroke();for(let t=0;t<=4;t++){let r=t/4,a=en.x+(eo.x-en.x)*r,i=en.y+(eo.y-en.y)*r,n=el.x+(es.x-el.x)*r,l=el.y+(es.y-el.y)*r;e.beginPath(),e.moveTo(a,i),e.lineTo(a,i-3),e.stroke(),e.beginPath(),e.moveTo(n,l),e.lineTo(n,l-5),e.stroke()}}(()=>{if(A)return;let t=L-.22*L;for(let r of(e.strokeStyle="#606060",e.lineWidth=.75,Q))e.beginPath(),e.moveTo(r.extendedX+D*t,r.extendedY+F*t),e.lineTo(r.extendedX-D*t,r.extendedY-F*t),e.stroke(),e.beginPath(),e.moveTo(r.connectorEdgeX+D*t,r.connectorEdgeY-3+F*t),e.lineTo(r.connectorEdgeX-D*t,r.connectorEdgeY-3-F*t),e.stroke()})()}(e,t,r,a.building,a.x,a.y,rY);if("marina_docks_small"===i||"pier_large"===i){let t=ea(i);for(let r=0;r<t.width;r++)for(let i=0;i<t.height;i++){let t=a.x+r,n=a.y+i,{screenX:l,screenY:o}=iR(t,n,0,0);z(e,l,o,t,n)}}let n=ex;if(ew[i]||n.parksBuildings&&n.parksBuildings[i]||n.stationsVariants&&n.stationsVariants[i])if("water"===i){let i=i3(a6),n=a.x,l=a.y,o={north:n>0&&t2[l]?.[n-1]?.building.type==="water",east:l>0&&t2[l-1]?.[n]?.building.type==="water",south:n<t5-1&&t2[l]?.[n+1]?.building.type==="water",west:l<t5-1&&t2[l+1]?.[n]?.building.type==="water"},s=+!!o.north+ +!!o.east+ +!!o.south+ +!!o.west;if(i){let a=t+32,c=r+19.2,d=i.naturalWidth||i.width,h=i.naturalHeight||i.height,u=(7919*n+6271*l)%1e3/1e3,f=(4177*n+9311*l)%1e3/1e3,m=.35*d,g=.35*h,p=u*(d-m),x=f*(h-g),y=r-(o.north&&o.east?12.8:0),b=t+64+(o.east&&o.south?12.8:0),w=r+38.4+(o.south&&o.west?12.8:0),v=t-(o.west&&o.north?12.8:0),_=o.north&&o.east?7.68:0,M=o.east&&o.south?7.68:0,S=o.south&&o.west?7.68:0,k=o.west&&o.north?7.68:0;e.save(),e.beginPath(),e.moveTo(t+32,y-_),e.lineTo(b+M,r+19.2),e.lineTo(t+32,w+S),e.lineTo(v-k,r+19.2),e.closePath(),e.clip();let j=g/m,P=e.globalAlpha,T=(u-.5)*19.2,C=(f-.5)*11.52;if(rY<.5){let t=73.6*j;e.globalAlpha=.9,e.drawImage(i,p,x,m,g,Math.round(a-36.8),Math.round(c-t/2),Math.round(73.6),Math.round(t))}else if(s>=2){let t=64*(2+.3*s),r=t*j;e.globalAlpha=.35,e.drawImage(i,p,x,m,g,Math.round(a-t/2+T),Math.round(c-r/2+C),Math.round(t),Math.round(r));let n=70.4*j;e.globalAlpha=.9,e.drawImage(i,p,x,m,g,Math.round(a-35.2+.5*T),Math.round(c-n/2+.5*C),Math.round(70.4),Math.round(n))}else{let t=73.6*j;e.globalAlpha=.95,e.drawImage(i,p,x,m,g,Math.round(a-36.8+.3*T),Math.round(c-t/2+.3*C),Math.round(73.6),Math.round(t))}e.globalAlpha=P,e.restore()}else e.fillStyle="#0ea5e9",e.beginPath(),e.moveTo(t+32,r),e.lineTo(t+64,r+19.2),e.lineTo(t+32,r+38.4),e.lineTo(t,r+19.2),e.closePath(),e.fill()}else{let l=void 0!==a.building.constructionProgress&&a.building.constructionProgress<100,o=a.building.constructionProgress??100;if(l&&o<40){let a=ea(i);if(a.width>1||a.height>1)for(let i=0;i<a.height;i++)for(let n=0;n<a.width;n++)iF(e,t+32*(n-i),r+19.2*(n+i),64,38.4,rY);else iF(e,t,r,64,38.4,rY);return}let s=function(e,t,r,a,i=ex){let n=void 0!==t.constructionProgress&&t.constructionProgress<100,l=t.constructionProgress??100,o=n&&l>=40,s=!0===t.abandoned,c=!!(i.parksBuildings&&i.parksBuildings[e]);if(o&&c&&i.parksConstructionSrc)return{source:i.parksConstructionSrc,variantType:"parksConstruction",variant:i.parksBuildings[e]};if(o&&i.constructionSrc)return{source:i.constructionSrc,variantType:"construction",variant:null};if(s&&i.abandonedSrc)return{source:i.abandonedSrc,variantType:"abandoned",variant:null};if(c&&i.parksSrc)return{source:i.parksSrc,variantType:"parks",variant:i.parksBuildings[e]};if(i.denseSrc&&i.denseVariants&&i.denseVariants[e]){let t=i.denseVariants[e],n=i.modernSrc&&i.modernVariants&&i.modernVariants[e]?i.modernVariants[e]:[],l=[...t.map(e=>({...e,type:"dense"})),...n.map(e=>({...e,type:"modern"}))],o=(31*r+17*a)%(1+l.length);if(o>0&&l.length>0){let e=l[o-1];return"modern"===e.type?{source:i.modernSrc,variantType:"modern",variant:{row:e.row,col:e.col}}:{source:i.denseSrc,variantType:"dense",variant:{row:e.row,col:e.col}}}}if(i.modernSrc&&i.modernVariants&&i.modernVariants[e]){let t=i.modernVariants[e],n=(31*r+17*a)%(1+t.length);if(n>0&&t.length>0)return{source:i.modernSrc,variantType:"modern",variant:t[n-1]}}if(i.farmsSrc&&i.farmsVariants&&i.farmsVariants[e]){let t=i.farmsVariants[e],n=(31*r+17*a)%(1+t.length);if(n>0&&t.length>0)return{source:i.farmsSrc,variantType:"farm",variant:t[n-1]}}if(i.shopsSrc&&i.shopsVariants&&i.shopsVariants[e]){let t=i.shopsVariants[e],n=(31*r+17*a)%(1+t.length);if(n>0&&t.length>0)return{source:i.shopsSrc,variantType:"shop",variant:t[n-1]}}if(i.stationsSrc&&i.stationsVariants&&i.stationsVariants[e]){let t=i.stationsVariants[e];if(t.length>0){let e=(7*r+13*a)%t.length;return{source:i.stationsSrc,variantType:"station",variant:t[e]}}}if(i.servicesSrc&&i.servicesVariants&&i.servicesVariants[e]){let r=i.servicesVariants[e];if(r.length>0){let e=Math.max(0,Math.min(t.level-1,r.length-1));return{source:i.servicesSrc,variantType:"services",variant:r[e]}}}if(i.infrastructureSrc&&i.infrastructureVariants&&i.infrastructureVariants[e]){let r=i.infrastructureVariants[e];if(r.length>0){let e=Math.max(0,Math.min(t.level-1,r.length-1));return{source:i.infrastructureSrc,variantType:"infrastructure",variant:r[e]}}}if(i.mansionsSrc&&i.mansionsVariants&&i.mansionsVariants[e]){let t=i.mansionsVariants[e],n=(31*r+17*a)%(1+t.length);if(n>0&&t.length>0)return{source:i.mansionsSrc,variantType:"mansion",variant:t[n-1]}}return{source:i.src,variantType:"normal",variant:null}}(i,a.building,a.x,a.y,n),c=i3(s.source,!0)||i3(s.source);if(c){let l=function(e,t,r,a,i=ex){let{variantType:n,variant:l}=t;if(("parks"===n||"parksConstruction"===n)&&l){let t=i.parksCols||5,n=i.parksRows||6,o=Math.floor(r/t),s=Math.floor(a/n),c=l.row*s,d=s;return"marina_docks_small"===e?(c+=.15*s,d=.85*s):"pier_large"===e?(c+=.2*s,d=.8*s):"amphitheater"===e?c+=.1*s:"mini_golf_course"===e?(c+=.2*s,d=.8*s):"cabin_house"===e||"go_kart_track"===e?c+=.1*s:"greenhouse_garden"===e?(c+=.1*s,d=.9*s):"bleachers_field"===e&&(d=1.1*s),{sx:l.col*o,sy:c,sw:o,sh:d}}if("dense"===n&&l){let t=Math.floor(r/i.cols),n=Math.floor(a/i.rows),o=l.row*n,s=n;return"mall"===e?o+=.12*n:"factory_large"===e?(o+=.05*n,s=.95*n):"apartment_high"===e?s=1.05*n:"office_high"===e?(o+=.1*n,s=.98*n):"office_low"===e&&(o+=.1*n),{sx:l.col*t,sy:o,sw:t,sh:s}}if("modern"===n&&l){let t=Math.floor(r/i.cols),n=Math.floor(a/i.rows),o=l.row*n,s=n;return"mall"===e?(o+=.15*n,s=3===l.row?.95*n:.85*n):"apartment_high"===e&&(s=1.05*n),{sx:l.col*t,sy:o,sw:t,sh:s}}if("farm"===n&&l){let e=i.farmsCols||5,t=i.farmsRows||6,n=Math.floor(r/e),o=Math.floor(a/t);return{sx:l.col*n,sy:l.row*o,sw:n,sh:o}}if("shop"===n&&l){let e=i.shopsCols||5,t=i.shopsRows||6,n=Math.floor(r/e),o=Math.floor(a/t);return{sx:l.col*n,sy:l.row*o,sw:n,sh:o}}if("station"===n&&l){let e=i.stationsCols||5,t=i.stationsRows||6,n=Math.floor(r/e),o=Math.floor(a/t),s=l.row*o,c=o;return 2===l.row?s+=.1*o:3===l.row?(s+=.1*o,c-=.05*o):4===l.row&&(s+=.1*o,c-=.1*o),{sx:l.col*n,sy:s,sw:n,sh:c}}if("mansion"===n&&l){let e=i.mansionsCols||5,t=i.mansionsRows||7,n=Math.floor(r/e),o=Math.floor(a/t);return{sx:l.col*n,sy:l.row*o,sw:n,sh:1.2*o}}if("services"===n&&l){let e=i.servicesCols||5,t=i.servicesRows||6,n=Math.floor(r/e),o=Math.floor(a/t);return{sx:l.col*n,sy:l.row*o,sw:n,sh:o}}if("infrastructure"===n&&l){let e=i.infrastructureCols||5,t=i.infrastructureRows||6,n=Math.floor(r/e),o=Math.floor(a/t);return{sx:l.col*n,sy:l.row*o,sw:n,sh:o}}let o=ev(e,r,a,i);if("factory_large"===e&&o){let e=Math.floor(a/i.rows);o.sh=o.sh-.08*e}return o}(i,s,c.naturalWidth||c.width,c.naturalHeight||c.height,n);if(l){let o,d=function(e,t,r,a=ex){let{variantType:i,variant:n}=t,l=ea(e),o=l.width>1||l.height>1,s=void 0!==r.constructionProgress&&r.constructionProgress>=40&&r.constructionProgress<100,c=!0===r.abandoned,d=o?Math.max(l.width,l.height):1,h={airport:1,school:1.05,university:.95,space_program:1.06,stadium:.7,water_tower:.9,subway_station:.7,police_station:.97,fire_station:.97,hospital:.9,house_small:1.08,apartment_low:1.15,apartment_high:1.38,office_high:1.2};return e in h&&(d*=h[e]),"dense"===i&&("mall"===e&&(d*=.85),a.denseScales&&e in a.denseScales&&(d*=a.denseScales[e]),"office_high"===e&&n&&2===n.row&&1===n.col&&(d*=.7),"office_high"===e&&n&&2===n.row&&2===n.col&&(d*=.7)),"modern"===i&&("mall"===e&&(d*=.85),a.modernScales&&e in a.modernScales&&(d*=a.modernScales[e])),"farm"===i&&a.farmsScales&&e in a.farmsScales&&(d*=a.farmsScales[e]),"shop"===i&&a.shopsScales&&e in a.shopsScales&&(d*=a.shopsScales[e]),"station"===i&&a.stationsScales&&e in a.stationsScales&&(d*=a.stationsScales[e]),"services"===i&&a.servicesScales&&e in a.servicesScales&&(d*=a.servicesScales[e]),"infrastructure"===i&&a.infrastructureScales&&e in a.infrastructureScales&&(d*=a.infrastructureScales[e]),"mansion"===i&&a.mansionsScales&&e in a.mansionsScales&&(d*=a.mansionsScales[e]),("parks"===i||"parksConstruction"===i)&&a.parksScales&&e in a.parksScales&&(d*=a.parksScales[e]),s&&a.constructionScales&&e in a.constructionScales&&(d*=a.constructionScales[e]),c&&a.abandonedScales&&e in a.abandonedScales&&(d*=a.abandonedScales[e]),d*=a.globalScale??1}(i,s,a.building,n),h=function(e,t,r,a=ex){let{variantType:i,variant:n}=t,l=void 0!==r.constructionProgress&&r.constructionProgress>=40&&r.constructionProgress<100,o=!0===r.abandoned,s="parks"===i||"parksConstruction"===i,c=0,d=0;if(l&&s&&a.parksConstructionVerticalOffsets&&e in a.parksConstructionVerticalOffsets)c=a.parksConstructionVerticalOffsets[e];else if(l&&a.constructionVerticalOffsets&&e in a.constructionVerticalOffsets)c=a.constructionVerticalOffsets[e];else if(o&&a.abandonedVerticalOffsets&&e in a.abandonedVerticalOffsets)c=a.abandonedVerticalOffsets[e];else if(s&&a.parksVerticalOffsets&&e in a.parksVerticalOffsets)c=a.parksVerticalOffsets[e];else if("dense"===i&&a.denseVerticalOffsets&&e in a.denseVerticalOffsets)c=a.denseVerticalOffsets[e],"mall"===e&&n&&2===n.row&&4===n.col&&(c+=.5),"mall"===e&&n&&3===n.row&&0===n.col&&(c+=.3),"mall"===e&&n&&3===n.row&&1===n.col&&(c+=.5),"mall"===e&&n&&3===n.row&&2===n.col&&(c+=.3),"office_high"===e&&n&&2===n.row&&0===n.col&&(c+=.2),"office_high"===e&&n&&2===n.row&&1===n.col&&(c+=.1),"office_high"===e&&n&&2===n.row&&2===n.col&&(c+=.1);else if("modern"===i&&a.modernVerticalOffsets&&e in a.modernVerticalOffsets)c=a.modernVerticalOffsets[e];else if("farm"===i&&a.farmsVerticalOffsets&&e in a.farmsVerticalOffsets)c=a.farmsVerticalOffsets[e];else if("shop"===i&&a.shopsVerticalOffsets&&e in a.shopsVerticalOffsets)c=a.shopsVerticalOffsets[e];else if("station"===i&&a.stationsVerticalOffsets&&e in a.stationsVerticalOffsets)c=a.stationsVerticalOffsets[e];else if("services"===i&&a.servicesVerticalOffsets&&e in a.servicesVerticalOffsets)c=a.servicesVerticalOffsets[e];else if("infrastructure"===i&&a.infrastructureVerticalOffsets&&e in a.infrastructureVerticalOffsets)c=a.infrastructureVerticalOffsets[e];else if("mansion"===i&&a.mansionsVerticalOffsets&&e in a.mansionsVerticalOffsets)c=a.mansionsVerticalOffsets[e];else if(a.buildingVerticalOffsets&&e in a.buildingVerticalOffsets)c=a.buildingVerticalOffsets[e];else{let t=ew[e];t&&ey[t]&&(c=ey[t])}"hospital"===e&&(c-=.1);let h=ew[e];return h&&eb[h]&&(d=eb[h]),s&&a.parksHorizontalOffsets&&e in a.parksHorizontalOffsets&&(d=a.parksHorizontalOffsets[e]),"farm"===i&&a.farmsHorizontalOffsets&&e in a.farmsHorizontalOffsets&&(d=a.farmsHorizontalOffsets[e]),"shop"===i&&a.shopsHorizontalOffsets&&e in a.shopsHorizontalOffsets&&(d=a.shopsHorizontalOffsets[e]),"station"===i&&a.stationsHorizontalOffsets&&e in a.stationsHorizontalOffsets&&(d=a.stationsHorizontalOffsets[e]),"services"===i&&a.servicesHorizontalOffsets&&e in a.servicesHorizontalOffsets&&(d=a.servicesHorizontalOffsets[e]),"infrastructure"===i&&a.infrastructureHorizontalOffsets&&e in a.infrastructureHorizontalOffsets&&(d=a.infrastructureHorizontalOffsets[e]),{vertical:c,horizontal:d}}(i,s,a.building,n),u=ea(i),f=u.width>1||u.height>1,m=t,g=r;if(f){let e=u.width-1,a=u.height-1;m=t+32*(e-a),g=r+19.2*(e+a)}let p=76.8*d,x=p*(l.sh/l.sw),y=m+32-p/2+64*h.horizontal;o=(f?(u.width+u.height-2)*9.6:.15*x)+38.4*h.vertical;let b=g+38.4-x+o,w=$(i),v=(()=>{if(w)return!1;let e=iC(a.x,a.y);return e?.hasAdjacentRoad?e.shouldFlipForRoad:(47*a.x+83*a.y)%100<50})();if(!0===a.building.flipped!==v){e.save();let t=Math.round(y+p/2);e.translate(t,0),e.scale(-1,1),e.translate(-t,0),e.drawImage(c,l.sx,l.sy,l.sw,l.sh,Math.round(y),Math.round(b),Math.round(p),Math.round(x)),e.restore()}else e.drawImage(c,l.sx,l.sy,l.sw,l.sh,Math.round(y),Math.round(b),Math.round(p),Math.round(x))}}else{let a,n,l,o;n=38.4*(a=iG[i]||iG.default).height,l=t+32,o=r-n,e.fillStyle=a.left,e.beginPath(),e.moveTo(t,r+19.2),e.lineTo(l,r+38.4),e.lineTo(l,o+38.4),e.lineTo(t,o+19.2),e.closePath(),e.fill(),e.fillStyle=a.right,e.beginPath(),e.moveTo(t+64,r+19.2),e.lineTo(l,r+38.4),e.lineTo(l,o+38.4),e.lineTo(t+64,o+19.2),e.closePath(),e.fill(),e.fillStyle=a.top,e.beginPath(),e.moveTo(l,o),e.lineTo(t+64,o+19.2),e.lineTo(l,o+38.4),e.lineTo(t,o+19.2),e.closePath(),e.fill(),e.strokeStyle="rgba(0,0,0,0.2)",e.lineWidth=.5,e.beginPath(),e.moveTo(l,o),e.lineTo(t+64,o+19.2),e.lineTo(l,o+38.4),e.lineTo(t,o+19.2),e.closePath(),e.stroke()}}if(a.building.onFire){let a=t+32,i=r-10;e.fillStyle="rgba(255, 100, 0, 0.5)",e.beginPath(),e.ellipse(a,i,18,25,0,0,2*Math.PI),e.fill(),e.fillStyle="rgba(255, 200, 0, 0.8)",e.beginPath(),e.ellipse(a,i+5,10,15,0,0,2*Math.PI),e.fill(),e.fillStyle="rgba(255, 255, 200, 0.9)",e.beginPath(),e.ellipse(a,i+8,5,8,0,0,2*Math.PI),e.fill()}};for(let e=m;e<=g;e++)for(let r=Math.max(0,e-t5+1);r<=Math.min(e,t5-1);r++){let a=e-r;if(a<0||a>=t5)continue;let{screenX:i,screenY:n}=iR(r,a,0,0);if(i+64<d||i>u||n+153.6<h||n>f)continue;let l=t2[a][r],o=ij&&ix&&ib&&r>=Math.min(ix.x,ib.x)&&r<=Math.max(ix.x,ib.x)&&a>=Math.min(ix.y,ib.y)&&a<=Math.max(ix.y,ib.y),s=iC(r,a),c=s?.needsGreyBase??!1,m=s?.needsGreenBaseOverWater??!1,g=s?.needsGreenBaseForPark??!1,p="subway"===tY&&"subway_station"===l.building.type;if(!function(e,t,r,a,i,n,l,o){let s="#4a7c3f",c="#2d4a26",d=iC(a.x,a.y),h=d?.isPartOfParkBuilding||["park","park_large","tennis","basketball_courts","playground_small","playground_large","baseball_field_small","soccer_field_small","football_field","skate_park","mini_golf_course","bleachers_field","go_kart_track","amphitheater","greenhouse_garden","animal_pens_farm","cabin_house","campground","marina_docks_small","pier_large","roller_coaster_small","community_garden","pond_park","park_gate","mountain_lodge","mountain_trailhead"].includes(a.building.type),u=d?.needsGreyBase??!1;"water"===a.building.type?(s="#2563eb",c="#1e3a8a"):"road"===a.building.type||"bridge"===a.building.type?(s="#4a4a4a",c="#333"):h?(s="#4a7c3f",c="#2d4a26"):u&&!(void 0!==l&&l)?(s="#6b7280",c="#374151"):"residential"===a.zone?(s="grass"!==a.building.type&&"empty"!==a.building.type?"#3d7c3f":"#2d5a2d",c="#22c55e"):"commercial"===a.zone?(s="grass"!==a.building.type&&"empty"!==a.building.type?"#3a5c7c":"#2a4a6a",c="#3b82f6"):"industrial"===a.zone&&(s="grass"!==a.building.type&&"empty"!==a.building.type?"#7c5c3a":"#6a4a2a",c="#f59e0b"),!(void 0!==o&&o&&("grass"===a.building.type||"empty"===a.building.type||"tree"===a.building.type)||"bridge"===a.building.type)&&(e.fillStyle=s,e.beginPath(),e.moveTo(t+32,r),e.lineTo(t+64,r+19.2),e.lineTo(t+32,r+38.4),e.lineTo(t,r+19.2),e.closePath(),e.fill(),n>=.6&&(e.strokeStyle=c,e.lineWidth=.5,e.stroke()),"none"!==a.zone&&n>=.95&&("grass"===a.building.type||"empty"===a.building.type)&&(e.strokeStyle="residential"===a.zone?"#22c55e":"commercial"===a.zone?"#3b82f6":"#f59e0b",e.lineWidth=1.5,e.setLineDash([4,2]),e.stroke(),e.setLineDash([]))),i&&(e.fillStyle="rgba(255, 255, 255, 0.25)",e.beginPath(),e.moveTo(t+32,r),e.lineTo(t+64,r+19.2),e.lineTo(t+32,r+38.4),e.lineTo(t,r+19.2),e.closePath(),e.fill(),e.strokeStyle="#ffffff",e.lineWidth=2,e.stroke())}(t,i,n,l,!!(o||p),rY,!0,m||g),c&&M.push({screenX:i,screenY:n,tile:l,depth:r+a}),(m||g)&&S.push({screenX:i,screenY:n,tile:l,depth:r+a}),"water"===l.building.type){let e=ea(l.building.type),t=r+a+e.width+e.height-2;y.push({screenX:i,screenY:n,tile:l,depth:t})}else if("road"===l.building.type){let e=r+a;b.push({screenX:i,screenY:n,tile:l,depth:e})}else if("bridge"===l.building.type){let e=r+a;w.push({screenX:i,screenY:n,tile:l,depth:e})}else if("rail"===l.building.type){let e=r+a;v.push({screenX:i,screenY:n,tile:l,depth:e})}else if(("grass"===l.building.type||"empty"===l.building.type)&&s?.isAdjacentToWater)_.push({screenX:i,screenY:n,tile:l,depth:r+a});else if("grass"!==l.building.type&&"empty"!==l.building.type){let e=ea(l.building.type),t=r+a+e.width+e.height-2;x.push({screenX:i,screenY:n,tile:l,depth:t})}"none"!==tY&&("subway"===tY?"water"!==l.building.type:"grass"!==l.building.type&&"water"!==l.building.type&&"road"!==l.building.type)&&k.push({screenX:i,screenY:n,tile:l})}t.save();let R=iR(0,0,0,0),Y=iR(t5-1,0,0,0),X=iR(t5-1,t5-1,0,0),A=iR(0,t5-1,0,0);t.beginPath(),t.moveTo(R.screenX+32,R.screenY),t.lineTo(Y.screenX+64,Y.screenY+19.2),t.lineTo(X.screenX+32,X.screenY+38.4),t.lineTo(A.screenX,A.screenY+19.2),t.closePath(),t.clip(),j(y);for(let e=0;e<y.length;e++){let{tile:r,screenX:a,screenY:i}=y[e];I(t,a,i,r)}if(t.restore(),rY>=.4)for(let e=0;e<y.length;e++){let{tile:r,screenX:a,screenY:i}=y[e];!function(e,t,r,a){let{north:i,east:n,south:l,west:o}=a;if(!i&&!n&&!l&&!o)return;let s=6.4,c=i$(t,r);i&&iU(e,c.left.x,c.left.y,c.top.x,c.top.y,iB.dx,iB.dy,s,o,n),n&&iU(e,c.top.x,c.top.y,c.right.x,c.right.y,iL.dx,iL.dy,s,i,l),l&&iU(e,c.right.x,c.right.y,c.bottom.x,c.bottom.y,iV.dx,iV.dy,s,n,o),o&&iU(e,c.bottom.x,c.bottom.y,c.left.x,c.left.y,iW.dx,iW.dy,s,l,i),i&&n&&iH(e,c.top,c.left,iB,c.right,iL,s),n&&l&&iH(e,c.right,c.top,iL,c.bottom,iV,s),l&&o&&iH(e,c.bottom,c.right,iV,c.left,iW,s),o&&i&&iH(e,c.left,c.bottom,iW,c.top,iB,s)}(t,a,i,{north:r.x-1>=0&&r.x-1<t5&&r.y>=0&&r.y<t5&&!P(r.x-1,r.y)&&!C(r.x-1,r.y)&&!T(r.x-1,r.y),east:r.x>=0&&r.x<t5&&r.y-1>=0&&r.y-1<t5&&!P(r.x,r.y-1)&&!C(r.x,r.y-1)&&!T(r.x,r.y-1),south:r.x+1>=0&&r.x+1<t5&&r.y>=0&&r.y<t5&&!P(r.x+1,r.y)&&!C(r.x+1,r.y)&&!T(r.x+1,r.y),west:r.x>=0&&r.x<t5&&r.y+1>=0&&r.y+1<t5&&!P(r.x,r.y+1)&&!C(r.x,r.y+1)&&!T(r.x,r.y+1)})}let O=19.2;j(S);for(let e=0;e<S.length;e++){let{tile:r,screenX:a,screenY:i}=S[e];!function(e,t,r,a,i){if(iD(e,t,r,iX[a.zone],{drawStroke:i>=.6,strokeWidth:.5}),"none"!==a.zone&&i>=.95){let i=iA[a.zone],n=i$(t,r);e.strokeStyle=i,e.lineWidth=1.5,e.setLineDash([4,2]),e.beginPath(),e.moveTo(n.top.x,n.top.y),e.lineTo(n.right.x,n.right.y),e.lineTo(n.bottom.x,n.bottom.y),e.lineTo(n.left.x,n.left.y),e.closePath(),e.stroke(),e.setLineDash([])}}(t,a,i,r,rY)}j(b);for(let e=0;e<b.length;e++){let{tile:i,screenX:n,screenY:l}=b[e];t.fillStyle="#4a4a4a",t.beginPath(),t.moveTo(n+32,l),t.lineTo(n+64,l+O),t.lineTo(n+32,l+38.4),t.lineTo(n,l+O),t.closePath(),t.fill(),I(t,n,l,i),i.hasRailOverlay&&(r=i.x,a=i.y,function(e,t,r,a,i){let n=t+32,l=r+19.2,o=i>=.7?.85:.7,s=o+.8,c={x:t+16,y:r+9.6},d={x:t+48,y:r+9.6},h={x:t+48,y:r+28.799999999999997},u={x:t+16,y:r+28.799999999999997},f={x:n,y:l},m="#101010",g="#7a7a7a",p=(t,r,a)=>{e.strokeStyle=m,e.lineWidth=s,e.lineCap="round",e.beginPath(),e.moveTo(t.x+1.92*a.x,t.y+1.92*a.y),e.lineTo(r.x+1.92*a.x,r.y+1.92*a.y),e.stroke(),e.beginPath(),e.moveTo(t.x-1.92*a.x,t.y-1.92*a.y),e.lineTo(r.x-1.92*a.x,r.y-1.92*a.y),e.stroke(),e.strokeStyle=g,e.lineWidth=o,e.beginPath(),e.moveTo(t.x+1.92*a.x,t.y+1.92*a.y),e.lineTo(r.x+1.92*a.x,r.y+1.92*a.y),e.stroke(),e.beginPath(),e.moveTo(t.x-1.92*a.x,t.y-1.92*a.y),e.lineTo(r.x-1.92*a.x,r.y-1.92*a.y),e.stroke()},x=(e,t,r)=>{p(le(e,r,7.04),le(t,r,7.04),r),p(le(e,r,-7.04),le(t,r,-7.04),r)},y=(t,r,a,i,n)=>{let l={x:(i.x+n.x)/2,y:(i.y+n.y)/2},c=Math.hypot(l.x,l.y),d={x:l.x/c,y:l.y/c};e.strokeStyle=m,e.lineWidth=s,e.lineCap="round",e.beginPath(),e.moveTo(t.x+1.92*i.x,t.y+1.92*i.y),e.quadraticCurveTo(a.x+1.92*d.x,a.y+1.92*d.y,r.x+1.92*n.x,r.y+1.92*n.y),e.stroke(),e.beginPath(),e.moveTo(t.x-1.92*i.x,t.y-1.92*i.y),e.quadraticCurveTo(a.x-1.92*d.x,a.y-1.92*d.y,r.x-1.92*n.x,r.y-1.92*n.y),e.stroke(),e.strokeStyle=g,e.lineWidth=o,e.beginPath(),e.moveTo(t.x+1.92*i.x,t.y+1.92*i.y),e.quadraticCurveTo(a.x+1.92*d.x,a.y+1.92*d.y,r.x+1.92*n.x,r.y+1.92*n.y),e.stroke(),e.beginPath(),e.moveTo(t.x-1.92*i.x,t.y-1.92*i.y),e.quadraticCurveTo(a.x-1.92*d.x,a.y-1.92*d.y,r.x-1.92*n.x,r.y-1.92*n.y),e.stroke()},b=(e,t,r,a,i,n)=>{y(le(e,a,7.04),le(t,i,7.04),le(r,n,7.04),a,i),y(le(e,a,-7.04),le(t,i,-7.04),le(r,n,-7.04),a,i)};switch(a){case"straight_ns":x(c,h,n6);break;case"straight_ew":x(d,u,n9);break;case"curve_ne":b(c,d,f,n6,n9,{x:0,y:1});break;case"curve_nw":b(c,u,f,n8,n9,{x:1,y:0});break;case"curve_se":b(h,d,f,n6,n7,{x:-1,y:0});break;case"curve_sw":b(h,u,f,n8,n7,{x:0,y:-1});break;case"junction_t_n":x(d,u,n9),b(h,d,f,n6,n7,{x:-1,y:0}),b(h,u,f,n8,n7,{x:0,y:-1});break;case"junction_t_e":x(c,h,n6),b(u,c,f,n9,n8,{x:1,y:0}),b(u,h,f,n7,n8,{x:0,y:-1});break;case"junction_t_s":x(d,u,n9),b(c,d,f,n6,n9,{x:0,y:1}),b(c,u,f,n8,n9,{x:1,y:0});break;case"junction_t_w":x(c,h,n6),b(d,c,f,n9,n6,{x:0,y:1}),b(d,h,f,n9,n8,{x:0,y:-1});break;case"junction_cross":x(c,h,n6),x(d,u,n9);break;case"terminus_n":x(f,h,n6);break;case"terminus_e":x(f,u,n9);break;case"terminus_s":x(f,c,n6);break;case"terminus_w":x(f,d,n9);break;case"single":{let e=h.x-c.x,t=h.y-c.y,r=Math.hypot(e,t),a={x:e/r,y:t/r},i=u.x-d.x,o=u.y-d.y,s=Math.hypot(i,o),f=.35*r;x({x:n-a.x*f,y:l-a.y*f},{x:n+a.x*f,y:l+a.y*f},{x:i/s,y:o/s})}}}(t,n,l,n4(lr(t2,t5,r,a)),rY))}j(w);for(let e=0;e<w.length;e++){let{tile:r,screenX:a,screenY:i}=w[e];z(t,a,i,r.x,r.y),I(t,a,i,r)}j(v);for(let e=0;e<v.length;e++){let{tile:r,screenX:a,screenY:i}=v[e];t.fillStyle="#5B6345",t.beginPath(),t.moveTo(a+32,i),t.lineTo(a+64,i+O),t.lineTo(a+32,i+38.4),t.lineTo(a,i+O),t.closePath(),t.fill(),t.strokeStyle="#4B5335",t.lineWidth=1,t.beginPath(),t.moveTo(a+32,i+38.4),t.lineTo(a,i+O),t.lineTo(a+32,i),t.stroke(),function(e,t,r,a,i,n,l,o){let s=n4(n3(n,l,a,i));!function(e,t,r,a,i){let n=t+32,l=r+19.2,o={x:t+16,y:r+9.6},s={x:t+48,y:r+9.6},c={x:t+48,y:r+28.799999999999997},d={x:t+16,y:r+28.799999999999997},h={x:n,y:l};e.fillStyle="#9B8365";let u=(t,r,a)=>{e.beginPath(),e.moveTo(t.x+5.76*a.x,t.y+5.76*a.y),e.lineTo(r.x+5.76*a.x,r.y+5.76*a.y),e.lineTo(r.x-5.76*a.x,r.y-5.76*a.y),e.lineTo(t.x-5.76*a.x,t.y-5.76*a.y),e.closePath(),e.fill()},f=(e,t,r)=>{u(le(e,r,7.04),le(t,r,7.04),r),u(le(e,r,-7.04),le(t,r,-7.04),r)},m=(t,r,a,i,n)=>{let l={x:(i.x+n.x)/2,y:(i.y+n.y)/2},o=Math.hypot(l.x,l.y),s={x:l.x/o,y:l.y/o};e.beginPath(),e.moveTo(t.x+5.76*i.x,t.y+5.76*i.y),e.quadraticCurveTo(a.x+5.76*s.x,a.y+5.76*s.y,r.x+5.76*n.x,r.y+5.76*n.y),e.lineTo(r.x-5.76*n.x,r.y-5.76*n.y),e.quadraticCurveTo(a.x-5.76*s.x,a.y-5.76*s.y,t.x-5.76*i.x,t.y-5.76*i.y),e.closePath(),e.fill()},g=(e,t,r,a,i,n)=>{m(le(e,a,7.04),le(t,i,7.04),le(r,n,7.04),a,i),m(le(e,a,-7.04),le(t,i,-7.04),le(r,n,-7.04),a,i)},p=()=>{let t=20.480000000000004,r=.6;e.beginPath(),e.moveTo(n,l-t*r),e.lineTo(n+t,l),e.lineTo(n,l+t*r),e.lineTo(n-t,l),e.closePath(),e.fill()};switch(a){case"straight_ns":f(o,c,n6);break;case"straight_ew":f(s,d,n9);break;case"curve_ne":g(o,s,h,n6,n9,{x:0,y:1});break;case"curve_nw":g(o,d,h,n8,n9,{x:1,y:0});break;case"curve_se":g(c,s,h,n6,n7,{x:-1,y:0});break;case"curve_sw":g(c,d,h,n8,n7,{x:0,y:-1});break;case"junction_t_n":f(s,d,n9),g(c,s,h,n6,n7,{x:-1,y:0}),g(c,d,h,n8,n7,{x:0,y:-1}),p();break;case"junction_t_e":f(o,c,n6),g(d,o,h,n9,n8,{x:1,y:0}),g(d,c,h,n7,n8,{x:0,y:-1}),p();break;case"junction_t_s":f(s,d,n9),g(o,s,h,n6,n9,{x:0,y:1}),g(o,d,h,n8,n9,{x:1,y:0}),p();break;case"junction_t_w":f(o,c,n6),g(s,o,h,n9,n6,{x:0,y:1}),g(s,c,h,n9,n8,{x:0,y:-1}),p();break;case"junction_cross":f(o,c,n6),f(s,d,n9),p();break;case"terminus_n":f(h,c,n6),p();break;case"terminus_e":f(h,d,n9),p();break;case"terminus_s":f(h,o,n6),p();break;case"terminus_w":f(h,s,n9),p();break;case"single":{let e=c.x-o.x,t=c.y-o.y,r=Math.hypot(e,t),a={x:e/r,y:t/r},i=d.x-s.x,h=d.y-s.y,u=Math.hypot(i,h),m=.35*r;f({x:n-a.x*m,y:l-a.y*m},{x:n+a.x*m,y:l+a.y*m},{x:i/u,y:h/u})}}}(e,t,r,s,0),function(e,t,r,a,i){if(i<.5)return;let n=t+32,l=r+19.2,o={x:t+16,y:r+9.6},s={x:t+48,y:r+9.6},c={x:t+48,y:r+28.799999999999997},d={x:t+16,y:r+28.799999999999997},h={x:n,y:l};e.fillStyle="#5c422e";let u=(t,r,a,i)=>{let n=4.4064,l=.576;e.beginPath(),e.moveTo(t+a.x*n+i.x*l,r+a.y*n+i.y*l),e.lineTo(t+a.x*n-i.x*l,r+a.y*n-i.y*l),e.lineTo(t-a.x*n-i.x*l,r-a.y*n-i.y*l),e.lineTo(t-a.x*n+i.x*l,r-a.y*n+i.y*l),e.closePath(),e.fill()},f=(e,t,r,a,i)=>{let n=t.x-e.x,l=t.y-e.y;for(let t=0;t<i;t++){let o=(t+.5)/i;u(e.x+n*o,e.y+l*o,r,a)}},m=(e,t,r,a,i,n)=>{f(le(e,i,7.04),le(t,i,7.04),r,a,n),f(le(e,i,-7.04),le(t,i,-7.04),r,a,n)},g=(e,t,r,a,i,n,l,o)=>{for(let s=0;s<o;s++){let c=(s+.5)/o,d=1-c,h=d*d*e.x+2*d*c*r.x+c*c*t.x,f=d*d*e.y+2*d*c*r.y+c*c*t.y,m={x:a.x*d+i.x*c,y:a.y*d+i.y*c},g=Math.hypot(m.x,m.y),p={x:m.x/g,y:m.y/g},x={x:n.x*d+l.x*c,y:n.y*d+l.y*c},y=Math.hypot(x.x,x.y);u(h,f,p,{x:x.x/y,y:x.y/y})}},p=(e,t,r,a,i,n,l,o,s,c,d)=>{g(le(e,o,7.04),le(t,s,7.04),le(r,c,7.04),a,i,n,l,d+3);let h=Math.max(3,d-2);g(le(e,o,-7.04),le(t,s,-7.04),le(r,c,-7.04),a,i,n,l,h)},x=Math.ceil(3.5);switch(a){case"straight_ns":m(o,c,n6,n9,n6,7);break;case"straight_ew":m(s,d,n9,n6,n9,7);break;case"curve_ne":p(o,s,h,n6,n9,n9,n6,n6,n9,{x:0,y:1},7);break;case"curve_nw":p(o,d,h,n8,n9,n9,n6,n8,n9,{x:1,y:0},7);break;case"curve_se":p(c,s,h,n6,n7,n7,n8,n6,n7,{x:-1,y:0},7);break;case"curve_sw":p(c,d,h,n8,n7,n7,n8,n8,n7,{x:0,y:-1},7);break;case"junction_t_n":m(s,d,n9,n6,n9,7),p(c,s,h,n6,n7,n7,n8,n6,n7,{x:-1,y:0},7),p(c,d,h,n8,n7,n7,n8,n8,n7,{x:0,y:-1},7);break;case"junction_t_e":m(o,c,n6,n9,n6,7),p(d,o,h,n9,n8,n6,n9,n9,n8,{x:1,y:0},7),p(d,c,h,n7,n8,n8,n7,n7,n8,{x:0,y:-1},7);break;case"junction_t_s":m(s,d,n9,n6,n9,7),p(o,s,h,n6,n9,n9,n6,n6,n9,{x:0,y:1},7),p(o,d,h,n8,n9,n9,n6,n8,n9,{x:1,y:0},7);break;case"junction_t_w":m(o,c,n6,n9,n6,7),p(s,o,h,n9,n6,n6,n9,n9,n6,{x:0,y:1},7),p(s,c,h,n9,n8,n8,n7,n9,n8,{x:0,y:-1},7);break;case"junction_cross":m(o,c,n6,n9,n6,7),m(s,d,n9,n6,n9,7);break;case"terminus_n":m(h,c,n6,n9,n6,x);break;case"terminus_e":m(h,d,n9,n6,n9,x);break;case"terminus_s":m(h,o,n6,n9,n6,x);break;case"terminus_w":m(h,s,n9,n6,n9,x);break;case"single":{let e=c.x-o.x,t=c.y-o.y,r=Math.hypot(e,t),a={x:e/r,y:t/r},i=d.x-s.x,h=d.y-s.y,u=Math.hypot(i,h),f={x:i/u,y:h/u},g=.35*r;m({x:n-a.x*g,y:l-a.y*g},{x:n+a.x*g,y:l+a.y*g},f,a,f,3)}}}(e,t,r,s,o),function(e,t,r,a,i){let n=t+32,l=r+19.2,o=i>=.7?.85:.7,s={x:t+16,y:r+9.6},c={x:t+48,y:r+9.6},d={x:t+48,y:r+28.799999999999997},h={x:t+16,y:r+28.799999999999997},u={x:n,y:l},f=(t,r,a)=>{e.strokeStyle=nG,e.lineWidth=o+.3,e.lineCap="round",e.beginPath(),e.moveTo(t.x+1.92*a.x+.3,t.y+1.92*a.y+.3),e.lineTo(r.x+1.92*a.x+.3,r.y+1.92*a.y+.3),e.stroke(),e.beginPath(),e.moveTo(t.x-1.92*a.x+.3,t.y-1.92*a.y+.3),e.lineTo(r.x-1.92*a.x+.3,r.y-1.92*a.y+.3),e.stroke(),e.strokeStyle=nH,e.lineWidth=o,e.beginPath(),e.moveTo(t.x+1.92*a.x,t.y+1.92*a.y),e.lineTo(r.x+1.92*a.x,r.y+1.92*a.y),e.stroke(),e.beginPath(),e.moveTo(t.x-1.92*a.x,t.y-1.92*a.y),e.lineTo(r.x-1.92*a.x,r.y-1.92*a.y),e.stroke()},m=(e,t,r)=>{f(le(e,r,7.04),le(t,r,7.04),r),f(le(e,r,-7.04),le(t,r,-7.04),r)},g=(t,r,a,i,n)=>{let l={x:(i.x+n.x)/2,y:(i.y+n.y)/2},s=Math.hypot(l.x,l.y),c={x:l.x/s,y:l.y/s};e.strokeStyle=nG,e.lineWidth=o+.3,e.lineCap="round",e.beginPath(),e.moveTo(t.x+1.92*i.x+.3,t.y+1.92*i.y+.3),e.quadraticCurveTo(a.x+1.92*c.x+.3,a.y+1.92*c.y+.3,r.x+1.92*n.x+.3,r.y+1.92*n.y+.3),e.stroke(),e.beginPath(),e.moveTo(t.x-1.92*i.x+.3,t.y-1.92*i.y+.3),e.quadraticCurveTo(a.x-1.92*c.x+.3,a.y-1.92*c.y+.3,r.x-1.92*n.x+.3,r.y-1.92*n.y+.3),e.stroke(),e.strokeStyle=nH,e.lineWidth=o,e.beginPath(),e.moveTo(t.x+1.92*i.x,t.y+1.92*i.y),e.quadraticCurveTo(a.x+1.92*c.x,a.y+1.92*c.y,r.x+1.92*n.x,r.y+1.92*n.y),e.stroke(),e.beginPath(),e.moveTo(t.x-1.92*i.x,t.y-1.92*i.y),e.quadraticCurveTo(a.x-1.92*c.x,a.y-1.92*c.y,r.x-1.92*n.x,r.y-1.92*n.y),e.stroke()},p=(e,t,r,a,i,n)=>{g(le(e,a,7.04),le(t,i,7.04),le(r,n,7.04),a,i),g(le(e,a,-7.04),le(t,i,-7.04),le(r,n,-7.04),a,i)};switch(a){case"straight_ns":m(s,d,n6);break;case"straight_ew":m(c,h,n9);break;case"curve_ne":p(s,c,u,n6,n9,{x:0,y:1});break;case"curve_nw":p(s,h,u,n8,n9,{x:1,y:0});break;case"curve_se":p(d,c,u,n6,n7,{x:-1,y:0});break;case"curve_sw":p(d,h,u,n8,n7,{x:0,y:-1});break;case"junction_t_n":m(c,h,n9),p(d,c,u,n6,n7,{x:-1,y:0}),p(d,h,u,n8,n7,{x:0,y:-1});break;case"junction_t_e":m(s,d,n6),p(h,s,u,n9,n8,{x:1,y:0}),p(h,d,u,n7,n8,{x:0,y:-1});break;case"junction_t_s":m(c,h,n9),p(s,c,u,n6,n9,{x:0,y:1}),p(s,h,u,n8,n9,{x:1,y:0});break;case"junction_t_w":m(s,d,n6),p(c,s,u,n9,n6,{x:0,y:1}),p(c,d,u,n9,n8,{x:0,y:-1});break;case"junction_cross":m(s,d,n6),m(c,h,n9);break;case"terminus_n":m(u,d,n6),lt(e,n+7.04*n6.x,l+7.04*n6.y,"north",i),lt(e,n-7.04*n6.x,l-7.04*n6.y,"north",i);break;case"terminus_e":m(u,h,n9),lt(e,n+7.04*n9.x,l+7.04*n9.y,"east",i),lt(e,n-7.04*n9.x,l-7.04*n9.y,"east",i);break;case"terminus_s":m(u,s,n6),lt(e,n+7.04*n6.x,l+7.04*n6.y,"south",i),lt(e,n-7.04*n6.x,l-7.04*n6.y,"south",i);break;case"terminus_w":m(u,c,n9),lt(e,n+7.04*n9.x,l+7.04*n9.y,"west",i),lt(e,n-7.04*n9.x,l-7.04*n9.y,"west",i);break;case"single":{let e=d.x-s.x,t=d.y-s.y,r=Math.hypot(e,t),a={x:e/r,y:t/r},i=h.x-c.x,o=h.y-c.y,u=Math.hypot(i,o),f=.35*r;m({x:n-a.x*f,y:l-a.y*f},{x:n+a.x*f,y:l+a.y*f},{x:i/u,y:o/u})}}}(e,t,r,s,o)}(t,a,i,r.x,r.y,t2,t5,rY)}j(M);for(let e=0;e<M.length;e++){let{tile:r,screenX:a,screenY:i}=M[e];iD(t,a,i,iO,{drawStroke:rY>=.6,strokeWidth:.5})}for(let e=0;e<w.length;e++){let{tile:r,screenX:a,screenY:i}=w[e];"suspension"===r.building.bridgeType&&lP(t,a,i,r.building,rY)}let E=new Set,B=aS.current;for(let e=0;e<B.length;e++){let{x:t,y:r}=B[e];E.add(r*t5+t)}let L=ay.current,V=a_.current,W=aM.current;for(let e=0;e<b.length;e++){let{tile:r,screenX:a,screenY:i}=b[e];if(r.hasRailOverlay){let e=r.y*t5+r.x;if(E.has(e)){let n=W.get(e)??0,l="open"!==lu(L,r.x,r.y);!function(e,t,r,a,i,n,l,o,s,c,d){let h,u,f,m=(u=(h=lr(n,l,a,i)).north||h.south,f=h.east||h.west,u&&f?"cross":u?"ns":"ew");"cross"===m?(ls(e,t,r,"ne",s,d,o),ls(e,t,r,"sw",s,d,o),ls(e,t,r,"nw",s,d,o),ls(e,t,r,"se",s,d,o),o>=.7&&(lc(e,t,r,"ne",c,o),lc(e,t,r,"sw",c,o),lc(e,t,r,"nw",c,o),lc(e,t,r,"se",c,o))):"ns"===m?(ls(e,t,r,"ne",s,d,o),ls(e,t,r,"sw",s,d,o),o>=.7&&(lc(e,t,r,"ne",c,o,1,30),lc(e,t,r,"sw",c,o,-1,-30))):(ls(e,t,r,"nw",s,d,o),ls(e,t,r,"se",s,d,o),o>=.7&&(lc(e,t,r,"nw",c,o),lc(e,t,r,"se",c,o)))}(t,a,i,r.x,r.y,t2,t5,rY,V,n,l)}}}j(x);let D=rl.current;if(D){D.width=a5.width,D.height=a5.height;let e=D.getContext("2d");if(e){e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,D.width,D.height),e.scale(l,l),e.translate(rm.x,rm.y),e.scale(rY,rY),e.imageSmoothingEnabled=!1;for(let t=0;t<x.length;t++){let{tile:r,screenX:a,screenY:i}=x[t];I(e,a,i,r)}for(let t=0;t<w.length;t++){let{tile:r,screenX:a,screenY:i}=w[t];"suspension"===r.building.bridgeType&&lP(e,a,i,r.building,rY)}for(let t=0;t<w.length;t++){let{tile:r,screenX:a,screenY:i}=w[t];"suspension"===r.building.bridgeType&&function(e,t,r,a,i){let n,l,o,s;if("suspension"!==a.bridgeType||i<.5)return;let c=a.bridgeOrientation||"ns",d=a.bridgeVariant||0,h=a.bridgePosition||"middle",u=a.bridgeIndex??0,f=a.bridgeSpan??1,m="rail"===(a.bridgeTrackType||"road"),g=r+3.84*!!m,p=t+32,x=g+19.2,y=64*(m?.36:.45)*.5,b=Math.hypot(32,19.2),w=19.2/b,v=19.2/b;"ns"===c?(n={x:t+16,y:g+9.6},l={x:t+48,y:g+28.799999999999997},o=-32/b,s=v):(n={x:t+48,y:g+9.6},l={x:t+16,y:g+28.799999999999997},o=32/b,s=w);let _=n.y-3,M=l.y-3,S=l.x-n.x,k=l.y-n.y,j=Math.hypot(S,k),P=S/j,T=k/j,C=-k/j,N=S/j,z={x:n.x+o*y,y:_+s*y},I={x:n.x-o*y,y:_-s*y},R={x:l.x+o*y,y:M+s*y},Y={x:l.x-o*y,y:M-s*y},X={startX:z.x+3*o-18*P,startY:z.y+3*s-18*T,endX:R.x+3*o+18*P,endY:R.y+3*s+18*T},A={startX:I.x-3*o-18*P,startY:I.y-3*s-18*T,endX:Y.x-3*o+18*P,endY:Y.y-3*s+18*T},O=p+28.8*C,E=x+28.8*N,$=p-28.8*C,B=x-28.8*N,L=E<B?{x:O,y:E}:{x:$,y:B},V=E<B?{x:$,y:B}:{x:O,y:E},W=Math.floor((f-1)/2),D=void 0!==a.bridgeSpan&&a.bridgeSpan>1,F="middle"===h&&(D&&f>6&&u===W||!D&&(t/64+g/38.4)%5==2);if("start"!==h&&"end"!==h&&!F)return;e.strokeStyle=["#DC143C","#708090","#5a7a5a"][d%3],e.lineWidth=1.25;let J=(X.startX+X.endX)/2,U=(A.startX+A.endX)/2,H=Math.abs(L.x-J),G=Math.abs(L.x-U),q=H<G?X:A,Q=H<G?A:X,Z=(t,r,a,i)=>{let n=(r+i)/2;e.beginPath(),e.moveTo(t,r),e.quadraticCurveTo((t+a)/2,n+8,a,i),e.stroke()},K=x-27+-5;Z(L.x,K,q.startX,q.startY),Z(L.x,K,q.endX,q.endY);let ee=x-27+8;Z(V.x,ee,Q.startX,Q.startY),Z(V.x,ee,Q.endX,Q.endY)}(e,a,i,r.building,rY)}for(let t=0;t<k.length;t++){let{tile:r,screenX:a,screenY:i}=k[t],n={fire:tH.services.fire[r.y][r.x],police:tH.services.police[r.y][r.x],health:tH.services.health[r.y][r.x],education:tH.services.education[r.y][r.x]},l=function(e,t,r){let a=!rL.has(t.building.type);switch(e){case"power":if(!a)return rW;return t.building.powered?rW:rV;case"water":if(!a)return rW;return t.building.watered?rW:rV;case"fire":if(!a)return rW;return r.fire>0?rW:rV;case"police":if(!a)return rW;return r.police>0?rW:rV;case"health":if(!a)return rW;return r.health>0?rW:rV;case"education":if(!a)return rW;return r.education>0?rW:rV;case"subway":return t.hasSubway?"rgba(245, 158, 11, 0.7)":"rgba(40, 30, 20, 0.4)";default:return rW}}(tY,r,n);"rgba(0, 0, 0, 0)"!==l&&(e.fillStyle=l,e.beginPath(),e.moveTo(a+32,i),e.lineTo(a+64,i+O),e.lineTo(a+32,i+38.4),e.lineTo(a,i+O),e.closePath(),e.fill())}if("none"!==tY&&"subway"!==tY){let t=rD[tY],r=rF[tY],a=rU[tY],i=rJ[tY];for(let n=0;n<t5;n++)for(let l=0;l<t5;l++){let o=t2[n][l];if(!t.includes(o.building.type)||void 0!==o.building.constructionProgress&&o.building.constructionProgress<100||o.building.abandoned)continue;let s=q[o.building.type];if(!s||!("range"in s))continue;let c=Math.floor(s.range*(1+(o.building.level-1)*.2)),{screenX:d,screenY:h}=iR(l,n,0,0),u=d+32,f=h+O,m=32*c,g=c*O;e.strokeStyle=r,e.lineWidth=2/rY,e.beginPath(),e.ellipse(u,f,m,g,0,0,2*Math.PI),e.stroke(),e.fillStyle=a,e.fill(),e.strokeStyle=i,e.lineWidth=3/rY,e.beginPath(),e.moveTo(d+32,h),e.lineTo(d+64,h+O),e.lineTo(d+32,h+38.4),e.lineTo(d,h+O),e.closePath(),e.stroke(),e.fillStyle=i,e.beginPath(),e.arc(u,f,4/rY,0,2*Math.PI),e.fill()}}e.setTransform(1,0,0,1,0,0)}}if(t6&&t6.length>0){t.save(),t.font=`${Math.max(10,12/rY)}px sans-serif`,t.fillStyle="rgba(255, 255, 255, 0.9)",t.strokeStyle="rgba(0, 0, 0, 0.5)",t.lineWidth=2,t.textAlign="center",t.textBaseline="middle";let e=a5.width/(l*rY),r=a5.height/(l*rY),a=-rm.x/rY-64,i=-rm.y/rY-76.8,n=e-rm.x/rY+64,o=r-rm.y/rY+76.8;for(let e of t6){if(0===e.tiles.length)continue;let{screenX:r,screenY:l}=iR(e.centerX,e.centerY,0,0);r>=a-100&&r<=n+100&&l>=i-50&&l<=o+50&&(t.strokeText(e.name,r+32,l+19.2),t.fillText(e.name,r+32,l+19.2))}t.restore()}t.restore()}),()=>{null!==rd.current&&(cancelAnimationFrame(rd.current),rd.current=null)}},tR[153]=a5.height,tR[154]=a5.width,tR[155]=ib,tR[156]=ix,tR[157]=iC,tR[158]=t2,tR[159]=t5,tR[160]=aK,tR[161]=tF,tR[162]=rm.x,tR[163]=rm.y,tR[164]=tY,tR[165]=ij,tR[166]=tH.services,tR[167]=t6,tR[168]=rY,tR[169]=eK):eK=tR[169],tR[170]!==a5||tR[171]!==t0||tR[172]!==ib||tR[173]!==ix||tR[174]!==iC||tR[175]!==t2||tR[176]!==t5||tR[177]!==a1||tR[178]!==aK||tR[179]!==tF||tR[180]!==rm||tR[181]!==tY||tR[182]!==ij||tR[183]!==tH.services||tR[184]!==t6||tR[185]!==rY?(e0=[t2,t5,rm,rY,tY,aK,a1,a5,ix,ib,tH.services,t0,t6,iC,ij,tF],tR[170]=a5,tR[171]=t0,tR[172]=ib,tR[173]=ix,tR[174]=iC,tR[175]=t2,tR[176]=t5,tR[177]=a1,tR[178]=aK,tR[179]=tF,tR[180]=rm,tR[181]=tY,tR[182]=ij,tR[183]=tH.services,tR[184]=t6,tR[185]=rY,tR[186]=e0):e0=tR[186],(0,l.useEffect)(eK,e0),tR[187]!==ib||tR[188]!==ix||tR[189]!==t2||tR[190]!==t5||tR[191]!==rN||tR[192]!==rp||tR[193]!==rm.x||tR[194]!==rm.y||tR[195]!==tX||tR[196]!==t3||tR[197]!==rY?(e1=()=>{let e=ri.current;if(!e)return;let t=e.getContext("2d");if(!t)return;let r=window.devicePixelRatio||1;t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,e.width,e.height),t.scale(r,r),t.translate(rm.x,rm.y),t.scale(rY,rY);let a=(e,r,a,i)=>{t.fillStyle=void 0===a?"rgba(255, 255, 255, 0.25)":a,t.beginPath(),t.moveTo(e+32,r),t.lineTo(e+64,r+19.2),t.lineTo(e+32,r+38.4),t.lineTo(e,r+19.2),t.closePath(),t.fill(),t.strokeStyle=void 0===i?"#ffffff":i,t.lineWidth=2,t.stroke()};if(rN&&rN.x>=0&&rN.x<t5&&rN.y>=0&&rN.y<t5)if(t3&&!["select","bulldoze","road","rail","subway","tree","zone_residential","zone_commercial","zone_industrial","zone_dezone","zone_water","zone_land"].includes(t3)){let e=ea(t3);for(let t=0;t<e.width;t++)for(let r=0;r<e.height;r++){let e=rN.x+t,i=rN.y+r;if(e>=0&&e<t5&&i>=0&&i<t5){let{screenX:t,screenY:r}=iR(e,i,0,0);a(t,r)}}}else{let{screenX:e,screenY:t}=iR(rN.x,rN.y,0,0);a(e,t)}if(tX&&tX.x>=0&&tX.x<t5&&tX.y>=0&&tX.y<t5){let e=t2[tX.y]?.[tX.x];if(e){let t=ea(e.building.type);for(let e=0;e<t.width;e++)for(let r=0;r<t.height;r++){let t=tX.x+e,i=tX.y+r;if(t>=0&&t<t5&&i>=0&&i<t5){let{screenX:e,screenY:r}=iR(t,i,0,0);a(e,r,"rgba(100, 200, 255, 0.3)","#60a5fa")}}}}if(rp&&("road"===t3||"rail"===t3)&&ix&&ib){let e=Math.min(ix.x,ib.x),t=Math.max(ix.x,ib.x),r=Math.min(ix.y,ib.y),i=Math.max(ix.y,ib.y),n=[];for(let a=e;a<=t;a++)for(let e=r;e<=i;e++)if(a>=0&&a<t5&&e>=0&&e<t5){let t=t2[e][a];n.push({x:a,y:e,isWater:"water"===t.building.type})}let l=(()=>{let a=new Map,l=t-e>i-r,o=[...n].sort((e,t)=>l?e.x-t.x:e.y-t.y),s=0;for(;s<o.length;){let e=o[s];if(!e.isWater){a.set(`${e.x},${e.y}`,"land"),s++;continue}let t=s;for(;s<o.length&&o[s].isWater;)s++;let r=s-1,i=r-t+1,n=t>0&&!o[t-1].isWater,c=r<o.length-1&&!o[r+1].isWater,d=!1,h=!1;if(0===t){let e=o[t],r=l?e.x-1:e.x,a=l?e.y:e.y-1;r>=0&&a>=0&&r<t5&&a<t5&&(d="water"!==t2[a][r].building.type)}if(r===o.length-1){let e=o[r],t=l?e.x+1:e.x,a=l?e.y:e.y+1;t>=0&&a>=0&&t<t5&&a<t5&&(h="water"!==t2[a][t].building.type)}let u=(n||d)&&(c||h)&&i<=10;for(let e=t;e<=r;e++){let t=o[e];a.set(`${t.x},${t.y}`,u?"valid":"invalid")}}return a})();for(let e of n){let{screenX:t,screenY:r}=iR(e.x,e.y,0,0),i=`${e.x},${e.y}`,n=l.get(i)||"land";"valid"===n?a(t,r,"rgba(59, 130, 246, 0.5)","#3b82f6"):"invalid"===n&&a(t,r,"rgba(239, 68, 68, 0.5)","#ef4444")}}t.setTransform(1,0,0,1,0,0)},tR[187]=ib,tR[188]=ix,tR[189]=t2,tR[190]=t5,tR[191]=rN,tR[192]=rp,tR[193]=rm.x,tR[194]=rm.y,tR[195]=tX,tR[196]=t3,tR[197]=rY,tR[198]=e1):e1=tR[198],tR[199]!==ib||tR[200]!==ix||tR[201]!==t2||tR[202]!==t5||tR[203]!==rN||tR[204]!==rp||tR[205]!==rm||tR[206]!==tX||tR[207]!==t3||tR[208]!==rY?(e2=[rN,tX,t3,rm,rY,t5,t2,rp,ix,ib],tR[199]=ib,tR[200]=ix,tR[201]=t2,tR[202]=t5,tR[203]=rN,tR[204]=rp,tR[205]=rm,tR[206]=tX,tR[207]=t3,tR[208]=rY,tR[209]=e2):e2=tR[209],(0,l.useEffect)(e1,e2),tR[210]!==lJ||tR[211]!==n$||tR[212]!==nV||tR[213]!==i6||tR[214]!==i9||tR[215]!==lD||tR[216]!==nw||tR[217]!==ll||tR[218]!==lK||tR[219]!==nv||tR[220]!==ny||tR[221]!==nb||tR[222]!==l0||tR[223]!==lB||tR[224]!==l2||tR[225]!==tF||tR[226]!==iJ||tR[227]!==nN||tR[228]!==nA||tR[229]!==nL||tR[230]!==i0||tR[231]!==iZ||tR[232]!==lW||tR[233]!==iq||tR[234]!==iQ||tR[235]!==la||tR[236]!==nz||tR[237]!==i1||tR[238]!==nY||tR[239]!==lo||tR[240]!==l1||tR[241]!==t1?(e5=()=>{let e,t=rn.current,r=ro.current;if(!t||!r)return;let a=t.getContext("2d"),i=r.getContext("2d");if(!a||!i)return;a.imageSmoothingEnabled=!1,i.imageSmoothingEnabled=!1;let n=()=>{i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,r.width,r.height)},l=performance.now(),o=0,s=tF?33:16,c=r=>{e=requestAnimationFrame(c);let d=r-o;if(tF&&d<s)return;let h=Math.min((r-l)/1e3,.3);l=r,o=r;let u=tF&&(r_.current||rM.current);if(h>0&&!u){iZ(h),i0(h),iJ(h),iq(h),iQ(h),i1(h),nN(h),nz(h),nY(h),nL(h),nA(h),l1(h),la(h,t1),lo(h),lW(h,t1),av.current=av.current+3*h,aO.current=aO.current+h,a_.current=a_.current+h;let e=ay.current,t=aM.current,r=aH.current.speed,a=0===r?0:1===r?1:2===r?2.5:4,i=aS.current,n=aH.current.gridSize;for(let r=0;r<i.length;r++){let{x:l,y:o}=i[r],s=o*n+l,c=t.get(s)??0,d=90*("open"!==lu(e,l,o));if(c!==d){let e=180*h*a;c<d?t.set(s,Math.min(d,c+e)):t.set(s,Math.max(d,c-e))}}}let f=tF&&(r_.current||rM.current),m=!tF&&r_.current&&rj.current<.5;f?(a.setTransform(1,0,0,1,0,0),a.clearRect(0,0,t.width,t.height),n()):(i9(a),i6(a),m||nV(a),n$(a),l2(a),m||lB(a),ny(a),nw(a),n(),nv(i,h),nb(i),m||(lK(i),l0(i)),lD(i,t1),lJ(i),ll(i))};return e=requestAnimationFrame(c),()=>cancelAnimationFrame(e)},tR[210]=lJ,tR[211]=n$,tR[212]=nV,tR[213]=i6,tR[214]=i9,tR[215]=lD,tR[216]=nw,tR[217]=ll,tR[218]=lK,tR[219]=nv,tR[220]=ny,tR[221]=nb,tR[222]=l0,tR[223]=lB,tR[224]=l2,tR[225]=tF,tR[226]=iJ,tR[227]=nN,tR[228]=nA,tR[229]=nL,tR[230]=i0,tR[231]=iZ,tR[232]=lW,tR[233]=iq,tR[234]=iQ,tR[235]=la,tR[236]=nz,tR[237]=i1,tR[238]=nY,tR[239]=lo,tR[240]=l1,tR[241]=t1,tR[242]=e5):e5=tR[242],tR[243]!==a5.height||tR[244]!==a5.width||tR[245]!==lJ||tR[246]!==n$||tR[247]!==nV||tR[248]!==i6||tR[249]!==i9||tR[250]!==lD||tR[251]!==nw||tR[252]!==ll||tR[253]!==lK||tR[254]!==nv||tR[255]!==ny||tR[256]!==nb||tR[257]!==l0||tR[258]!==lB||tR[259]!==l2||tR[260]!==tF||tR[261]!==iJ||tR[262]!==nN||tR[263]!==nA||tR[264]!==nL||tR[265]!==i0||tR[266]!==iZ||tR[267]!==lW||tR[268]!==iq||tR[269]!==iQ||tR[270]!==la||tR[271]!==nz||tR[272]!==i1||tR[273]!==nY||tR[274]!==lo||tR[275]!==l1||tR[276]!==t1?(e3=[a5.width,a5.height,iZ,i0,i9,i6,iJ,iq,iQ,nw,i1,ny,nb,nN,lJ,nz,lK,nY,l0,nL,nV,nA,n$,l1,l2,nv,la,ll,lo,lB,lW,lD,t1,tF],tR[243]=a5.height,tR[244]=a5.width,tR[245]=lJ,tR[246]=n$,tR[247]=nV,tR[248]=i6,tR[249]=i9,tR[250]=lD,tR[251]=nw,tR[252]=ll,tR[253]=lK,tR[254]=nv,tR[255]=ny,tR[256]=nb,tR[257]=l0,tR[258]=lB,tR[259]=l2,tR[260]=tF,tR[261]=iJ,tR[262]=nN,tR[263]=nA,tR[264]=nL,tR[265]=i0,tR[266]=iZ,tR[267]=lW,tR[268]=iq,tR[269]=iQ,tR[270]=la,tR[271]=nz,tR[272]=i1,tR[273]=nY,tR[274]=lo,tR[275]=l1,tR[276]=t1,tR[277]=e3):e3=tR[277],(0,l.useEffect)(e5,e3),tR[278]!==a5.height||tR[279]!==a5.width||tR[280]!==tF||tR[281]!==ry||tR[282]!==rw||tR[283]!==rm||tR[284]!==t1||tR[285]!==rY?(e4={canvasRef:rs,worldStateRef:aH,visualHour:t1,offset:rm,zoom:rY,canvasWidth:a5.width,canvasHeight:a5.height,isMobile:tF,isPanningRef:r_,isPinchZoomingRef:rM,isWheelZoomingRef:rS,isPanning:ry,isWheelZooming:rw},tR[278]=a5.height,tR[279]=a5.width,tR[280]=tF,tR[281]=ry,tR[282]=rw,tR[283]=rm,tR[284]=t1,tR[285]=rY,tR[286]=e4):e4=tR[286],function(e){let t,r,a=(0,n.c)(24),{canvasRef:i,worldStateRef:o,visualHour:s,offset:c,zoom:d,canvasWidth:h,canvasHeight:u,isMobile:f,isPanningRef:m,isPinchZoomingRef:g,isWheelZoomingRef:p,isPanning:x,isWheelZooming:y}=e;a[0]!==i||a[1]!==f||a[2]!==m||a[3]!==g||a[4]!==p||a[5]!==c||a[6]!==s||a[7]!==o||a[8]!==d?(t=()=>{let e=i.current;if(!e)return;let t=e.getContext("2d");if(!t)return;if(m.current||g.current||p.current){t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,e.width,e.height);return}let r=window.devicePixelRatio||1,a=s>=7&&s<18?0:s>=5&&s<7?1-(s-5)/2:s>=18&&s<20?(s-18)/2:1;if(t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,e.width,e.height),a<=.01)return;let n=function(e){if(e>=7&&e<18)return{r:255,g:255,b:255};if(e>=5&&e<7){let t=(e-5)/2;return{r:Math.round(60+40*t),g:Math.round(40+30*t),b:Math.round(70+20*t)}}if(e>=18&&e<20){let t=(e-18)/2;return{r:Math.round(100-40*t),g:Math.round(70-30*t),b:Math.round(90-20*t)}}return{r:20,g:30,b:60}}(s);t.fillStyle=`rgba(${n.r}, ${n.g}, ${n.b}, ${.6*a})`,t.fillRect(0,0,e.width,e.height);let l=e.width/(r*d),h=e.height/(r*d),u=-c.x/d-128,x=-c.y/d-153.6,y=l-c.x/d+128,b=h-c.y/d+153.6,w=o.current.grid,v=o.current.gridSize,_=Math.min(2*v-2,Math.ceil((b+38.4)*2/38.4)),M=Math.min(1,1.3*a),{lightCutouts:S,coloredGlows:k}=function(e,t,r,a,i,n,l,o,s){let c=[],d=[],h=s?3:1,u=0;for(let f=r;f<=a;f++)for(let r=Math.max(0,f-t+1);r<=Math.min(f,t-1);r++){let a=f-r;if(a<0||a>=t)continue;let{screenX:m,screenY:g}=iR(r,a,0,0);if(m+64<i||m>n||g+115.19999999999999<l||g>o)continue;let p=e[a][r],x=p.building.type;"road"===x||"bridge"===x?++u%h==0&&(c.push({x:r,y:a,type:"road"}),s||d.push({x:r,y:a,type:"road"})):!il.has(x)&&p.building.powered&&(c.push({x:r,y:a,type:"building",buildingType:x,seed:1e3*r+a}),s||"hospital"!==x&&"fire_station"!==x&&"police_station"!==x&&"power_plant"!==x||d.push({x:r,y:a,type:x}))}return{lightCutouts:c,coloredGlows:d}}(w,v,Math.max(0,Math.floor((x-230.39999999999998)*2/38.4)),_,u,y,x,b,f);t.globalCompositeOperation="destination-out",t.save(),t.scale(r*d,r*d),t.translate(c.x/d,c.y/d),function(e,t,r,a){for(let i of t){let{screenX:t,screenY:n}=iR(i.x,i.y,0,0),l=t+32,o=n+19.2;if("road"===i.type){let t=e.createRadialGradient(l,o,0,l,o,28);t.addColorStop(0,`rgba(255, 255, 255, ${.75*r})`),t.addColorStop(.4,`rgba(255, 255, 255, ${.4*r})`),t.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=t,e.beginPath(),e.arc(l,o,28,0,2*Math.PI),e.fill()}else if("building"===i.type&&i.buildingType&&void 0!==i.seed){let t=i.buildingType,n=io.has(t),s=is.has(t)?.9:n?.65:.75;if(!a){let a=2;(t.includes("medium")||t.includes("low"))&&(a=3),(t.includes("high")||"mall"===t)&&(a=5),("mansion"===t||"office_high"===t)&&(a=4);for(let t=0;t<a;t++){if(!(l$(i.seed,t)<(n?.55:.75)))continue;let a=l+(l$(i.seed,t+10)-.5)*22,c=o+-18+(l$(i.seed,t+20)-.5)*16,d=e.createRadialGradient(a,c,0,a,c,12.5);d.addColorStop(0,`rgba(255, 255, 255, ${s*r})`),d.addColorStop(.5,`rgba(255, 255, 255, ${.4*s*r})`),d.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=d,e.beginPath(),e.arc(a,c,12.5,0,2*Math.PI),e.fill()}}let c=a?32:38.4,d=a?.4:.28,h=e.createRadialGradient(l,o+9.6,0,l,o+9.6,c);h.addColorStop(0,`rgba(255, 255, 255, ${d*r})`),h.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=h,e.beginPath(),e.ellipse(l,o+9.6,c,15.36,0,0,2*Math.PI),e.fill()}}}(t,S,M,f),t.restore(),t.globalCompositeOperation="source-over",t.save(),t.scale(r*d,r*d),t.translate(c.x/d,c.y/d),function(e,t,r){for(let a of t){let{screenX:t,screenY:i}=iR(a.x,a.y,0,0),n=t+32,l=i+19.2;if("road"===a.type){let t=e.createRadialGradient(n,l,0,n,l,20);t.addColorStop(0,`rgba(255, 210, 130, ${.3*r})`),t.addColorStop(.5,`rgba(255, 190, 100, ${.15*r})`),t.addColorStop(1,"rgba(0, 0, 0, 0)"),e.fillStyle=t,e.beginPath(),e.arc(n,l,20,0,2*Math.PI),e.fill()}else{let t=null,i=20;if("hospital"===a.type?(t={r:255,g:80,b:80},i=25):"fire_station"===a.type?(t={r:255,g:100,b:50},i=22):"police_station"===a.type?(t={r:60,g:140,b:255},i=22):"power_plant"===a.type&&(t={r:255,g:200,b:50},i=30),t){let a=e.createRadialGradient(n,l-15,0,n,l-15,i);a.addColorStop(0,`rgba(${t.r}, ${t.g}, ${t.b}, ${.55*r})`),a.addColorStop(.5,`rgba(${t.r}, ${t.g}, ${t.b}, ${.25*r})`),a.addColorStop(1,"rgba(0, 0, 0, 0)"),e.fillStyle=a,e.beginPath(),e.arc(n,l-15,i,0,2*Math.PI),e.fill()}}}}(t,k,M),t.restore(),t.globalCompositeOperation="source-over"},a[0]=i,a[1]=f,a[2]=m,a[3]=g,a[4]=p,a[5]=c,a[6]=s,a[7]=o,a[8]=d,a[9]=t):t=a[9],a[10]!==u||a[11]!==i||a[12]!==h||a[13]!==f||a[14]!==x||a[15]!==m||a[16]!==g||a[17]!==y||a[18]!==p||a[19]!==c||a[20]!==s||a[21]!==o||a[22]!==d?(r=[i,o,s,c,d,h,u,f,m,g,p,x,y],a[10]=u,a[11]=i,a[12]=h,a[13]=f,a[14]=x,a[15]=m,a[16]=g,a[17]=y,a[18]=p,a[19]=c,a[20]=s,a[21]=o,a[22]=d,a[23]=r):r=a[23],(0,l.useEffect)(t,r)}(e4),tR[287]!==iT||tR[288]!==t2||tR[289]!==t5||tR[290]!==re||tR[291]!==rm.x||tR[292]!==rm.y||tR[293]!==tq||tR[294]!==t3||tR[295]!==tA||tR[296]!==ij||tR[297]!==iP||tR[298]!==rY?(e9=e=>{if(!re){if(1===e.button||0===e.button&&e.altKey){rb(!0),rT({x:e.clientX-rm.x,y:e.clientY-rm.y}),rC.current=null,e.preventDefault();return}if(0===e.button){let t=rc.current?.getBoundingClientRect();if(t){let{gridX:r,gridY:a}=iY((e.clientX-t.left)/rY,(e.clientY-t.top)/rY,rm.x/rY,rm.y/rY);if(!(r>=0&&r<t5&&a>=0&&a<t5)){rb(!0),rT({x:e.clientX-rm.x,y:e.clientY-rm.y}),rC.current=null;return}if("select"===t3){let t=t2[a]?.[r];if(t?.building.type==="empty"||t?.building.type==="grass"||t?.building.type==="water"){rC.current={startX:e.clientX,startY:e.clientY,gridX:r,gridY:a};return}rC.current=null;let i=iT(r,a);i?tA({x:i.originX,y:i.originY}):tA({x:r,y:a})}else ij?(rC.current=null,iy({x:r,y:a}),iw({x:r,y:a}),rx(!0)):iP&&(rC.current=null,iy({x:r,y:a}),iw({x:r,y:a}),rx(!0),aq(null),aQ.current.clear(),tq(r,a),("road"===t3||"rail"===t3||"subway"===t3)&&aQ.current.add(`${r},${a}`))}}}},tR[287]=iT,tR[288]=t2,tR[289]=t5,tR[290]=re,tR[291]=rm.x,tR[292]=rm.y,tR[293]=tq,tR[294]=t3,tR[295]=tA,tR[296]=ij,tR[297]=iP,tR[298]=rY,tR[299]=e9):e9=tR[299];let l5=e9;tR[300]!==t5?(e6=(e,t,r)=>{let a=-(64*(t5-1))/2;return{minOffsetX:100-(t5-1)*64/2*e,maxOffsetX:t-100-a*e,minOffsetY:100-(t5-1)*38.4*e,maxOffsetY:r-100-0*e}},tR[300]=t5,tR[301]=e6):e6=tR[301];let l3=e6;tR[302]!==a5.height||tR[303]!==a5.width||tR[304]!==l3?(e8=(e,t)=>{let r=l3(t,a5.width,a5.height);return{x:Math.max(r.minOffsetX,Math.min(r.maxOffsetX,e.x)),y:Math.max(r.minOffsetY,Math.min(r.maxOffsetY,e.y))}},tR[302]=a5.height,tR[303]=a5.width,tR[304]=l3,tR[305]=e8):e8=tR[305];let l4=e8;tR[306]!==iT||tR[307]!==t2||tR[308]!==t5||tR[309]!==rm.x||tR[310]!==rm.y||tR[311]!==rY?(e7=(e,t)=>{let r=Number.isFinite(e)?e:0,a=Number.isFinite(t)?t:0,{gridX:i,gridY:n}=iY(r/rY,a/rY,rm.x/rY,rm.y/rY),l=i>=0&&i<t5&&n>=0&&n<t5,o=l?t2[n]?.[i]:void 0,s=l?iT(i,n):null;return{screenX:r,screenY:a,gridX:i,gridY:n,inBounds:l,buildingType:o?.building.type,originX:s?.originX,originY:s?.originY}},tR[306]=iT,tR[307]=t2,tR[308]=t5,tR[309]=rm.x,tR[310]=rm.y,tR[311]=rY,tR[312]=e7):e7=tR[312];let l9=e7;tR[313]!==iT||tR[314]!==l9||tR[315]!==tq||tR[316]!==t3||tR[317]!==tA?(te=(e,t)=>{let r=l9(e,t);if(!r.inBounds)return null;if("select"===t3){let e=iT(r.gridX,r.gridY);e?tA({x:e.originX,y:e.originY}):tA({x:r.gridX,y:r.gridY})}else tq(r.gridX,r.gridY);return r},tR[313]=iT,tR[314]=l9,tR[315]=tq,tR[316]=t3,tR[317]=tA,tR[318]=te):te=tR[318];let l6=te;tR[319]!==a5.height||tR[320]!==a5.width||tR[321]!==l4||tR[322]!==rm.x||tR[323]!==rm.y||tR[324]!==rY?(tt=e=>{let t=function(e){if(!e||"object"!=typeof e)return null;let t={offsetX:lL(e.offsetX),offsetY:lL(e.offsetY),zoom:lL(e.zoom),x:lL(e.x),y:lL(e.y),scale:lL(e.scale),rotation:lL(e.rotation)};return void 0===t.offsetX&&void 0===t.offsetY&&void 0===t.zoom&&void 0===t.x&&void 0===t.y&&void 0===t.scale&&void 0===t.rotation?null:t}(e&&"object"==typeof e?e:null);if(!t)return;let r=Math.max(.3,Math.min(5,t.zoom??t.scale??rY)),a={x:rm.x,y:rm.y};"number"==typeof t.offsetX||"number"==typeof t.offsetY?a={x:t.offsetX??rm.x,y:t.offsetY??rm.y}:"number"==typeof t.x&&"number"==typeof t.y&&(a={x:a5.width/2-t.x*r,y:a5.height/2-t.y*r});let i=l4(a,r);r!==rY&&rX(r),(i.x!==rm.x||i.y!==rm.y)&&rg(i)},tR[319]=a5.height,tR[320]=a5.width,tR[321]=l4,tR[322]=rm.x,tR[323]=rm.y,tR[324]=rY,tR[325]=tt):tt=tR[325];let l8=tt,l7=(0,l.useRef)(l9),oe=(0,l.useRef)(l8),ot=(0,l.useRef)(l6);tR[326]!==l9?(tr=()=>{l7.current=l9},ta=[l9],tR[326]=l9,tR[327]=tr,tR[328]=ta):(tr=tR[327],ta=tR[328]),(0,l.useEffect)(tr,ta),tR[329]!==l8?(ti=()=>{oe.current=l8},tn=[l8],tR[329]=l8,tR[330]=ti,tR[331]=tn):(ti=tR[330],tn=tR[331]),(0,l.useEffect)(ti,tn),tR[332]!==l6?(tl=()=>{ot.current=l6},to=[l6],tR[332]=l6,tR[333]=tl,tR[334]=to):(tl=tR[333],to=tR[334]),(0,l.useEffect)(tl,to),tR[335]===Symbol.for("react.memo_cache_sentinel")?(ts=()=>{let e=window.__native??{};return window.__native={...e,setCamera:e=>{oe.current(e)},getCamera:()=>r$.current,hitTest:(e,t)=>l7.current(e,t),tap:(e,t)=>ot.current(e,t)},lQ},tc=[],tR[335]=ts,tR[336]=tc):(ts=tR[335],tc=tR[336]),(0,l.useEffect)(ts,tc),tR[337]!==a5.height||tR[338]!==a5.width||tR[339]!==l3||tR[340]!==tE||tR[341]!==t$||tR[342]!==rY?(td=()=>{if(!tE)return;let{screenX:e,screenY:t}=iR(tE.x,tE.y,0,0),r={x:a5.width/2-e*rY,y:a5.height/2-t*rY},a=l3(rY,a5.width,a5.height);rg({x:Math.max(a.minOffsetX,Math.min(a.maxOffsetX,r.x)),y:Math.max(a.minOffsetY,Math.min(a.maxOffsetY,r.y))}),t$?.()},tu=[tE,rY,a5.width,a5.height,l3,t$],tR[337]=a5.height,tR[338]=a5.width,tR[339]=l3,tR[340]=tE,tR[341]=t$,tR[342]=rY,tR[343]=td,tR[344]=tu):(td=tR[343],tu=tR[344]),(0,l.useEffect)(td,tu),tR[345]!==l4||tR[346]!==rP||tR[347]!==ix||tR[348]!==t2||tR[349]!==t5||tR[350]!==rp||tR[351]!==ry||tR[352]!==re||tR[353]!==rm.x||tR[354]!==rm.y||tR[355]!==tq||tR[356]!==aG||tR[357]!==t3||tR[358]!==ij||tR[359]!==iP||tR[360]!==rY?(tf=e=>{if(re)return;if(!ry&&rC.current){let{startX:t,startY:r}=rC.current,a=e.clientX-t,i=e.clientY-r;if(Math.abs(a)>=6||Math.abs(i)>=6){rb(!0),rT({x:t-rm.x,y:r-rm.y}),rC.current=null,rg(l4({x:e.clientX-(t-rm.x),y:e.clientY-(r-rm.y)},rY));return}}if(ry)return void rg(l4({x:e.clientX-rP.x,y:e.clientY-rP.y},rY));let t=rc.current?.getBoundingClientRect();if(t){let{gridX:r,gridY:a}=iY((e.clientX-t.left)/rY,(e.clientY-t.top)/rY,rm.x/rY,rm.y/rY);if(r>=0&&r<t5&&a>=0&&a<t5){rz(e=>e?.x===r&&e?.y===a?e:{x:r,y:a});let t=t2[a]?.[r],i=`${r},${a}`,n=r3.current.get(i);if(t?.building.onFire?rR({x:r,y:a,type:"fire",screenX:e.clientX,screenY:e.clientY}):n?rR({x:r,y:a,type:"crime",crimeType:n.type,screenX:e.clientX,screenY:e.clientY}):rR(null),rp&&ij&&ix)iw({x:r,y:a});else if(rp&&("road"===t3||"rail"===t3||"subway"===t3)&&ix){let e=Math.abs(r-ix.x),t=Math.abs(a-ix.y),i=aG;!i&&(e>0||t>0)&&aq(i=e>=t?"h":"v");let n=r,l=a;"h"===i?l=ix.y:"v"===i&&(n=ix.x),iw({x:n,y:l});let o=Math.min(ix.x,n),s=Math.max(ix.x,n),c=Math.min(ix.y,l),d=Math.max(ix.y,l);for(let e=o;e<=s;e++)for(let t=c;t<=d;t++){let r=`${e},${t}`;if(!aQ.current.has(r)){let a=t2[t]?.[e];if(a&&"water"===a.building.type){aQ.current.add(r);continue}tq(e,t),aQ.current.add(r)}}}else rp&&iP&&ix&&tq(r,a)}}},tR[345]=l4,tR[346]=rP,tR[347]=ix,tR[348]=t2,tR[349]=t5,tR[350]=rp,tR[351]=ry,tR[352]=re,tR[353]=rm.x,tR[354]=rm.y,tR[355]=tq,tR[356]=aG,tR[357]=t3,tR[358]=ij,tR[359]=iP,tR[360]=rY,tR[361]=tf):tf=tR[361];let or=tf;tR[362]!==tK||tR[363]!==ib||tR[364]!==ix||tR[365]!==iT||tR[366]!==tQ||tR[367]!==rp||tR[368]!==ry||tR[369]!==re||tR[370]!==tq||tR[371]!==t3||tR[372]!==tA||tR[373]!==ij?(tm=()=>{if(!re){if(rC.current&&!ry&&"select"===t3){let{gridX:e,gridY:t}=rC.current;rC.current=null;let r=iT(e,t);r?tA({x:r.originX,y:r.originY}):tA({x:e,y:t})}else rC.current=null;if(rp&&ix&&ib&&ij){let e=Math.min(ix.x,ib.x),t=Math.max(ix.x,ib.x),r=Math.min(ix.y,ib.y),a=Math.max(ix.y,ib.y);for(let i=e;i<=t;i++)for(let e=r;e<=a;e++)tq(i,e)}if(rp&&("road"===t3||"rail"===t3)&&ix&&ib){let e=Math.min(ix.x,ib.x),t=Math.max(ix.x,ib.x),r=Math.min(ix.y,ib.y),a=Math.max(ix.y,ib.y),i=[];for(let n=e;n<=t;n++)for(let e=r;e<=a;e++)i.push({x:n,y:e});tQ(i,t3),setTimeout(()=>{tK(e=>{iS({direction:e.direction})})},50)}rx(!1),iy(null),iw(null),rb(!1),aq(null),aQ.current.clear(),rc.current||rz(null)}},tR[362]=tK,tR[363]=ib,tR[364]=ix,tR[365]=iT,tR[366]=tQ,tR[367]=rp,tR[368]=ry,tR[369]=re,tR[370]=tq,tR[371]=t3,tR[372]=tA,tR[373]=ij,tR[374]=tm):tm=tR[374];let oa=tm;tR[375]!==l4||tR[376]!==re||tR[377]!==rm.x||tR[378]!==rm.y||tR[379]!==rY?(tg=e=>{if(re)return;e.preventDefault();let t=rc.current?.getBoundingClientRect();if(!t)return;let r=e.clientX-t.left,a=e.clientY-t.top,i=.05*Math.max(.5,rY),n=Math.max(.3,Math.min(5,rY+(e.deltaY>0?-i:i)));if(n===rY)return;rS.current||(rS.current=!0,rv(!0)),rk.current&&clearTimeout(rk.current),rk.current=setTimeout(()=>{rS.current=!1,rv(!1)},150);let l=(r-rm.x)/rY,o=(a-rm.y)/rY;rg(l4({x:r-l*n,y:a-o*n},n)),rX(n)},tR[375]=l4,tR[376]=re,tR[377]=rm.x,tR[378]=rm.y,tR[379]=rY,tR[380]=tg):tg=tR[380];let oi=tg,on=lq,ol=lG;tR[381]!==re||tR[382]!==rm.x||tR[383]!==rm.y||tR[384]!==rY?(tp=e=>{if(!re)if(1===e.touches.length){let t=e.touches[0];r7.current={x:t.clientX,y:t.clientY,time:Date.now()},rT({x:t.clientX-rm.x,y:t.clientY-rm.y}),rb(!0),rM.current=!1}else 2===e.touches.length&&(ae.current=on(e.touches[0],e.touches[1]),at.current=rY,ar.current=ol(e.touches[0],e.touches[1]),rb(!1),rM.current=!0)},tR[381]=re,tR[382]=rm.x,tR[383]=rm.y,tR[384]=rY,tR[385]=tp):tp=tR[385];let oo=tp;tR[386]!==l4||tR[387]!==rP||tR[388]!==ry||tR[389]!==re||tR[390]!==rm.x||tR[391]!==rm.y||tR[392]!==rY?(tx=e=>{if(!re){if(e.preventDefault(),1===e.touches.length&&ry&&!ae.current){let t=e.touches[0];rg(l4({x:t.clientX-rP.x,y:t.clientY-rP.y},rY))}else if(2===e.touches.length&&null!==ae.current){let t=on(e.touches[0],e.touches[1])/ae.current,r=Math.max(.3,Math.min(5,at.current*t)),a=ol(e.touches[0],e.touches[1]),i=rc.current?.getBoundingClientRect();if(i&&ar.current){let e=a.x-i.left,t=a.y-i.top,n=(e-rm.x)/rY,l=(t-rm.y)/rY,o=e-n*r,s=t-l*r;rg(l4({x:o+(a.x-ar.current.x),y:s+(a.y-ar.current.y)},r)),rX(r),ar.current=a}}}},tR[386]=l4,tR[387]=rP,tR[388]=ry,tR[389]=re,tR[390]=rm.x,tR[391]=rm.y,tR[392]=rY,tR[393]=tx):tx=tR[393];let os=tx;tR[394]!==iT||tR[395]!==t5||tR[396]!==re||tR[397]!==rm.x||tR[398]!==rm.y||tR[399]!==tq||tR[400]!==t3||tR[401]!==tA||tR[402]!==rY?(ty=e=>{if(re)return;let t=r7.current;if(0===e.touches.length){if(t&&1===e.changedTouches.length){let r=e.changedTouches[0],a=Math.abs(r.clientX-t.x),i=Math.abs(r.clientY-t.y);if(Date.now()-t.time<300&&a<10&&i<10){let e=rc.current?.getBoundingClientRect();if(e){let{gridX:t,gridY:a}=iY((r.clientX-e.left)/rY,(r.clientY-e.top)/rY,rm.x/rY,rm.y/rY);if(t>=0&&t<t5&&a>=0&&a<t5)if("select"===t3){let e=iT(t,a);e?tA({x:e.originX,y:e.originY}):tA({x:t,y:a})}else tq(t,a)}}}rb(!1),rx(!1),rM.current=!1,r7.current=null,ae.current=null,ar.current=null}else if(1===e.touches.length){let t=e.touches[0];rT({x:t.clientX-rm.x,y:t.clientY-rm.y}),rb(!0),rM.current=!1,ae.current=null,ar.current=null}},tR[394]=iT,tR[395]=t5,tR[396]=re,tR[397]=rm.x,tR[398]=rm.y,tR[399]=tq,tR[400]=t3,tR[401]=tA,tR[402]=rY,tR[403]=ty):ty=tR[403];let oc=ty,od=re?"default":ry?"grabbing":rp?"crosshair":"default";if(tR[404]!==od?(tw={cursor:od},tR[404]=od,tR[405]=tw):tw=tR[405],tR[406]!==a5.height||tR[407]!==a5.width?(tv=(0,i.jsx)("canvas",{ref:ra,width:a5.width,height:a5.height,className:"absolute top-0 left-0"}),t_=(0,i.jsx)("canvas",{ref:ri,width:a5.width,height:a5.height,className:"absolute top-0 left-0 pointer-events-none"}),tM=(0,i.jsx)("canvas",{ref:rn,width:a5.width,height:a5.height,className:"absolute top-0 left-0 pointer-events-none"}),tS=(0,i.jsx)("canvas",{ref:rl,width:a5.width,height:a5.height,className:"absolute top-0 left-0 pointer-events-none"}),tk=(0,i.jsx)("canvas",{ref:ro,width:a5.width,height:a5.height,className:"absolute top-0 left-0 pointer-events-none"}),tR[406]=a5.height,tR[407]=a5.width,tR[408]=tv,tR[409]=t_,tR[410]=tM,tR[411]=tS,tR[412]=tk):(tv=tR[408],t_=tR[409],tM=tR[410],tS=tR[411],tk=tR[412]),tR[413]===Symbol.for("react.memo_cache_sentinel")?(tj={mixBlendMode:"multiply"},tR[413]=tj):tj=tR[413],tR[414]!==a5.height||tR[415]!==a5.width?(tP=(0,i.jsx)("canvas",{ref:rs,width:a5.width,height:a5.height,className:"absolute top-0 left-0 pointer-events-none",style:tj}),tR[414]=a5.height,tR[415]=a5.width,tR[416]=tP):tP=tR[416],tR[417]!==t2||tR[418]!==tF||tR[419]!==tX||tR[420]!==t3||tR[421]!==tA||tR[422]!==tH.services?(tT=tX&&"select"===t3&&!tF&&(0,i.jsx)(az,{tile:t2[tX.y][tX.x],services:tH.services,onClose:()=>tA(null)}),tR[417]=t2,tR[418]=tF,tR[419]=tX,tR[420]=t3,tR[421]=tA,tR[422]=tH.services,tR[423]=tT):tT=tR[423],tR[424]!==t9||tR[425]!==iv||tR[426]!==tZ){let e;tC=iv&&((e=t9.find(e=>e.direction===iv.direction&&e.discovered&&!e.connected))?(0,i.jsx)(tB,{open:!0,onOpenChange:()=>{iS(null),iy(null),iw(null)},children:(0,i.jsxs)(tW,{className:"max-w-[400px]",onPointerDown:lH,onMouseDown:lU,children:[(0,i.jsxs)(tD,{children:[(0,i.jsx)(k.T,{children:(0,i.jsx)(tJ,{children:"City Discovered!"})}),(0,i.jsx)(k.T,{children:(0,i.jsxs)(tU,{children:["Your road has reached the ",(0,i.jsx)(k.Var,{children:iv.direction})," border! You've discovered ",(0,i.jsx)(k.Var,{children:e.name}),"."]})})]}),(0,i.jsxs)("div",{className:"flex flex-col gap-4 mt-4",children:[(0,i.jsx)(k.T,{children:(0,i.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Connecting to ",(0,i.jsx)(k.Var,{children:e.name})," will establish a trade route, providing:",(0,i.jsxs)("ul",{className:"mt-2 space-y-1 list-disc list-inside",children:[(0,i.jsx)("li",{children:"$5,000 one-time bonus"}),(0,i.jsx)("li",{children:"$200/month additional income"})]})]})}),(0,i.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,i.jsx)(k.T,{children:(0,i.jsx)(f,{variant:"outline",onClick:e=>{e.stopPropagation(),iS(null),iy(null),iw(null)},children:"Maybe Later"})}),(0,i.jsx)(k.T,{children:(0,i.jsxs)(f,{onClick:t=>{t.stopPropagation(),tZ(e.id),iS(null),iy(null),iw(null)},children:["Connect to ",(0,i.jsx)(k.Var,{children:e.name})]})})]})]})]})}):null),tR[424]=t9,tR[425]=iv,tR[426]=tZ,tR[427]=tC}else tC=tR[427];if(tR[428]!==ib||tR[429]!==ix||tR[430]!==t2||tR[431]!==t5||tR[432]!==rr||tR[433]!==rN||tR[434]!==rp||tR[435]!==rt||tR[436]!==t3||tR[437]!==ij||tR[438]!==iP?(tN=rN&&"select"!==t3&&j[t3]&&(()=>{let e,t,r,a=$(t3),n=!1;if(a&&rN){let e=ea(t3);n=!B(t2,rN.x,rN.y,e.width,e.height,t5).hasWater}let l=rt(j[t3].name);return(0,i.jsx)("div",{className:`absolute bottom-4 left-1/2 -translate-x-1/2 px-4 py-2 rounded-md text-sm ${n?"border bg-destructive/90 border-destructive-foreground/30 text-destructive-foreground":"border bg-card/90 border-border"}`,children:rp&&ix&&ib&&ij?(0,i.jsx)(i.Fragment,{children:(e=Math.abs(ib.x-ix.x)+1,t=Math.abs(ib.y-ix.y)+1,r=j[t3].cost*e*t,(0,i.jsxs)(i.Fragment,{children:[rr("{toolName} - {width}x{height} area",{toolName:l,width:e,height:t}),j[t3].cost>0&&` - $${r}`]}))}):n?(0,i.jsx)(i.Fragment,{children:rr("{toolName} must be placed next to water",{toolName:l})}):(0,i.jsxs)(i.Fragment,{children:[rr("{toolName} at ({x}, {y})",{toolName:l,x:rN.x,y:rN.y}),j[t3].cost>0&&` - $${j[t3].cost}`,ij&&rr(" - Drag to zone area"),iP&&!ij&&rr(" - Drag to place")]})})})(),tR[428]=ib,tR[429]=ix,tR[430]=t2,tR[431]=t5,tR[432]=rr,tR[433]=rN,tR[434]=rp,tR[435]=rt,tR[436]=t3,tR[437]=ij,tR[438]=iP,tR[439]=tN):tN=tR[439],tR[440]!==rr||tR[441]!==rI){var oh,ou;let e,t,r,a;tz=rI&&(e=window.innerWidth,t=rI.screenX+16+200>e-16?rI.screenX-200-16:rI.screenX+16,(0,i.jsx)("div",{className:"fixed pointer-events-none z-[100]",style:{left:t,top:rI.screenY-8},children:(0,i.jsxs)("div",{className:"bg-sidebar border border-sidebar-border rounded-md shadow-lg px-3 py-2 w-[220px]",children:[(0,i.jsxs)("div",{className:"flex gap-2 items-center mb-1",children:["fire"===rI.type?(0,i.jsx)(th,{size:14,className:"text-red-400"}):(0,i.jsx)(tb,{size:14,className:"text-blue-400"}),(0,i.jsx)("span",{className:"text-xs font-semibold text-sidebar-foreground",children:"fire"===rI.type?(r=Math.abs((31*rI.x+17*rI.y)%lx.length),lp[lx[r]].name):rI.crimeType?(oh=rI.crimeType,lm[oh]?.name||"Unknown Incident"):rr("Incident")})]}),(0,i.jsx)("p",{className:"text-[11px] text-muted-foreground leading-tight",children:"fire"===rI.type?(a=Math.abs((31*rI.x+17*rI.y)%lx.length),lp[lx[a]].description):rI.crimeType?(ou=rI.crimeType,lm[ou]?.description||"Incident reported."):rr("Incident reported.")}),(0,i.jsxs)("div",{className:"mt-1.5 pt-1.5 border-t border-sidebar-border/50 text-[10px] text-muted-foreground/60 font-mono",children:["(",rI.x,", ",rI.y,")"]})]})})),tR[440]=rr,tR[441]=rI,tR[442]=tz}else tz=tR[442];return tR[443]!==l5||tR[444]!==or||tR[445]!==oa||tR[446]!==oc||tR[447]!==os||tR[448]!==oo||tR[449]!==oi||tR[450]!==tw||tR[451]!==tv||tR[452]!==t_||tR[453]!==tM||tR[454]!==tS||tR[455]!==tk||tR[456]!==tP||tR[457]!==tT||tR[458]!==tC||tR[459]!==tN||tR[460]!==tz?(tI=(0,i.jsxs)("div",{ref:rc,className:"overflow-hidden relative w-full h-full touch-none",style:tw,onMouseDown:l5,onMouseMove:or,onMouseUp:oa,onMouseLeave:oa,onWheel:oi,onTouchStart:oo,onTouchMove:os,onTouchEnd:oc,onTouchCancel:oc,children:[tv,t_,tM,tS,tk,tP,tT,tC,tN,tz]}),tR[443]=l5,tR[444]=or,tR[445]=oa,tR[446]=oc,tR[447]=os,tR[448]=oo,tR[449]=oi,tR[450]=tw,tR[451]=tv,tR[452]=t_,tR[453]=tM,tR[454]=tS,tR[455]=tk,tR[456]=tP,tR[457]=tT,tR[458]=tC,tR[459]=tN,tR[460]=tz,tR[461]=tI):tI=tR[461],tI}function lU(e){return e.stopPropagation()}function lH(e){return e.stopPropagation()}function lG(e,t){return{x:(e.clientX+t.clientX)/2,y:(e.clientY+t.clientY)/2}}function lq(e,t){let r=e.clientX-t.clientX,a=e.clientY-t.clientY;return Math.sqrt(r*r+a*a)}function lQ(){window.__native&&(delete window.__native.setCamera,delete window.__native.getCamera,delete window.__native.hitTest,delete window.__native.tap)}function lZ(e){return e+1}let lK=[(0,k.msg)("containers"),(0,k.msg)("bulk materials"),(0,k.msg)("oil")],l0=["none","power","water","fire","police","health","education","subway"];function l1(e){let t,r,a,o,s,c,d,h,u,f,m,g,p,x,y,b,w,v,_,M,S,P,T,C,N,z,I,R,Y,X,A,O,E,$,B,L,V,W,D,F,J,U,H,G,q,Q,Z,K,ee,et,er,ea,ei,en,el,eo,es,ec,ed,eh,eu,ef,em,eg,ep,ex,ey,eb,ew,ev,e_,eM,eS,ek,ej,eP,eT,eC,eN,ez,eI,eR,eY,eX,eA,eO,eE,e$,eB,eV=(0,n.c)(193),{onExit:eW}=e,eD=(0,k.useGT)(),eF=(0,k.useMessages)(),{state:eJ,setTool:eU,setActivePanel:eH,addMoney:eG,addNotification:eq,setSpeed:eQ}=eL(),[eZ,eK]=(0,l.useState)("none"),[e0,e1]=(0,l.useState)(null),[e2,e5]=(0,l.useState)(null),[e3,e4]=(0,l.useState)(null),e9=(0,l.useRef)(!0),{isMobileDevice:e6,isSmallScreen:e8}=tt(),e7=lV(),tr="ios"===e7.host,{settings:ta}=ab(),[ti,tn]=(0,l.useState)(!1),tl=te(),{triggeredCheat:to,showVinnieDialog:ts,setShowVinnieDialog:tc,clearTriggeredCheat:td}=function(){let e,t,r,a,i,o=(0,n.c)(7),[s,c]=(0,l.useState)(null),[d,h]=(0,l.useState)(!1);o[0]===Symbol.for("react.memo_cache_sentinel")?(e=[],o[0]=e):e=o[0];let u=(0,l.useRef)(e),f=(0,l.useRef)(""),m=(0,l.useRef)(null);o[1]===Symbol.for("react.memo_cache_sentinel")?(t=()=>{let e=e=>{if(rs(e.target))return;let t=e.key;if(m.current&&(clearTimeout(m.current),m.current=null),u.current.push(t.toLowerCase()),u.current.length>rl.length&&u.current.shift(),u.current.length>=rl.length&&u.current.slice(-rl.length).every(ro)&&(c({type:"konami",amount:5e4}),u.current=[],m.current&&(clearTimeout(m.current),m.current=null)),m.current=setTimeout(()=>{u.current=[],m.current=null},2e3),1===t.length&&/[a-z\s]/i.test(t)){f.current=f.current+t.toLowerCase(),f.current.length>50&&(f.current=f.current.slice(-50));let e=f.current,r=e.replace(/\s+/g,"");e.includes("vinnie")?(console.log("\uD83C\uDFAE Cheat activated: vinnie"),h(!0),c({type:"vinnie"}),f.current=""):r.includes("motherlode")?(console.log("\uD83C\uDFAE Cheat activated: motherlode"),c({type:"motherlode",amount:5e4}),f.current=""):r.includes("fund")&&(console.log("\uD83C\uDFAE Cheat activated: fund"),c({type:"fund",amount:1e4}),f.current="")}};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e),m.current&&clearTimeout(m.current)}},r=[rs],o[1]=t,o[2]=r):(t=o[1],r=o[2]),(0,l.useEffect)(t,r),o[3]===Symbol.for("react.memo_cache_sentinel")?(a=()=>{c(null)},o[3]=a):a=o[3];let g=a;return o[4]!==d||o[5]!==s?(i={triggeredCheat:s,showVinnieDialog:d,setShowVinnieDialog:h,clearTriggeredCheat:g},o[4]=d,o[5]=s,o[6]=i):i=o[6],i}(),{currentTip:th,isVisible:tu,onContinue:tf,onSkipAll:tm}=function(e){let[t,r]=(0,l.useState)(!0),[a,i]=(0,l.useState)(null),[n,o]=(0,l.useState)(!1),[s,c]=(0,l.useState)(new Set),d=(0,l.useRef)(0),h=(0,l.useRef)(null),u=(0,l.useRef)(!1),f=(0,l.useRef)(e);f.current=e,(0,l.useEffect)(()=>{try{let e=localStorage.getItem(rC);"true"===e&&r(!1);let t=localStorage.getItem(rN);if(t){let e=JSON.parse(t);Array.isArray(e)&&c(new Set(e))}}catch(e){console.error("Failed to load tip preferences:",e)}u.current=!0},[]),(0,l.useEffect)(()=>{if(u.current)try{localStorage.setItem(rN,JSON.stringify(Array.from(s)))}catch(e){console.error("Failed to save shown tips:",e)}},[s]);let m=(0,l.useCallback)(e=>{r(e);try{localStorage.setItem(rC,e?"false":"true")}catch(e){console.error("Failed to save tip preference:",e)}e||(o(!1),i(null))},[]),g=(0,l.useRef)(new Set);(0,l.useEffect)(()=>{g.current=s},[s]);let p=(0,l.useCallback)(()=>{if(!u.current||!t||n)return;let e=Date.now();if(d.current>0&&e-d.current<15e3)return;let r=f.current,a=g.current,l=rT.filter(e=>!a.has(e.id)&&e.check(r)).sort((e,t)=>e.priority-t.priority);if(l.length>0){let t=l[0];i(t.message),o(!0),d.current=e,c(e=>new Set([...e,t.id]))}},[t,n]);return(0,l.useEffect)(()=>{if(h.current&&clearInterval(h.current),!t)return;let e=setTimeout(()=>{p()},3e3);return h.current=setInterval(p,5e3),()=>{clearTimeout(e),h.current&&clearInterval(h.current)}},[t,p]),{currentTip:a,isVisible:n,onContinue:(0,l.useCallback)(()=>{o(!1),setTimeout(()=>{i(null)},300)},[]),onSkipAll:(0,l.useCallback)(()=>{m(!1),o(!1),i(null)},[m]),tipsEnabled:t,setTipsEnabled:m}}(eJ),{isMultiplayer:tg,roomCode:tp,players:tx}=(em=(0,n.c)(65),eg=te(),ep=eL(),ex=(0,l.useRef)(null),ey=(0,l.useRef)(!1),em[0]===Symbol.for("react.memo_cache_sentinel")?(D=[],em[0]=D):D=em[0],eb=(0,l.useRef)(D),ew=(0,l.useRef)(null),ev=(0,l.useRef)(eg),em[1]!==eg?(F=()=>{ev.current=eg},J=[eg],em[1]=eg,em[2]=F,em[3]=J):(F=em[2],J=em[3]),(0,l.useEffect)(F,J),e_=(0,l.useRef)(null),em[4]!==ep||em[5]!==eg?(U=()=>{if(!eg||!eg.initialState)return;let e=JSON.stringify(eg.initialState.tick||0);if(e_.current===e&&ey.current)return;console.log("[useMultiplayerSync] Received initial state from network, loading...");let t=JSON.stringify(eg.initialState);ep.loadState(t)&&(ey.current=!0,e_.current=e)},em[4]=ep,em[5]=eg,em[6]=U):U=em[6],eM=eg?.initialState,em[7]!==ep||em[8]!==eM?(H=[eM,ep],em[7]=ep,em[8]=eM,em[9]=H):H=em[9],(0,l.useEffect)(U,H),em[10]!==ep?(G=e=>{if(!e||!e.type)return void console.warn("[useMultiplayerSync] Received invalid action:",e);switch(e.type){case"place":{let t=ep.state.selectedTool;ep.setTool(e.tool),ep.placeAtTile(e.x,e.y,!0),ep.setTool(t);break}case"placeBatch":{let t=ep.state.selectedTool;for(let t of e.placements)ep.setTool(t.tool),ep.placeAtTile(t.x,t.y,!0);ep.setTool(t);break}case"bulldoze":{let t=ep.state.selectedTool;ep.setTool("bulldoze"),ep.placeAtTile(e.x,e.y,!0),ep.setTool(t);break}case"setTaxRate":ep.setTaxRate(e.rate);break;case"setBudget":ep.setBudgetFunding(e.key,e.funding);break;case"setSpeed":ep.setSpeed(e.speed);break;case"setDisasters":ep.setDisastersEnabled(e.enabled);break;case"createBridges":ep.finishTrackDrag(e.pathTiles,e.trackType,!0)}},em[10]=ep,em[11]=G):G=em[11],eS=G,em[12]!==eS||em[13]!==eg?(q=()=>{if(eg)return eg.setOnRemoteAction(e=>{eS(e)}),()=>{eg.setOnRemoteAction(null)}},Q=[eg,eS],em[12]=eS,em[13]=eg,em[14]=q,em[15]=Q):(q=em[14],Q=em[15]),(0,l.useEffect)(q,Q),em[16]===Symbol.for("react.memo_cache_sentinel")?(Z=()=>{let e=ev.current;if(!e||0===eb.current.length)return;ew.current&&(clearTimeout(ew.current),ew.current=null);let t=[...eb.current];if(eb.current=[],1===t.length){let r=t[0];e.dispatchAction({type:"place",x:r.x,y:r.y,tool:r.tool})}else e.dispatchAction({type:"placeBatch",placements:t})},em[16]=Z):Z=em[16],ek=Z,em[17]!==ep||em[18]!==eg?(K=()=>{if(!eg||"connected"!==eg.connectionState){ep.setPlaceCallback(null),eb.current.length>0&&(eb.current=[]),ew.current&&(clearTimeout(ew.current),ew.current=null);return}return ep.setPlaceCallback(e=>{let{x:t,y:r,tool:a}=e;"bulldoze"===a?(ek(),eg.dispatchAction({type:"bulldoze",x:t,y:r})):"select"!==a&&(eb.current.push({x:t,y:r,tool:a}),eb.current.length>=100?ek():ew.current||(ew.current=setTimeout(()=>{ew.current=null,ek()},100)))}),()=>{ek(),ep.setPlaceCallback(null)}},em[17]=ep,em[18]=eg,em[19]=K):K=em[19],ej=eg?.connectionState,em[20]!==ep||em[21]!==eg||em[22]!==ej?(ee=[eg,ej,ep,ek],em[20]=ep,em[21]=eg,em[22]=ej,em[23]=ee):ee=em[23],(0,l.useEffect)(K,ee),em[24]!==ep||em[25]!==eg?(et=()=>eg&&"connected"===eg.connectionState?(ep.setBridgeCallback(e=>{let{pathTiles:t,trackType:r}=e;eg.dispatchAction({type:"createBridges",pathTiles:t,trackType:r})}),()=>{ep.setBridgeCallback(null)}):void ep.setBridgeCallback(null),em[24]=ep,em[25]=eg,em[26]=et):et=em[26],eP=eg?.connectionState,em[27]!==ep||em[28]!==eg||em[29]!==eP?(er=[eg,eP,ep],em[27]=ep,em[28]=eg,em[29]=eP,em[30]=er):er=em[30],(0,l.useEffect)(et,er),eT=(0,l.useRef)(0),eC=(0,l.useRef)(0),em[31]!==ep.state||em[32]!==eg?(ea=()=>{if(!eg||"connected"!==eg.connectionState)return;let e=Date.now();!(e-eT.current<2e3)&&(eT.current=e,eg.updateGameState(ep.state),eg.roomCode&&e-eC.current>1e4&&(eC.current=e,function(e,t){try{let r=localStorage.getItem(rz),a=r?JSON.parse(r):[],i={id:e.id||`city-${Date.now()}`,cityName:e.cityName||"Co-op City",population:e.stats.population,money:e.stats.money,year:e.year,month:e.month,gridSize:e.gridSize,savedAt:Date.now(),roomCode:t},n=a.findIndex(e=>e.roomCode===t);n>=0?a[n]=i:a.unshift(i),localStorage.setItem(rz,JSON.stringify(a.slice(0,20)))}catch(e){console.error("Failed to update saved cities index:",e)}}(ep.state,eg.roomCode)))},ei=[eg,ep.state],em[31]=ep.state,em[32]=eg,em[33]=ea,em[34]=ei):(ea=em[33],ei=em[34]),(0,l.useEffect)(ea,ei),em[35]!==eg?(en=e=>{if(!eg||"connected"!==eg.connectionState)return;let t=JSON.stringify(e);ex.current!==t&&(ex.current=t,setTimeout(()=>{ex.current===t&&(ex.current=null)},100),eg.dispatchAction(e))},em[35]=eg,em[36]=en):en=em[36],eN=en,em[37]!==eN?(el=e=>{let{x:t,y:r,tool:a}=e;"bulldoze"===a?eN({type:"bulldoze",x:t,y:r}):"select"!==a&&eN({type:"place",x:t,y:r,tool:a})},em[37]=eN,em[38]=el):el=em[38],ez=el,em[39]!==eN?(eo=e=>{eN({type:"setTaxRate",rate:e})},em[39]=eN,em[40]=eo):eo=em[40],eI=eo,em[41]!==eN?(es=(e,t)=>{eN({type:"setBudget",key:e,funding:t})},em[41]=eN,em[42]=es):es=em[42],eR=es,em[43]!==eN?(ec=e=>{eN({type:"setSpeed",speed:e})},em[43]=eN,em[44]=ec):ec=em[44],eY=ec,em[45]!==eN?(ed=e=>{eN({type:"setDisasters",enabled:e})},em[45]=eN,em[46]=ed):ed=em[46],eX=ed,eA=eg?.connectionState==="connected",eO=eg?.isHost??!1,eE=eg?.players.length??0,e$=eg?.roomCode??null,eB=eg?.connectionState??"disconnected",em[47]!==eg?.players?(eh=eg?.players??[],em[47]=eg?.players,em[48]=eh):eh=em[48],em[49]!==eg?.leaveRoom?(eu=eg?.leaveRoom??rI,em[49]=eg?.leaveRoom,em[50]=eu):eu=em[50],em[51]!==eN||em[52]!==eR||em[53]!==eX||em[54]!==ez||em[55]!==eY||em[56]!==eI||em[57]!==eB||em[58]!==eO||em[59]!==eA||em[60]!==eE||em[61]!==e$||em[62]!==eh||em[63]!==eu?(ef={isMultiplayer:eA,isHost:eO,playerCount:eE,roomCode:e$,connectionState:eB,players:eh,broadcastPlace:ez,broadcastTaxRate:eI,broadcastBudget:eR,broadcastSpeed:eY,broadcastDisasters:eX,broadcastAction:eN,leaveRoom:eu},em[51]=eN,em[52]=eR,em[53]=eX,em[54]=ez,em[55]=eY,em[56]=eI,em[57]=eB,em[58]=eO,em[59]=eA,em[60]=eE,em[61]=e$,em[62]=eh,em[63]=eu,em[64]=ef):ef=em[64],ef),{copied:ty,handleCopyRoomLink:tb}=function(e,t){let r,a,i,o,s,c=(0,n.c)(9),[d,h]=(0,l.useState)(!1),u=(0,l.useRef)(null);c[0]===Symbol.for("react.memo_cache_sentinel")?(r=()=>{u.current&&(clearTimeout(u.current),u.current=null),h(!1)},c[0]=r):r=c[0];let f=r;c[1]!==t||c[2]!==e?(a=()=>{if(!e)return;let r=t.startsWith("/")?t.slice(1):t,a=`${window.location.origin}/${r}/${e}`;navigator.clipboard.writeText(a),h(!0),u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{f()},2e3)},c[1]=t,c[2]=e,c[3]=a):a=c[3];let m=a;return c[4]===Symbol.for("react.memo_cache_sentinel")?(i=()=>()=>{u.current&&clearTimeout(u.current)},o=[],c[4]=i,c[5]=o):(i=c[4],o=c[5]),(0,l.useEffect)(i,o),c[6]!==d||c[7]!==m?(s={copied:d,handleCopyRoomLink:m,resetCopied:f},c[6]=d,c[7]=m,c[8]=s):s=c[8],s}(tp,"coop"),tw=(0,l.useRef)(null),tv=(0,l.useRef)(null),t_=(0,l.useRef)(!1),tM=(0,l.useRef)(eJ.selectedTool);eV[0]!==eJ.selectedTool?(t=()=>{tM.current=eJ.selectedTool},r=[eJ.selectedTool],eV[0]=eJ.selectedTool,eV[1]=t,eV[2]=r):(t=eV[1],r=eV[2]),(0,l.useEffect)(t,r),eV[3]===Symbol.for("react.memo_cache_sentinel")?(a=()=>{if(!t_.current){let e=setTimeout(()=>{tw.current=tM.current,tv.current=tM.current,t_.current=!0},100);return()=>clearTimeout(e)}},o=[],eV[3]=a,eV[4]=o):(a=eV[3],o=eV[4]),(0,l.useEffect)(a,o),eV[5]!==eJ.selectedTool?(s=()=>{if(e9.current){e9.current=!1;return}if("select"===eJ.selectedTool){setTimeout(()=>{eK("none")},0),tv.current=eJ.selectedTool;return}if("subway"===eJ.selectedTool||"subway_station"===eJ.selectedTool){setTimeout(()=>{eK("subway")},0),tv.current=eJ.selectedTool;return}t_.current&&(null===tw.current||tw.current!==eJ.selectedTool)&&tv.current!==eJ.selectedTool&&(tv.current=eJ.selectedTool,setTimeout(()=>{eK(rB[eJ.selectedTool]??"none")},0))},c=[eJ.selectedTool],eV[5]=eJ.selectedTool,eV[6]=s,eV[7]=c):(s=eV[6],c=eV[7]),(0,l.useEffect)(s,c),eV[8]===Symbol.for("react.memo_cache_sentinel")?(d=[],eV[8]=d):d=eV[8],(0,l.useEffect)(l3,d),eV[9]!==ta||eV[10]!==e7||eV[11]!==eZ||eV[12]!==e0||eV[13]!==eJ.activePanel||eV[14]!==eJ.cityName||eV[15]!==eJ.month||eV[16]!==eJ.selectedTool||eV[17]!==eJ.speed||eV[18]!==eJ.stats.demand||eV[19]!==eJ.stats.education||eV[20]!==eJ.stats.environment||eV[21]!==eJ.stats.expenses||eV[22]!==eJ.stats.happiness||eV[23]!==eJ.stats.health||eV[24]!==eJ.stats.income||eV[25]!==eJ.stats.money||eV[26]!==eJ.stats.population||eV[27]!==eJ.stats.safety||eV[28]!==eJ.year?(h=()=>{lF({type:"host.state",payload:{cityName:eJ.cityName,year:eJ.year,month:eJ.month,speed:eJ.speed,selectedTool:eJ.selectedTool,activePanel:eJ.activePanel,stats:{population:eJ.stats.population,money:eJ.stats.money,income:eJ.stats.income,expenses:eJ.stats.expenses,happiness:eJ.stats.happiness,health:eJ.stats.health,education:eJ.stats.education,safety:eJ.stats.safety,environment:eJ.stats.environment,demand:eJ.stats.demand},selectedTile:e0,overlayMode:eZ,mobileUi:ta,host:e7}})},u=[eJ.cityName,eJ.year,eJ.month,eJ.speed,eJ.selectedTool,eJ.activePanel,eJ.stats.population,eJ.stats.money,eJ.stats.income,eJ.stats.expenses,eJ.stats.happiness,eJ.stats.health,eJ.stats.education,eJ.stats.safety,eJ.stats.environment,eJ.stats.demand,e0,eZ,ta,e7],eV[9]=ta,eV[10]=e7,eV[11]=eZ,eV[12]=e0,eV[13]=eJ.activePanel,eV[14]=eJ.cityName,eV[15]=eJ.month,eV[16]=eJ.selectedTool,eV[17]=eJ.speed,eV[18]=eJ.stats.demand,eV[19]=eJ.stats.education,eV[20]=eJ.stats.environment,eV[21]=eJ.stats.expenses,eV[22]=eJ.stats.happiness,eV[23]=eJ.stats.health,eV[24]=eJ.stats.income,eV[25]=eJ.stats.money,eV[26]=eJ.stats.population,eV[27]=eJ.stats.safety,eV[28]=eJ.year,eV[29]=h,eV[30]=u):(h=eV[29],u=eV[30]),(0,l.useEffect)(h,u),eV[31]!==eJ.selectedTool?(f=()=>{lF({type:"event.toolChanged",payload:{tool:eJ.selectedTool}})},m=[eJ.selectedTool],eV[31]=eJ.selectedTool,eV[32]=f,eV[33]=m):(f=eV[32],m=eV[33]),(0,l.useEffect)(f,m),eV[34]!==e0?(g=()=>{lF({type:"event.selectionChanged",payload:e0?{x:e0.x,y:e0.y}:null})},p=[e0],eV[34]=e0,eV[35]=g,eV[36]=p):(g=eV[35],p=eV[36]),(0,l.useEffect)(g,p),eV[37]!==eH||eV[38]!==eQ||eV[39]!==eU||eV[40]!==eJ.gridSize?(x=()=>{var e;let t;return e=e=>{let t=e.payload&&"object"==typeof e.payload?e.payload:null;switch(e.type){case"tool.set":{let e=t?.tool;"string"==typeof e&&e in j&&eU(e);break}case"speed.set":{let e=t?.speed;(0===e||1===e||2===e||3===e)&&eQ(e);break}case"panel.set":{let e=t?.panel;("none"===e||"budget"===e||"statistics"===e||"advisors"===e||"settings"===e)&&eH(e);break}case"overlay.set":{let e=t?.mode;"string"==typeof e&&l0.includes(e)&&eK(e);break}case"selection.set":{let e=t?.x,r=t?.y;if("number"==typeof e&&"number"==typeof r){let t=Math.round(e),a=Math.round(r);t>=0&&a>=0&&t<eJ.gridSize&&a<eJ.gridSize&&e1({x:t,y:a})}break}case"selection.clear":e1(null)}},lD(),t=t=>{let r=t.detail;r?.type&&e(r)},window.addEventListener(lB,t),()=>window.removeEventListener(lB,t)},y=[eU,eQ,eH,eK,eJ.gridSize],eV[37]=eH,eV[38]=eQ,eV[39]=eU,eV[40]=eJ.gridSize,eV[41]=x,eV[42]=y):(x=eV[41],y=eV[42]),(0,l.useEffect)(x,y),eV[43]!==eZ||eV[44]!==e0||eV[45]!==eH||eV[46]!==eQ||eV[47]!==eU||eV[48]!==eJ.activePanel||eV[49]!==eJ.selectedTool||eV[50]!==eJ.speed?(b=()=>{let e=e=>{let t=e.target;"INPUT"===t.tagName||"TEXTAREA"===t.tagName||t.isContentEditable||("Escape"===e.key?"none"!==eZ?eK("none"):"none"!==eJ.activePanel?eH("none"):e0?e1(null):"select"!==eJ.selectedTool&&eU("select"):"b"===e.key||"B"===e.key?(e.preventDefault(),eU("bulldoze")):("p"===e.key||"P"===e.key)&&(e.preventDefault(),eQ(+(0===eJ.speed))))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},w=[eJ.activePanel,eJ.selectedTool,eJ.speed,e0,eH,eU,eQ,eZ],eV[43]=eZ,eV[44]=e0,eV[45]=eH,eV[46]=eQ,eV[47]=eU,eV[48]=eJ.activePanel,eV[49]=eJ.selectedTool,eV[50]=eJ.speed,eV[51]=b,eV[52]=w):(b=eV[51],w=eV[52]),(0,l.useEffect)(b,w),eV[53]!==eG||eV[54]!==eq||eV[55]!==td||eV[56]!==eD||eV[57]!==to?(v=()=>{if(to)switch(to.type){case"konami":eG(to.amount),eq(eD("Retro Cheat Activated!"),eD("Your accountants are confused but not complaining. You received $50,000!"),"trophy"),td();break;case"motherlode":eG(to.amount),eq(eD("Motherlode!"),eD("Your treasury just got a lot heavier. You received $1,000,000!"),"trophy"),td();break;case"vinnie":td()}},eV[53]=eG,eV[54]=eq,eV[55]=td,eV[56]=eD,eV[57]=to,eV[58]=v):v=eV[58],eV[59]!==eG||eV[60]!==eq||eV[61]!==td||eV[62]!==to?(_=[to,eG,eq,td],eV[59]=eG,eV[60]=eq,eV[61]=td,eV[62]=to,eV[63]=_):_=eV[63],(0,l.useEffect)(v,_);let tS=(0,l.useRef)(0),tk=!tr,tj=tk?"minimal"===ta.hudDensity?58:"full"===ta.hudDensity?112:72:0,tP=tk?"quick"===ta.toolLayout?84:74:0;eV[64]!==eG||eV[65]!==eq||eV[66]!==eD||eV[67]!==eF?(M=(e,t)=>{if(eG(e),tS.current=tS.current+1,tS.current%5==1){let r=lK[t]||(0,k.msg)("cargo");eq(eD("Cargo Delivered"),eD("A shipment of {cargoName} has arrived at the marina. +${cargoValue} trade revenue.",{cargoName:eF(r),cargoValue:e}),"ship")}},eV[64]=eG,eV[65]=eq,eV[66]=eD,eV[67]=eF,eV[68]=M):M=eV[68];let tT=M;if(e6||e8){let e,t,r,a,n,l,o,s,c,d,h,u,f,m,g,p;eV[69]!==ta||eV[70]!==eW||eV[71]!==e0||eV[72]!==tk||eV[73]!==eJ.grid||eV[74]!==eJ.selectedTool||eV[75]!==eJ.services?(e=tk&&(0,i.jsx)(t8,{selectedTile:e0&&"select"===eJ.selectedTool?eJ.grid[e0.y][e0.x]:null,services:eJ.services,onCloseTile:()=>e1(null),onShare:()=>tn(!0),onExit:eW,hudDensity:ta.hudDensity}),eV[69]=ta,eV[70]=eW,eV[71]=e0,eV[72]=tk,eV[73]=eJ.grid,eV[74]=eJ.selectedTool,eV[75]=eJ.services,eV[76]=e):e=eV[76],eV[77]!==tl||eV[78]!==ti?(t=tl&&(0,i.jsx)(rA,{open:ti,onOpenChange:tn}),eV[77]=tl,eV[78]=ti,eV[79]=t):t=eV[79];let x=`${tj}px`,y=`${tP}px`;return eV[80]!==x||eV[81]!==y?(r={paddingTop:x,paddingBottom:y},eV[80]=x,eV[81]=y,eV[82]=r):r=eV[82],eV[83]===Symbol.for("react.memo_cache_sentinel")?(a=()=>e5(null),eV[83]=a):a=eV[83],eV[84]!==tT||eV[85]!==e2||eV[86]!==eZ||eV[87]!==e0?(n=(0,i.jsx)(lJ,{overlayMode:eZ,selectedTile:e0,setSelectedTile:e1,isMobile:!0,navigationTarget:e2,onNavigationComplete:a,onViewportChange:e4,onBargeDelivery:tT}),eV[84]=tT,eV[85]=e2,eV[86]=eZ,eV[87]=e0,eV[88]=n):n=eV[88],eV[89]!==ta||eV[90]!==tk||eV[91]!==e3?(l=tk&&ta.showMinimap&&(0,i.jsx)(aO,{compact:!0,onNavigate:(e,t)=>e5({x:e,y:t}),viewport:e3}),eV[89]=ta,eV[90]=tk,eV[91]=e3,eV[92]=l):l=eV[92],eV[93]!==ty||eV[94]!==tb||eV[95]!==tg||eV[96]!==tx||eV[97]!==tp?(o=tg&&(0,i.jsx)("div",{className:"absolute top-2 right-2 z-20",children:(0,i.jsxs)("div",{className:"bg-slate-900/90 border border-slate-700 rounded-lg px-2 py-1.5 shadow-lg",children:[(0,i.jsx)("div",{className:"flex items-center gap-1.5 text-xs text-white",children:tp&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:"font-mono tracking-wider",children:tp}),(0,i.jsx)("button",{onClick:tb,className:"p-0.5 hover:bg-white/10 rounded transition-colors",title:"Copy invite link",children:ty?(0,i.jsx)(rY.A,{className:"w-3 h-3 text-green-400"}):(0,i.jsx)(rX.A,{className:"w-3 h-3 text-slate-400"})})]})}),tx.length>0&&(0,i.jsx)("div",{className:"mt-1 space-y-0.5",children:tx.map(l5)})]})}),eV[93]=ty,eV[94]=tb,eV[95]=tg,eV[96]=tx,eV[97]=tp,eV[98]=o):o=eV[98],eV[99]!==r||eV[100]!==n||eV[101]!==l||eV[102]!==o?(s=(0,i.jsxs)("div",{className:"flex-1 relative overflow-hidden",style:r,children:[n,l,o]}),eV[99]=r,eV[100]=n,eV[101]=l,eV[102]=o,eV[103]=s):s=eV[103],eV[104]!==ta||eV[105]!==eZ||eV[106]!==eH||eV[107]!==tk?(c=tk&&(0,i.jsx)(tI,{onOpenPanel:e=>eH(e),overlayMode:eZ,setOverlayMode:eK,toolLayout:ta.toolLayout}),eV[104]=ta,eV[105]=eZ,eV[106]=eH,eV[107]=tk,eV[108]=c):c=eV[108],eV[109]!==tk||eV[110]!==eJ.activePanel?(d=tk&&"budget"===eJ.activePanel&&(0,i.jsx)(r6,{}),eV[109]=tk,eV[110]=eJ.activePanel,eV[111]=d):d=eV[111],eV[112]!==tk||eV[113]!==eJ.activePanel?(h=tk&&"statistics"===eJ.activePanel&&(0,i.jsx)(aa,{}),eV[112]=tk,eV[113]=eJ.activePanel,eV[114]=h):h=eV[114],eV[115]!==tk||eV[116]!==eJ.activePanel?(u=tk&&"advisors"===eJ.activePanel&&(0,i.jsx)(aT,{}),eV[115]=tk,eV[116]=eJ.activePanel,eV[117]=u):u=eV[117],eV[118]!==tk||eV[119]!==eJ.activePanel?(f=tk&&"settings"===eJ.activePanel&&(0,i.jsx)(aM,{}),eV[118]=tk,eV[119]=eJ.activePanel,eV[120]=f):f=eV[120],eV[121]!==tc||eV[122]!==ts?(m=(0,i.jsx)(rc,{open:ts,onOpenChange:tc}),eV[121]=tc,eV[122]=ts,eV[123]=m):m=eV[123],eV[124]!==th||eV[125]!==tu||eV[126]!==tf||eV[127]!==tm||eV[128]!==tk?(g=tk&&(0,i.jsx)(rP,{message:th||"",isVisible:tu,onContinue:tf,onSkipAll:tm}),eV[124]=th,eV[125]=tu,eV[126]=tf,eV[127]=tm,eV[128]=tk,eV[129]=g):g=eV[129],eV[130]!==e||eV[131]!==t||eV[132]!==s||eV[133]!==c||eV[134]!==d||eV[135]!==h||eV[136]!==u||eV[137]!==f||eV[138]!==m||eV[139]!==g?(p=(0,i.jsx)(rr,{children:(0,i.jsxs)("div",{className:"w-full h-full overflow-hidden bg-background flex flex-col",children:[e,t,s,c,d,h,u,f,m,g]})}),eV[130]=e,eV[131]=t,eV[132]=s,eV[133]=c,eV[134]=d,eV[135]=h,eV[136]=u,eV[137]=f,eV[138]=m,eV[139]=g,eV[140]=p):p=eV[140],p}eV[141]!==eW?(S=(0,i.jsx)(r2,{onExit:eW}),eV[141]=eW,eV[142]=S):S=eV[142],eV[143]===Symbol.for("react.memo_cache_sentinel")?(P=(0,i.jsx)(aD,{}),T=(0,i.jsx)(aW,{}),eV[143]=P,eV[144]=T):(P=eV[143],T=eV[144]),eV[145]===Symbol.for("react.memo_cache_sentinel")?(C=()=>e5(null),eV[145]=C):C=eV[145],eV[146]!==tT||eV[147]!==e2||eV[148]!==eZ||eV[149]!==e0?(N=(0,i.jsx)(lJ,{overlayMode:eZ,selectedTile:e0,setSelectedTile:e1,navigationTarget:e2,onNavigationComplete:C,onViewportChange:e4,onBargeDelivery:tT}),eV[146]=tT,eV[147]=e2,eV[148]=eZ,eV[149]=e0,eV[150]=N):N=eV[150],eV[151]!==eZ?(z=(0,i.jsx)(rq,{overlayMode:eZ,setOverlayMode:eK}),eV[151]=eZ,eV[152]=z):z=eV[152],eV[153]===Symbol.for("react.memo_cache_sentinel")?(I=(e,t)=>e5({x:e,y:t}),eV[153]=I):I=eV[153],eV[154]!==e3?(R=(0,i.jsx)(aO,{onNavigate:I,viewport:e3}),eV[154]=e3,eV[155]=R):R=eV[155],eV[156]!==ty||eV[157]!==tb||eV[158]!==tg||eV[159]!==tx||eV[160]!==tp?(Y=tg&&(0,i.jsx)("div",{className:"absolute top-4 right-4 z-20",children:(0,i.jsxs)("div",{className:"bg-slate-900/90 border border-slate-700 rounded-lg px-3 py-2 shadow-lg min-w-[120px]",children:[(0,i.jsx)("div",{className:"flex items-center gap-2 text-sm text-white",children:tp&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:"font-mono font-medium tracking-wider",children:tp}),(0,i.jsx)("button",{onClick:tb,className:"p-1 hover:bg-white/10 rounded transition-colors",title:"Copy invite link",children:ty?(0,i.jsx)(rY.A,{className:"w-3.5 h-3.5 text-green-400"}):(0,i.jsx)(rX.A,{className:"w-3.5 h-3.5 text-slate-400 hover:text-white"})})]})}),tx.length>0&&(0,i.jsx)("div",{className:"mt-1.5 space-y-0.5",children:tx.map(l2)})]})}),eV[156]=ty,eV[157]=tb,eV[158]=tg,eV[159]=tx,eV[160]=tp,eV[161]=Y):Y=eV[161],eV[162]!==N||eV[163]!==z||eV[164]!==R||eV[165]!==Y?(X=(0,i.jsxs)("div",{className:"flex-1 flex flex-col ml-56",children:[P,T,(0,i.jsxs)("div",{className:"flex-1 relative overflow-visible",children:[N,z,R,Y]})]}),eV[162]=N,eV[163]=z,eV[164]=R,eV[165]=Y,eV[166]=X):X=eV[166],eV[167]!==eJ.activePanel?(A="budget"===eJ.activePanel&&(0,i.jsx)(r6,{}),eV[167]=eJ.activePanel,eV[168]=A):A=eV[168],eV[169]!==eJ.activePanel?(O="statistics"===eJ.activePanel&&(0,i.jsx)(aa,{}),eV[169]=eJ.activePanel,eV[170]=O):O=eV[170],eV[171]!==eJ.activePanel?(E="advisors"===eJ.activePanel&&(0,i.jsx)(aT,{}),eV[171]=eJ.activePanel,eV[172]=E):E=eV[172],eV[173]!==eJ.activePanel?($="settings"===eJ.activePanel&&(0,i.jsx)(aM,{}),eV[173]=eJ.activePanel,eV[174]=$):$=eV[174],eV[175]!==tc||eV[176]!==ts?(B=(0,i.jsx)(rc,{open:ts,onOpenChange:tc}),eV[175]=tc,eV[176]=ts,eV[177]=B):B=eV[177],eV[178]===Symbol.for("react.memo_cache_sentinel")?(L=(0,i.jsx)(rb,{}),eV[178]=L):L=eV[178];let tC=th||"";return eV[179]!==tu||eV[180]!==tf||eV[181]!==tm||eV[182]!==tC?(V=(0,i.jsx)(rP,{message:tC,isVisible:tu,onContinue:tf,onSkipAll:tm}),eV[179]=tu,eV[180]=tf,eV[181]=tm,eV[182]=tC,eV[183]=V):V=eV[183],eV[184]!==S||eV[185]!==X||eV[186]!==A||eV[187]!==O||eV[188]!==E||eV[189]!==$||eV[190]!==B||eV[191]!==V?(W=(0,i.jsx)(rr,{children:(0,i.jsxs)("div",{className:"w-full h-full min-h-[720px] overflow-hidden bg-background flex",children:[S,X,A,O,E,$,B,L,V]})}),eV[184]=S,eV[185]=X,eV[186]=A,eV[187]=O,eV[188]=E,eV[189]=$,eV[190]=B,eV[191]=V,eV[192]=W):W=eV[192],W}function l2(e){return(0,i.jsxs)("div",{className:"flex items-center gap-1.5 text-xs text-slate-400",children:[(0,i.jsx)("span",{className:"w-2 h-2 rounded-full bg-green-500"}),e.name]},e.id)}function l5(e){return(0,i.jsxs)("div",{className:"flex items-center gap-1 text-[10px] text-slate-400",children:[(0,i.jsx)("span",{className:"w-1.5 h-1.5 rounded-full bg-green-500"}),e.name]},e.id)}function l3(){lD(),lF({type:"host.ready",payload:{app:"isocity",version:1}})}var l4=r(7274),l9=r(4372);function l6({open:e,onOpenChange:t,onStartGame:r,currentGameState:a,pendingRoomCode:n}){let o=(0,k.useGT)(),[s,c]=(0,l.useState)("select"),[d,h]=(0,l.useState)(o("My Co-op City")),[u,m]=(0,l.useState)(""),[g,p]=(0,l.useState)(!1),[x,y]=(0,l.useState)(!1),[b,w]=(0,l.useState)(!1),[v,_]=(0,l.useState)(!1),[M,S]=(0,l.useState)(null),{connectionState:j,roomCode:P,players:T,error:C,createRoom:N,joinRoom:z,leaveRoom:I,initialState:Y}=e7();(0,l.useEffect)(()=>{e&&n&&!b&&(w(!0),y(!0),z(n).then(()=>{window.history.replaceState({},"",`/coop/${n.toUpperCase()}`),y(!1),_(!0)}).catch(e=>{console.error("Failed to auto-join room:",e),y(!1),S(e instanceof Error?e.message:o("Failed to join room"))}))},[e,n,b,z]),(0,l.useEffect)(()=>{e||((v||b&&!Y)&&I(),c("select"),y(!1),p(!1),w(!1),_(!1),S(null))},[e,v,b,Y,I]);let X=async()=>{if(d.trim()){y(!0);try{let e=a?{...a,cityName:d}:H(R,d),i=await N(d,e);window.history.replaceState({},"",`/coop/${i}`),r(!0,e,i),t(!1)}catch(e){console.error("Failed to create room:",e)}finally{y(!1)}}},A=async()=>{if(u.trim()&&5===u.length){y(!0);try{await z(u),window.history.replaceState({},"",`/coop/${u.toUpperCase()}`),y(!1),_(!0)}catch(e){console.error("Failed to join room:",e),y(!1)}}};(0,l.useEffect)(()=>{v&&Y&&(_(!1),r(!1,Y,P||u.toUpperCase()||n?.toUpperCase()||void 0),t(!1))},[v,Y,r,t,P,u,n]),(0,l.useEffect)(()=>{if(!v)return;let e=setTimeout(()=>{v&&!Y&&(console.error("[CoopModal] Timeout waiting for state"),_(!1),I())},15e3);return()=>clearTimeout(e)},[v,Y,I]);let O=()=>{P&&I(),c("select")};return M?(0,i.jsx)(tB,{open:e,onOpenChange:t,children:(0,i.jsxs)(tW,{className:"sm:max-w-md bg-slate-900 border-slate-700 text-white",children:[(0,i.jsxs)(tD,{children:[(0,i.jsxs)(tJ,{className:"text-2xl font-light text-white flex items-center gap-2",children:[(0,i.jsx)(l4.A,{className:"w-6 h-6 text-red-400"}),(0,i.jsx)(k.T,{children:"Could Not Join Room"})]}),(0,i.jsx)(tU,{className:"text-slate-400",children:"Room not found"===M?(0,i.jsx)(k.T,{children:"This room doesn't exist or may have expired."}):(0,i.jsx)(k.T,{children:"There was a problem connecting to the room. This may be due to network issues or server limits."})})]}),(0,i.jsxs)("div",{className:"flex flex-col gap-3 mt-4",children:[n&&(0,i.jsx)(f,{onClick:()=>{S(null),w(!1),y(!0),z(n).then(()=>{window.history.replaceState({},"",`/coop/${n.toUpperCase()}`),y(!1),_(!0)}).catch(e=>{y(!1),S(e instanceof Error?e.message:o("Failed to join room"))})},className:"w-full py-4 text-base font-light bg-white/10 hover:bg-white/20 text-white border border-white/20 rounded-none",children:(0,i.jsx)(k.T,{children:"Try Again"})}),(0,i.jsx)(f,{onClick:()=>{S(null),c("create")},variant:"outline",className:"w-full py-4 text-base font-light bg-transparent hover:bg-white/10 text-white/70 hover:text-white border border-white/15 rounded-none",children:(0,i.jsx)(k.T,{children:"Create New City"})}),(0,i.jsx)(f,{onClick:()=>{S(null),c("join")},variant:"outline",className:"w-full py-4 text-base font-light bg-transparent hover:bg-white/10 text-white/70 hover:text-white border border-white/15 rounded-none",children:(0,i.jsx)(k.T,{children:"Join Different Room"})}),(0,i.jsx)(f,{onClick:()=>{window.location.href="/"},variant:"ghost",className:"w-full py-4 text-base font-light text-slate-500 hover:text-white hover:bg-transparent",children:(0,i.jsx)(k.T,{children:"Go to Homepage"})})]}),(0,i.jsx)("p",{className:"text-xs text-slate-600 text-center mt-2",children:(0,i.jsxs)(k.T,{children:["Room code: ",(0,i.jsx)(k.Var,{children:n})]})})]})}):b&&(x||v)?(0,i.jsx)(tB,{open:e,onOpenChange:t,children:(0,i.jsxs)(tW,{className:"sm:max-w-md bg-slate-900 border-slate-700 text-white","aria-describedby":void 0,children:[(0,i.jsx)(rm.bL,{children:(0,i.jsx)(tJ,{children:(0,i.jsx)(k.T,{children:"Joining Co-op City"})})}),(0,i.jsx)(f,{type:"button",variant:"ghost",size:"icon",onClick:e=>{e.stopPropagation(),_(!1),y(!1),I(),window.history.replaceState({},"","/"),c("select")},className:"absolute left-4 top-4 z-50 text-slate-400 hover:text-white hover:bg-slate-800","aria-label":o("Back"),children:(0,i.jsx)(l9.A,{className:"w-5 h-5"})}),(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center py-8",children:[(0,i.jsx)(rR.A,{className:"w-8 h-8 animate-spin text-slate-400 mb-4"}),(0,i.jsx)(k.T,{children:(0,i.jsx)("p",{className:"text-slate-300",children:"Joining city..."})}),(0,i.jsx)(k.T,{children:(0,i.jsx)("p",{className:"text-slate-500 text-sm mt-1",children:"Waiting for game state"})})]})]})}):"select"===s?(0,i.jsx)(tB,{open:e,onOpenChange:t,children:(0,i.jsxs)(tW,{className:"sm:max-w-md bg-slate-900 border-slate-700 text-white",children:[(0,i.jsxs)(tD,{children:[(0,i.jsx)(tJ,{className:"text-2xl font-light text-white",children:(0,i.jsx)(k.T,{children:"Co-op Multiplayer"})}),(0,i.jsx)(tU,{className:"text-slate-400",children:(0,i.jsx)(k.T,{children:"Build a city together with friends in real-time"})})]}),(0,i.jsxs)("div",{className:"flex flex-col gap-3 mt-4",children:[(0,i.jsx)(f,{onClick:()=>c("create"),className:"w-full py-6 text-lg font-light bg-white/10 hover:bg-white/20 text-white border border-white/20 rounded-none",children:(0,i.jsx)(k.T,{children:"Create City"})}),(0,i.jsx)(f,{onClick:()=>c("join"),variant:"outline",className:"w-full py-6 text-lg font-light bg-transparent hover:bg-white/10 text-white/70 hover:text-white border border-white/15 rounded-none",children:(0,i.jsx)(k.T,{children:"Join City"})})]})]})}):"create"===s?(0,i.jsx)(tB,{open:e,onOpenChange:t,children:(0,i.jsxs)(tW,{className:"sm:max-w-md bg-slate-900 border-slate-700 text-white",children:[(0,i.jsxs)(tD,{children:[(0,i.jsx)(tJ,{className:"text-2xl font-light text-white",children:(0,i.jsx)(k.T,{children:"Create Co-op City"})}),(0,i.jsx)(tU,{className:"text-slate-400",children:P?(0,i.jsx)(k.T,{children:"Share the invite code with friends"}):(0,i.jsx)(k.T,{children:"Set up your co-op city"})})]}),P?(0,i.jsxs)("div",{className:"flex flex-col gap-4 mt-4",children:[(0,i.jsxs)("div",{className:"bg-slate-800 rounded-lg p-6 text-center",children:[(0,i.jsx)(k.T,{children:(0,i.jsx)("p",{className:"text-slate-400 text-sm mb-2",children:"Invite Code"})}),(0,i.jsx)("p",{className:"text-4xl font-mono font-bold tracking-widest text-white",children:(0,i.jsx)(k.T,{children:(0,i.jsx)(k.Var,{children:P})})})]}),(0,i.jsx)(f,{onClick:()=>{if(!P)return;let e=`${window.location.origin}/coop/${P}`;navigator.clipboard.writeText(e),p(!0),setTimeout(()=>p(!1),2e3)},variant:"outline",className:"w-full bg-transparent hover:bg-white/10 text-white border-white/20 rounded-none",children:g?(0,i.jsxs)(k.T,{children:[(0,i.jsx)(rY.A,{className:"w-4 h-4 mr-2"}),"Copied!"]}):(0,i.jsxs)(k.T,{children:[(0,i.jsx)(rX.A,{className:"w-4 h-4 mr-2"}),"Copy Invite Link"]})}),T.length>0&&(0,i.jsxs)("div",{className:"bg-slate-800/50 rounded-lg p-4",children:[(0,i.jsx)(k.T,{children:(0,i.jsx)("p",{className:"text-slate-400 text-sm mb-2",children:(0,i.jsx)(k.Plural,{n:T.length,one:(0,i.jsx)(i.Fragment,{children:"1 player"}),other:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(k.Var,{children:T.length})," players"]})})})}),(0,i.jsx)("div",{className:"space-y-1",children:T.map(e=>(0,i.jsx)("div",{className:"text-sm text-white",children:(0,i.jsx)(k.T,{children:(0,i.jsx)(k.Var,{children:e.name})})},e.id))})]}),(0,i.jsx)(f,{onClick:()=>t(!1),className:"w-full mt-2 bg-slate-700 hover:bg-slate-600 text-white border border-slate-600 rounded-md",children:(0,i.jsx)(k.T,{children:"Continue Playing"})})]}):(0,i.jsxs)("div",{className:"flex flex-col gap-4 mt-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(r4,{htmlFor:"cityName",className:"text-slate-300",children:(0,i.jsx)(k.T,{children:"City Name"})}),(0,i.jsx)(rd,{id:"cityName",value:d,onChange:e=>h(e.target.value),placeholder:o("My Co-op City"),className:"bg-slate-800 border-slate-600 text-white placeholder:text-slate-500"})]}),C&&(0,i.jsxs)("div",{className:"flex items-center gap-2 text-red-400 text-sm",children:[(0,i.jsx)(l4.A,{className:"w-4 h-4"}),(0,i.jsx)(k.T,{children:(0,i.jsx)(k.Var,{children:C})})]}),(0,i.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,i.jsx)(f,{onClick:O,variant:"outline",className:"flex-1 bg-transparent hover:bg-white/10 text-white/70 border-white/20 rounded-none",children:(0,i.jsx)(k.T,{children:"Back"})}),(0,i.jsx)(f,{onClick:X,disabled:x||!d.trim(),className:"flex-1 bg-white/10 hover:bg-white/20 text-white border border-white/20 rounded-none",children:x?(0,i.jsxs)(k.T,{children:[(0,i.jsx)(rR.A,{className:"w-4 h-4 mr-2 animate-spin"}),"Creating..."]}):(0,i.jsx)(k.T,{children:"Create City"})})]})]})]})}):(0,i.jsx)(tB,{open:e,onOpenChange:t,children:(0,i.jsxs)(tW,{className:"sm:max-w-md bg-slate-900 border-slate-700 text-white",children:[(0,i.jsxs)(tD,{children:[(0,i.jsx)(tJ,{className:"text-2xl font-light text-white",children:(0,i.jsx)(k.T,{children:"Join Co-op City"})}),(0,i.jsx)(tU,{className:"text-slate-400",children:(0,i.jsx)(k.T,{children:"Enter the 5-character invite code to join"})})]}),(0,i.jsxs)("div",{className:"flex flex-col gap-4 mt-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(r4,{htmlFor:"joinCode",className:"text-slate-300",children:(0,i.jsx)(k.T,{children:"Invite Code"})}),(0,i.jsx)(rd,{id:"joinCode",value:u,onChange:e=>m(e.target.value.toUpperCase().slice(0,5)),placeholder:o("ABCDE"),maxLength:5,className:"bg-slate-800 border-slate-600 text-white text-center text-2xl font-mono tracking-widest placeholder:text-slate-500"})]}),C&&(0,i.jsxs)("div",{className:"flex items-center gap-2 text-red-400 text-sm",children:[(0,i.jsx)(l4.A,{className:"w-4 h-4"}),(0,i.jsx)(k.T,{children:(0,i.jsx)(k.Var,{children:C})})]}),"connecting"===j&&!v&&(0,i.jsxs)("div",{className:"flex items-center justify-center gap-2 text-sm text-slate-400",children:[(0,i.jsx)(rR.A,{className:"w-4 h-4 animate-spin"}),(0,i.jsx)(k.T,{children:"Connecting..."})]}),v&&(0,i.jsxs)("div",{className:"bg-slate-800/50 rounded-lg p-4 text-center",children:[(0,i.jsx)(rR.A,{className:"w-6 h-6 animate-spin mx-auto mb-2 text-slate-400"}),(0,i.jsx)(k.T,{children:(0,i.jsx)("p",{className:"text-slate-300 text-sm",children:"Connecting..."})}),(0,i.jsx)(k.T,{children:(0,i.jsx)("p",{className:"text-slate-500 text-xs mt-1",children:"Waiting for game state"})})]}),(0,i.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,i.jsx)(f,{onClick:O,variant:"outline",className:"flex-1 bg-transparent hover:bg-white/10 text-white/70 border-white/20 rounded-none",children:(0,i.jsx)(k.T,{children:"Back"})}),(0,i.jsx)(f,{onClick:A,disabled:x||5!==u.length,className:"flex-1 bg-white/10 hover:bg-white/20 text-white border border-white/20 rounded-none",children:x?(0,i.jsxs)(k.T,{children:[(0,i.jsx)(rR.A,{className:"w-4 h-4 mr-2 animate-spin"}),"Joining..."]}):(0,i.jsx)(k.T,{children:"Join City"})})]})]})]})})}let l8="isocity-game-state",l7="isocity-saved-cities-index";function oe(){try{let e=localStorage.getItem(l8);if(e){let t=(0,m.decompressFromUTF16)(e);if(!t||!t.startsWith("{"))if(!e.startsWith("{"))return!1;else t=e;let r=JSON.parse(t);return r.grid&&r.gridSize&&r.stats}}catch{}return!1}function ot(){try{let e=localStorage.getItem(l7);if(e){let t=JSON.parse(e);if(Array.isArray(t))return t}}catch{}return[]}function or(e,t){try{let r=ot(),a={id:e.id||`city-${Date.now()}`,cityName:e.cityName||"Co-op City",population:e.stats.population,money:e.stats.money,year:e.year,month:e.month,gridSize:e.gridSize,savedAt:Date.now(),roomCode:t},i=r.findIndex(e=>e.id===a.id||t&&e.roomCode===t);i>=0?r[i]=a:r.unshift(a);let n=r.slice(0,20);localStorage.setItem(l7,JSON.stringify(n))}catch(e){console.error("Failed to save city to index:",e)}}function oa(e){let t,r,a,o,s,c,d,h,u=(0,n.c)(21),{count:f,cols:m,cellSize:g}=e,p=void 0===f?16:f,x=void 0===m?4:m,y=void 0===g?120:g,b=(0,l.useRef)(null),[w,v]=(0,l.useState)(null);u[0]===Symbol.for("react.memo_cache_sentinel")?(t=ep(eg),u[0]=t):t=u[0];let _=t;if(u[1]!==p){let e;u[3]===Symbol.for("react.memo_cache_sentinel")?(e=e=>Object.values(_.buildingToSprite).includes(e),u[3]=e):e=u[3],r=(function(e){let t=[...e];for(let e=t.length-1;e>0;e--){let r=Math.floor(Math.random()*(e+1));[t[e],t[r]]=[t[r],t[e]]}return t})([..._.spriteOrder.filter(e)]).slice(0,p),u[1]=p,u[2]=r}else r=u[2];let M=r;u[4]===Symbol.for("react.memo_cache_sentinel")?(a=()=>{let e=new Image;e.onload=()=>{v(function(e){let t=document.createElement("canvas");t.width=e.naturalWidth||e.width,t.height=e.naturalHeight||e.height;let r=t.getContext("2d");if(!r)return t;r.drawImage(e,0,0);let a=r.getImageData(0,0,t.width,t.height),i=a.data;for(let e=0;e<i.length;e+=4)155>=Math.sqrt(Math.pow(i[e]-255,2)+Math.pow(i[e+1]-0,2)+Math.pow(i[e+2]-0,2))&&(i[e+3]=0);return r.putImageData(a,0,0),t}(e))},e.src=_.src},o=[_.src],u[4]=a,u[5]=o):(a=u[4],o=u[5]),(0,l.useEffect)(a,o);e:{let e;if(!w){let e;u[6]===Symbol.for("react.memo_cache_sentinel")?(e=[],u[6]=e):e=u[6],s=e;break e}let t=w.width,r=w.height;if(u[7]!==M||u[8]!==r||u[9]!==t){let a;u[11]!==r||u[12]!==t?(a=e=>{let a=ev(Object.entries(_.buildingToSprite).find(t=>{let[,r]=t;return r===e})?.[0]||e,t,r,_);return a?{spriteKey:e,coords:a}:null},u[11]=r,u[12]=t,u[13]=a):a=u[13],e=M.map(a).filter(oi),u[7]=M,u[8]=r,u[9]=t,u[10]=e}else e=u[10];s=e}let S=s;return u[14]!==y||u[15]!==x||u[16]!==w||u[17]!==S?(d=()=>{let e=b.current;if(!e||!w||0===S.length)return;let t=e.getContext("2d",{alpha:!0});if(!t)return;let r=window.devicePixelRatio||1,a=Math.ceil(S.length/x),i=x*y,n=a*y;e.width=i*r,e.height=n*r,e.style.width=`${i}px`,e.style.height=`${n}px`,t.scale(r,r),t.imageSmoothingEnabled=!1,t.clearRect(0,0,i,n),S.forEach((e,r)=>{let{coords:a}=e,i=r%x*y,n=Math.floor(r/x)*y;t.fillStyle="rgba(255, 255, 255, 0.03)",t.strokeStyle="rgba(255, 255, 255, 0.08)",t.lineWidth=1,t.beginPath(),t.roundRect(i+2,n+2,y-4,y-4,4),t.fill(),t.stroke();let l=y-20,o=a.sh/a.sw,s=l,c=s*o;c>l&&(s=(c=l)/o);let d=i+(y-s)/2,h=n+(y-c)/2+.1*c;t.drawImage(w,a.sx,a.sy,a.sw,a.sh,Math.round(d),Math.round(h),Math.round(s),Math.round(c))})},c=[w,S,x,y],u[14]=y,u[15]=x,u[16]=w,u[17]=S,u[18]=c,u[19]=d):(c=u[18],d=u[19]),(0,l.useEffect)(d,c),u[20]===Symbol.for("react.memo_cache_sentinel")?(h=(0,i.jsx)("canvas",{ref:b,className:"opacity-80 hover:opacity-100 transition-opacity",style:{imageRendering:"pixelated"}}),u[20]=h):h=u[20],h}function oi(e){return null!==e}function on(e){let t,r,a,l,o,s,c,d,h,u,f,m,g=(0,n.c)(30),{city:p,onLoad:x,onDelete:y}=e;return g[0]!==p.cityName?(t=(0,i.jsx)("h3",{className:"text-white font-medium truncate group-hover:text-white/90 text-sm flex-1",children:p.cityName}),g[0]=p.cityName,g[1]=t):t=g[1],g[2]!==p.roomCode?(r=p.roomCode&&(0,i.jsx)("span",{className:"text-xs px-1.5 py-0.5 bg-blue-500/20 text-blue-300 rounded shrink-0",children:"Co-op"}),g[2]=p.roomCode,g[3]=r):r=g[3],g[4]!==t||g[5]!==r?(a=(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[t,r]}),g[4]=t,g[5]=r,g[6]=a):a=g[6],g[7]!==p.population?(l=p.population.toLocaleString(),g[7]=p.population,g[8]=l):l=g[8],g[9]!==l?(o=(0,i.jsxs)("span",{children:["Pop: ",l]}),g[9]=l,g[10]=o):o=g[10],g[11]!==p.money?(s=p.money.toLocaleString(),g[11]=p.money,g[12]=s):s=g[12],g[13]!==s?(c=(0,i.jsxs)("span",{children:["$",s]}),g[13]=s,g[14]=c):c=g[14],g[15]!==p.roomCode?(d=p.roomCode&&(0,i.jsx)("span",{className:"text-blue-400/60",children:p.roomCode}),g[15]=p.roomCode,g[16]=d):d=g[16],g[17]!==o||g[18]!==c||g[19]!==d?(h=(0,i.jsxs)("div",{className:"flex items-center gap-3 mt-1 text-xs text-white/50",children:[o,c,d]}),g[17]=o,g[18]=c,g[19]=d,g[20]=h):h=g[20],g[21]!==x||g[22]!==a||g[23]!==h?(u=(0,i.jsxs)("button",{onClick:x,className:"w-full text-left p-3 pr-8 bg-white/5 hover:bg-white/10 border border-white/10 hover:border-white/20 rounded-none transition-all duration-200",children:[a,h]}),g[21]=x,g[22]=a,g[23]=h,g[24]=u):u=g[24],g[25]!==y?(f=y&&(0,i.jsx)("button",{onClick:e=>{e.stopPropagation(),y()},className:"absolute top-1/2 -translate-y-1/2 right-1.5 p-1.5 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 hover:bg-red-500/20 text-white/40 hover:text-red-400 rounded transition-all duration-200",title:"Delete city",children:(0,i.jsx)(rM.A,{className:"w-3.5 h-3.5"})}),g[25]=y,g[26]=f):f=g[26],g[27]!==u||g[28]!==f?(m=(0,i.jsxs)("div",{className:"relative group",children:[u,f]}),g[27]=u,g[28]=f,g[29]=m):m=g[29],m}let ol="isocity-city-";function oo(){let e,t,r,a,o,s,c,d,h,u,g,p,x,y,b,w,v,_,M,S,j,P,T,C=(0,n.c)(76),N="ios"!==lV().host,[z,I]=(0,l.useState)(!1),[R,Y]=(0,l.useState)(!0);C[0]===Symbol.for("react.memo_cache_sentinel")?(e=[],C[0]=e):e=C[0];let[X,A]=(0,l.useState)(e),[O,E]=(0,l.useState)(!1),[$,B]=(0,l.useState)(!1),[,L]=(0,l.useState)(!1),[V,W]=(0,l.useState)(!1),[D,F]=(0,l.useState)(null),{isMobileDevice:J,isSmallScreen:U}=tt();C[1]===Symbol.for("react.memo_cache_sentinel")?(t=()=>{requestAnimationFrame(()=>{Y(!1),A(ot()),E(oe());let e=new URLSearchParams(window.location.search).get("room");if(e&&5===e.length)return void window.location.replace(`/coop/${e.toUpperCase()}`)})},r=[],C[1]=t,C[2]=r):(t=C[1],r=C[2]),(0,l.useEffect)(t,r),C[3]===Symbol.for("react.memo_cache_sentinel")?(a=()=>{I(!1),L(!1),W(!1),A(ot()),E(oe()),window.history.replaceState({},"","/")},C[3]=a):a=C[3];let H=a;C[4]===Symbol.for("react.memo_cache_sentinel")?(o=e=>{if(e.roomCode){window.history.replaceState({},"",`/coop/${e.roomCode}`),F(e.roomCode),B(!0);return}try{let t=localStorage.getItem(ol+e.id);t&&(localStorage.setItem(l8,t),I(!0))}catch{console.error("Failed to load saved city")}},C[4]=o):o=C[4];let G=o;C[5]!==X?(s=e=>{try{let t=X.filter(t=>t.id!==e.id);localStorage.setItem(l7,JSON.stringify(t)),A(t),e.roomCode||localStorage.removeItem(ol+e.id)}catch{console.error("Failed to delete saved city")}},C[5]=X,C[6]=s):s=C[6];let q=s;C[7]===Symbol.for("react.memo_cache_sentinel")?(c=(e,t,r)=>{if(L(!0),e&&t){try{let e=(0,m.compressToUTF16)(JSON.stringify(t));localStorage.setItem(l8,e),r&&or(t,r)}catch(e){console.error("Failed to save co-op state:",e)}W(!1)}else if(e)W(!0);else if(t){try{let e=(0,m.compressToUTF16)(JSON.stringify(t));localStorage.setItem(l8,e),r&&or(t,r)}catch(e){console.error("Failed to save co-op state:",e)}W(!1)}else W(!0);I(!0)},C[7]=c):c=C[7];let Q=c;if(R){let e;return C[8]===Symbol.for("react.memo_cache_sentinel")?(e=(0,i.jsx)("main",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 flex items-center justify-center",children:(0,i.jsx)("div",{className:"text-white/60",children:(0,i.jsx)(k.T,{children:"Loading..."})})}),C[8]=e):e=C[8],e}if(z){let e,t;C[9]===Symbol.for("react.memo_cache_sentinel")?(e=(0,i.jsx)("main",{className:"h-screen w-screen overflow-hidden",children:(0,i.jsx)(l1,{onExit:H})}),C[9]=e):e=C[9];let r=e;if(!N){let e;return C[10]!==V?(e=(0,i.jsx)(eB,{startFresh:V,children:r}),C[10]=V,C[11]=e):e=C[11],e}return C[12]!==V?(t=(0,i.jsx)(e8,{children:(0,i.jsx)(eB,{startFresh:V,children:r})}),C[12]=V,C[13]=t):t=C[13],t}if(J||U){let e,t,r,a,n,l,o,s,c,d,h,u,g,p,x,y;C[14]===Symbol.for("react.memo_cache_sentinel")?(e=(0,i.jsx)("div",{className:"flex-shrink-0 h-4 sm:h-8"}),t=(0,i.jsx)("h1",{className:"text-4xl sm:text-5xl font-light tracking-wider text-white/90 mb-4 sm:mb-6 flex-shrink-0",children:"IsoCity"}),C[14]=e,C[15]=t):(e=C[14],t=C[15]),C[16]===Symbol.for("react.memo_cache_sentinel")?(r=(0,i.jsx)("div",{className:"mb-4 sm:mb-6 flex-shrink-0",children:(0,i.jsx)(oa,{count:9,cols:3,cellSize:56})}),C[16]=r):r=C[16],C[17]===Symbol.for("react.memo_cache_sentinel")?(a=()=>I(!0),C[17]=a):a=C[17],C[18]!==O?(n=(0,i.jsx)(f,{onClick:a,className:"w-full py-4 sm:py-6 text-lg sm:text-xl font-light tracking-wide bg-white/10 hover:bg-white/20 text-white border border-white/20 rounded-none transition-all duration-300",children:O?(0,i.jsx)(k.T,{children:"Continue"}):(0,i.jsx)(k.T,{children:"New Game"})}),C[18]=O,C[19]=n):n=C[19],C[20]!==N?(l=N?(0,i.jsx)(f,{onClick:()=>B(!0),variant:"outline",className:"w-full py-4 sm:py-6 text-lg sm:text-xl font-light tracking-wide bg-white/5 hover:bg-white/15 text-white/60 hover:text-white border border-white/15 rounded-none transition-all duration-300",children:(0,i.jsx)(k.T,{children:"Co-op"})}):null,C[20]=N,C[21]=l):l=C[21],C[22]===Symbol.for("react.memo_cache_sentinel")?(o=async()=>{window.location.search.includes("room=")&&(window.history.replaceState({},"","/"),F(null));let e=await fetch("/example-states/example_state_9.json"),t=await e.json();try{let e=(0,m.compressToUTF16)(JSON.stringify(t));localStorage.setItem(l8,e)}catch(e){console.error("Failed to save example state:",e)}I(!0)},C[22]=o):o=C[22],C[23]===Symbol.for("react.memo_cache_sentinel")?(s=(0,i.jsx)(f,{onClick:o,variant:"outline",className:"w-full py-4 sm:py-6 text-lg sm:text-xl font-light tracking-wide bg-transparent hover:bg-white/10 text-white/40 hover:text-white/60 border border-white/10 rounded-none transition-all duration-300",children:(0,i.jsx)(k.T,{children:"Load Example"})}),C[23]=s):s=C[23],C[24]===Symbol.for("react.memo_cache_sentinel")?(c=(0,i.jsx)("a",{href:"https://cursor.com",target:"_blank",rel:"noopener noreferrer",className:"text-left py-2 text-sm font-light tracking-wide text-white/40 hover:text-white/70 transition-colors duration-200",children:(0,i.jsx)(k.T,{children:"Made with Cursor"})}),C[24]=c):c=C[24],C[25]===Symbol.for("react.memo_cache_sentinel")?(d=(0,i.jsxs)("div",{className:"flex items-start justify-between w-full",children:[(0,i.jsxs)("div",{className:"flex flex-col",children:[c,(0,i.jsx)("a",{href:"https://github.com/amilich/isometric-city",target:"_blank",rel:"noopener noreferrer",className:"text-left py-2 text-sm font-light tracking-wide text-white/40 hover:text-white/70 transition-colors duration-200",children:(0,i.jsx)(k.T,{children:"Open GitHub"})})]}),(0,i.jsx)(t3,{variant:"ghost",className:"text-white/40 hover:text-white/70 hover:bg-white/10"})]}),C[25]=d):d=C[25],C[26]!==n||C[27]!==l?(h=(0,i.jsxs)("div",{className:"flex flex-col gap-2 sm:gap-3 w-full max-w-xs flex-shrink-0",children:[n,l,s,d]}),C[26]=n,C[27]=l,C[28]=h):h=C[28],C[29]!==q||C[30]!==X?(u=X.length>0&&(0,i.jsxs)("div",{className:"w-full max-w-xs mt-3 sm:mt-4 flex-1 min-h-0 flex flex-col",children:[(0,i.jsx)("h2",{className:"text-xs font-medium text-white/40 uppercase tracking-wider mb-2 flex-shrink-0",children:(0,i.jsx)(k.T,{children:"Saved Cities"})}),(0,i.jsx)("div",{className:"flex flex-col gap-2 flex-1 overflow-y-auto overscroll-y-contain",style:{WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:X.slice(0,5).map(e=>(0,i.jsx)(on,{city:e,onLoad:()=>G(e),onDelete:()=>q(e)},e.id))})]}),C[29]=q,C[30]=X,C[31]=u):u=C[31],C[32]===Symbol.for("react.memo_cache_sentinel")?(g=(0,i.jsx)("div",{className:"flex-shrink-0 h-2"}),C[32]=g):g=C[32],C[33]!==N||C[34]!==D||C[35]!==$?(p=N?(0,i.jsx)(l6,{open:$,onOpenChange:B,onStartGame:Q,pendingRoomCode:D}):null,C[33]=N,C[34]=D,C[35]=$,C[36]=p):p=C[36],C[37]!==h||C[38]!==u||C[39]!==p?(x=(0,i.jsxs)("main",{className:"h-[100dvh] max-h-[100dvh] bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 flex flex-col items-center px-4 pt-[max(1rem,env(safe-area-inset-top))] pb-[max(1rem,env(safe-area-inset-bottom))] overflow-y-auto",children:[e,t,r,h,u,g,p]}),C[37]=h,C[38]=u,C[39]=p,C[40]=x):x=C[40];let b=x;return C[41]!==b||C[42]!==N?(y=N?(0,i.jsx)(e8,{children:b}):b,C[41]=b,C[42]=N,C[43]=y):y=C[43],y}C[44]===Symbol.for("react.memo_cache_sentinel")?(d=(0,i.jsx)("h1",{className:"text-8xl font-light tracking-wider text-white/90",children:"IsoCity"}),C[44]=d):d=C[44],C[45]===Symbol.for("react.memo_cache_sentinel")?(h=()=>I(!0),C[45]=h):h=C[45],C[46]!==O?(u=(0,i.jsx)(f,{onClick:h,className:"w-64 py-8 text-2xl font-light tracking-wide bg-white/10 hover:bg-white/20 text-white border border-white/20 rounded-none transition-all duration-300",children:O?(0,i.jsx)(k.T,{children:"Continue"}):(0,i.jsx)(k.T,{children:"New Game"})}),C[46]=O,C[47]=u):u=C[47],C[48]!==N?(g=N?(0,i.jsx)(f,{onClick:()=>B(!0),variant:"outline",className:"w-64 py-8 text-2xl font-light tracking-wide bg-white/5 hover:bg-white/15 text-white/60 hover:text-white border border-white/15 rounded-none transition-all duration-300",children:(0,i.jsx)(k.T,{children:"Co-op"})}):null,C[48]=N,C[49]=g):g=C[49],C[50]===Symbol.for("react.memo_cache_sentinel")?(p=async()=>{window.location.search.includes("room=")&&(window.history.replaceState({},"","/"),F(null));let e=await fetch("/example-states/example_state_9.json"),t=await e.json();try{let e=(0,m.compressToUTF16)(JSON.stringify(t));localStorage.setItem(l8,e)}catch(e){console.error("Failed to save example state:",e)}I(!0)},C[50]=p):p=C[50],C[51]===Symbol.for("react.memo_cache_sentinel")?(x=(0,i.jsx)(f,{onClick:p,variant:"outline",className:"w-64 py-8 text-2xl font-light tracking-wide bg-transparent hover:bg-white/10 text-white/40 hover:text-white/60 border border-white/10 rounded-none transition-all duration-300",children:(0,i.jsx)(k.T,{children:"Load Example"})}),C[51]=x):x=C[51],C[52]===Symbol.for("react.memo_cache_sentinel")?(y=(0,i.jsx)("a",{href:"https://cursor.com",target:"_blank",rel:"noopener noreferrer",className:"text-left py-2 text-sm font-light tracking-wide text-white/40 hover:text-white/70 transition-colors duration-200",children:(0,i.jsx)(k.T,{children:"Made with Cursor"})}),C[52]=y):y=C[52],C[53]===Symbol.for("react.memo_cache_sentinel")?(b=(0,i.jsxs)("div",{className:"flex items-start justify-between w-64",children:[(0,i.jsxs)("div",{className:"flex flex-col",children:[y,(0,i.jsx)("a",{href:"https://github.com/amilich/isometric-city",target:"_blank",rel:"noopener noreferrer",className:"text-left py-2 text-sm font-light tracking-wide text-white/40 hover:text-white/70 transition-colors duration-200",children:(0,i.jsx)(k.T,{children:"Open GitHub"})})]}),(0,i.jsx)(t3,{variant:"ghost",className:"text-white/40 hover:text-white/70 hover:bg-white/10"})]}),C[53]=b):b=C[53],C[54]!==g||C[55]!==u?(w=(0,i.jsxs)("div",{className:"flex flex-col gap-3",children:[u,g,x,b]}),C[54]=g,C[55]=u,C[56]=w):w=C[56],C[57]!==q||C[58]!==X?(v=X.length>0&&(0,i.jsxs)("div",{className:"w-64",children:[(0,i.jsx)("h2",{className:"text-xs font-medium text-white/40 uppercase tracking-wider mb-2",children:(0,i.jsx)(k.T,{children:"Saved Cities"})}),(0,i.jsx)("div",{className:"flex flex-col gap-2 max-h-64 overflow-y-auto overscroll-y-contain",style:{WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:X.slice(0,5).map(e=>(0,i.jsx)(on,{city:e,onLoad:()=>G(e),onDelete:()=>q(e)},e.id))})]}),C[57]=q,C[58]=X,C[59]=v):v=C[59],C[60]!==w||C[61]!==v?(_=(0,i.jsxs)("div",{className:"flex flex-col items-center lg:items-start justify-center space-y-12",children:[d,w,v]}),C[60]=w,C[61]=v,C[62]=_):_=C[62],C[63]===Symbol.for("react.memo_cache_sentinel")?(M=(0,i.jsx)("div",{className:"flex justify-center lg:justify-end",children:(0,i.jsx)(oa,{count:16})}),C[63]=M):M=C[63],C[64]!==_?(S=(0,i.jsxs)("div",{className:"max-w-7xl w-full grid lg:grid-cols-2 gap-16 items-center",children:[_,M]}),C[64]=_,C[65]=S):S=C[65],C[66]!==N||C[67]!==D||C[68]!==$?(j=N?(0,i.jsx)(l6,{open:$,onOpenChange:B,onStartGame:Q,pendingRoomCode:D}):null,C[66]=N,C[67]=D,C[68]=$,C[69]=j):j=C[69],C[70]!==S||C[71]!==j?(P=(0,i.jsxs)("main",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 flex items-center justify-center p-8",children:[S,j]}),C[70]=S,C[71]=j,C[72]=P):P=C[72];let Z=P;return C[73]!==Z||C[74]!==N?(T=N?(0,i.jsx)(e8,{children:Z}):Z,C[73]=Z,C[74]=N,C[75]=T):T=C[75],T}},8016:(e,t,r)=>{Promise.resolve().then(r.bind(r,3302))}},e=>{e.O(0,[709,268,193,667,179,108,441,826,358],()=>e(e.s=8016)),_N_E=e.O()}]);